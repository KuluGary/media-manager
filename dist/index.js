#!/usr/bin/env node
var Kg=Object.create;var ui=Object.defineProperty;var Wg=Object.getOwnPropertyDescriptor;var Gg=Object.getOwnPropertyNames;var Qg=Object.getPrototypeOf,Jg=Object.prototype.hasOwnProperty;var li=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var Zg=(r,e)=>()=>(r&&(e=r(r=0)),e);var P=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ga=(r,e)=>{for(var t in e)ui(r,t,{get:e[t],enumerable:!0})},wd=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Gg(e))!Jg.call(r,n)&&n!==t&&ui(r,n,{get:()=>e[n],enumerable:!(s=Wg(e,n))||s.enumerable});return r};var bd=(r,e,t)=>(t=r!=null?Kg(Qg(r)):{},wd(e||!r||!r.__esModule?ui(t,"default",{value:r,enumerable:!0}):t,r)),ue=r=>wd(ui({},"__esModule",{value:!0}),r);var se={};ga(se,{__addDisposableResource:()=>Eh,__assign:()=>Si,__asyncDelegator:()=>ph,__asyncGenerator:()=>fh,__asyncValues:()=>mh,__await:()=>ps,__awaiter:()=>ah,__classPrivateFieldGet:()=>vh,__classPrivateFieldIn:()=>bh,__classPrivateFieldSet:()=>wh,__createBinding:()=>Ai,__decorate:()=>eh,__disposeResources:()=>Sh,__esDecorate:()=>rh,__exportStar:()=>uh,__extends:()=>Yd,__generator:()=>ch,__importDefault:()=>_h,__importStar:()=>yh,__makeTemplateObject:()=>gh,__metadata:()=>oh,__param:()=>th,__propKey:()=>nh,__read:()=>Da,__rest:()=>Xd,__rewriteRelativeImportExtension:()=>Th,__runInitializers:()=>sh,__setFunctionName:()=>ih,__spread:()=>lh,__spreadArray:()=>hh,__spreadArrays:()=>dh,__values:()=>Ti,default:()=>Uy});function Yd(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Na(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Xd(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t}function eh(r,e,t,s){var n=arguments.length,i=n<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,s);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(n<3?o(i):n>3?o(e,t,i):o(e,t))||i);return n>3&&i&&Object.defineProperty(e,t,i),i}function th(r,e){return function(t,s){e(t,s,r)}}function rh(r,e,t,s,n,i){function o(b){if(b!==void 0&&typeof b!="function")throw new TypeError("Function expected");return b}for(var a=s.kind,c=a==="getter"?"get":a==="setter"?"set":"value",u=!e&&r?s.static?r:r.prototype:null,l=e||(u?Object.getOwnPropertyDescriptor(u,s.name):{}),d,f=!1,p=t.length-1;p>=0;p--){var y={};for(var g in s)y[g]=g==="access"?{}:s[g];for(var g in s.access)y.access[g]=s.access[g];y.addInitializer=function(b){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(b||null))};var w=(0,t[p])(a==="accessor"?{get:l.get,set:l.set}:l[c],y);if(a==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(d=o(w.get))&&(l.get=d),(d=o(w.set))&&(l.set=d),(d=o(w.init))&&n.unshift(d)}else(d=o(w))&&(a==="field"?n.unshift(d):l[c]=d)}u&&Object.defineProperty(u,s.name,l),f=!0}function sh(r,e,t){for(var s=arguments.length>2,n=0;n<e.length;n++)t=s?e[n].call(r,t):e[n].call(r);return s?t:void 0}function nh(r){return typeof r=="symbol"?r:"".concat(r)}function ih(r,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(r,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function oh(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function ah(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(d){o(d)}}function c(l){try{u(s.throw(l))}catch(d){o(d)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})}function ch(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,n,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(s)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(s=1,n&&(i=u[0]&2?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,n=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],n=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function uh(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Ai(e,r,t)}function Ti(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Da(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var s=t.call(r),n,i=[],o;try{for(;(e===void 0||e-- >0)&&!(n=s.next()).done;)i.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=s.return)&&t.call(s)}finally{if(o)throw o.error}}return i}function lh(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Da(arguments[e]));return r}function dh(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var s=Array(r),n=0,e=0;e<t;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,n++)s[n]=i[o];return s}function hh(r,e,t){if(t||arguments.length===2)for(var s=0,n=e.length,i;s<n;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return r.concat(i||Array.prototype.slice.call(e))}function ps(r){return this instanceof ps?(this.v=r,this):new ps(r)}function fh(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(r,e||[]),n,i=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(p){return function(y){return Promise.resolve(y).then(p,d)}}function a(p,y){s[p]&&(n[p]=function(g){return new Promise(function(w,b){i.push([p,g,w,b])>1||c(p,g)})},y&&(n[p]=y(n[p])))}function c(p,y){try{u(s[p](y))}catch(g){f(i[0][3],g)}}function u(p){p.value instanceof ps?Promise.resolve(p.value.v).then(l,d):f(i[0][2],p)}function l(p){c("next",p)}function d(p){c("throw",p)}function f(p,y){p(y),i.shift(),i.length&&c(i[0][0],i[0][1])}}function ph(r){var e,t;return e={},s("next"),s("throw",function(n){throw n}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(n,i){e[n]=r[n]?function(o){return(t=!t)?{value:ps(r[n](o)),done:!1}:i?i(o):o}:i}}function mh(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Ti=="function"?Ti(r):r[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=r[i]&&function(o){return new Promise(function(a,c){o=r[i](o),n(a,c,o.done,o.value)})}}function n(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}}function gh(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function yh(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t=$a(r),s=0;s<t.length;s++)t[s]!=="default"&&Ai(e,r,t[s]);return Dy(e,r),e}function _h(r){return r&&r.__esModule?r:{default:r}}function vh(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)}function wh(r,e,t,s,n){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t}function bh(r,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof r=="function"?e===r:r.has(e)}function Eh(r,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose],t&&(n=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");n&&(s=function(){try{n.call(this)}catch(i){return Promise.reject(i)}}),r.stack.push({value:e,dispose:s,async:t})}else t&&r.stack.push({async:!0});return e}function Sh(r){function e(i){r.error=r.hasError?new Ly(i,r.error,"An error was suppressed during disposal."):i,r.hasError=!0}var t,s=0;function n(){for(;t=r.stack.pop();)try{if(!t.async&&s===1)return s=0,r.stack.push(t),Promise.resolve().then(n);if(t.dispose){var i=t.dispose.call(t.value);if(t.async)return s|=2,Promise.resolve(i).then(n,function(o){return e(o),n()})}else s|=1}catch(o){e(o)}if(s===1)return r.hasError?Promise.reject(r.error):Promise.resolve();if(r.hasError)throw r.error}return n()}function Th(r,e){return typeof r=="string"&&/^\.\.?\//.test(r)?r.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,s,n,i,o){return s?e?".jsx":".js":n&&(!i||!o)?t:n+i+"."+o.toLowerCase()+"js"}):r}var Na,Si,Ai,Dy,$a,Ly,Uy,ne=Zg(()=>{Na=function(r,e){return Na=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])},Na(r,e)};Si=function(){return Si=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++){t=arguments[s];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Si.apply(this,arguments)};Ai=Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]};Dy=Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e},$a=function(r){return $a=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},$a(r)};Ly=typeof SuppressedError=="function"?SuppressedError:function(r,e,t){var s=new Error(t);return s.name="SuppressedError",s.error=r,s.suppressed=e,s};Uy={__extends:Yd,__assign:Si,__rest:Xd,__decorate:eh,__param:th,__esDecorate:rh,__runInitializers:sh,__propKey:nh,__setFunctionName:ih,__metadata:oh,__awaiter:ah,__generator:ch,__createBinding:Ai,__exportStar:uh,__values:Ti,__read:Da,__spread:lh,__spreadArrays:dh,__spreadArray:hh,__await:ps,__asyncGenerator:fh,__asyncDelegator:ph,__asyncValues:mh,__makeTemplateObject:gh,__importStar:yh,__importDefault:_h,__classPrivateFieldGet:vh,__classPrivateFieldSet:wh,__classPrivateFieldIn:bh,__addDisposableResource:Eh,__disposeResources:Sh,__rewriteRelativeImportExtension:Th}});var Ah=P(Oi=>{"use strict";Object.defineProperty(Oi,"__esModule",{value:!0});Oi.resolveFetch=void 0;var qy=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);Oi.resolveFetch=qy});var Ba=P(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.FunctionRegion=Rt.FunctionsHttpError=Rt.FunctionsRelayError=Rt.FunctionsFetchError=Rt.FunctionsError=void 0;var ms=class extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}};Rt.FunctionsError=ms;var La=class extends ms{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}};Rt.FunctionsFetchError=La;var Ua=class extends ms{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}};Rt.FunctionsRelayError=Ua;var qa=class extends ms{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}};Rt.FunctionsHttpError=qa;var Oh;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Oh||(Rt.FunctionRegion=Oh={}))});var Rh=P(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});Ri.FunctionsClient=void 0;var By=(ne(),ue(se)),My=Ah(),gs=Ba(),Ma=class{constructor(e,{headers:t={},customFetch:s,region:n=gs.FunctionRegion.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=(0,My.resolveFetch)(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return By.__awaiter(this,arguments,void 0,function*(t,s={}){var n;let i,o;try{let{headers:a,method:c,body:u,signal:l,timeout:d}=s,f={},{region:p}=s;p||(p=this.region);let y=new URL(`${this.url}/${t}`);p&&p!=="any"&&(f["x-region"]=p,y.searchParams.set("forceFunctionRegion",p));let g;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",g=u):typeof u=="string"?(f["Content-Type"]="text/plain",g=u):typeof FormData<"u"&&u instanceof FormData?g=u:(f["Content-Type"]="application/json",g=JSON.stringify(u)):g=u;let w=l;d&&(o=new AbortController,i=setTimeout(()=>o.abort(),d),l?(w=o.signal,l.addEventListener("abort",()=>o.abort())):w=o.signal);let b=yield this.fetch(y.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),a),body:g,signal:w}).catch(U=>{throw new gs.FunctionsFetchError(U)}),A=b.headers.get("x-relay-error");if(A&&A==="true")throw new gs.FunctionsRelayError(b);if(!b.ok)throw new gs.FunctionsHttpError(b);let E=((n=b.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),x;return E==="application/json"?x=yield b.json():E==="application/octet-stream"||E==="application/pdf"?x=yield b.blob():E==="text/event-stream"?x=b:E==="multipart/form-data"?x=yield b.formData():x=yield b.text(),{data:x,error:null,response:b}}catch(a){return{data:null,error:a,response:a instanceof gs.FunctionsHttpError||a instanceof gs.FunctionsRelayError?a.context:void 0}}finally{i&&clearTimeout(i)}})}};Ri.FunctionsClient=Ma});var Fa=P(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.FunctionRegion=ht.FunctionsRelayError=ht.FunctionsHttpError=ht.FunctionsFetchError=ht.FunctionsError=ht.FunctionsClient=void 0;var Fy=Rh();Object.defineProperty(ht,"FunctionsClient",{enumerable:!0,get:function(){return Fy.FunctionsClient}});var ln=Ba();Object.defineProperty(ht,"FunctionsError",{enumerable:!0,get:function(){return ln.FunctionsError}});Object.defineProperty(ht,"FunctionsFetchError",{enumerable:!0,get:function(){return ln.FunctionsFetchError}});Object.defineProperty(ht,"FunctionsHttpError",{enumerable:!0,get:function(){return ln.FunctionsHttpError}});Object.defineProperty(ht,"FunctionsRelayError",{enumerable:!0,get:function(){return ln.FunctionsRelayError}});Object.defineProperty(ht,"FunctionRegion",{enumerable:!0,get:function(){return ln.FunctionRegion}})});var Ha=P(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});var Va=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};za.default=Va});var Ga=P(Wa=>{"use strict";Object.defineProperty(Wa,"__esModule",{value:!0});var Vy=(ne(),ue(se)),zy=Vy.__importDefault(Ha()),Ka=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(s=e.isMaybeSingle)!==null&&s!==void 0?s:!1,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");let s=this.fetch,n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,c,u;let l=null,d=null,f=null,p=i.status,y=i.statusText;if(i.ok){if(this.method!=="HEAD"){let A=await i.text();A===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?d=A:d=JSON.parse(A))}let w=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),b=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");w&&b&&b.length>1&&(f=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(l={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,f=null,p=406,y="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{let w=await i.text();try{l=JSON.parse(w),Array.isArray(l)&&i.status===404&&(d=[],l=null,p=200,y="OK")}catch{i.status===404&&w===""?(p=204,y="No Content"):l={message:w}}if(l&&this.isMaybeSingle&&(!((u=l?.details)===null||u===void 0)&&u.includes("0 rows"))&&(l=null,p=200,y="OK"),l&&this.shouldThrowOnError)throw new zy.default(l)}return{error:l,data:d,count:f,status:p,statusText:y}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,a,c,u,l,d;let f="",p=i?.cause;if(p){let y=(o=p?.message)!==null&&o!==void 0?o:"",g=(a=p?.code)!==null&&a!==void 0?a:"";f=`${(c=i?.name)!==null&&c!==void 0?c:"FetchError"}: ${i?.message}`,f+=`

Caused by: ${(u=p?.name)!==null&&u!==void 0?u:"Error"}: ${y}`,g&&(f+=` (${g})`),p?.stack&&(f+=`
${p.stack}`)}else f=(l=i?.stack)!==null&&l!==void 0?l:"";return{error:{message:`${(d=i?.name)!==null&&d!==void 0?d:"FetchError"}: ${i?.message}`,details:f,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Wa.default=Ka});var Za=P(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});var Hy=(ne(),ue(se)),Ky=Hy.__importDefault(Ga()),Qa=class extends Ky.default{select(e){let t=!1,s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){let o=i?`${i}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){let n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){let i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var a;let c=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};Ja.default=Qa});var xi=P(Xa=>{"use strict";Object.defineProperty(Xa,"__esModule",{value:!0});var Wy=(ne(),ue(se)),Gy=Wy.__importDefault(Za()),Qy=new RegExp("[,()]"),Ya=class extends Gy.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){let s=Array.from(new Set(t)).map(n=>typeof n=="string"&&Qy.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");let o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){let n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Xa.default=Ya});var rc=P(tc=>{"use strict";Object.defineProperty(tc,"__esModule",{value:!0});var Jy=(ne(),ue(se)),dn=Jy.__importDefault(xi()),ec=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=n}select(e,t){let{head:s=!1,count:n}=t??{},i=s?"HEAD":"GET",o=!1,a=(e??"*").split("").map(c=>/\s/.test(c)&&!o?"":(c==='"'&&(o=!o),c)).join("");return this.url.searchParams.set("select",a),n&&this.headers.append("Prefer",`count=${n}`),new dn.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var n;let i="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){let a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new dn.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){var o;let a="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let c=e.reduce((u,l)=>u.concat(Object.keys(l)),[]);if(c.length>0){let u=[...new Set(c)].map(l=>`"${l}"`);this.url.searchParams.set("columns",u.join(","))}}return new dn.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:t}={}){var s;let n="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new dn.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:e}={}){var t;let s="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new dn.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};tc.default=ec});var kh=P(nc=>{"use strict";Object.defineProperty(nc,"__esModule",{value:!0});var xh=(ne(),ue(se)),Zy=xh.__importDefault(rc()),Yy=xh.__importDefault(xi()),sc=class r{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=n}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");let t=new URL(`${this.url}/${e}`);return new Zy.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new r(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){var o;let a,c=new URL(`${this.url}/rpc/${e}`),u;s||n?(a=s?"HEAD":"GET",Object.entries(t).filter(([d,f])=>f!==void 0).map(([d,f])=>[d,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([d,f])=>{c.searchParams.append(d,f)})):(a="POST",u=t);let l=new Headers(this.headers);return i&&l.set("Prefer",`count=${i}`),new Yy.default({method:a,url:c,headers:l,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};nc.default=sc});var ic=P(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.PostgrestError=ut.PostgrestBuilder=ut.PostgrestTransformBuilder=ut.PostgrestFilterBuilder=ut.PostgrestQueryBuilder=ut.PostgrestClient=void 0;var ys=(ne(),ue(se)),Ch=ys.__importDefault(kh());ut.PostgrestClient=Ch.default;var Ph=ys.__importDefault(rc());ut.PostgrestQueryBuilder=Ph.default;var jh=ys.__importDefault(xi());ut.PostgrestFilterBuilder=jh.default;var Ih=ys.__importDefault(Za());ut.PostgrestTransformBuilder=Ih.default;var Nh=ys.__importDefault(Ga());ut.PostgrestBuilder=Nh.default;var $h=ys.__importDefault(Ha());ut.PostgrestError=$h.default;ut.default={PostgrestClient:Ch.default,PostgrestQueryBuilder:Ph.default,PostgrestFilterBuilder:jh.default,PostgrestTransformBuilder:Ih.default,PostgrestBuilder:Nh.default,PostgrestError:$h.default}});var oc=P(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.WebSocketFactory=void 0;var ki=class{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){let t=process.versions;if(t&&t.node){let s=t.node,n=parseInt(s.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){let s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}};hn.WebSocketFactory=ki;hn.default=ki});var Dh=P(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.version=void 0;Ci.version="2.86.2"});var Pi=P(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.CONNECTION_STATE=pe.TRANSPORTS=pe.CHANNEL_EVENTS=pe.CHANNEL_STATES=pe.SOCKET_STATES=pe.MAX_PUSH_BUFFER_SIZE=pe.WS_CLOSE_NORMAL=pe.DEFAULT_TIMEOUT=pe.VERSION=pe.DEFAULT_VSN=pe.VSN_2_0_0=pe.VSN_1_0_0=pe.DEFAULT_VERSION=void 0;var Fh=Dh();pe.DEFAULT_VERSION=`realtime-js/${Fh.version}`;pe.VSN_1_0_0="1.0.0";pe.VSN_2_0_0="2.0.0";pe.DEFAULT_VSN=pe.VSN_1_0_0;pe.VERSION=Fh.version;pe.DEFAULT_TIMEOUT=1e4;pe.WS_CLOSE_NORMAL=1e3;pe.MAX_PUSH_BUFFER_SIZE=100;var Lh;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Lh||(pe.SOCKET_STATES=Lh={}));var Uh;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Uh||(pe.CHANNEL_STATES=Uh={}));var qh;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(qh||(pe.CHANNEL_EVENTS=qh={}));var Bh;(function(r){r.websocket="websocket"})(Bh||(pe.TRANSPORTS=Bh={}));var Mh;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Mh||(pe.CONNECTION_STATE=Mh={}))});var Vh=P(cc=>{"use strict";Object.defineProperty(cc,"__esModule",{value:!0});var ac=class{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;let n=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var t,s;let n=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:{},o=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,t,s){var n,i;let o=e.topic,a=(n=e.ref)!==null&&n!==void 0?n:"",c=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,l=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},d=Object.keys(l).length===0?"":JSON.stringify(l);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`metadata length ${d.length} exceeds maximum of 255`);let f=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+a.length+o.length+u.length+d.length,p=new ArrayBuffer(this.HEADER_LENGTH+f),y=new DataView(p),g=0;y.setUint8(g++,this.KINDS.userBroadcastPush),y.setUint8(g++,c.length),y.setUint8(g++,a.length),y.setUint8(g++,o.length),y.setUint8(g++,u.length),y.setUint8(g++,d.length),y.setUint8(g++,t),Array.from(c,b=>y.setUint8(g++,b.charCodeAt(0))),Array.from(a,b=>y.setUint8(g++,b.charCodeAt(0))),Array.from(o,b=>y.setUint8(g++,b.charCodeAt(0))),Array.from(u,b=>y.setUint8(g++,b.charCodeAt(0))),Array.from(d,b=>y.setUint8(g++,b.charCodeAt(0)));var w=new Uint8Array(p.byteLength+s.byteLength);return w.set(new Uint8Array(p),0),w.set(new Uint8Array(s),p.byteLength),w.buffer}decode(e,t){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return t(s)}if(typeof e=="string"){let s=JSON.parse(e),[n,i,o,a,c]=s;return t({join_ref:n,ref:i,topic:o,event:a,payload:c})}return t({})}_binaryDecode(e){let t=new DataView(e),s=t.getUint8(0),n=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,n)}}_decodeUserBroadcast(e,t,s){let n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4),c=this.HEADER_LENGTH+4,u=s.decode(e.slice(c,c+n));c=c+n;let l=s.decode(e.slice(c,c+i));c=c+i;let d=s.decode(e.slice(c,c+o));c=c+o;let f=e.slice(c,e.byteLength),p=a===this.JSON_ENCODING?JSON.parse(s.decode(f)):f,y={type:this.BROADCAST_EVENT,event:l,payload:p};return o>0&&(y.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:y}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>t.includes(s)))}};cc.default=ac});var dc=P(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0});var uc=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};lc.default=uc});var ji=P(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.httpEndpointURL=de.toTimestampString=de.toArray=de.toJson=de.toNumber=de.toBoolean=de.convertCell=de.convertColumn=de.convertChangeData=de.PostgresTypes=void 0;var Ee;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Ee||(de.PostgresTypes=Ee={}));var Xy=(r,e,t={})=>{var s;let n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=(0,de.convertColumn)(o,r,e,n),i),{}):{}};de.convertChangeData=Xy;var e_=(r,e,t,s)=>{let n=e.find(a=>a.name===r),i=n?.type,o=t[r];return i&&!s.includes(i)?(0,de.convertCell)(i,o):hc(o)};de.convertColumn=e_;var t_=(r,e)=>{if(r.charAt(0)==="_"){let t=r.slice(1,r.length);return(0,de.toArray)(e,t)}switch(r){case Ee.bool:return(0,de.toBoolean)(e);case Ee.float4:case Ee.float8:case Ee.int2:case Ee.int4:case Ee.int8:case Ee.numeric:case Ee.oid:return(0,de.toNumber)(e);case Ee.json:case Ee.jsonb:return(0,de.toJson)(e);case Ee.timestamp:return(0,de.toTimestampString)(e);case Ee.abstime:case Ee.date:case Ee.daterange:case Ee.int4range:case Ee.int8range:case Ee.money:case Ee.reltime:case Ee.text:case Ee.time:case Ee.timestamptz:case Ee.timetz:case Ee.tsrange:case Ee.tstzrange:return hc(e);default:return hc(e)}};de.convertCell=t_;var hc=r=>r,r_=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}};de.toBoolean=r_;var s_=r=>{if(typeof r=="string"){let e=parseFloat(r);if(!Number.isNaN(e))return e}return r};de.toNumber=s_;var n_=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r};de.toJson=n_;var i_=(r,e)=>{if(typeof r!="string")return r;let t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i,o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>(0,de.convertCell)(e,a))}return r};de.toArray=i_;var o_=r=>typeof r=="string"?r.replace(" ","T"):r;de.toTimestampString=o_;var a_=r=>{let e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};de.httpEndpointURL=a_});var zh=P(pc=>{"use strict";Object.defineProperty(pc,"__esModule",{value:!0});var c_=Pi(),fc=class{constructor(e,t,s={},n=c_.DEFAULT_TIMEOUT){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}};pc.default=fc});var gc=P(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.REALTIME_PRESENCE_LISTEN_EVENTS=void 0;var Hh;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Hh||(fn.REALTIME_PRESENCE_LISTEN_EVENTS=Hh={}));var mc=class r{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{let{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=r.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=r.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{let{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=r.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){let i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(u,l)=>{o[u]||(c[u]=l)}),this.map(o,(u,l)=>{let d=i[u];if(d){let f=l.map(w=>w.presence_ref),p=d.map(w=>w.presence_ref),y=l.filter(w=>p.indexOf(w.presence_ref)<0),g=d.filter(w=>f.indexOf(w.presence_ref)<0);y.length>0&&(a[u]=y),g.length>0&&(c[u]=g)}else a[u]=l}),this.syncDiff(i,{joins:a,leaves:c},s,n)}static syncDiff(e,t,s,n){let{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,c)=>{var u;let l=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(c),l.length>0){let d=e[a].map(p=>p.presence_ref),f=l.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...f)}s(a,l,c)}),this.map(o,(a,c)=>{let u=e[a];if(!u)return;let l=c.map(d=>d.presence_ref);u=u.filter(d=>l.indexOf(d.presence_ref)<0),e[a]=u,n(a,u,c),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{let n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};fn.default=mc});var vc=P(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.REALTIME_CHANNEL_STATES=Lt.REALTIME_SUBSCRIBE_STATES=Lt.REALTIME_LISTEN_TYPES=Lt.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT=void 0;var Ii=(ne(),ue(se)),Se=Pi(),yc=Ii.__importDefault(zh()),u_=Ii.__importDefault(dc()),l_=Ii.__importDefault(gc()),Kh=Ii.__importStar(ji()),d_=ji(),Wh;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Wh||(Lt.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT=Wh={}));var pn;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(pn||(Lt.REALTIME_LISTEN_TYPES=pn={}));var rr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(rr||(Lt.REALTIME_SUBSCRIBE_STATES=rr={}));Lt.REALTIME_CHANNEL_STATES=Se.CHANNEL_STATES;var _c=class r{constructor(e,t={config:{}},s){var n,i;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Se.CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new yc.default(this,Se.CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new u_.default(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Se.CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Se.CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Se.CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Se.CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Se.CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Se.CHANNEL_EVENTS.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new l_.default(this),this.broadcastEndpointURL=(0,d_.httpEndpointURL)(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Se.CHANNEL_STATES.closed){let{config:{broadcast:o,presence:a,private:c}}=this.params,u=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(p=>p.filter))!==null&&n!==void 0?n:[],l=!!this.bindings[pn.PRESENCE]&&this.bindings[pn.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,d={},f={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:l}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(p=>e?.(rr.CHANNEL_ERROR,p)),this._onClose(()=>e?.(rr.CLOSED)),this.updateJoinPayload(Object.assign({config:f},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var y;if(this.socket.setAuth(),p===void 0){e?.(rr.SUBSCRIBED);return}else{let g=this.bindings.postgres_changes,w=(y=g?.length)!==null&&y!==void 0?y:0,b=[];for(let A=0;A<w;A++){let E=g[A],{filter:{event:x,schema:U,table:V,filter:N}}=E,W=p&&p[A];if(W&&W.event===x&&W.schema===U&&W.table===V&&W.filter===N)b.push(Object.assign(Object.assign({},E),{id:W.id}));else{this.unsubscribe(),this.state=Se.CHANNEL_STATES.errored,e?.(rr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,e&&e(rr.SUBSCRIBED);return}}).receive("error",p=>{this.state=Se.CHANNEL_STATES.errored,e?.(rr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e?.(rr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===Se.CHANNEL_STATES.joined&&e===pn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var n;let i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");let o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let c=a.statusText;try{let u=await a.json();c=u.error||u.message||c}catch{}return Promise.reject(new Error(c))}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{let u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;let u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Se.CHANNEL_STATES.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Se.CHANNEL_EVENTS.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new yc.default(this,Se.CHANNEL_EVENTS.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Se.CHANNEL_STATES.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){let n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new yc.default(this,e,t,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Se.MAX_PUSH_BUFFER_SIZE){let t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;let o=e.toLocaleLowerCase(),{close:a,error:c,leave:u,join:l}=Se.CHANNEL_EVENTS;if(s&&[a,c,u,l].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(p=>{var y,g,w;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((w=(g=p.filter)===null||g===void 0?void 0:g.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(p=>p.callback(f,s)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var y,g,w,b,A,E;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){let x=p.id,U=(y=p.filter)===null||y===void 0?void 0:y.event;return x&&((g=t.ids)===null||g===void 0?void 0:g.includes(x))&&(U==="*"||U?.toLocaleLowerCase()===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{let x=(A=(b=p?.filter)===null||b===void 0?void 0:b.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return x==="*"||x===((E=t?.event)===null||E===void 0?void 0:E.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){let y=f.data,{schema:g,table:w,commit_timestamp:b,type:A,errors:E}=y;f=Object.assign(Object.assign({},{schema:g,table:w,commit_timestamp:b,eventType:A,new:{},old:{},errors:E}),this._getPayloadRecords(y))}p.callback(f,s)})}_isClosed(){return this.state===Se.CHANNEL_STATES.closed}_isJoined(){return this.state===Se.CHANNEL_STATES.joined}_isJoining(){return this.state===Se.CHANNEL_STATES.joining}_isLeaving(){return this.state===Se.CHANNEL_STATES.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){let n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){let s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&r.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Se.CHANNEL_EVENTS.close,{},e)}_onError(e){this._on(Se.CHANNEL_EVENTS.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Se.CHANNEL_STATES.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Kh.convertChangeData(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Kh.convertChangeData(e.columns,e.old_record)),t}};Lt.default=_c});var Gh=P(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});var $i=(ne(),ue(se)),h_=$i.__importDefault(oc()),De=Pi(),f_=$i.__importDefault(Vh()),p_=$i.__importDefault(dc()),m_=ji(),g_=$i.__importDefault(vc()),wc=()=>{},Ni={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},y_=[1e3,2e3,5e3,1e4],__=1e4,v_=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,bc=class{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=De.DEFAULT_TIMEOUT,this.transport=null,this.heartbeatIntervalMs=Ni.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=wc,this.ref=0,this.reconnectTimer=null,this.vsn=De.DEFAULT_VSN,this.logger=wc,this.conn=null,this.sendBuffer=[],this.serializer=new f_.default,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((s=t?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${De.TRANSPORTS.websocket}`,this.httpEndpoint=(0,m_.httpEndpointURL)(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=h_.default.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");let t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case De.SOCKET_STATES.connecting:return De.CONNECTION_STATE.Connecting;case De.SOCKET_STATES.open:return De.CONNECTION_STATE.Open;case De.SOCKET_STATES.closing:return De.CONNECTION_STATE.Closing;default:return De.CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===De.CONNECTION_STATE.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){let s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{let i=new g_.default(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){let{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(De.WS_CLOSE_NORMAL,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ni.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:s,event:n,payload:i,ref:o}=t,a=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${s} ${n} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(s)).forEach(u=>u._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===De.SOCKET_STATES.open||this.conn.readyState===De.SOCKET_STATES.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(De.CHANNEL_EVENTS.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{let s=new Blob([v_],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{let n={access_token:t,version:De.DEFAULT_VERSION};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push(De.CHANNEL_EVENTS.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new p_.default(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ni.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,n,i,o,a,c,u,l,d,f,p;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e?.timeout)!==null&&s!==void 0?s:De.DEFAULT_TIMEOUT,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:Ni.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:wc,this.vsn=(c=e?.vsn)!==null&&c!==void 0?c:De.DEFAULT_VSN,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e?.reconnectAfterMs)!==null&&u!==void 0?u:y=>y_[y-1]||__,this.vsn){case De.VSN_1_0_0:this.encode=(l=e?.encode)!==null&&l!==void 0?l:(y,g)=>g(JSON.stringify(y)),this.decode=(d=e?.decode)!==null&&d!==void 0?d:(y,g)=>g(JSON.parse(y));break;case De.VSN_2_0_0:this.encode=(f=e?.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(p=e?.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}};Ec.default=bc});var Sc=P(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.WebSocketFactory=Ue.REALTIME_CHANNEL_STATES=Ue.REALTIME_SUBSCRIBE_STATES=Ue.REALTIME_PRESENCE_LISTEN_EVENTS=Ue.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT=Ue.REALTIME_LISTEN_TYPES=Ue.RealtimeClient=Ue.RealtimeChannel=Ue.RealtimePresence=void 0;var Di=(ne(),ue(se)),w_=Di.__importDefault(Gh());Ue.RealtimeClient=w_.default;var mn=Di.__importStar(vc());Ue.RealtimeChannel=mn.default;Object.defineProperty(Ue,"REALTIME_LISTEN_TYPES",{enumerable:!0,get:function(){return mn.REALTIME_LISTEN_TYPES}});Object.defineProperty(Ue,"REALTIME_POSTGRES_CHANGES_LISTEN_EVENT",{enumerable:!0,get:function(){return mn.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT}});Object.defineProperty(Ue,"REALTIME_SUBSCRIBE_STATES",{enumerable:!0,get:function(){return mn.REALTIME_SUBSCRIBE_STATES}});Object.defineProperty(Ue,"REALTIME_CHANNEL_STATES",{enumerable:!0,get:function(){return mn.REALTIME_CHANNEL_STATES}});var Qh=Di.__importStar(gc());Ue.RealtimePresence=Qh.default;Object.defineProperty(Ue,"REALTIME_PRESENCE_LISTEN_EVENTS",{enumerable:!0,get:function(){return Qh.REALTIME_PRESENCE_LISTEN_EVENTS}});var b_=Di.__importDefault(oc());Ue.WebSocketFactory=b_.default});var mr=P(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.StorageUnknownError=sr.StorageApiError=sr.StorageError=void 0;sr.isStorageError=E_;var gn=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};sr.StorageError=gn;function E_(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var Tc=class extends gn{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}};sr.StorageApiError=Tc;var Ac=class extends gn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};sr.StorageUnknownError=Ac});var yn=P(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.isValidBucketName=ft.isPlainObject=ft.recursiveToCamel=ft.resolveResponse=ft.resolveFetch=void 0;var S_=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);ft.resolveFetch=S_;var T_=()=>Response;ft.resolveResponse=T_;var A_=r=>{if(Array.isArray(r))return r.map(t=>(0,ft.recursiveToCamel)(t));if(typeof r=="function"||r!==Object(r))return r;let e={};return Object.entries(r).forEach(([t,s])=>{let n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=(0,ft.recursiveToCamel)(s)}),e};ft.recursiveToCamel=A_;var O_=r=>{if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};ft.isPlainObject=O_;var R_=r=>!r||typeof r!="string"||r.length===0||r.length>100||r.trim()!==r||r.includes("/")||r.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(r);ft.isValidBucketName=R_});var Li=P(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.get=C_;Nr.post=P_;Nr.put=j_;Nr.head=I_;Nr.remove=N_;var Ir=(ne(),ue(se)),Oc=mr(),Jh=yn(),Rc=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)===null||e===void 0?void 0:e.message)||JSON.stringify(r)},x_=(r,e,t)=>Ir.__awaiter(void 0,void 0,void 0,function*(){let s=yield(0,Jh.resolveResponse)();r instanceof s&&!t?.noResolveJson?r.json().then(n=>{let i=r.status||500,o=n?.statusCode||i+"";e(new Oc.StorageApiError(Rc(n),i,o))}).catch(n=>{e(new Oc.StorageUnknownError(Rc(n),n))}):e(new Oc.StorageUnknownError(Rc(r),r))}),k_=(r,e,t,s)=>{let n={method:r,headers:e?.headers||{}};return r==="GET"||!s?n:((0,Jh.isPlainObject)(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function _n(r,e,t,s,n,i){return Ir.__awaiter(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,k_(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>x_(c,a,s))})})}function C_(r,e,t,s){return Ir.__awaiter(this,void 0,void 0,function*(){return _n(r,"GET",e,t,s)})}function P_(r,e,t,s,n){return Ir.__awaiter(this,void 0,void 0,function*(){return _n(r,"POST",e,s,n,t)})}function j_(r,e,t,s,n){return Ir.__awaiter(this,void 0,void 0,function*(){return _n(r,"PUT",e,s,n,t)})}function I_(r,e,t,s){return Ir.__awaiter(this,void 0,void 0,function*(){return _n(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function N_(r,e,t,s,n){return Ir.__awaiter(this,void 0,void 0,function*(){return _n(r,"DELETE",e,s,n,t)})}});var Zh=P(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});var $_=(ne(),ue(se)),D_=mr(),xc=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return $_.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if((0,D_.isStorageError)(e))return{data:null,error:e};throw e}})}};kc.default=xc});var ef=P(Pc=>{"use strict";var Yh;Object.defineProperty(Pc,"__esModule",{value:!0});var Xh=(ne(),ue(se)),L_=mr(),U_=Xh.__importDefault(Zh()),Cc=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Yh]="BlobDownloadBuilder",this.promise=null}asStream(){return new U_.default(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Xh.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if((0,L_.isStorageError)(e))return{data:null,error:e};throw e}})}};Yh=Symbol.toStringTag;Pc.default=Cc});var sf=P(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});var lt=(ne(),ue(se)),pt=mr(),mt=Li(),tf=yn(),q_=lt.__importDefault(ef()),B_={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},rf={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},jc=class{constructor(e,t={},s,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=(0,tf.resolveFetch)(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,n){return lt.__awaiter(this,void 0,void 0,function*(){try{let i,o=Object.assign(Object.assign({},rf),n),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)}),c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(c))):(i=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),n?.headers&&(a=Object.assign(Object.assign({},a),n.headers));let u=this._removeEmptyFolders(t),l=this._getFinalPath(u),d=yield(e=="PUT"?mt.put:mt.post)(this.fetch,`${this.url}/object/${l}`,i,Object.assign({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:d.Id,fullPath:d.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if((0,pt.isStorageError)(i))return{data:null,error:i};throw i}})}upload(e,t,s){return lt.__awaiter(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return lt.__awaiter(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c,u=Object.assign({upsert:rf.upsert},n),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",u.cacheControl)):(c=s,l["cache-control"]=`max-age=${u.cacheControl}`,l["content-type"]=u.contentType);let d=yield(0,mt.put)(this.fetch,a.toString(),c,{headers:l});return{data:{path:i,fullPath:d.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if((0,pt.isStorageError)(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return lt.__awaiter(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");let i=yield(0,mt.post)(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new pt.StorageError("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,pt.isStorageError)(s))return{data:null,error:s};throw s}})}update(e,t,s){return lt.__awaiter(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return lt.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,mt.post)(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,pt.isStorageError)(n))return{data:null,error:n};throw n}})}copy(e,t,s){return lt.__awaiter(this,void 0,void 0,function*(){try{return{data:{path:(yield(0,mt.post)(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,pt.isStorageError)(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return lt.__awaiter(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield(0,mt.post)(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers}),o=s?.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,pt.isStorageError)(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return lt.__awaiter(this,void 0,void 0,function*(){try{let n=yield(0,mt.post)(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,pt.isStorageError)(n))return{data:null,error:n};throw n}})}download(e,t){let n=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"",a=this._getFinalPath(e),c=()=>(0,mt.get)(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new q_.default(c,this.shouldThrowOnError)}info(e){return lt.__awaiter(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let s=yield(0,mt.get)(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:(0,tf.recursiveToCamel)(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,pt.isStorageError)(s))return{data:null,error:s};throw s}})}exists(e){return lt.__awaiter(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield(0,mt.head)(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,pt.isStorageError)(s)&&s instanceof pt.StorageUnknownError){let n=s.originalError;if([400,404].includes(n?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){let s=this._getFinalPath(e),n=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);let a=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&n.push(c);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${u}`)}}}remove(e){return lt.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,mt.remove)(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,pt.isStorageError)(t))return{data:null,error:t};throw t}})}list(e,t,s){return lt.__awaiter(this,void 0,void 0,function*(){try{let n=Object.assign(Object.assign(Object.assign({},B_),t),{prefix:e||""});return{data:yield(0,mt.post)(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,pt.isStorageError)(n))return{data:null,error:n};throw n}})}listV2(e,t){return lt.__awaiter(this,void 0,void 0,function*(){try{let s=Object.assign({},e);return{data:yield(0,mt.post)(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,pt.isStorageError)(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};Ic.default=jc});var Nc=P(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});Ui.version=void 0;Ui.version="2.86.2"});var $c=P(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.DEFAULT_HEADERS=void 0;var M_=Nc();qi.DEFAULT_HEADERS={"X-Client-Info":`storage-js/${M_.version}`}});var nf=P(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});var _s=(ne(),ue(se)),F_=$c(),vs=mr(),ws=Li(),V_=yn(),Dc=class{constructor(e,t={},s,n){this.shouldThrowOnError=!1;let i=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},F_.DEFAULT_HEADERS),t),this.fetch=(0,V_.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return _s.__awaiter(this,void 0,void 0,function*(){try{let t=this.listBucketOptionsToQueryString(e);return{data:yield(0,ws.get)(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,vs.isStorageError)(t))return{data:null,error:t};throw t}})}getBucket(e){return _s.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,ws.get)(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,vs.isStorageError)(t))return{data:null,error:t};throw t}})}createBucket(e){return _s.__awaiter(this,arguments,void 0,function*(t,s={public:!1}){try{return{data:yield(0,ws.post)(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,vs.isStorageError)(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return _s.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,ws.put)(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,vs.isStorageError)(s))return{data:null,error:s};throw s}})}emptyBucket(e){return _s.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,ws.post)(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,vs.isStorageError)(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _s.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,ws.remove)(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,vs.isStorageError)(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){let t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}};Lc.default=Dc});var cf=P(nr=>{"use strict";var Es=class extends Error{constructor(r,e){super(r),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function z_(r,e,t){let s=new URL(e,r);if(t)for(let[n,i]of Object.entries(t))i!==void 0&&s.searchParams.set(n,i);return s.toString()}async function H_(r){return!r||r.type==="none"?{}:r.type==="bearer"?{Authorization:`Bearer ${r.token}`}:r.type==="header"?{[r.name]:r.value}:r.type==="custom"?await r.getHeaders():{}}function K_(r){let e=r.fetchImpl??globalThis.fetch;return{async request({method:t,path:s,query:n,body:i,headers:o}){let a=z_(r.baseUrl,s,n),c=await H_(r.auth),u=await e(a,{method:t,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),l=await u.text(),d=(u.headers.get("content-type")||"").includes("application/json"),f=d&&l?JSON.parse(l):l;if(!u.ok){let p=d?f:void 0,y=p?.error;throw new Es(y?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:y?.type,icebergCode:y?.code,details:p})}return{status:u.status,headers:u.headers,data:f}}}}function Bi(r){return r.join("")}var W_=class{constructor(r,e=""){this.client=r,this.prefix=e}async listNamespaces(r){let e=r?{parent:Bi(r.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(r,e){let t={namespace:r.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(r){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Bi(r.namespace)}`})}async loadNamespaceMetadata(r){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Bi(r.namespace)}`})).data.properties}}async namespaceExists(r){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Bi(r.namespace)}`}),!0}catch(e){if(e instanceof Es&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(r,e){try{return await this.createNamespace(r,e)}catch(t){if(t instanceof Es&&t.status===409)return;throw t}}};function bs(r){return r.join("")}var G_=class{constructor(r,e="",t){this.client=r,this.prefix=e,this.accessDelegation=t}async listTables(r){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${bs(r.namespace)}/tables`})).data.identifiers}async createTable(r,e){let t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${bs(r.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(r,e){let t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${bs(r.namespace)}/tables/${r.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(r,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${bs(r.namespace)}/tables/${r.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(r){let e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${bs(r.namespace)}/tables/${r.name}`,headers:e})).data.metadata}async tableExists(r){let e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${bs(r.namespace)}/tables/${r.name}`,headers:e}),!0}catch(t){if(t instanceof Es&&t.status===404)return!1;throw t}}async createTableIfNotExists(r,e){try{return await this.createTable(r,e)}catch(t){if(t instanceof Es&&t.status===409)return await this.loadTable({namespace:r.namespace,name:e.name});throw t}}},Q_=class{constructor(r){let e="v1";r.catalogName&&(e+=`/${r.catalogName}`);let t=r.baseUrl.endsWith("/")?r.baseUrl:`${r.baseUrl}/`;this.client=K_({baseUrl:t,auth:r.auth,fetchImpl:r.fetch}),this.accessDelegation=r.accessDelegation?.join(","),this.namespaceOps=new W_(this.client,e),this.tableOps=new G_(this.client,e,this.accessDelegation)}async listNamespaces(r){return this.namespaceOps.listNamespaces(r)}async createNamespace(r,e){return this.namespaceOps.createNamespace(r,e)}async dropNamespace(r){await this.namespaceOps.dropNamespace(r)}async loadNamespaceMetadata(r){return this.namespaceOps.loadNamespaceMetadata(r)}async listTables(r){return this.tableOps.listTables(r)}async createTable(r,e){return this.tableOps.createTable(r,e)}async updateTable(r,e){return this.tableOps.updateTable(r,e)}async dropTable(r,e){await this.tableOps.dropTable(r,e)}async loadTable(r){return this.tableOps.loadTable(r)}async namespaceExists(r){return this.namespaceOps.namespaceExists(r)}async tableExists(r){return this.tableOps.tableExists(r)}async createNamespaceIfNotExists(r,e){return this.namespaceOps.createNamespaceIfNotExists(r,e)}async createTableIfNotExists(r,e){return this.tableOps.createTableIfNotExists(r,e)}},of=/^decimal\s*\(\s*(\d+)\s*,\s*(\d+)\s*\)$/,af=/^fixed\s*\[\s*(\d+)\s*\]$/;function Uc(r){let e=r.match(of);return e?{precision:parseInt(e[1],10),scale:parseInt(e[2],10)}:null}function qc(r){let e=r.match(af);return e?{length:parseInt(e[1],10)}:null}function J_(r){return of.test(r)}function Z_(r){return af.test(r)}function Y_(r,e){let t=Uc(r),s=Uc(e);if(t&&s)return t.precision===s.precision&&t.scale===s.scale;let n=qc(r),i=qc(e);return n&&i?n.length===i.length:r===e}function X_(r){return r.schemas.find(e=>e["schema-id"]===r["current-schema-id"])}nr.IcebergError=Es;nr.IcebergRestCatalog=Q_;nr.getCurrentSchema=X_;nr.isDecimalType=J_;nr.isFixedType=Z_;nr.parseDecimalType=Uc;nr.parseFixedType=qc;nr.typesEqual=Y_});var Vc=P(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});var Mi=(ne(),ue(se)),ev=cf(),tv=$c(),Fi=mr(),Bc=Li(),uf=yn(),Mc=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},tv.DEFAULT_HEADERS),t),this.fetch=(0,uf.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Mi.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Bc.post)(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Fi.isStorageError)(t))return{data:null,error:t};throw t}})}listBuckets(e){return Mi.__awaiter(this,void 0,void 0,function*(){try{let t=new URLSearchParams;e?.limit!==void 0&&t.set("limit",e.limit.toString()),e?.offset!==void 0&&t.set("offset",e.offset.toString()),e?.sortColumn&&t.set("sortColumn",e.sortColumn),e?.sortOrder&&t.set("sortOrder",e.sortOrder),e?.search&&t.set("search",e.search);let s=t.toString(),n=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield(0,Bc.get)(this.fetch,n,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Fi.isStorageError)(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Mi.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Bc.remove)(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Fi.isStorageError)(t))return{data:null,error:t};throw t}})}from(e){if(!(0,uf.isValidBucketName)(e))throw new Fi.StorageError("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");return new ev.IcebergRestCatalog({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:()=>Mi.__awaiter(this,void 0,void 0,function*(){return this.headers})},fetch:this.fetch})}};Fc.default=Mc});var zi=P(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});Vi.DEFAULT_HEADERS=void 0;var rv=Nc();Vi.DEFAULT_HEADERS={"X-Client-Info":`storage-js/${rv.version}`,"Content-Type":"application/json"}});var Ss=P(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.StorageVectorsErrorCode=Ut.StorageVectorsUnknownError=Ut.StorageVectorsApiError=Ut.StorageVectorsError=void 0;Ut.isStorageVectorsError=sv;var vn=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};Ut.StorageVectorsError=vn;function sv(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}var zc=class extends vn{constructor(e,t,s){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}};Ut.StorageVectorsApiError=zc;var Hc=class extends vn{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};Ut.StorageVectorsUnknownError=Hc;var lf;(function(r){r.InternalError="InternalError",r.S3VectorConflictException="S3VectorConflictException",r.S3VectorNotFoundException="S3VectorNotFoundException",r.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",r.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",r.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(lf||(Ut.StorageVectorsErrorCode=lf={}))});var Ts=P(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.validateVectorDimension=xt.normalizeToFloat32=xt.isPlainObject=xt.resolveResponse=xt.resolveFetch=void 0;var nv=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);xt.resolveFetch=nv;var iv=()=>Response;xt.resolveResponse=iv;var ov=r=>{if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};xt.isPlainObject=ov;var av=r=>Array.from(new Float32Array(r));xt.normalizeToFloat32=av;var cv=(r,e)=>{if(e!==void 0&&r.float32.length!==e)throw new Error(`Vector dimension mismatch: expected ${e}, got ${r.float32.length}`)};xt.validateVectorDimension=cv});var Wi=P(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.get=hv;Os.post=fv;Os.put=pv;Os.remove=mv;var As=(ne(),ue(se)),Hi=Ss(),uv=Ts(),df=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),lv=(r,e,t)=>As.__awaiter(void 0,void 0,void 0,function*(){if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!t?.noResolveJson){let n=r.status||500,i=r;if(typeof i.json=="function")i.json().then(o=>{let a=o?.statusCode||o?.code||n+"";e(new Hi.StorageVectorsApiError(df(o),n,a))}).catch(()=>{let o=n+"",a=i.statusText||`HTTP ${n} error`;e(new Hi.StorageVectorsApiError(a,n,o))});else{let o=n+"",a=i.statusText||`HTTP ${n} error`;e(new Hi.StorageVectorsApiError(a,n,o))}}else e(new Hi.StorageVectorsUnknownError(df(r),r))}),dv=(r,e,t,s)=>{let n={method:r,headers:e?.headers||{}};return r==="GET"||!s?n:((0,uv.isPlainObject)(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,Object.assign(Object.assign({},n),t))};function Ki(r,e,t,s,n,i){return As.__awaiter(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,dv(e,s,n,i)).then(c=>{if(!c.ok)throw c;if(s?.noResolveJson)return c;let u=c.headers.get("content-type");return!u||!u.includes("application/json")?{}:c.json()}).then(c=>o(c)).catch(c=>lv(c,a,s))})})}function hv(r,e,t,s){return As.__awaiter(this,void 0,void 0,function*(){return Ki(r,"GET",e,t,s)})}function fv(r,e,t,s,n){return As.__awaiter(this,void 0,void 0,function*(){return Ki(r,"POST",e,s,n,t)})}function pv(r,e,t,s,n){return As.__awaiter(this,void 0,void 0,function*(){return Ki(r,"PUT",e,s,n,t)})}function mv(r,e,t,s,n){return As.__awaiter(this,void 0,void 0,function*(){return Ki(r,"DELETE",e,s,n,t)})}});var Gc=P(Wc=>{"use strict";Object.defineProperty(Wc,"__esModule",{value:!0});var Gi=(ne(),ue(se)),gv=zi(),Qi=Ss(),Ji=Wi(),yv=Ts(),Kc=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},gv.DEFAULT_HEADERS),t),this.fetch=(0,yv.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return Gi.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield(0,Ji.post)(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Qi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}getIndex(e,t){return Gi.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Ji.post)(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,Qi.isStorageVectorsError)(s))return{data:null,error:s};throw s}})}listIndexes(e){return Gi.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Ji.post)(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Qi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return Gi.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield(0,Ji.post)(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,Qi.isStorageVectorsError)(s))return{data:null,error:s};throw s}})}};Wc.default=Kc});var Zc=P(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});var wn=(ne(),ue(se)),_v=zi(),bn=Ss(),En=Wi(),vv=Ts(),Qc=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},_v.DEFAULT_HEADERS),t),this.fetch=(0,vv.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return wn.__awaiter(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield(0,En.post)(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,bn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}getVectors(e){return wn.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,En.post)(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,bn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}listVectors(e){return wn.__awaiter(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield(0,En.post)(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,bn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}queryVectors(e){return wn.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,En.post)(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,bn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}deleteVectors(e){return wn.__awaiter(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield(0,En.post)(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,bn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}};Jc.default=Qc});var eu=P(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});var Zi=(ne(),ue(se)),wv=zi(),Yi=Ss(),Xi=Wi(),bv=Ts(),Yc=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},wv.DEFAULT_HEADERS),t),this.fetch=(0,bv.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Zi.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield(0,Xi.post)(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Yi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}getBucket(e){return Zi.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Xi.post)(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Yi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}listBuckets(){return Zi.__awaiter(this,arguments,void 0,function*(e={}){try{return{data:yield(0,Xi.post)(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Yi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Zi.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield(0,Xi.post)(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Yi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}};Xc.default=Yc});var hf=P(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.VectorIndexScope=gr.VectorBucketScope=gr.StorageVectorsClient=void 0;var rt=(ne(),ue(se)),Ev=rt.__importDefault(Gc()),Sv=rt.__importDefault(Zc()),Tv=rt.__importDefault(eu()),tu=class extends Tv.default{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new eo(this.url,this.headers,e,this.fetch)}createBucket(e){let t=Object.create(null,{createBucket:{get:()=>super.createBucket}});return rt.__awaiter(this,void 0,void 0,function*(){return t.createBucket.call(this,e)})}getBucket(e){let t=Object.create(null,{getBucket:{get:()=>super.getBucket}});return rt.__awaiter(this,void 0,void 0,function*(){return t.getBucket.call(this,e)})}listBuckets(){let e=Object.create(null,{listBuckets:{get:()=>super.listBuckets}});return rt.__awaiter(this,arguments,void 0,function*(t={}){return e.listBuckets.call(this,t)})}deleteBucket(e){let t=Object.create(null,{deleteBucket:{get:()=>super.deleteBucket}});return rt.__awaiter(this,void 0,void 0,function*(){return t.deleteBucket.call(this,e)})}};gr.StorageVectorsClient=tu;var eo=class extends Ev.default{constructor(e,t,s,n){super(e,t,n),this.vectorBucketName=s}createIndex(e){let t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return rt.__awaiter(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return rt.__awaiter(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){let t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return rt.__awaiter(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){let t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return rt.__awaiter(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new to(this.url,this.headers,this.vectorBucketName,e,this.fetch)}};gr.VectorBucketScope=eo;var to=class extends Sv.default{constructor(e,t,s,n,i){super(e,t,i),this.vectorBucketName=s,this.indexName=n}putVectors(e){let t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return rt.__awaiter(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){let t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return rt.__awaiter(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return rt.__awaiter(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){let t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return rt.__awaiter(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){let t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return rt.__awaiter(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}};gr.VectorIndexScope=to});var nu=P(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.validateVectorDimension=re.normalizeToFloat32=re.isPlainObject=re.resolveResponse=re.resolveFetch=re.isStorageVectorsError=re.StorageVectorsErrorCode=re.StorageVectorsUnknownError=re.StorageVectorsApiError=re.StorageVectorsError=re.VectorDataApi=re.VectorIndexApi=re.VectorBucketApi=re.VectorIndexScope=re.VectorBucketScope=re.StorageVectorsClient=void 0;var ru=(ne(),ue(se)),su=hf();Object.defineProperty(re,"StorageVectorsClient",{enumerable:!0,get:function(){return su.StorageVectorsClient}});Object.defineProperty(re,"VectorBucketScope",{enumerable:!0,get:function(){return su.VectorBucketScope}});Object.defineProperty(re,"VectorIndexScope",{enumerable:!0,get:function(){return su.VectorIndexScope}});var Av=eu();Object.defineProperty(re,"VectorBucketApi",{enumerable:!0,get:function(){return ru.__importDefault(Av).default}});var Ov=Gc();Object.defineProperty(re,"VectorIndexApi",{enumerable:!0,get:function(){return ru.__importDefault(Ov).default}});var Rv=Zc();Object.defineProperty(re,"VectorDataApi",{enumerable:!0,get:function(){return ru.__importDefault(Rv).default}});var Sn=Ss();Object.defineProperty(re,"StorageVectorsError",{enumerable:!0,get:function(){return Sn.StorageVectorsError}});Object.defineProperty(re,"StorageVectorsApiError",{enumerable:!0,get:function(){return Sn.StorageVectorsApiError}});Object.defineProperty(re,"StorageVectorsUnknownError",{enumerable:!0,get:function(){return Sn.StorageVectorsUnknownError}});Object.defineProperty(re,"StorageVectorsErrorCode",{enumerable:!0,get:function(){return Sn.StorageVectorsErrorCode}});Object.defineProperty(re,"isStorageVectorsError",{enumerable:!0,get:function(){return Sn.isStorageVectorsError}});var Tn=Ts();Object.defineProperty(re,"resolveFetch",{enumerable:!0,get:function(){return Tn.resolveFetch}});Object.defineProperty(re,"resolveResponse",{enumerable:!0,get:function(){return Tn.resolveResponse}});Object.defineProperty(re,"isPlainObject",{enumerable:!0,get:function(){return Tn.isPlainObject}});Object.defineProperty(re,"normalizeToFloat32",{enumerable:!0,get:function(){return Tn.normalizeToFloat32}});Object.defineProperty(re,"validateVectorDimension",{enumerable:!0,get:function(){return Tn.validateVectorDimension}})});var ff=P(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.StorageClient=void 0;var ou=(ne(),ue(se)),xv=ou.__importDefault(sf()),kv=ou.__importDefault(nf()),Cv=ou.__importDefault(Vc()),Pv=nu(),iu=class extends kv.default{constructor(e,t={},s,n){super(e,t,s,n)}from(e){return new xv.default(this.url,this.headers,e,this.fetch)}get vectors(){return new Pv.StorageVectorsClient(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Cv.default(this.url+"/iceberg",this.headers,this.fetch)}};ro.StorageClient=iu});var mf=P(pf=>{"use strict";Object.defineProperty(pf,"__esModule",{value:!0})});var gf=P(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.StorageAnalyticsClient=ir.StorageClient=void 0;var so=(ne(),ue(se)),jv=ff();Object.defineProperty(ir,"StorageClient",{enumerable:!0,get:function(){return jv.StorageClient}});var Iv=Vc();Object.defineProperty(ir,"StorageAnalyticsClient",{enumerable:!0,get:function(){return so.__importDefault(Iv).default}});so.__exportStar(mf(),ir);so.__exportStar(mr(),ir);so.__exportStar(nu(),ir)});var yf=P(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.version=void 0;no.version="2.86.2"});var _f=P(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.DEFAULT_REALTIME_OPTIONS=bt.DEFAULT_AUTH_OPTIONS=bt.DEFAULT_DB_OPTIONS=bt.DEFAULT_GLOBAL_OPTIONS=bt.DEFAULT_HEADERS=void 0;var Nv=yf(),An="";typeof Deno<"u"?An="deno":typeof document<"u"?An="web":typeof navigator<"u"&&navigator.product==="ReactNative"?An="react-native":An="node";bt.DEFAULT_HEADERS={"X-Client-Info":`supabase-js-${An}/${Nv.version}`};bt.DEFAULT_GLOBAL_OPTIONS={headers:bt.DEFAULT_HEADERS};bt.DEFAULT_DB_OPTIONS={schema:"public"};bt.DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"};bt.DEFAULT_REALTIME_OPTIONS={}});var vf=P(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.fetchWithAuth=Ht.resolveHeadersConstructor=Ht.resolveFetch=void 0;var $v=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);Ht.resolveFetch=$v;var Dv=()=>Headers;Ht.resolveHeadersConstructor=Dv;var Lv=(r,e,t)=>{let s=(0,Ht.resolveFetch)(t),n=(0,Ht.resolveHeadersConstructor)();return async(i,o)=>{var a;let c=(a=await e())!==null&&a!==void 0?a:r,u=new n(o?.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},o),{headers:u}))}};Ht.fetchWithAuth=Lv});var bf=P(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.isBrowser=void 0;yr.uuid=Uv;yr.ensureTrailingSlash=wf;yr.applySettingDefaults=Bv;yr.validateSupabaseUrl=Mv;function Uv(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var e=Math.random()*16|0,t=r=="x"?e:e&3|8;return t.toString(16)})}function wf(r){return r.endsWith("/")?r:r+"/"}var qv=()=>typeof window<"u";yr.isBrowser=qv;function Bv(r,e){var t,s;let{db:n,auth:i,realtime:o,global:a}=r,{db:c,auth:u,realtime:l,global:d}=e,f={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},l),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d?.headers)!==null&&t!==void 0?t:{}),(s=a?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}function Mv(r){let e=r?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(wf(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}});var au=P(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.version=void 0;io.version="2.86.2"});var oo=P(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.JWKS_TTL=ge.BASE64URL_REGEX=ge.API_VERSIONS=ge.API_VERSION_HEADER_NAME=ge.NETWORK_FAILURE=ge.DEFAULT_HEADERS=ge.AUDIENCE=ge.STORAGE_KEY=ge.GOTRUE_URL=ge.EXPIRY_MARGIN_MS=ge.AUTO_REFRESH_TICK_THRESHOLD=ge.AUTO_REFRESH_TICK_DURATION_MS=void 0;var Fv=au();ge.AUTO_REFRESH_TICK_DURATION_MS=30*1e3;ge.AUTO_REFRESH_TICK_THRESHOLD=3;ge.EXPIRY_MARGIN_MS=ge.AUTO_REFRESH_TICK_THRESHOLD*ge.AUTO_REFRESH_TICK_DURATION_MS;ge.GOTRUE_URL="http://localhost:9999";ge.STORAGE_KEY="supabase.auth.token";ge.AUDIENCE="";ge.DEFAULT_HEADERS={"X-Client-Info":`gotrue-js/${Fv.version}`};ge.NETWORK_FAILURE={MAX_RETRIES:10,RETRY_INTERVAL:2};ge.API_VERSION_HEADER_NAME="X-Supabase-Api-Version";ge.API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};ge.BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;ge.JWKS_TTL=10*60*1e3});var $r=P(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.AuthInvalidJwtError=ie.AuthWeakPasswordError=ie.AuthRetryableFetchError=ie.AuthPKCEGrantCodeExchangeError=ie.AuthImplicitGrantRedirectError=ie.AuthInvalidCredentialsError=ie.AuthInvalidTokenResponseError=ie.AuthSessionMissingError=ie.CustomAuthError=ie.AuthUnknownError=ie.AuthApiError=ie.AuthError=void 0;ie.isAuthError=xs;ie.isAuthApiError=Vv;ie.isAuthSessionMissingError=zv;ie.isAuthImplicitGrantRedirectError=Hv;ie.isAuthRetryableFetchError=Kv;ie.isAuthWeakPasswordError=Wv;var Rs=class extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}};ie.AuthError=Rs;function xs(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}var cu=class extends Rs{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}};ie.AuthApiError=cu;function Vv(r){return xs(r)&&r.name==="AuthApiError"}var uu=class extends Rs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}};ie.AuthUnknownError=uu;var qt=class extends Rs{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}};ie.CustomAuthError=qt;var lu=class extends qt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};ie.AuthSessionMissingError=lu;function zv(r){return xs(r)&&r.name==="AuthSessionMissingError"}var du=class extends qt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}};ie.AuthInvalidTokenResponseError=du;var hu=class extends qt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}};ie.AuthInvalidCredentialsError=hu;var fu=class extends qt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};ie.AuthImplicitGrantRedirectError=fu;function Hv(r){return xs(r)&&r.name==="AuthImplicitGrantRedirectError"}var pu=class extends qt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};ie.AuthPKCEGrantCodeExchangeError=pu;var mu=class extends qt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}};ie.AuthRetryableFetchError=mu;function Kv(r){return xs(r)&&r.name==="AuthRetryableFetchError"}var gu=class extends qt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}};ie.AuthWeakPasswordError=gu;function Wv(r){return xs(r)&&r.name==="AuthWeakPasswordError"}var yu=class extends qt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}};ie.AuthInvalidJwtError=yu});var co=P(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.byteToBase64URL=On;kt.byteFromBase64URL=_u;kt.stringToBase64URL=Qv;kt.stringFromBase64URL=Jv;kt.codepointToUTF8=Sf;kt.stringToUTF8=vu;kt.stringFromUTF8=Tf;kt.base64UrlToUint8Array=Zv;kt.stringToUint8Array=Yv;kt.bytesToBase64URL=Xv;var ao="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ef=` 	
\r=`.split(""),Gv=(()=>{let r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Ef.length;e+=1)r[Ef[e].charCodeAt(0)]=-2;for(let e=0;e<ao.length;e+=1)r[ao[e].charCodeAt(0)]=e;return r})();function On(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){let s=e.queue>>e.queuedBits-6&63;t(ao[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){let s=e.queue>>e.queuedBits-6&63;t(ao[s]),e.queuedBits-=6}}function _u(r,e,t){let s=Gv[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Qv(r){let e=[],t=n=>{e.push(n)},s={queue:0,queuedBits:0};return vu(r,n=>{On(n,s,t)}),On(null,s,t),e.join("")}function Jv(r){let e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{Tf(o,s,t)};for(let o=0;o<r.length;o+=1)_u(r.charCodeAt(o),n,i);return e.join("")}function Sf(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function vu(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){let n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Sf(s,e)}}function Tf(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Zv(r){let e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)_u(r.charCodeAt(n),t,s);return new Uint8Array(e)}function Yv(r){let e=[];return vu(r,t=>e.push(t)),new Uint8Array(e)}function Xv(r){let e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>On(n,t,s)),On(null,t,s),e.join("")}});var ks=P(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.Deferred=ee.removeItemAsync=ee.getItemAsync=ee.setItemAsync=ee.looksLikeFetchResponse=ee.resolveFetch=ee.supportsLocalStorage=ee.isBrowser=void 0;ee.expiresAt=ew;ee.generateCallbackId=tw;ee.parseParametersFromURL=nw;ee.decodeJWT=lw;ee.sleep=dw;ee.retryable=hw;ee.generatePKCEVerifier=Rf;ee.generatePKCEChallenge=xf;ee.getCodeChallengeAndMethod=mw;ee.parseResponseAPIVersion=yw;ee.validateExp=_w;ee.getAlgorithm=vw;ee.validateUUID=bw;ee.userNotAvailableProxy=Ew;ee.insecureUserWarningProxy=Sw;ee.deepClone=Tw;var Of=oo(),Af=$r(),wu=co();function ew(r){return Math.round(Date.now()/1e3)+r}function tw(){return Symbol("auth-callback")}var rw=()=>typeof window<"u"&&typeof document<"u";ee.isBrowser=rw;var Dr={tested:!1,writable:!1},sw=()=>{if(!(0,ee.isBrowser)())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Dr.tested)return Dr.writable;let r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Dr.tested=!0,Dr.writable=!0}catch{Dr.tested=!0,Dr.writable=!1}return Dr.writable};ee.supportsLocalStorage=sw;function nw(r){let e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}var iw=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);ee.resolveFetch=iw;var ow=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function";ee.looksLikeFetchResponse=ow;var aw=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))};ee.setItemAsync=aw;var cw=async(r,e)=>{let t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}};ee.getItemAsync=cw;var uw=async(r,e)=>{await r.removeItem(e)};ee.removeItemAsync=uw;var uo=class r{constructor(){this.promise=new r.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}};ee.Deferred=uo;uo.promiseConstructor=Promise;function lw(r){let e=r.split(".");if(e.length!==3)throw new Af.AuthInvalidJwtError("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!Of.BASE64URL_REGEX.test(e[s]))throw new Af.AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse((0,wu.stringFromBase64URL)(e[0])),payload:JSON.parse((0,wu.stringFromBase64URL)(e[1])),signature:(0,wu.base64UrlToUint8Array)(e[2]),raw:{header:e[0],payload:e[1]}}}async function dw(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function hw(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{let o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function fw(r){return("0"+r.toString(16)).substr(-2)}function Rf(){let e=new Uint32Array(56);if(typeof crypto>"u"){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length,n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,fw).join("")}async function pw(r){let t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function xf(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;let t=await pw(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function mw(r,e,t=!1){let s=Rf(),n=s;t&&(n+="/PASSWORD_RECOVERY"),await(0,ee.setItemAsync)(r,`${e}-code-verifier`,n);let i=await xf(s);return[i,s===i?"plain":"s256"]}var gw=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function yw(r){let e=r.headers.get(Of.API_VERSION_HEADER_NAME);if(!e||!e.match(gw))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function _w(r){if(!r)throw new Error("Missing exp claim");let e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function vw(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var ww=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function bw(r){if(!ww.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ew(){let r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){let s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Sw(r,e){return new Proxy(r,{get:(t,s,n)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){let i=s.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,s,n)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,s,n)}})}function Tw(r){return JSON.parse(JSON.stringify(r))}});var Su=P(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.handleError=Eu;Kt._request=xw;Kt._sessionResponse=kf;Kt._sessionResponsePassword=Cw;Kt._userResponse=Pw;Kt._ssoResponse=jw;Kt._generateLinkResponse=Iw;Kt._noResolveJsonResponse=Nw;var Aw=(ne(),ue(se)),lo=oo(),bu=ks(),_r=$r(),Lr=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Ow=[502,503,504];async function Eu(r){var e;if(!(0,bu.looksLikeFetchResponse)(r))throw new _r.AuthRetryableFetchError(Lr(r),0);if(Ow.includes(r.status))throw new _r.AuthRetryableFetchError(Lr(r),r.status);let t;try{t=await r.json()}catch(i){throw new _r.AuthUnknownError(Lr(i),i)}let s,n=(0,bu.parseResponseAPIVersion)(r);if(n&&n.getTime()>=lo.API_VERSIONS["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new _r.AuthWeakPasswordError(Lr(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new _r.AuthSessionMissingError}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new _r.AuthWeakPasswordError(Lr(t),r.status,t.weak_password.reasons);throw new _r.AuthApiError(Lr(t),r.status||500,s)}var Rw=(r,e,t,s)=>{let n={method:r,headers:e?.headers||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function xw(r,e,t,s){var n;let i=Object.assign({},s?.headers);i[lo.API_VERSION_HEADER_NAME]||(i[lo.API_VERSION_HEADER_NAME]=lo.API_VERSIONS["2024-01-01"].name),s?.jwt&&(i.Authorization=`Bearer ${s.jwt}`);let o=(n=s?.query)!==null&&n!==void 0?n:{};s?.redirectTo&&(o.redirect_to=s.redirectTo);let a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await kw(r,e,t+a,{headers:i,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(c):{data:Object.assign({},c),error:null}}async function kw(r,e,t,s,n,i){let o=Rw(e,s,n,i),a;try{a=await r(t,Object.assign({},o))}catch(c){throw console.error(c),new _r.AuthRetryableFetchError(Lr(c),0)}if(a.ok||await Eu(a),s?.noResolveJson)return a;try{return await a.json()}catch(c){await Eu(c)}}function kf(r){var e;let t=null;$w(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=(0,bu.expiresAt)(r.expires_in)));let s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function Cw(r){let e=kf(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Pw(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function jw(r){return{data:r,error:null}}function Iw(r){let{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=Aw.__rest(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function Nw(r){return r}function $w(r){return r.access_token&&r.refresh_token&&r.expires_in}});var Tu=P(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.SIGN_OUT_SCOPES=void 0;ho.SIGN_OUT_SCOPES=["global","local","others"]});var fo=P(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});var Dw=(ne(),ue(se)),Ce=Su(),Ur=ks(),Au=Tu(),st=$r(),Ou=class{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=(0,Ur.resolveFetch)(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Au.SIGN_OUT_SCOPES[0]){if(Au.SIGN_OUT_SCOPES.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Au.SIGN_OUT_SCOPES.join(", ")}`);try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if((0,st.isAuthError)(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ce._userResponse})}catch(s){if((0,st.isAuthError)(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{let{options:t}=e,s=Dw.__rest(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s?.newEmail,delete n.newEmail),await(0,Ce._request)(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Ce._generateLinkResponse,redirectTo:t?.redirectTo})}catch(t){if((0,st.isAuthError)(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ce._userResponse})}catch(t){if((0,st.isAuthError)(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,a,c;try{let u={nextPage:null,lastPage:0,total:0},l=await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Ce._noResolveJsonResponse});if(l.error)throw l.error;let d=await l.json(),f=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{let g=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(y.split(";")[1].split("=")[1]);u[`${w}Page`]=g}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if((0,st.isAuthError)(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){(0,Ur.validateUUID)(e);try{return await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ce._userResponse})}catch(t){if((0,st.isAuthError)(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){(0,Ur.validateUUID)(e);try{return await(0,Ce._request)(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ce._userResponse})}catch(s){if((0,st.isAuthError)(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){(0,Ur.validateUUID)(e);try{return await(0,Ce._request)(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ce._userResponse})}catch(s){if((0,st.isAuthError)(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){(0,Ur.validateUUID)(e.userId);try{let{data:t,error:s}=await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if((0,st.isAuthError)(t))return{data:null,error:t};throw t}}async _deleteFactor(e){(0,Ur.validateUUID)(e.userId),(0,Ur.validateUUID)(e.id);try{return{data:await(0,Ce._request)(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if((0,st.isAuthError)(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,n,i,o,a,c;try{let u={nextPage:null,lastPage:0,total:0},l=await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Ce._noResolveJsonResponse});if(l.error)throw l.error;let d=await l.json(),f=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{let g=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(y.split(";")[1].split("=")[1]);u[`${w}Page`]=g}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if((0,st.isAuthError)(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if((0,st.isAuthError)(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if((0,st.isAuthError)(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await(0,Ce._request)(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if((0,st.isAuthError)(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await(0,Ce._request)(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if((0,st.isAuthError)(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if((0,st.isAuthError)(t))return{data:null,error:t};throw t}}};Ru.default=Ou});var Cf=P(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});xu.memoryLocalStorageAdapter=Lw;function Lw(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}});var ku=P(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.ProcessLockAcquireTimeoutError=He.NavigatorLockAcquireTimeoutError=He.LockAcquireTimeoutError=He.internals=void 0;He.navigatorLock=qw;He.processLock=Bw;var Uw=ks();He.internals={debug:!!(globalThis&&(0,Uw.supportsLocalStorage)()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};var Rn=class extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}};He.LockAcquireTimeoutError=Rn;var po=class extends Rn{};He.NavigatorLockAcquireTimeoutError=po;var mo=class extends Rn{};He.ProcessLockAcquireTimeoutError=mo;async function qw(r,e,t){He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);let s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new po(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(He.internals.debug)try{let i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}var Pf={};async function Bw(r,e,t){var s;let n=(s=Pf[r])!==null&&s!==void 0?s:Promise.resolve(),i=Promise.race([n.catch(()=>null),e>=0?new Promise((o,a)=>{setTimeout(()=>{a(new mo(`Acquring process lock with name "${r}" timed out`))},e)}):null].filter(o=>o)).catch(o=>{if(o&&o.isAcquireTimeout)throw o;return null}).then(async()=>await t());return Pf[r]=i.catch(async o=>{if(o&&o.isAcquireTimeout)return await n,null;throw o}),await i}});var jf=P(Cu=>{"use strict";Object.defineProperty(Cu,"__esModule",{value:!0});Cu.polyfillGlobalThis=Mw;function Mw(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}});var Nf=P(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});Cs.getAddress=If;Cs.fromHex=Fw;Cs.toHex=Vw;Cs.createSiweMessage=zw;function If(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function Fw(r){return parseInt(r,16)}function Vw(r){let e=new TextEncoder().encode(r);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function zw(r){var e;let{chainId:t,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:c,resources:u,scheme:l,uri:d,version:f}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}let p=If(r.address),y=l?`${l}://${s}`:s,g=r.statement?`${r.statement}
`:"",w=`${y} wants you to sign in with your Ethereum account:
${p}

${g}`,b=`URI: ${d}
Version: ${f}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(b+=`
Expiration Time: ${n.toISOString()}`),a&&(b+=`
Not Before: ${a.toISOString()}`),c&&(b+=`
Request ID: ${c}`),u){let A=`
Resources:`;for(let E of u){if(!E||typeof E!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${E}`);A+=`
- ${E}`}b+=A}return`${w}
${b}`}});var Df=P(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.WebAuthnUnknownError=or.WebAuthnError=void 0;or.isWebAuthnError=Hw;or.identifyRegistrationError=Kw;or.identifyAuthenticationError=Ww;var $f=ju(),je=class extends Error{constructor({message:e,code:t,cause:s,name:n}){var i;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=n??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}};or.WebAuthnError=je;var Pu=class extends je{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}};or.WebAuthnUnknownError=Pu;function Hw(r){return typeof r=="object"&&r!==null&&"__isWebAuthnError"in r}function Kw({error:r,options:e}){var t,s,n;let{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new je({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new je({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new je({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new je({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new je({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new je({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new je({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new je({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){let o=window.location.hostname;if((0,$f.isValidDomain)(o)){if(i.rp.id!==o)return new je({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new je({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new je({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new je({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new je({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function Ww({error:r,options:e}){let{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new je({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new je({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){let s=window.location.hostname;if((0,$f.isValidDomain)(s)){if(t.rpId!==s)return new je({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new je({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new je({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new je({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}});var ju=P(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.WebAuthnApi=oe.DEFAULT_REQUEST_OPTIONS=oe.DEFAULT_CREATION_OPTIONS=oe.webAuthnAbortService=oe.WebAuthnAbortService=oe.identifyAuthenticationError=oe.identifyRegistrationError=oe.isWebAuthnError=oe.WebAuthnError=void 0;oe.deserializeCredentialCreationOptions=Qw;oe.deserializeCredentialRequestOptions=Jw;oe.serializeCredentialCreationResponse=Zw;oe.serializeCredentialRequestResponse=Yw;oe.isValidDomain=Xw;oe.createCredential=qf;oe.getCredential=Bf;oe.mergeCredentialCreationOptions=Mf;oe.mergeCredentialRequestOptions=Ff;var Uf=(ne(),ue(se)),Bt=co(),Wt=$r(),Gw=ks(),Gt=Df();Object.defineProperty(oe,"identifyAuthenticationError",{enumerable:!0,get:function(){return Gt.identifyAuthenticationError}});Object.defineProperty(oe,"identifyRegistrationError",{enumerable:!0,get:function(){return Gt.identifyRegistrationError}});Object.defineProperty(oe,"isWebAuthnError",{enumerable:!0,get:function(){return Gt.isWebAuthnError}});Object.defineProperty(oe,"WebAuthnError",{enumerable:!0,get:function(){return Gt.WebAuthnError}});var go=class{createNewAbortSignal(){if(this.controller){let t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};oe.WebAuthnAbortService=go;oe.webAuthnAbortService=new go;function Qw(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);let{challenge:e,user:t,excludeCredentials:s}=r,n=Uf.__rest(r,["challenge","user","excludeCredentials"]),i=(0,Bt.base64UrlToUint8Array)(e).buffer,o=Object.assign(Object.assign({},t),{id:(0,Bt.base64UrlToUint8Array)(t.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:i,user:o});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let c=0;c<s.length;c++){let u=s[c];a.excludeCredentials[c]=Object.assign(Object.assign({},u),{id:(0,Bt.base64UrlToUint8Array)(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function Jw(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);let{challenge:e,allowCredentials:t}=r,s=Uf.__rest(r,["challenge","allowCredentials"]),n=(0,Bt.base64UrlToUint8Array)(e).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){let a=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:(0,Bt.base64UrlToUint8Array)(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function Zw(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();let t=r;return{id:r.id,rawId:r.id,response:{attestationObject:(0,Bt.bytesToBase64URL)(new Uint8Array(r.response.attestationObject)),clientDataJSON:(0,Bt.bytesToBase64URL)(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Yw(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();let t=r,s=r.getClientExtensionResults(),n=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:(0,Bt.bytesToBase64URL)(new Uint8Array(n.authenticatorData)),clientDataJSON:(0,Bt.bytesToBase64URL)(new Uint8Array(n.clientDataJSON)),signature:(0,Bt.bytesToBase64URL)(new Uint8Array(n.signature)),userHandle:n.userHandle?(0,Bt.bytesToBase64URL)(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Xw(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function Lf(){var r,e;return!!((0,Gw.isBrowser)()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator?.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function qf(r){try{let e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Gt.WebAuthnUnknownError("Browser returned unexpected credential type",e)}:{data:null,error:new Gt.WebAuthnUnknownError("Empty credential response",e)}}catch(e){return{data:null,error:(0,Gt.identifyRegistrationError)({error:e,options:r})}}}async function Bf(r){try{let e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Gt.WebAuthnUnknownError("Browser returned unexpected credential type",e)}:{data:null,error:new Gt.WebAuthnUnknownError("Empty credential response",e)}}catch(e){return{data:null,error:(0,Gt.identifyAuthenticationError)({error:e,options:r})}}}oe.DEFAULT_CREATION_OPTIONS={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"};oe.DEFAULT_REQUEST_OPTIONS={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function yo(...r){let e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),t=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(let n of r)if(n)for(let i in n){let o=n[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(t(o))s[i]=o;else if(e(o)){let a=s[i];e(a)?s[i]=yo(a,o):s[i]=yo(o)}else s[i]=o}return s}function Mf(r,e){return yo(oe.DEFAULT_CREATION_OPTIONS,r,e||{})}function Ff(r,e){return yo(oe.DEFAULT_REQUEST_OPTIONS,r,e||{})}var Iu=class{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:n},i){try{let{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};let c=n??oe.webAuthnAbortService.createNewAbortSignal();if(o.webauthn.type==="create"){let{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${s}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{let u=Mf(o.webauthn.credential_options.publicKey,i?.create),{data:l,error:d}=await qf({publicKey:u,signal:c});return l?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:l}},error:null}:{data:null,error:d}}case"request":{let u=Ff(o.webauthn.credential_options.publicKey,i?.request),{data:l,error:d}=await Bf(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:c}));return l?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:l}},error:null}:{data:null,error:d}}}}catch(o){return(0,Wt.isAuthError)(o)?{data:null,error:o}:{data:null,error:new Wt.AuthUnknownError("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Wt.AuthError("rpId is required for WebAuthn authentication")};try{if(!Lf())return{data:null,error:new Wt.AuthUnknownError("Browser does not support WebAuthn",null)};let{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:n},{request:i});if(!o)return{data:null,error:a};let{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:s,credential_response:c.credential_response}})}catch(o){return(0,Wt.isAuthError)(o)?{data:null,error:o}:{data:null,error:new Wt.AuthUnknownError("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Wt.AuthError("rpId is required for WebAuthn registration")};try{if(!Lf())return{data:null,error:new Wt.AuthUnknownError("Browser does not support WebAuthn",null)};let{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(l=>{var d;return(d=l.data)===null||d===void 0?void 0:d.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(l=>l?this.client.mfa.unenroll({factorId:l?.id}):void 0),{data:null,error:a};let{data:c,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:n},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:s,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:u}}catch(o){return(0,Wt.isAuthError)(o)?{data:null,error:o}:{data:null,error:new Wt.AuthUnknownError("Unexpected error in register",o)}}}};oe.WebAuthnApi=Iu});var $u=P(Nu=>{"use strict";Object.defineProperty(Nu,"__esModule",{value:!0});var eb=(ne(),ue(se)),tb=eb.__importDefault(fo()),gt=oo(),j=$r(),H=Su(),$=ks(),Vf=Cf(),zf=ku(),rb=jf(),sb=au(),Hf=co(),_o=Nf(),xn=ju();(0,rb.polyfillGlobalThis)();var nb={url:gt.GOTRUE_URL,storageKey:gt.STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:gt.DEFAULT_HEADERS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Kf(r,e,t){return await t()}var Ps={},vo=class r{get jwks(){var e,t;return(t=(e=Ps[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Ps[this.storageKey]=Object.assign(Object.assign({},Ps[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Ps[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ps[this.storageKey]=Object.assign(Object.assign({},Ps[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;let i=Object.assign(Object.assign({},nb),e);if(this.storageKey=i.storageKey,this.instanceID=(t=r.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,r.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&(0,$.isBrowser)()){let o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new tb.default({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=(0,$.resolveFetch)(i.fetch),this.lock=i.lock||Kf,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:(0,$.isBrowser)()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=zf.navigatorLock:this.lock=Kf,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new xn.WebAuthnApi(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:(0,$.supportsLocalStorage)()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=(0,Vf.memoryLocalStorageAdapter)(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=(0,Vf.memoryLocalStorageAdapter)(this.memoryStorage)),(0,$.isBrowser)()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${sb.version}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},s="none";if((0,$.isBrowser)()&&(t=(0,$.parseParametersFromURL)(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),(0,$.isBrowser)()&&this.detectSessionInUrl&&s!=="none"){let{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),(0,j.isAuthImplicitGrantRedirectError)(i)){let c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}let{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return(0,j.isAuthError)(t)?this._returnResult({error:t}):this._returnResult({error:new j.AuthUnknownError("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{let i=await(0,H._request)(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:H._sessionResponse}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});let c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if((0,j.isAuthError)(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){let{email:l,password:d,options:f}=e,p=null,y=null;this.flowType==="pkce"&&([p,y]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey)),i=await(0,H._request)(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:l,password:d,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:y},xform:H._sessionResponse})}else if("phone"in e){let{phone:l,password:d,options:f}=e;i=await(0,H._request)(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:d,data:(s=f?.data)!==null&&s!==void 0?s:{},channel:(n=f?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:H._sessionResponse})}else throw new j.AuthInvalidCredentialsError("You must provide either an email or phone number and a password");let{data:o,error:a}=i;if(a||!o)return await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});let c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){let{email:i,password:o,options:a}=e;t=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:H._sessionResponsePassword})}else if("phone"in e){let{phone:i,password:o,options:a}=e;t=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:H._sessionResponsePassword})}else throw new j.AuthInvalidCredentialsError("You must provide either an email or phone number and a password");let{data:s,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!s||!s.session||!s.user){let i=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:i})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,n,i,o,a,c,u,l,d,f;let p,y;if("message"in e)p=e.message,y=e.signature;else{let{chain:g,wallet:w,statement:b,options:A}=e,E;if((0,$.isBrowser)())if(typeof w=="object")E=w;else{let Y=window;if("ethereum"in Y&&typeof Y.ethereum=="object"&&"request"in Y.ethereum&&typeof Y.ethereum.request=="function")E=Y.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!A?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=w}let x=new URL((t=A?.url)!==null&&t!==void 0?t:window.location.href),U=await E.request({method:"eth_requestAccounts"}).then(Y=>Y).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!U||U.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let V=(0,_o.getAddress)(U[0]),N=(s=A?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!N){let Y=await E.request({method:"eth_chainId"});N=(0,_o.fromHex)(Y)}let W={domain:x.host,address:V,statement:b,uri:x.href,version:"1",chainId:N,nonce:(n=A?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=A?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=A?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(c=A?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(u=A?.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(l=A?.signInWithEthereum)===null||l===void 0?void 0:l.resources};p=(0,_o.createSiweMessage)(W),y=await E.request({method:"personal_sign",params:[(0,_o.toHex)(p),V]})}try{let{data:g,error:w}=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:y},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:H._sessionResponse});if(w)throw w;if(!g||!g.session||!g.user){let b=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:b})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:w})}catch(g){if((0,j.isAuthError)(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var t,s,n,i,o,a,c,u,l,d,f,p;let y,g;if("message"in e)y=e.message,g=e.signature;else{let{chain:w,wallet:b,statement:A,options:E}=e,x;if((0,$.isBrowser)())if(typeof b=="object")x=b;else{let V=window;if("solana"in V&&typeof V.solana=="object"&&("signIn"in V.solana&&typeof V.solana.signIn=="function"||"signMessage"in V.solana&&typeof V.solana.signMessage=="function"))x=V.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!E?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=b}let U=new URL((t=E?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in x&&x.signIn){let V=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},E?.signInWithSolana),{version:"1",domain:U.host,uri:U.href}),A?{statement:A}:null)),N;if(Array.isArray(V)&&V[0]&&typeof V[0]=="object")N=V[0];else if(V&&typeof V=="object"&&"signedMessage"in V&&"signature"in V)N=V;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in N&&"signature"in N&&(typeof N.signedMessage=="string"||N.signedMessage instanceof Uint8Array)&&N.signature instanceof Uint8Array)y=typeof N.signedMessage=="string"?N.signedMessage:new TextDecoder().decode(N.signedMessage),g=N.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${U.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...A?["",A,""]:[""],"Version: 1",`URI: ${U.href}`,`Issued At: ${(n=(s=E?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=E?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${E.signInWithSolana.notBefore}`]:[],...!((o=E?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${E.signInWithSolana.expirationTime}`]:[],...!((a=E?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${E.signInWithSolana.chainId}`]:[],...!((c=E?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${E.signInWithSolana.nonce}`]:[],...!((u=E?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${E.signInWithSolana.requestId}`]:[],...!((d=(l=E?.signInWithSolana)===null||l===void 0?void 0:l.resources)===null||d===void 0)&&d.length?["Resources",...E.signInWithSolana.resources.map(N=>`- ${N}`)]:[]].join(`
`);let V=await x.signMessage(new TextEncoder().encode(y),"utf8");if(!V||!(V instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=V}}try{let{data:w,error:b}=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:(0,Hf.bytesToBase64URL)(g)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:H._sessionResponse});if(b)throw b;if(!w||!w.session||!w.user){let A=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:A})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:b})}catch(w){if((0,j.isAuthError)(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async _exchangeCodeForSession(e){let t=await(0,$.getItemAsync)(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{let{data:i,error:o}=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:H._sessionResponse});if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){let a=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{let{options:t,provider:s,token:n,access_token:i,nonce:o}=e,a=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:H._sessionResponse}),{data:c,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!c||!c.session||!c.user){let l=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:l})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:u})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){let{email:a,options:c}=e,u=null,l=null;this.flowType==="pkce"&&([u,l]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey));let{error:d}=await(0,H._request)(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:l},redirectTo:c?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){let{phone:a,options:c}=e,{data:u,error:l}=await(0,H._request)(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=c?.data)!==null&&n!==void 0?n:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u?.message_id},error:l})}throw new j.AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(a){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);let{data:o,error:a}=await(0,H._request)(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:H._sessionResponse});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");let c=o.session,u=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(n){if((0,j.isAuthError)(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var t,s,n,i,o;try{let a=null,c=null;this.flowType==="pkce"&&([a,c]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey));let u=await(0,H._request)(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:c}),headers:this.headers,xform:H._ssoResponse});return!((i=u.data)===null||i===void 0)&&i.url&&(0,$.isBrowser)()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new j.AuthSessionMissingError;let{error:n}=await(0,H._request)(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if((0,j.isAuthError)(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:s,type:n,options:i}=e,{error:o}=await(0,H._request)(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){let{phone:s,type:n,options:i}=e,{data:o,error:a}=await(0,H._request)(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new j.AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){let n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,t=await(0,$.getItemAsync)(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let s=e.expires_at?e.expires_at*1e3-Date.now()<gt.EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){let o=await(0,$.getItemAsync)(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=(0,$.userNotAvailableProxy)()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){let o={value:this.suppressGetSessionWarning};e.user=(0,$.insecureUserWarningProxy)(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}let{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;let t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await(0,H._request)(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:H._userResponse}):await this._useSession(async t=>{var s,n,i;let{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new j.AuthSessionMissingError}:await(0,H._request)(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:H._userResponse})})}catch(t){if((0,j.isAuthError)(t))return(0,j.isAuthSessionMissingError)(t)&&(await this._removeSession(),await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{let{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new j.AuthSessionMissingError;let o=n.session,a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey));let{data:u,error:l}=await(0,H._request)(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:H._userResponse});if(l)throw l;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new j.AuthSessionMissingError;let t=Date.now()/1e3,s=t,n=!0,i=null,{payload:o}=(0,$.decodeJWT)(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){let{data:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!a)return{data:{user:null,session:null},error:null};i=a}else{let{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){let{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new j.AuthSessionMissingError;let{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!(0,$.isBrowser)())throw new j.AuthImplicitGrantRedirectError("No browser detected.");if(e.error||e.error_description||e.error_code)throw new j.AuthImplicitGrantRedirectError(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new j.AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new j.AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new j.AuthPKCEGrantCodeExchangeError("No code detected.");let{data:A,error:E}=await this._exchangeCodeForSession(e.code);if(E)throw E;let x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:A.session,redirectType:null},error:null}}let{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:u}=e;if(!i||!a||!o||!u)throw new j.AuthImplicitGrantRedirectError("No session defined in URL");let l=Math.round(Date.now()/1e3),d=parseInt(a),f=l+d;c&&(f=parseInt(c));let p=f-l;p*1e3<=gt.AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);let y=f-d;l-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,l):l-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,l);let{data:g,error:w}=await this._getUser(i);if(w)throw w;let b={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:d,expires_at:f,refresh_token:o,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:b,redirectType:e.type},error:null})}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await(0,$.getItemAsync)(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;let{data:n,error:i}=t;if(i)return this._returnResult({error:i});let o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){let{error:a}=await this.admin.signOut(o,e);if(a&&!((0,j.isAuthApiError)(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){let t=(0,$.generateCallbackId)(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{let{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey,!0));try{return await(0,H._request)(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{let{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{let{data:s,error:n}=await this._useSession(async i=>{var o,a,c,u,l;let{data:d,error:f}=i;if(f)throw f;let p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await(0,H._request)(this.fetch,"GET",p,{headers:this.headers,jwt:(l=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&l!==void 0?l:void 0})});if(n)throw n;return(0,$.isBrowser)()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:e.provider,url:s?.url},error:null})}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{let{error:n,data:{session:i}}=t;if(n)throw n;let{options:o,provider:a,token:c,access_token:u,nonce:l}=e,d=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:c,access_token:u,nonce:l,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:H._sessionResponse}),{data:f,error:p}=d;return p?this._returnResult({data:{user:null,session:null},error:p}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new j.AuthInvalidTokenResponseError}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:p}))}catch(n){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;let{data:i,error:o}=t;if(o)throw o;return await(0,H._request)(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{let s=Date.now();return await(0,$.retryable)(async n=>(n>0&&await(0,$.sleep)(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:H._sessionResponse})),(n,i)=>{let o=200*Math.pow(2,n);return i&&(0,j.isAuthRetryableFetchError)(i)&&Date.now()+o-s<gt.AUTO_REFRESH_TICK_DURATION_MS})}catch(s){if(this._debug(t,"error",s),(0,j.isAuthError)(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),(0,$.isBrowser)()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;let s="#_recoverAndRefresh()";this._debug(s,"begin");try{let n=await(0,$.getItemAsync)(this.storage,this.storageKey);if(n&&this.userStorage){let o=await(0,$.getItemAsync)(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await(0,$.setItemAsync)(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o?.user)!==null&&e!==void 0?e:(0,$.userNotAvailableProxy)()}else if(n&&!n.user&&!n.user){let o=await(0,$.getItemAsync)(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await(0,$.removeItemAsync)(this.storage,this.storageKey+"-user"),await(0,$.setItemAsync)(this.storage,this.storageKey,n)):n.user=(0,$.userNotAvailableProxy)()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}let i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<gt.EXPIRY_MARGIN_MS;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${gt.EXPIRY_MARGIN_MS}s`),i){if(this.autoRefreshToken&&n.refresh_token){let{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),(0,j.isAuthRetryableFetchError)(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{let{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new j.AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new $.Deferred;let{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new j.AuthSessionMissingError;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);let a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),(0,j.isAuthError)(i)){let o={data:null,error:i};return(0,j.isAuthRetryableFetchError)(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){let n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});let i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`);let t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await(0,$.setItemAsync)(this.userStorage,this.storageKey+"-user",{user:t.user});let n=Object.assign({},t);delete n.user;let i=(0,$.deepClone)(n);await(0,$.setItemAsync)(this.storage,this.storageKey,i)}else{let n=(0,$.deepClone)(t);await(0,$.setItemAsync)(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await(0,$.removeItemAsync)(this.storage,this.storageKey),await(0,$.removeItemAsync)(this.storage,this.storageKey+"-code-verifier"),await(0,$.removeItemAsync)(this.storage,this.storageKey+"-user"),this.userStorage&&await(0,$.removeItemAsync)(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&(0,$.isBrowser)()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),gt.AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let n=Math.floor((s.expires_at*1e3-e)/gt.AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${gt.AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${gt.AUTO_REFRESH_TICK_THRESHOLD} ticks`),n<=gt.AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof zf.LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!(0,$.isBrowser)()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){let n=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){let[i,o]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s?.queryParams){let i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s?.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;let{data:n,error:i}=t;return i?this._returnResult({data:null,error:i}):await(0,H._request)(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;let{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});let a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:u}=await(0,H._request)(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&c.type==="totp"&&(!((n=c?.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;let{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});let o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?(0,xn.serializeCredentialCreationResponse)(e.webauthn.credential_response):(0,xn.serializeCredentialRequestResponse)(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:c}=await(0,H._request)(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:c}))})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;let{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});let o=await(0,H._request)(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;let{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:(0,xn.deserializeCredentialCreationOptions)(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:(0,xn.deserializeCredentialRequestOptions)(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){let{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;let{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};let n={all:[],phone:[],totp:[],webauthn:[]};for(let i of(e=t?.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;let{data:{session:s},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:i}=(0,$.decodeJWT)(s.access_token),o=null;i.aal&&(o=i.aal);let a=o;((t=(e=s.user.factors)===null||e===void 0?void 0:e.filter(l=>l.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");let u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{let{data:{session:s},error:n}=t;return n?this._returnResult({data:null,error:n}):s?await(0,H._request)(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new j.AuthSessionMissingError})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{let{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new j.AuthSessionMissingError});let o=await(0,H._request)(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&(0,$.isBrowser)()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{let{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new j.AuthSessionMissingError});let o=await(0,H._request)(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&(0,$.isBrowser)()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;return s?this._returnResult({data:null,error:s}):t?await(0,H._request)(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new j.AuthSessionMissingError})})}catch(e){if((0,j.isAuthError)(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{let{data:{session:s},error:n}=t;return n?this._returnResult({data:null,error:n}):s?(await(0,H._request)(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new j.AuthSessionMissingError})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(a=>a.kid===e);if(s)return s;let n=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+gt.JWKS_TTL>n)return s;let{data:i,error:o}=await(0,H._request)(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){let{data:p,error:y}=await this.getSession();if(y||!p.session)return this._returnResult({data:null,error:y});s=p.session.access_token}let{header:n,payload:i,signature:o,raw:{header:a,payload:c}}=(0,$.decodeJWT)(s);t?.allowExpired||(0,$.validateExp)(i.exp);let u=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!u){let{error:p}=await this.getUser(s);if(p)throw p;return{data:{claims:i,header:n,signature:o},error:null}}let l=(0,$.getAlgorithm)(n.alg),d=await crypto.subtle.importKey("jwk",u,l,!0,["verify"]);if(!await crypto.subtle.verify(l,d,o,(0,Hf.stringToUint8Array)(`${a}.${c}`)))throw new j.AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:null,error:s});throw s}}};vo.nextInstanceID={};Nu.default=vo});var Wf=P(Du=>{"use strict";Object.defineProperty(Du,"__esModule",{value:!0});var ib=(ne(),ue(se)),ob=ib.__importDefault(fo()),ab=ob.default;Du.default=ab});var Gf=P(Lu=>{"use strict";Object.defineProperty(Lu,"__esModule",{value:!0});var cb=(ne(),ue(se)),ub=cb.__importDefault($u()),lb=ub.default;Lu.default=lb});var Uu=P(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.processLock=qe.lockInternals=qe.NavigatorLockAcquireTimeoutError=qe.navigatorLock=qe.AuthClient=qe.AuthAdminApi=qe.GoTrueClient=qe.GoTrueAdminApi=void 0;var js=(ne(),ue(se)),db=js.__importDefault(fo());qe.GoTrueAdminApi=db.default;var hb=js.__importDefault($u());qe.GoTrueClient=hb.default;var fb=js.__importDefault(Wf());qe.AuthAdminApi=fb.default;var pb=js.__importDefault(Gf());qe.AuthClient=pb.default;js.__exportStar(Tu(),qe);js.__exportStar($r(),qe);var wo=ku();Object.defineProperty(qe,"navigatorLock",{enumerable:!0,get:function(){return wo.navigatorLock}});Object.defineProperty(qe,"NavigatorLockAcquireTimeoutError",{enumerable:!0,get:function(){return wo.NavigatorLockAcquireTimeoutError}});Object.defineProperty(qe,"lockInternals",{enumerable:!0,get:function(){return wo.internals}});Object.defineProperty(qe,"processLock",{enumerable:!0,get:function(){return wo.processLock}})});var Qf=P(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.SupabaseAuthClient=void 0;var mb=Uu(),qu=class extends mb.AuthClient{constructor(e){super(e)}};bo.SupabaseAuthClient=qu});var Fu=P(Mu=>{"use strict";Object.defineProperty(Mu,"__esModule",{value:!0});var gb=Fa(),yb=ic(),_b=Sc(),vb=gf(),Eo=_f(),wb=vf(),Jf=bf(),bb=Qf(),Bu=class{constructor(e,t,s){var n,i,o;this.supabaseUrl=e,this.supabaseKey=t;let a=(0,Jf.validateSupabaseUrl)(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);let c=`sb-${a.hostname.split(".")[0]}-auth-token`,u={db:Eo.DEFAULT_DB_OPTIONS,realtime:Eo.DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},Eo.DEFAULT_AUTH_OPTIONS),{storageKey:c}),global:Eo.DEFAULT_GLOBAL_OPTIONS},l=(0,Jf.applySettingDefaults)(s??{},u);this.storageKey=(n=l.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=l.auth)!==null&&o!==void 0?o:{},this.headers,l.global.fetch),this.fetch=(0,wb.fetchWithAuth)(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new yb.PostgrestClient(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new vb.StorageClient(this.storageUrl.href,this.headers,this.fetch,s?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new gb.FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:s}=await this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,storageKey:o,flowType:a,lock:c,debug:u,throwOnError:l},d,f){let p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new bb.SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),d),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,flowType:a,lock:c,debug:u,throwOnError:l,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(y=>y.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new _b.RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};Mu.default=Bu});var Xf=P(Te=>{"use strict";var Eb=Te&&Te.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),Zf=Te&&Te.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Eb(e,r,t)},Yf=Te&&Te.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Te,"__esModule",{value:!0});Te.createClient=Te.SupabaseClient=Te.FunctionRegion=Te.FunctionsError=Te.FunctionsRelayError=Te.FunctionsFetchError=Te.FunctionsHttpError=Te.PostgrestError=void 0;var Sb=Yf(Fu());Zf(Uu(),Te);var Tb=ic();Object.defineProperty(Te,"PostgrestError",{enumerable:!0,get:function(){return Tb.PostgrestError}});var kn=Fa();Object.defineProperty(Te,"FunctionsHttpError",{enumerable:!0,get:function(){return kn.FunctionsHttpError}});Object.defineProperty(Te,"FunctionsFetchError",{enumerable:!0,get:function(){return kn.FunctionsFetchError}});Object.defineProperty(Te,"FunctionsRelayError",{enumerable:!0,get:function(){return kn.FunctionsRelayError}});Object.defineProperty(Te,"FunctionsError",{enumerable:!0,get:function(){return kn.FunctionsError}});Object.defineProperty(Te,"FunctionRegion",{enumerable:!0,get:function(){return kn.FunctionRegion}});Zf(Sc(),Te);var Ab=Fu();Object.defineProperty(Te,"SupabaseClient",{enumerable:!0,get:function(){return Yf(Ab).default}});var Ob=(r,e,t)=>new Sb.default(r,e,t);Te.createClient=Ob;function Rb(){if(typeof window<"u"||typeof process>"u")return!1;let r=process.version;if(r==null)return!1;let e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Rb()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217")});var hp=P((sx,q0)=>{q0.exports={name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}});var yp=P((nx,dr)=>{var Wu=li("fs"),xo=li("path"),B0=li("os"),M0=li("crypto"),F0=hp(),Gu=F0.version,V0=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function z0(r){let e={},t=r.toString();t=t.replace(/\r\n?/mg,`
`);let s;for(;(s=V0.exec(t))!=null;){let n=s[1],i=s[2]||"";i=i.trim();let o=i[0];i=i.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),o==='"'&&(i=i.replace(/\\n/g,`
`),i=i.replace(/\\r/g,"\r")),e[n]=i}return e}function H0(r){r=r||{};let e=gp(r);r.path=e;let t=Ve.configDotenv(r);if(!t.parsed){let o=new Error(`MISSING_DATA: Cannot parse ${e} for an unknown reason`);throw o.code="MISSING_DATA",o}let s=mp(r).split(","),n=s.length,i;for(let o=0;o<n;o++)try{let a=s[o].trim(),c=W0(t,a);i=Ve.decrypt(c.ciphertext,c.key);break}catch(a){if(o+1>=n)throw a}return Ve.parse(i)}function K0(r){console.log(`[dotenv@${Gu}][WARN] ${r}`)}function In(r){console.log(`[dotenv@${Gu}][DEBUG] ${r}`)}function pp(r){console.log(`[dotenv@${Gu}] ${r}`)}function mp(r){return r&&r.DOTENV_KEY&&r.DOTENV_KEY.length>0?r.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function W0(r,e){let t;try{t=new URL(e)}catch(a){if(a.code==="ERR_INVALID_URL"){let c=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw c.code="INVALID_DOTENV_KEY",c}throw a}let s=t.password;if(!s){let a=new Error("INVALID_DOTENV_KEY: Missing key part");throw a.code="INVALID_DOTENV_KEY",a}let n=t.searchParams.get("environment");if(!n){let a=new Error("INVALID_DOTENV_KEY: Missing environment part");throw a.code="INVALID_DOTENV_KEY",a}let i=`DOTENV_VAULT_${n.toUpperCase()}`,o=r.parsed[i];if(!o){let a=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${i} in your .env.vault file.`);throw a.code="NOT_FOUND_DOTENV_ENVIRONMENT",a}return{ciphertext:o,key:s}}function gp(r){let e=null;if(r&&r.path&&r.path.length>0)if(Array.isArray(r.path))for(let t of r.path)Wu.existsSync(t)&&(e=t.endsWith(".vault")?t:`${t}.vault`);else e=r.path.endsWith(".vault")?r.path:`${r.path}.vault`;else e=xo.resolve(process.cwd(),".env.vault");return Wu.existsSync(e)?e:null}function fp(r){return r[0]==="~"?xo.join(B0.homedir(),r.slice(1)):r}function G0(r){let e=!!(r&&r.debug),t=r&&"quiet"in r?r.quiet:!0;(e||!t)&&pp("Loading env from encrypted .env.vault");let s=Ve._parseVault(r),n=process.env;return r&&r.processEnv!=null&&(n=r.processEnv),Ve.populate(n,s,r),{parsed:s}}function Q0(r){let e=xo.resolve(process.cwd(),".env"),t="utf8",s=!!(r&&r.debug),n=r&&"quiet"in r?r.quiet:!0;r&&r.encoding?t=r.encoding:s&&In("No encoding is specified. UTF-8 is used by default");let i=[e];if(r&&r.path)if(!Array.isArray(r.path))i=[fp(r.path)];else{i=[];for(let u of r.path)i.push(fp(u))}let o,a={};for(let u of i)try{let l=Ve.parse(Wu.readFileSync(u,{encoding:t}));Ve.populate(a,l,r)}catch(l){s&&In(`Failed to load ${u} ${l.message}`),o=l}let c=process.env;if(r&&r.processEnv!=null&&(c=r.processEnv),Ve.populate(c,a,r),s||!n){let u=Object.keys(a).length,l=[];for(let d of i)try{let f=xo.relative(process.cwd(),d);l.push(f)}catch(f){s&&In(`Failed to load ${d} ${f.message}`),o=f}pp(`injecting env (${u}) from ${l.join(",")}`)}return o?{parsed:a,error:o}:{parsed:a}}function J0(r){if(mp(r).length===0)return Ve.configDotenv(r);let e=gp(r);return e?Ve._configVault(r):(K0(`You set DOTENV_KEY but you are missing a .env.vault file at ${e}. Did you forget to build it?`),Ve.configDotenv(r))}function Z0(r,e){let t=Buffer.from(e.slice(-64),"hex"),s=Buffer.from(r,"base64"),n=s.subarray(0,12),i=s.subarray(-16);s=s.subarray(12,-16);try{let o=M0.createDecipheriv("aes-256-gcm",t,n);return o.setAuthTag(i),`${o.update(s)}${o.final()}`}catch(o){let a=o instanceof RangeError,c=o.message==="Invalid key length",u=o.message==="Unsupported state or unable to authenticate data";if(a||c){let l=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw l.code="INVALID_DOTENV_KEY",l}else if(u){let l=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw l.code="DECRYPTION_FAILED",l}else throw o}}function Y0(r,e,t={}){let s=!!(t&&t.debug),n=!!(t&&t.override);if(typeof e!="object"){let i=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw i.code="OBJECT_REQUIRED",i}for(let i of Object.keys(e))Object.prototype.hasOwnProperty.call(r,i)?(n===!0&&(r[i]=e[i]),s&&In(n===!0?`"${i}" is already defined and WAS overwritten`:`"${i}" is already defined and was NOT overwritten`)):r[i]=e[i]}var Ve={configDotenv:Q0,_configVault:G0,_parseVault:H0,config:J0,decrypt:Z0,parse:z0,populate:Y0};dr.exports.configDotenv=Ve.configDotenv;dr.exports._configVault=Ve._configVault;dr.exports._parseVault=Ve._parseVault;dr.exports.config=Ve.config;dr.exports.decrypt=Ve.decrypt;dr.exports.parse=Ve.parse;dr.exports.populate=Ve.populate;dr.exports=Ve});import{createServer as Yg}from"http";import{Http2ServerRequest as Xg}from"http2";import{Http2ServerRequest as ya}from"http2";import{Readable as Ed}from"stream";import dy from"crypto";var xr=class extends Error{constructor(r,e){super(r,e),this.name="RequestError"}},ey=r=>r instanceof xr?r:new xr(r.message,{cause:r}),ty=global.Request,rn=class extends ty{constructor(r,e){typeof r=="object"&&ds in r&&(r=r[ds]()),typeof e?.body?.getReader<"u"&&(e.duplex??="half"),super(r,e)}},ry=r=>{let e=[],t=r.rawHeaders;for(let s=0;s<t.length;s+=2){let{[s]:n,[s+1]:i}=t;n.charCodeAt(0)!==58&&e.push([n,i])}return new Headers(e)},Td=Symbol("wrapBodyStream"),sy=(r,e,t,s,n)=>{let i={method:r,headers:t,signal:n.signal};if(r==="TRACE"){i.method="GET";let o=new rn(e,i);return Object.defineProperty(o,"method",{get(){return"TRACE"}}),o}if(!(r==="GET"||r==="HEAD"))if("rawBody"in s&&s.rawBody instanceof Buffer)i.body=new ReadableStream({start(o){o.enqueue(s.rawBody),o.close()}});else if(s[Td]){let o;i.body=new ReadableStream({async pull(a){try{o||=Ed.toWeb(s).getReader();let{done:c,value:u}=await o.read();c?a.close():a.enqueue(u)}catch(c){a.error(c)}}})}else i.body=Ed.toWeb(s);return new rn(e,i)},ds=Symbol("getRequestCache"),ny=Symbol("requestCache"),di=Symbol("incomingKey"),hi=Symbol("urlKey"),iy=Symbol("headersKey"),ls=Symbol("abortControllerKey"),oy=Symbol("getAbortController"),fi={get method(){return this[di].method||"GET"},get url(){return this[hi]},get headers(){return this[iy]||=ry(this[di])},[oy](){return this[ds](),this[ls]},[ds](){return this[ls]||=new AbortController,this[ny]||=sy(this.method,this[hi],this.headers,this[di],this[ls])}};["body","bodyUsed","cache","credentials","destination","integrity","mode","redirect","referrer","referrerPolicy","signal","keepalive"].forEach(r=>{Object.defineProperty(fi,r,{get(){return this[ds]()[r]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(r=>{Object.defineProperty(fi,r,{value:function(){return this[ds]()[r]()}})});Object.setPrototypeOf(fi,rn.prototype);var ay=(r,e)=>{let t=Object.create(fi);t[di]=r;let s=r.url||"";if(s[0]!=="/"&&(s.startsWith("http://")||s.startsWith("https://"))){if(r instanceof ya)throw new xr("Absolute URL for :path is not allowed in HTTP/2");try{let a=new URL(s);t[hi]=a.href}catch(a){throw new xr("Invalid absolute URL",{cause:a})}return t}let n=(r instanceof ya?r.authority:r.headers.host)||e;if(!n)throw new xr("Missing host header");let i;if(r instanceof ya){if(i=r.scheme,!(i==="http"||i==="https"))throw new xr("Unsupported scheme")}else i=r.socket&&r.socket.encrypted?"https":"http";let o=new URL(`${i}://${n}${s}`);if(o.hostname.length!==n.length&&o.hostname!==n.replace(/:\d+$/,""))throw new xr("Invalid host header");return t[hi]=o.href,t},Sd=Symbol("responseCache"),us=Symbol("getResponseCache"),kr=Symbol("cache"),va=global.Response,sn=class Ad{#t;#e;[us](){return delete this[kr],this[Sd]||=new va(this.#t,this.#e)}constructor(e,t){let s;if(this.#t=e,t instanceof Ad){let n=t[Sd];if(n){this.#e=n,this[us]();return}else this.#e=t.#e,s=new Headers(t.#e.headers)}else this.#e=t;(typeof e=="string"||typeof e?.getReader<"u"||e instanceof Blob||e instanceof Uint8Array)&&(s||=t?.headers||{"content-type":"text/plain; charset=UTF-8"},this[kr]=[t?.status||200,e,s])}get headers(){let e=this[kr];return e?(e[2]instanceof Headers||(e[2]=new Headers(e[2])),e[2]):this[us]().headers}get status(){return this[kr]?.[0]??this[us]().status}get ok(){let e=this.status;return e>=200&&e<300}};["body","bodyUsed","redirected","statusText","trailers","type","url"].forEach(r=>{Object.defineProperty(sn.prototype,r,{get(){return this[us]()[r]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(r=>{Object.defineProperty(sn.prototype,r,{value:function(){return this[us]()[r]()}})});Object.setPrototypeOf(sn,va);Object.setPrototypeOf(sn.prototype,va.prototype);async function cy(r){return Promise.race([r,Promise.resolve().then(()=>Promise.resolve(void 0))])}function Od(r,e,t){let s=a=>{r.cancel(a).catch(()=>{})};return e.on("close",s),e.on("error",s),(t??r.read()).then(o,n),r.closed.finally(()=>{e.off("close",s),e.off("error",s)});function n(a){a&&e.destroy(a)}function i(){r.read().then(o,n)}function o({done:a,value:c}){try{if(a)e.end();else if(!e.write(c))e.once("drain",i);else return r.read().then(o,n)}catch(u){n(u)}}}function uy(r,e){if(r.locked)throw new TypeError("ReadableStream is locked.");return e.destroyed?void 0:Od(r.getReader(),e)}var Rd=r=>{let e={};r instanceof Headers||(r=new Headers(r??void 0));let t=[];for(let[s,n]of r)s==="set-cookie"?t.push(n):e[s]=n;return t.length>0&&(e["set-cookie"]=t),e["content-type"]??="text/plain; charset=UTF-8",e},ly="x-hono-already-sent",hy=global.fetch;typeof global.crypto>"u"&&(global.crypto=dy);global.fetch=(r,e)=>(e={compress:!1,...e},hy(r,e));var wa=Symbol("outgoingEnded"),fy=()=>new Response(null,{status:400}),xd=r=>new Response(null,{status:r instanceof Error&&(r.name==="TimeoutError"||r.constructor.name==="TimeoutError")?504:500}),_a=(r,e)=>{let t=r instanceof Error?r:new Error("unknown error",{cause:r});t.code==="ERR_STREAM_PREMATURE_CLOSE"?console.info("The user aborted a request."):(console.error(r),e.headersSent||e.writeHead(500,{"Content-Type":"text/plain"}),e.end(`Error: ${t.message}`),e.destroy(t))},kd=r=>{"flushHeaders"in r&&r.writable&&r.flushHeaders()},Cd=async(r,e)=>{let[t,s,n]=r[kr];n instanceof Headers&&(n=Rd(n)),typeof s=="string"?n["Content-Length"]=Buffer.byteLength(s):s instanceof Uint8Array?n["Content-Length"]=s.byteLength:s instanceof Blob&&(n["Content-Length"]=s.size),e.writeHead(t,n),typeof s=="string"||s instanceof Uint8Array?e.end(s):s instanceof Blob?e.end(new Uint8Array(await s.arrayBuffer())):(kd(e),await uy(s,e)?.catch(i=>_a(i,e))),e[wa]?.()},py=r=>typeof r.then=="function",my=async(r,e,t={})=>{if(py(r))if(t.errorHandler)try{r=await r}catch(n){let i=await t.errorHandler(n);if(!i)return;r=i}else r=await r.catch(xd);if(kr in r)return Cd(r,e);let s=Rd(r.headers);if(r.body){let n=r.body.getReader(),i=[],o=!1,a;if(s["transfer-encoding"]!=="chunked"){let c=2;for(let u=0;u<c;u++){a||=n.read();let l=await cy(a).catch(d=>{console.error(d),o=!0});if(!l){if(u===1){await new Promise(d=>setTimeout(d)),c=3;continue}break}if(a=void 0,l.value&&i.push(l.value),l.done){o=!0;break}}o&&!("content-length"in s)&&(s["content-length"]=i.reduce((u,l)=>u+l.length,0))}e.writeHead(r.status,s),i.forEach(c=>{e.write(c)}),o?e.end():(i.length===0&&kd(e),await Od(n,e,a))}else s[ly]||(e.writeHead(r.status,s),e.end());e[wa]?.()},gy=(r,e={})=>{let t=e.autoCleanupIncoming??!0;return e.overrideGlobalObjects!==!1&&global.Request!==rn&&(Object.defineProperty(global,"Request",{value:rn}),Object.defineProperty(global,"Response",{value:sn})),async(s,n)=>{let i,o;try{o=ay(s,e.hostname);let a=!t||s.method==="GET"||s.method==="HEAD";if(a||(s[Td]=!0,s.on("end",()=>{a=!0}),s instanceof Xg&&(n[wa]=()=>{a||setTimeout(()=>{a||setTimeout(()=>{s.destroy(),n.destroy()})})})),n.on("close",()=>{o[ls]&&(s.errored?o[ls].abort(s.errored.toString()):n.writableFinished||o[ls].abort("Client connection prematurely closed.")),a||setTimeout(()=>{a||setTimeout(()=>{s.destroy()})})}),i=r(o,{incoming:s,outgoing:n}),kr in i)return Cd(i,n)}catch(a){if(i)return _a(a,n);if(e.errorHandler){if(i=await e.errorHandler(o?a:ey(a)),!i)return}else o?i=xd(a):i=fy()}try{return await my(i,n,e)}catch(a){return _a(a,n)}}},yy=r=>{let e=r.fetch,t=gy(e,{hostname:r.hostname,overrideGlobalObjects:r.overrideGlobalObjects,autoCleanupIncoming:r.autoCleanupIncoming});return(r.createServer||Yg)(r.serverOptions||{},t)},Pd=(r,e)=>{let t=yy(r);return t.listen(r?.port??3e3,r.hostname,()=>{let s=t.address();e&&e(s)}),t};function jd(){let{process:r,Deno:e}=globalThis;return!(typeof e?.noColor=="boolean"?e.noColor:r!==void 0?"NO_COLOR"in r?.env:!1)}var nn="__COMPOSED_HANDLER";var ba=r=>r.length>1,Ea=r=>r[nn]?Ea(r[nn]):r;var _y=r=>r.name||(ba(r)?"[middleware]":"[handler]"),vy=r=>r.routes.map(({path:e,method:t,handler:s})=>{let n=Ea(s);return{path:e,method:t,name:_y(n),isMiddleware:ba(n)}}),Id=(r,e)=>{let t=e?.colorize??jd(),s={},n=0,i=0;vy(r).filter(({isMiddleware:o})=>e?.verbose||!o).map(o=>{let a=`${o.method}-${o.path}`;if((s[a]||=[]).push(o),!(s[a].length>1))return n=Math.max(n,o.method.length),i=Math.max(i,o.path.length),{method:o.method,path:o.path,routes:s[a]}}).forEach(o=>{if(!o)return;let{method:a,path:c,routes:u}=o,l=t?`\x1B[32m${a}\x1B[0m`:a;console.log(`${l} ${" ".repeat(n-a.length)} ${c}`),e?.verbose&&u.forEach(({name:d})=>{console.log(`${" ".repeat(n+3)} ${d}`)})})};var Sa=(r,e,t)=>(s,n)=>{let i=-1;return o(0);async function o(a){if(a<=i)throw new Error("next() called multiple times");i=a;let c,u=!1,l;if(r[a]?(l=r[a][0][0],s.req.routeIndex=a):l=a===r.length&&n||void 0,l)try{c=await l(s,()=>o(a+1))}catch(d){if(d instanceof Error&&e)s.error=d,c=await e(d,s),u=!0;else throw d}else s.finalized===!1&&t&&(c=await t(s));return c&&(s.finalized===!1||u)&&(s.res=c),s}};var Dt=class extends Error{res;status;constructor(r=500,e){super(e?.message,{cause:e?.cause}),this.res=e?.res,this.status=r}getResponse(){return this.res?new Response(this.res.body,{status:this.status,headers:this.res.headers}):new Response(this.message,{status:this.status})}};var Nd=Symbol();var $d=async(r,e=Object.create(null))=>{let{all:t=!1,dot:s=!1}=e,i=(r instanceof pi?r.raw.headers:r.headers).get("Content-Type");return i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded")?wy(r,{all:t,dot:s}):{}};async function wy(r,e){let t=await r.formData();return t?by(t,e):{}}function by(r,e){let t=Object.create(null);return r.forEach((s,n)=>{e.all||n.endsWith("[]")?Ey(t,n,s):t[n]=s}),e.dot&&Object.entries(t).forEach(([s,n])=>{s.includes(".")&&(Sy(t,s,n),delete t[s])}),t}var Ey=(r,e,t)=>{r[e]!==void 0?Array.isArray(r[e])?r[e].push(t):r[e]=[r[e],t]:e.endsWith("[]")?r[e]=[t]:r[e]=t},Sy=(r,e,t)=>{let s=r,n=e.split(".");n.forEach((i,o)=>{o===n.length-1?s[i]=t:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})};var Aa=r=>{let e=r.split("/");return e[0]===""&&e.shift(),e},Dd=r=>{let{groups:e,path:t}=Ty(r),s=Aa(t);return Ay(s,e)},Ty=r=>{let e=[];return r=r.replace(/\{[^}]+\}/g,(t,s)=>{let n=`@${s}`;return e.push([n,t]),n}),{groups:e,path:r}},Ay=(r,e)=>{for(let t=e.length-1;t>=0;t--){let[s]=e[t];for(let n=r.length-1;n>=0;n--)if(r[n].includes(s)){r[n]=r[n].replace(s,e[t][1]);break}}return r},mi={},Ld=(r,e)=>{if(r==="*")return"*";let t=r.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(t){let s=`${r}#${e}`;return mi[s]||(t[2]?mi[s]=e&&e[0]!==":"&&e[0]!=="*"?[s,t[1],new RegExp(`^${t[2]}(?=/${e})`)]:[r,t[1],new RegExp(`^${t[2]}$`)]:mi[s]=[r,t[1],!0]),mi[s]}return null},hs=(r,e)=>{try{return e(r)}catch{return r.replace(/(?:%[0-9A-Fa-f]{2})+/g,t=>{try{return e(t)}catch{return t}})}},Oy=r=>hs(r,decodeURI),Oa=r=>{let e=r.url,t=e.indexOf("/",e.indexOf(":")+4),s=t;for(;s<e.length;s++){let n=e.charCodeAt(s);if(n===37){let i=e.indexOf("?",s),o=e.slice(t,i===-1?void 0:i);return Oy(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(n===63)break}return e.slice(t,s)};var Ud=r=>{let e=Oa(r);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},Cr=(r,e,...t)=>(t.length&&(e=Cr(e,...t)),`${r?.[0]==="/"?"":"/"}${r}${e==="/"?"":`${r?.at(-1)==="/"?"":"/"}${e?.[0]==="/"?e.slice(1):e}`}`),gi=r=>{if(r.charCodeAt(r.length-1)!==63||!r.includes(":"))return null;let e=r.split("/"),t=[],s="";return e.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){t.length===0&&s===""?t.push("/"):t.push(s);let i=n.replace("?","");s+="/"+i,t.push(s)}else s+="/"+n}),t.filter((n,i,o)=>o.indexOf(n)===i)},Ta=r=>/[%+]/.test(r)?(r.indexOf("+")!==-1&&(r=r.replace(/\+/g," ")),r.indexOf("%")!==-1?hs(r,on):r):r,qd=(r,e,t)=>{let s;if(!t&&e&&!/[%+]/.test(e)){let o=r.indexOf("?",8);if(o===-1)return;for(r.startsWith(e,o+1)||(o=r.indexOf(`&${e}`,o+1));o!==-1;){let a=r.charCodeAt(o+e.length+1);if(a===61){let c=o+e.length+2,u=r.indexOf("&",c);return Ta(r.slice(c,u===-1?void 0:u))}else if(a==38||isNaN(a))return"";o=r.indexOf(`&${e}`,o+1)}if(s=/[%+]/.test(r),!s)return}let n={};s??=/[%+]/.test(r);let i=r.indexOf("?",8);for(;i!==-1;){let o=r.indexOf("&",i+1),a=r.indexOf("=",i);a>o&&o!==-1&&(a=-1);let c=r.slice(i+1,a===-1?o===-1?void 0:o:a);if(s&&(c=Ta(c)),i=o,c==="")continue;let u;a===-1?u="":(u=r.slice(a+1,o===-1?void 0:o),s&&(u=Ta(u))),t?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(u)):n[c]??=u}return e?n[e]:n},Bd=qd,Md=(r,e)=>qd(r,e,!0),on=decodeURIComponent;var Fd=r=>hs(r,on),pi=class{raw;#t;#e;routeIndex=0;path;bodyCache={};constructor(r,e="/",t=[[]]){this.raw=r,this.path=e,this.#e=t,this.#t={}}param(r){return r?this.#r(r):this.#i()}#r(r){let e=this.#e[0][this.routeIndex][1][r],t=this.#n(e);return t&&/\%/.test(t)?Fd(t):t}#i(){let r={},e=Object.keys(this.#e[0][this.routeIndex][1]);for(let t of e){let s=this.#n(this.#e[0][this.routeIndex][1][t]);s!==void 0&&(r[t]=/\%/.test(s)?Fd(s):s)}return r}#n(r){return this.#e[1]?this.#e[1][r]:r}query(r){return Bd(this.url,r)}queries(r){return Md(this.url,r)}header(r){if(r)return this.raw.headers.get(r)??void 0;let e={};return this.raw.headers.forEach((t,s)=>{e[s]=t}),e}async parseBody(r){return this.bodyCache.parsedBody??=await $d(this,r)}#s=r=>{let{bodyCache:e,raw:t}=this,s=e[r];if(s)return s;let n=Object.keys(e)[0];return n?e[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[r]())):e[r]=t[r]()};json(){return this.#s("text").then(r=>JSON.parse(r))}text(){return this.#s("text")}arrayBuffer(){return this.#s("arrayBuffer")}blob(){return this.#s("blob")}formData(){return this.#s("formData")}addValidatedData(r,e){this.#t[r]=e}valid(r){return this.#t[r]}get url(){return this.raw.url}get method(){return this.raw.method}get[Nd](){return this.#e}get matchedRoutes(){return this.#e[0].map(([[,r]])=>r)}get routePath(){return this.#e[0].map(([[,r]])=>r)[this.routeIndex].path}};var Vd={Stringify:1,BeforeStream:2,Stream:3},Ry=(r,e)=>{let t=new String(r);return t.isEscaped=!0,t.callbacks=e,t};var Ra=async(r,e,t,s,n)=>{typeof r=="object"&&!(r instanceof String)&&(r instanceof Promise||(r=r.toString()),r instanceof Promise&&(r=await r));let i=r.callbacks;if(!i?.length)return Promise.resolve(r);n?n[0]+=r:n=[r];let o=Promise.all(i.map(a=>a({phase:e,buffer:n,context:s}))).then(a=>Promise.all(a.filter(Boolean).map(c=>Ra(c,e,!1,s,n))).then(()=>n[0]));return t?Ry(await o,i):o};var xy="text/plain; charset=UTF-8",xa=(r,e)=>({"Content-Type":r,...e}),zd=class{#t;#e;env={};#r;finalized=!1;error;#i;#n;#s;#l;#c;#u;#a;#d;#h;constructor(r,e){this.#t=r,e&&(this.#n=e.executionCtx,this.env=e.env,this.#u=e.notFoundHandler,this.#h=e.path,this.#d=e.matchResult)}get req(){return this.#e??=new pi(this.#t,this.#h,this.#d),this.#e}get event(){if(this.#n&&"respondWith"in this.#n)return this.#n;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#n)return this.#n;throw Error("This context has no ExecutionContext")}get res(){return this.#s||=new Response(null,{headers:this.#a??=new Headers})}set res(r){if(this.#s&&r){r=new Response(r.body,r);for(let[e,t]of this.#s.headers.entries())if(e!=="content-type")if(e==="set-cookie"){let s=this.#s.headers.getSetCookie();r.headers.delete("set-cookie");for(let n of s)r.headers.append("set-cookie",n)}else r.headers.set(e,t)}this.#s=r,this.finalized=!0}render=(...r)=>(this.#c??=e=>this.html(e),this.#c(...r));setLayout=r=>this.#l=r;getLayout=()=>this.#l;setRenderer=r=>{this.#c=r};header=(r,e,t)=>{this.finalized&&(this.#s=new Response(this.#s.body,this.#s));let s=this.#s?this.#s.headers:this.#a??=new Headers;e===void 0?s.delete(r):t?.append?s.append(r,e):s.set(r,e)};status=r=>{this.#i=r};set=(r,e)=>{this.#r??=new Map,this.#r.set(r,e)};get=r=>this.#r?this.#r.get(r):void 0;get var(){return this.#r?Object.fromEntries(this.#r):{}}#o(r,e,t){let s=this.#s?new Headers(this.#s.headers):this.#a??new Headers;if(typeof e=="object"&&"headers"in e){let i=e.headers instanceof Headers?e.headers:new Headers(e.headers);for(let[o,a]of i)o.toLowerCase()==="set-cookie"?s.append(o,a):s.set(o,a)}if(t)for(let[i,o]of Object.entries(t))if(typeof o=="string")s.set(i,o);else{s.delete(i);for(let a of o)s.append(i,a)}let n=typeof e=="number"?e:e?.status??this.#i;return new Response(r,{status:n,headers:s})}newResponse=(...r)=>this.#o(...r);body=(r,e,t)=>this.#o(r,e,t);text=(r,e,t)=>!this.#a&&!this.#i&&!e&&!t&&!this.finalized?new Response(r):this.#o(r,e,xa(xy,t));json=(r,e,t)=>this.#o(JSON.stringify(r),e,xa("application/json",t));html=(r,e,t)=>{let s=n=>this.#o(n,e,xa("text/html; charset=UTF-8",t));return typeof r=="object"?Ra(r,Vd.Stringify,!1,{}).then(s):s(r)};redirect=(r,e)=>{let t=String(r);return this.header("Location",/[^\x00-\xFF]/.test(t)?encodeURI(t):t),this.newResponse(null,e??302)};notFound=()=>(this.#u??=()=>new Response,this.#u(this))};var ke="ALL",Hd="all",Kd=["get","post","put","delete","options","patch"],yi="Can not add a route since the matcher is already built.",_i=class extends Error{};var ky=r=>r.text("404 Not Found",404),Wd=(r,e)=>{if("getResponse"in r){let t=r.getResponse();return e.newResponse(t.body,t)}return console.error(r),e.text("Internal Server Error",500)},ka=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#t="/";routes=[];constructor(r={}){[...Kd,Hd].forEach(n=>{this[n]=(i,...o)=>(typeof i=="string"?this.#t=i:this.#i(n,this.#t,i),o.forEach(a=>{this.#i(n,this.#t,a)}),this)}),this.on=(n,i,...o)=>{for(let a of[i].flat()){this.#t=a;for(let c of[n].flat())o.map(u=>{this.#i(c.toUpperCase(),this.#t,u)})}return this},this.use=(n,...i)=>(typeof n=="string"?this.#t=n:(this.#t="*",i.unshift(n)),i.forEach(o=>{this.#i(ke,this.#t,o)}),this);let{strict:t,...s}=r;Object.assign(this,s),this.getPath=t??!0?r.getPath??Oa:Ud}#e(){let r=new ka({router:this.router,getPath:this.getPath});return r.errorHandler=this.errorHandler,r.#r=this.#r,r.routes=this.routes,r}#r=ky;errorHandler=Wd;route(r,e){let t=this.basePath(r);return e.routes.map(s=>{let n;e.errorHandler===Wd?n=s.handler:(n=async(i,o)=>(await Sa([],e.errorHandler)(i,()=>s.handler(i,o))).res,n[nn]=s.handler),t.#i(s.method,s.path,n)}),this}basePath(r){let e=this.#e();return e._basePath=Cr(this._basePath,r),e}onError=r=>(this.errorHandler=r,this);notFound=r=>(this.#r=r,this);mount(r,e,t){let s,n;t&&(typeof t=="function"?n=t:(n=t.optionHandler,t.replaceRequest===!1?s=a=>a:s=t.replaceRequest));let i=n?a=>{let c=n(a);return Array.isArray(c)?c:[c]}:a=>{let c;try{c=a.executionCtx}catch{}return[a.env,c]};s||=(()=>{let a=Cr(this._basePath,r),c=a==="/"?0:a.length;return u=>{let l=new URL(u.url);return l.pathname=l.pathname.slice(c)||"/",new Request(l,u)}})();let o=async(a,c)=>{let u=await e(s(a.req.raw),...i(a));if(u)return u;await c()};return this.#i(ke,Cr(r,"*"),o),this}#i(r,e,t){r=r.toUpperCase(),e=Cr(this._basePath,e);let s={basePath:this._basePath,path:e,method:r,handler:t};this.router.add(r,e,[t,s]),this.routes.push(s)}#n(r,e){if(r instanceof Error)return this.errorHandler(r,e);throw r}#s(r,e,t,s){if(s==="HEAD")return(async()=>new Response(null,await this.#s(r,e,t,"GET")))();let n=this.getPath(r,{env:t}),i=this.router.match(s,n),o=new zd(r,{path:n,matchResult:i,env:t,executionCtx:e,notFoundHandler:this.#r});if(i[0].length===1){let c;try{c=i[0][0][0][0](o,async()=>{o.res=await this.#r(o)})}catch(u){return this.#n(u,o)}return c instanceof Promise?c.then(u=>u||(o.finalized?o.res:this.#r(o))).catch(u=>this.#n(u,o)):c??this.#r(o)}let a=Sa(i[0],this.errorHandler,this.#r);return(async()=>{try{let c=await a(o);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return this.#n(c,o)}})()}fetch=(r,...e)=>this.#s(r,e[1],e[0],r.method);request=(r,e,t,s)=>r instanceof Request?this.fetch(e?new Request(r,e):r,t,s):(r=r.toString(),this.fetch(new Request(/^https?:\/\//.test(r)?r:`http://localhost${Cr("/",r)}`,e),t,s));fire=()=>{addEventListener("fetch",r=>{r.respondWith(this.#s(r.request,r,void 0,r.request.method))})}};var vi=[];function Ca(r,e){let t=this.buildAllMatchers(),s=(n,i)=>{let o=t[n]||t[ke],a=o[2][i];if(a)return a;let c=i.match(o[0]);if(!c)return[[],vi];let u=c.indexOf("",1);return[o[1][u],c]};return this.match=s,s(r,e)}var wi="[^/]+",an=".*",cn="(?:|/.*)",Pr=Symbol(),Cy=new Set(".\\+*[^]$()");function Py(r,e){return r.length===1?e.length===1?r<e?-1:1:-1:e.length===1||r===an||r===cn?1:e===an||e===cn?-1:r===wi?1:e===wi?-1:r.length===e.length?r<e?-1:1:e.length-r.length}var bi=class{#t;#e;#r=Object.create(null);insert(r,e,t,s,n){if(r.length===0){if(this.#t!==void 0)throw Pr;if(n)return;this.#t=e;return}let[i,...o]=r,a=i==="*"?o.length===0?["","",an]:["","",wi]:i==="/*"?["","",cn]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(a){let u=a[1],l=a[2]||wi;if(u&&a[2]&&(l===".*"||(l=l.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(l))))throw Pr;if(c=this.#r[l],!c){if(Object.keys(this.#r).some(d=>d!==an&&d!==cn))throw Pr;if(n)return;c=this.#r[l]=new bi,u!==""&&(c.#e=s.varIndex++)}!n&&u!==""&&t.push([u,c.#e])}else if(c=this.#r[i],!c){if(Object.keys(this.#r).some(u=>u.length>1&&u!==an&&u!==cn))throw Pr;if(n)return;c=this.#r[i]=new bi}c.insert(o,e,t,s,n)}buildRegExpStr(){let e=Object.keys(this.#r).sort(Py).map(t=>{let s=this.#r[t];return(typeof s.#e=="number"?`(${t})@${s.#e}`:Cy.has(t)?`\\${t}`:t)+s.buildRegExpStr()});return typeof this.#t=="number"&&e.unshift(`#${this.#t}`),e.length===0?"":e.length===1?e[0]:"(?:"+e.join("|")+")"}};var Gd=class{#t={varIndex:0};#e=new bi;insert(r,e,t){let s=[],n=[];for(let o=0;;){let a=!1;if(r=r.replace(/\{[^}]+\}/g,c=>{let u=`@\\${o}`;return n[o]=[u,c],o++,a=!0,u}),!a)break}let i=r.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=n.length-1;o>=0;o--){let[a]=n[o];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(a)!==-1){i[c]=i[c].replace(a,n[o][1]);break}}return this.#e.insert(i,e,s,this.#t,t),s}buildRegExp(){let r=this.#e.buildRegExpStr();if(r==="")return[/^$/,[],[]];let e=0,t=[],s=[];return r=r.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,o)=>i!==void 0?(t[++e]=Number(i),"$()"):(o!==void 0&&(s[Number(o)]=++e),"")),[new RegExp(`^${r}`),t,s]}};var jy=[/^$/,[],Object.create(null)],Qd=Object.create(null);function Jd(r){return Qd[r]??=new RegExp(r==="*"?"":`^${r.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,t)=>t?`\\${t}`:"(?:|/.*)")}$`)}function Iy(){Qd=Object.create(null)}function Ny(r){let e=new Gd,t=[];if(r.length===0)return jy;let s=r.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,l],[d,f])=>u?1:d?-1:l.length-f.length),n=Object.create(null);for(let u=0,l=-1,d=s.length;u<d;u++){let[f,p,y]=s[u];f?n[p]=[y.map(([w])=>[w,Object.create(null)]),vi]:l++;let g;try{g=e.insert(p,l,f)}catch(w){throw w===Pr?new _i(p):w}f||(t[l]=y.map(([w,b])=>{let A=Object.create(null);for(b-=1;b>=0;b--){let[E,x]=g[b];A[E]=x}return[w,A]}))}let[i,o,a]=e.buildRegExp();for(let u=0,l=t.length;u<l;u++)for(let d=0,f=t[u].length;d<f;d++){let p=t[u][d]?.[1];if(!p)continue;let y=Object.keys(p);for(let g=0,w=y.length;g<w;g++)p[y[g]]=a[p[y[g]]]}let c=[];for(let u in o)c[u]=t[o[u]];return[i,c,n]}function fs(r,e){if(r){for(let t of Object.keys(r).sort((s,n)=>n.length-s.length))if(Jd(t).test(e))return[...r[t]]}}var Ei=class{name="RegExpRouter";#t;#e;constructor(){this.#t={[ke]:Object.create(null)},this.#e={[ke]:Object.create(null)}}add(r,e,t){let s=this.#t,n=this.#e;if(!s||!n)throw new Error(yi);s[r]||[s,n].forEach(a=>{a[r]=Object.create(null),Object.keys(a[ke]).forEach(c=>{a[r][c]=[...a[ke][c]]})}),e==="/*"&&(e="*");let i=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){let a=Jd(e);r===ke?Object.keys(s).forEach(c=>{s[c][e]||=fs(s[c],e)||fs(s[ke],e)||[]}):s[r][e]||=fs(s[r],e)||fs(s[ke],e)||[],Object.keys(s).forEach(c=>{(r===ke||r===c)&&Object.keys(s[c]).forEach(u=>{a.test(u)&&s[c][u].push([t,i])})}),Object.keys(n).forEach(c=>{(r===ke||r===c)&&Object.keys(n[c]).forEach(u=>a.test(u)&&n[c][u].push([t,i]))});return}let o=gi(e)||[e];for(let a=0,c=o.length;a<c;a++){let u=o[a];Object.keys(n).forEach(l=>{(r===ke||r===l)&&(n[l][u]||=[...fs(s[l],u)||fs(s[ke],u)||[]],n[l][u].push([t,i-c+a+1]))})}}match=Ca;buildAllMatchers(){let r=Object.create(null);return Object.keys(this.#e).concat(Object.keys(this.#t)).forEach(e=>{r[e]||=this.#r(e)}),this.#t=this.#e=void 0,Iy(),r}#r(r){let e=[],t=r===ke;return[this.#t,this.#e].forEach(s=>{let n=s[r]?Object.keys(s[r]).map(i=>[i,s[r][i]]):[];n.length!==0?(t||=!0,e.push(...n)):r!==ke&&e.push(...Object.keys(s[ke]).map(i=>[i,s[ke][i]]))}),t?Ny(e):null}};var Pa=class{name="SmartRouter";#t=[];#e=[];constructor(r){this.#t=r.routers}add(r,e,t){if(!this.#e)throw new Error(yi);this.#e.push([r,e,t])}match(r,e){if(!this.#e)throw new Error("Fatal error");let t=this.#t,s=this.#e,n=t.length,i=0,o;for(;i<n;i++){let a=t[i];try{for(let c=0,u=s.length;c<u;c++)a.add(...s[c]);o=a.match(r,e)}catch(c){if(c instanceof _i)continue;throw c}this.match=a.match.bind(a),this.#t=[a],this.#e=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(this.#e||this.#t.length!==1)throw new Error("No active router has been determined yet.");return this.#t[0]}};var un=Object.create(null),ja=class{#t;#e;#r;#i=0;#n=un;constructor(r,e,t){if(this.#e=t||Object.create(null),this.#t=[],r&&e){let s=Object.create(null);s[r]={handler:e,possibleKeys:[],score:0},this.#t=[s]}this.#r=[]}insert(r,e,t){this.#i=++this.#i;let s=this,n=Dd(e),i=[];for(let o=0,a=n.length;o<a;o++){let c=n[o],u=n[o+1],l=Ld(c,u),d=Array.isArray(l)?l[0]:c;if(d in s.#e){s=s.#e[d],l&&i.push(l[1]);continue}s.#e[d]=new ja,l&&(s.#r.push(l),i.push(l[1])),s=s.#e[d]}return s.#t.push({[r]:{handler:t,possibleKeys:i.filter((o,a,c)=>c.indexOf(o)===a),score:this.#i}}),s}#s(r,e,t,s){let n=[];for(let i=0,o=r.#t.length;i<o;i++){let a=r.#t[i],c=a[e]||a[ke],u={};if(c!==void 0&&(c.params=Object.create(null),n.push(c),t!==un||s&&s!==un))for(let l=0,d=c.possibleKeys.length;l<d;l++){let f=c.possibleKeys[l],p=u[c.score];c.params[f]=s?.[f]&&!p?s[f]:t[f]??s?.[f],u[c.score]=!0}}return n}search(r,e){let t=[];this.#n=un;let n=[this],i=Aa(e),o=[];for(let a=0,c=i.length;a<c;a++){let u=i[a],l=a===c-1,d=[];for(let f=0,p=n.length;f<p;f++){let y=n[f],g=y.#e[u];g&&(g.#n=y.#n,l?(g.#e["*"]&&t.push(...this.#s(g.#e["*"],r,y.#n)),t.push(...this.#s(g,r,y.#n))):d.push(g));for(let w=0,b=y.#r.length;w<b;w++){let A=y.#r[w],E=y.#n===un?{}:{...y.#n};if(A==="*"){let Y=y.#e["*"];Y&&(t.push(...this.#s(Y,r,y.#n)),Y.#n=E,d.push(Y));continue}let[x,U,V]=A;if(!u&&!(V instanceof RegExp))continue;let N=y.#e[x],W=i.slice(a).join("/");if(V instanceof RegExp){let Y=V.exec(W);if(Y){if(E[U]=Y[0],t.push(...this.#s(N,r,y.#n,E)),Object.keys(N.#e).length){N.#n=E;let R=Y[0].match(/\//)?.length??0;(o[R]||=[]).push(N)}continue}}(V===!0||V.test(u))&&(E[U]=u,l?(t.push(...this.#s(N,r,E,y.#n)),N.#e["*"]&&t.push(...this.#s(N.#e["*"],r,E,y.#n))):(N.#n=E,d.push(N)))}}n=d.concat(o.shift()??[])}return t.length>1&&t.sort((a,c)=>a.score-c.score),[t.map(({handler:a,params:c})=>[a,c])]}};var Ia=class{name="TrieRouter";#t;constructor(){this.#t=new ja}add(r,e,t){let s=gi(e);if(s){for(let n=0,i=s.length;n<i;n++)this.#t.insert(r,s[n],t);return}this.#t.insert(r,e,t)}match(r,e){return this.#t.search(r,e)}};var jr=class extends ka{constructor(r={}){super(r),this.router=r.router??new Pa({routers:[new Ei,new Ia]})}};var $y=(r,e)=>(console.error(`Error on ${e.req.method} ${e.req.url}`),console.error(r?.message),console.error(r?.stack),r instanceof Dt?r.getResponse():new Response("Internal Error",{status:500,statusText:r?.message||"Internal Error"})),Zd=$y;var Vu=bd(Xf(),1),{PostgrestError:VO,FunctionsHttpError:zO,FunctionsFetchError:HO,FunctionsRelayError:KO,FunctionsError:WO,FunctionRegion:GO,SupabaseClient:QO,createClient:ep,GoTrueAdminApi:JO,GoTrueClient:ZO,AuthAdminApi:YO,AuthClient:XO,navigatorLock:eR,NavigatorLockAcquireTimeoutError:tR,lockInternals:rR,processLock:sR,SIGN_OUT_SCOPES:nR,AuthError:iR,AuthApiError:oR,AuthUnknownError:aR,CustomAuthError:cR,AuthSessionMissingError:uR,AuthInvalidTokenResponseError:lR,AuthInvalidCredentialsError:dR,AuthImplicitGrantRedirectError:hR,AuthPKCEGrantCodeExchangeError:fR,AuthRetryableFetchError:pR,AuthWeakPasswordError:mR,AuthInvalidJwtError:gR,isAuthError:yR,isAuthApiError:_R,isAuthSessionMissingError:vR,isAuthImplicitGrantRedirectError:wR,isAuthRetryableFetchError:bR,isAuthWeakPasswordError:ER,RealtimePresence:SR,RealtimeChannel:TR,RealtimeClient:AR,REALTIME_LISTEN_TYPES:OR,REALTIME_POSTGRES_CHANGES_LISTEN_EVENT:RR,REALTIME_PRESENCE_LISTEN_EVENTS:xR,REALTIME_SUBSCRIBE_STATES:kR,REALTIME_CHANNEL_STATES:CR}=Vu.default||Vu;var $e={};ga($e,{BRAND:()=>Xb,DIRTY:()=>qr,EMPTY_PATH:()=>Pb,INVALID:()=>z,NEVER:()=>L0,OK:()=>nt,ParseStatus:()=>Qe,Schema:()=>Z,ZodAny:()=>br,ZodArray:()=>lr,ZodBigInt:()=>Mr,ZodBoolean:()=>Fr,ZodBranded:()=>Pn,ZodCatch:()=>Xr,ZodDate:()=>Vr,ZodDefault:()=>Yr,ZodDiscriminatedUnion:()=>Ao,ZodEffects:()=>jt,ZodEnum:()=>Jr,ZodError:()=>yt,ZodFirstPartyTypeKind:()=>K,ZodFunction:()=>Ro,ZodIntersection:()=>Wr,ZodIssueCode:()=>S,ZodLazy:()=>Gr,ZodLiteral:()=>Qr,ZodMap:()=>Us,ZodNaN:()=>Bs,ZodNativeEnum:()=>Zr,ZodNever:()=>Mt,ZodNull:()=>Hr,ZodNullable:()=>Zt,ZodNumber:()=>Br,ZodObject:()=>_t,ZodOptional:()=>Ct,ZodParsedType:()=>I,ZodPipeline:()=>jn,ZodPromise:()=>Er,ZodReadonly:()=>es,ZodRecord:()=>Oo,ZodSchema:()=>Z,ZodSet:()=>qs,ZodString:()=>wr,ZodSymbol:()=>Ds,ZodTransformer:()=>jt,ZodTuple:()=>Jt,ZodType:()=>Z,ZodUndefined:()=>zr,ZodUnion:()=>Kr,ZodUnknown:()=>ur,ZodVoid:()=>Ls,addIssueToContext:()=>C,any:()=>c0,array:()=>h0,bigint:()=>s0,boolean:()=>dp,coerce:()=>D0,custom:()=>cp,date:()=>n0,datetimeRegex:()=>op,defaultErrorMap:()=>ar,discriminatedUnion:()=>g0,effect:()=>x0,enum:()=>A0,function:()=>E0,getErrorMap:()=>Is,getParsedType:()=>Qt,instanceof:()=>t0,intersection:()=>y0,isAborted:()=>So,isAsync:()=>Ns,isDirty:()=>To,isValid:()=>vr,late:()=>e0,lazy:()=>S0,literal:()=>T0,makeIssue:()=>Cn,map:()=>w0,nan:()=>r0,nativeEnum:()=>O0,never:()=>l0,null:()=>a0,nullable:()=>C0,number:()=>lp,object:()=>f0,objectUtil:()=>zu,oboolean:()=>$0,onumber:()=>N0,optional:()=>k0,ostring:()=>I0,pipeline:()=>j0,preprocess:()=>P0,promise:()=>R0,quotelessJson:()=>xb,record:()=>v0,set:()=>b0,setErrorMap:()=>Cb,strictObject:()=>p0,string:()=>up,symbol:()=>i0,transformer:()=>x0,tuple:()=>_0,undefined:()=>o0,union:()=>m0,unknown:()=>u0,util:()=>X,void:()=>d0});var X;(function(r){r.assertEqual=n=>{};function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{let i={};for(let o of n)i[o]=o;return i},r.getValidEnumValues=n=>{let i=r.objectKeys(n).filter(a=>typeof n[n[a]]!="number"),o={};for(let a of i)o[a]=n[a];return r.objectValues(o)},r.objectValues=n=>r.objectKeys(n).map(function(i){return n[i]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let i=[];for(let o in n)Object.prototype.hasOwnProperty.call(n,o)&&i.push(o);return i},r.find=(n,i)=>{for(let o of n)if(i(o))return o},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}r.joinValues=s,r.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(X||(X={}));var zu;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(zu||(zu={}));var I=X.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Qt=r=>{switch(typeof r){case"undefined":return I.undefined;case"string":return I.string;case"number":return Number.isNaN(r)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(r)?I.array:r===null?I.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?I.promise:typeof Map<"u"&&r instanceof Map?I.map:typeof Set<"u"&&r instanceof Set?I.set:typeof Date<"u"&&r instanceof Date?I.date:I.object;default:return I.unknown}};var S=X.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),xb=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),yt=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},s={_errors:[]},n=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(n);else if(o.code==="invalid_return_type")n(o.returnTypeError);else if(o.code==="invalid_arguments")n(o.argumentsError);else if(o.path.length===0)s._errors.push(t(o));else{let a=s,c=0;for(;c<o.path.length;){let u=o.path[c];c===o.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(t(o))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return n(this),s}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,X.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},s=[];for(let n of this.issues)if(n.path.length>0){let i=n.path[0];t[i]=t[i]||[],t[i].push(e(n))}else s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};yt.create=r=>new yt(r);var kb=(r,e)=>{let t;switch(r.code){case S.invalid_type:r.received===I.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case S.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,X.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:t=`Unrecognized key(s) in object: ${X.joinValues(r.keys,", ")}`;break;case S.invalid_union:t="Invalid input";break;case S.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${X.joinValues(r.options)}`;break;case S.invalid_enum_value:t=`Invalid enum value. Expected ${X.joinValues(r.options)}, received '${r.received}'`;break;case S.invalid_arguments:t="Invalid function arguments";break;case S.invalid_return_type:t="Invalid function return type";break;case S.invalid_date:t="Invalid date";break;case S.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:X.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case S.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case S.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case S.custom:t="Invalid input";break;case S.invalid_intersection_types:t="Intersection results could not be merged";break;case S.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case S.not_finite:t="Number must be finite";break;default:t=e.defaultError,X.assertNever(r)}return{message:t}},ar=kb;var tp=ar;function Cb(r){tp=r}function Is(){return tp}var Cn=r=>{let{data:e,path:t,errorMaps:s,issueData:n}=r,i=[...t,...n.path||[]],o={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let a="",c=s.filter(u=>!!u).slice().reverse();for(let u of c)a=u(o,{data:e,defaultError:a}).message;return{...n,path:i,message:a}},Pb=[];function C(r,e){let t=Is(),s=Cn({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===ar?void 0:ar].filter(n=>!!n)});r.common.issues.push(s)}var Qe=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let n of t){if(n.status==="aborted")return z;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let n of t){let i=await n.key,o=await n.value;s.push({key:i,value:o})}return r.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let n of t){let{key:i,value:o}=n;if(i.status==="aborted"||o.status==="aborted")return z;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||n.alwaysSet)&&(s[i.value]=o.value)}return{status:e.value,value:s}}},z=Object.freeze({status:"aborted"}),qr=r=>({status:"dirty",value:r}),nt=r=>({status:"valid",value:r}),So=r=>r.status==="aborted",To=r=>r.status==="dirty",vr=r=>r.status==="valid",Ns=r=>typeof Promise<"u"&&r instanceof Promise;var L;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Pt=class{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},rp=(r,e)=>{if(vr(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new yt(r.common.issues);return this._error=t,this._error}}};function G(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(o,a)=>{let{message:c}=r;return o.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??s??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:c??t??a.defaultError}},description:n}}var Z=class{get description(){return this._def.description}_getType(e){return Qt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Qt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Qe,ctx:{common:e.parent.common,data:e.data,parsedType:Qt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Ns(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qt(e)},n=this._parseSync({data:e,path:s.path,parent:s});return rp(s,n)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qt(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return vr(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>vr(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qt(e)},n=this._parse({data:e,path:s.path,parent:s}),i=await(Ns(n)?n:Promise.resolve(n));return rp(s,i)}refine(e,t){let s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,i)=>{let o=e(n),a=()=>i.addIssue({code:S.custom,...s(n)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new jt({schema:this,typeName:K.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Ct.create(this,this._def)}nullable(){return Zt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return lr.create(this)}promise(){return Er.create(this,this._def)}or(e){return Kr.create([this,e],this._def)}and(e){return Wr.create(this,e,this._def)}transform(e){return new jt({...G(this._def),schema:this,typeName:K.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Yr({...G(this._def),innerType:this,defaultValue:t,typeName:K.ZodDefault})}brand(){return new Pn({typeName:K.ZodBranded,type:this,...G(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Xr({...G(this._def),innerType:this,catchValue:t,typeName:K.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return jn.create(this,e)}readonly(){return es.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},jb=/^c[^\s-]{8,}$/i,Ib=/^[0-9a-z]+$/,Nb=/^[0-9A-HJKMNP-TV-Z]{26}$/i,$b=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Db=/^[a-z0-9_-]{21}$/i,Lb=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Ub=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,qb=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Bb="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Hu,Mb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Fb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Vb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,zb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Hb=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Kb=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,np="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Wb=new RegExp(`^${np}$`);function ip(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Gb(r){return new RegExp(`^${ip(r)}$`)}function op(r){let e=`${np}T${ip(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Qb(r,e){return!!((e==="v4"||!e)&&Mb.test(r)||(e==="v6"||!e)&&Vb.test(r))}function Jb(r,e){if(!Lb.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function Zb(r,e){return!!((e==="v4"||!e)&&Fb.test(r)||(e==="v6"||!e)&&zb.test(r))}var wr=class r extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==I.string){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:I.string,received:i.parsedType}),z}let s=new Qe,n;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){let o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(n=this._getOrReturnCtx(e,n),o?C(n,{code:S.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&C(n,{code:S.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")qb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"email",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Hu||(Hu=new RegExp(Bb,"u")),Hu.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"emoji",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")$b.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"uuid",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Db.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"nanoid",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")jb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"cuid",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")Ib.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"cuid2",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Nb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"ulid",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),C(n,{validation:"url",code:S.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"regex",code:S.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?op(i).test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?Wb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?Gb(i).test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?Ub.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"duration",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?Qb(e.data,i.version)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"ip",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?Jb(e.data,i.alg)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"jwt",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?Zb(e.data,i.version)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"cidr",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Hb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"base64",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?Kb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"base64url",code:S.invalid_string,message:i.message}),s.dirty()):X.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(n=>e.test(n),{validation:t,code:S.invalid_string,...L.errToObj(s)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...L.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...L.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...L.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...L.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...L.errToObj(t)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};wr.create=r=>new wr({checks:[],typeName:K.ZodString,coerce:r?.coerce??!1,...G(r)});function Yb(r,e){let t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,i=Number.parseInt(r.toFixed(n).replace(".","")),o=Number.parseInt(e.toFixed(n).replace(".",""));return i%o/10**n}var Br=class r extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==I.number){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:I.number,received:i.parsedType}),z}let s,n=new Qe;for(let i of this._def.checks)i.kind==="int"?X.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{code:S.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?Yb(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{code:S.not_finite,message:i.message}),n.dirty()):X.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,L.toString(t))}gt(e,t){return this.setLimit("min",e,!1,L.toString(t))}lte(e,t){return this.setLimit("max",e,!0,L.toString(t))}lt(e,t){return this.setLimit("max",e,!1,L.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:L.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&X.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Br.create=r=>new Br({checks:[],typeName:K.ZodNumber,coerce:r?.coerce||!1,...G(r)});var Mr=class r extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==I.bigint)return this._getInvalidInput(e);let s,n=new Qe;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):X.assertNever(i);return{status:n.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:I.bigint,received:t.parsedType}),z}gte(e,t){return this.setLimit("min",e,!0,L.toString(t))}gt(e,t){return this.setLimit("min",e,!1,L.toString(t))}lte(e,t){return this.setLimit("max",e,!0,L.toString(t))}lt(e,t){return this.setLimit("max",e,!1,L.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:L.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Mr.create=r=>new Mr({checks:[],typeName:K.ZodBigInt,coerce:r?.coerce??!1,...G(r)});var Fr=class extends Z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==I.boolean){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:I.boolean,received:s.parsedType}),z}return nt(e.data)}};Fr.create=r=>new Fr({typeName:K.ZodBoolean,coerce:r?.coerce||!1,...G(r)});var Vr=class r extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==I.date){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:I.date,received:i.parsedType}),z}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_date}),z}let s=new Qe,n;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):X.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Vr.create=r=>new Vr({checks:[],coerce:r?.coerce||!1,typeName:K.ZodDate,...G(r)});var Ds=class extends Z{_parse(e){if(this._getType(e)!==I.symbol){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:I.symbol,received:s.parsedType}),z}return nt(e.data)}};Ds.create=r=>new Ds({typeName:K.ZodSymbol,...G(r)});var zr=class extends Z{_parse(e){if(this._getType(e)!==I.undefined){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:I.undefined,received:s.parsedType}),z}return nt(e.data)}};zr.create=r=>new zr({typeName:K.ZodUndefined,...G(r)});var Hr=class extends Z{_parse(e){if(this._getType(e)!==I.null){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:I.null,received:s.parsedType}),z}return nt(e.data)}};Hr.create=r=>new Hr({typeName:K.ZodNull,...G(r)});var br=class extends Z{constructor(){super(...arguments),this._any=!0}_parse(e){return nt(e.data)}};br.create=r=>new br({typeName:K.ZodAny,...G(r)});var ur=class extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return nt(e.data)}};ur.create=r=>new ur({typeName:K.ZodUnknown,...G(r)});var Mt=class extends Z{_parse(e){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:I.never,received:t.parsedType}),z}};Mt.create=r=>new Mt({typeName:K.ZodNever,...G(r)});var Ls=class extends Z{_parse(e){if(this._getType(e)!==I.undefined){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:I.void,received:s.parsedType}),z}return nt(e.data)}};Ls.create=r=>new Ls({typeName:K.ZodVoid,...G(r)});var lr=class r extends Z{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==I.array)return C(t,{code:S.invalid_type,expected:I.array,received:t.parsedType}),z;if(n.exactLength!==null){let o=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(o||a)&&(C(t,{code:o?S.too_big:S.too_small,minimum:a?n.exactLength.value:void 0,maximum:o?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(C(t,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(C(t,{code:S.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>n.type._parseAsync(new Pt(t,o,t.path,a)))).then(o=>Qe.mergeArray(s,o));let i=[...t.data].map((o,a)=>n.type._parseSync(new Pt(t,o,t.path,a)));return Qe.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:L.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:L.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:L.toString(t)}})}nonempty(e){return this.min(1,e)}};lr.create=(r,e)=>new lr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:K.ZodArray,...G(e)});function $s(r){if(r instanceof _t){let e={};for(let t in r.shape){let s=r.shape[t];e[t]=Ct.create($s(s))}return new _t({...r._def,shape:()=>e})}else return r instanceof lr?new lr({...r._def,type:$s(r.element)}):r instanceof Ct?Ct.create($s(r.unwrap())):r instanceof Zt?Zt.create($s(r.unwrap())):r instanceof Jt?Jt.create(r.items.map(e=>$s(e))):r}var _t=class r extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=X.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==I.object){let u=this._getOrReturnCtx(e);return C(u,{code:S.invalid_type,expected:I.object,received:u.parsedType}),z}let{status:s,ctx:n}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Mt&&this._def.unknownKeys==="strip"))for(let u in n.data)o.includes(u)||a.push(u);let c=[];for(let u of o){let l=i[u],d=n.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Pt(n,d,n.path,u)),alwaysSet:u in n.data})}if(this._def.catchall instanceof Mt){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:n.data[l]}});else if(u==="strict")a.length>0&&(C(n,{code:S.unrecognized_keys,keys:a}),s.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=n.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Pt(n,d,n.path,l)),alwaysSet:l in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,f=await l.value;u.push({key:d,value:f,alwaysSet:l.alwaysSet})}return u}).then(u=>Qe.mergeObjectSync(s,u)):Qe.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return L.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{let n=this._def.errorMap?.(t,s).message??s.defaultError;return t.code==="unrecognized_keys"?{message:L.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:K.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let s of X.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let s of X.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}deepPartial(){return $s(this)}partial(e){let t={};for(let s of X.objectKeys(this.shape)){let n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let s of X.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof Ct;)i=i._def.innerType;t[s]=i}return new r({...this._def,shape:()=>t})}keyof(){return ap(X.objectKeys(this.shape))}};_t.create=(r,e)=>new _t({shape:()=>r,unknownKeys:"strip",catchall:Mt.create(),typeName:K.ZodObject,...G(e)});_t.strictCreate=(r,e)=>new _t({shape:()=>r,unknownKeys:"strict",catchall:Mt.create(),typeName:K.ZodObject,...G(e)});_t.lazycreate=(r,e)=>new _t({shape:r,unknownKeys:"strip",catchall:Mt.create(),typeName:K.ZodObject,...G(e)});var Kr=class extends Z{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;function n(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(a=>new yt(a.ctx.common.issues));return C(t,{code:S.invalid_union,unionErrors:o}),z}if(t.common.async)return Promise.all(s.map(async i=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(n);{let i,o=[];for(let c of s){let u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:u}),u.common.issues.length&&o.push(u.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let a=o.map(c=>new yt(c));return C(t,{code:S.invalid_union,unionErrors:a}),z}}get options(){return this._def.options}};Kr.create=(r,e)=>new Kr({options:r,typeName:K.ZodUnion,...G(e)});var cr=r=>r instanceof Gr?cr(r.schema):r instanceof jt?cr(r.innerType()):r instanceof Qr?[r.value]:r instanceof Jr?r.options:r instanceof Zr?X.objectValues(r.enum):r instanceof Yr?cr(r._def.innerType):r instanceof zr?[void 0]:r instanceof Hr?[null]:r instanceof Ct?[void 0,...cr(r.unwrap())]:r instanceof Zt?[null,...cr(r.unwrap())]:r instanceof Pn||r instanceof es?cr(r.unwrap()):r instanceof Xr?cr(r._def.innerType):[],Ao=class r extends Z{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.object)return C(t,{code:S.invalid_type,expected:I.object,received:t.parsedType}),z;let s=this.discriminator,n=t.data[s],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(C(t,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),z)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let n=new Map;for(let i of t){let o=cr(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(n.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,i)}}return new r({typeName:K.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...G(s)})}};function Ku(r,e){let t=Qt(r),s=Qt(e);if(r===e)return{valid:!0,data:r};if(t===I.object&&s===I.object){let n=X.objectKeys(e),i=X.objectKeys(r).filter(a=>n.indexOf(a)!==-1),o={...r,...e};for(let a of i){let c=Ku(r[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===I.array&&s===I.array){if(r.length!==e.length)return{valid:!1};let n=[];for(let i=0;i<r.length;i++){let o=r[i],a=e[i],c=Ku(o,a);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===I.date&&s===I.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Wr=class extends Z{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=(i,o)=>{if(So(i)||So(o))return z;let a=Ku(i.value,o.value);return a.valid?((To(i)||To(o))&&t.dirty(),{status:t.value,value:a.data}):(C(s,{code:S.invalid_intersection_types}),z)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,o])=>n(i,o)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};Wr.create=(r,e,t)=>new Wr({left:r,right:e,typeName:K.ZodIntersection,...G(t)});var Jt=class r extends Z{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==I.array)return C(s,{code:S.invalid_type,expected:I.array,received:s.parsedType}),z;if(s.data.length<this._def.items.length)return C(s,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),z;!this._def.rest&&s.data.length>this._def.items.length&&(C(s,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...s.data].map((o,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Pt(s,o,s.path,a)):null}).filter(o=>!!o);return s.common.async?Promise.all(i).then(o=>Qe.mergeArray(t,o)):Qe.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Jt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Jt({items:r,typeName:K.ZodTuple,rest:null,...G(e)})};var Oo=class r extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==I.object)return C(s,{code:S.invalid_type,expected:I.object,received:s.parsedType}),z;let n=[],i=this._def.keyType,o=this._def.valueType;for(let a in s.data)n.push({key:i._parse(new Pt(s,a,s.path,a)),value:o._parse(new Pt(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?Qe.mergeObjectAsync(t,n):Qe.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof Z?new r({keyType:e,valueType:t,typeName:K.ZodRecord,...G(s)}):new r({keyType:wr.create(),valueType:e,typeName:K.ZodRecord,...G(t)})}},Us=class extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==I.map)return C(s,{code:S.invalid_type,expected:I.map,received:s.parsedType}),z;let n=this._def.keyType,i=this._def.valueType,o=[...s.data.entries()].map(([a,c],u)=>({key:n._parse(new Pt(s,a,s.path,[u,"key"])),value:i._parse(new Pt(s,c,s.path,[u,"value"]))}));if(s.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of o){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return z;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(u.value,l.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let c of o){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return z;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(u.value,l.value)}return{status:t.value,value:a}}}};Us.create=(r,e,t)=>new Us({valueType:e,keyType:r,typeName:K.ZodMap,...G(t)});var qs=class r extends Z{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==I.set)return C(s,{code:S.invalid_type,expected:I.set,received:s.parsedType}),z;let n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(C(s,{code:S.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(C(s,{code:S.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function o(c){let u=new Set;for(let l of c){if(l.status==="aborted")return z;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}let a=[...s.data.values()].map((c,u)=>i._parse(new Pt(s,c,s.path,u)));return s.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new r({...this._def,minSize:{value:e,message:L.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:L.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};qs.create=(r,e)=>new qs({valueType:r,minSize:null,maxSize:null,typeName:K.ZodSet,...G(e)});var Ro=class r extends Z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.function)return C(t,{code:S.invalid_type,expected:I.function,received:t.parsedType}),z;function s(a,c){return Cn({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Is(),ar].filter(u=>!!u),issueData:{code:S.invalid_arguments,argumentsError:c}})}function n(a,c){return Cn({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Is(),ar].filter(u=>!!u),issueData:{code:S.invalid_return_type,returnTypeError:c}})}let i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof Er){let a=this;return nt(async function(...c){let u=new yt([]),l=await a._def.args.parseAsync(c,i).catch(p=>{throw u.addIssue(s(c,p)),u}),d=await Reflect.apply(o,this,l);return await a._def.returns._def.type.parseAsync(d,i).catch(p=>{throw u.addIssue(n(d,p)),u})})}else{let a=this;return nt(function(...c){let u=a._def.args.safeParse(c,i);if(!u.success)throw new yt([s(c,u.error)]);let l=Reflect.apply(o,this,u.data),d=a._def.returns.safeParse(l,i);if(!d.success)throw new yt([n(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Jt.create(e).rest(ur.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new r({args:e||Jt.create([]).rest(ur.create()),returns:t||ur.create(),typeName:K.ZodFunction,...G(s)})}},Gr=class extends Z{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Gr.create=(r,e)=>new Gr({getter:r,typeName:K.ZodLazy,...G(e)});var Qr=class extends Z{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return C(t,{received:t.data,code:S.invalid_literal,expected:this._def.value}),z}return{status:"valid",value:e.data}}get value(){return this._def.value}};Qr.create=(r,e)=>new Qr({value:r,typeName:K.ZodLiteral,...G(e)});function ap(r,e){return new Jr({values:r,typeName:K.ZodEnum,...G(e)})}var Jr=class r extends Z{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),s=this._def.values;return C(t,{expected:X.joinValues(s),received:t.parsedType,code:S.invalid_type}),z}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return C(t,{received:t.data,code:S.invalid_enum_value,options:s}),z}return nt(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};Jr.create=ap;var Zr=class extends Z{_parse(e){let t=X.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==I.string&&s.parsedType!==I.number){let n=X.objectValues(t);return C(s,{expected:X.joinValues(n),received:s.parsedType,code:S.invalid_type}),z}if(this._cache||(this._cache=new Set(X.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let n=X.objectValues(t);return C(s,{received:s.data,code:S.invalid_enum_value,options:n}),z}return nt(e.data)}get enum(){return this._def.values}};Zr.create=(r,e)=>new Zr({values:r,typeName:K.ZodNativeEnum,...G(e)});var Er=class extends Z{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.promise&&t.common.async===!1)return C(t,{code:S.invalid_type,expected:I.promise,received:t.parsedType}),z;let s=t.parsedType===I.promise?t.data:Promise.resolve(t.data);return nt(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Er.create=(r,e)=>new Er({type:r,typeName:K.ZodPromise,...G(e)});var jt=class extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===K.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:o=>{C(s,o),o.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){let o=n.transform(s.data,i);if(s.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return z;let c=await this._def.schema._parseAsync({data:a,path:s.path,parent:s});return c.status==="aborted"?z:c.status==="dirty"?qr(c.value):t.value==="dirty"?qr(c.value):c});{if(t.value==="aborted")return z;let a=this._def.schema._parseSync({data:o,path:s.path,parent:s});return a.status==="aborted"?z:a.status==="dirty"?qr(a.value):t.value==="dirty"?qr(a.value):a}}if(n.type==="refinement"){let o=a=>{let c=n.refinement(a,i);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?z:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>a.status==="aborted"?z:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(n.type==="transform")if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!vr(o))return z;let a=n.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>vr(o)?Promise.resolve(n.transform(o.value,i)).then(a=>({status:t.value,value:a})):z);X.assertNever(n)}};jt.create=(r,e,t)=>new jt({schema:r,typeName:K.ZodEffects,effect:e,...G(t)});jt.createWithPreprocess=(r,e,t)=>new jt({schema:e,effect:{type:"preprocess",transform:r},typeName:K.ZodEffects,...G(t)});var Ct=class extends Z{_parse(e){return this._getType(e)===I.undefined?nt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ct.create=(r,e)=>new Ct({innerType:r,typeName:K.ZodOptional,...G(e)});var Zt=class extends Z{_parse(e){return this._getType(e)===I.null?nt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Zt.create=(r,e)=>new Zt({innerType:r,typeName:K.ZodNullable,...G(e)});var Yr=class extends Z{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===I.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Yr.create=(r,e)=>new Yr({innerType:r,typeName:K.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...G(e)});var Xr=class extends Z{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Ns(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new yt(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new yt(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};Xr.create=(r,e)=>new Xr({innerType:r,typeName:K.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...G(e)});var Bs=class extends Z{_parse(e){if(this._getType(e)!==I.nan){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:I.nan,received:s.parsedType}),z}return{status:"valid",value:e.data}}};Bs.create=r=>new Bs({typeName:K.ZodNaN,...G(r)});var Xb=Symbol("zod_brand"),Pn=class extends Z{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}},jn=class r extends Z{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?z:i.status==="dirty"?(t.dirty(),qr(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{let n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?z:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new r({in:e,out:t,typeName:K.ZodPipeline})}},es=class extends Z{_parse(e){let t=this._def.innerType._parse(e),s=n=>(vr(n)&&(n.value=Object.freeze(n.value)),n);return Ns(t)?t.then(n=>s(n)):s(t)}unwrap(){return this._def.innerType}};es.create=(r,e)=>new es({innerType:r,typeName:K.ZodReadonly,...G(e)});function sp(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function cp(r,e={},t){return r?br.create().superRefine((s,n)=>{let i=r(s);if(i instanceof Promise)return i.then(o=>{if(!o){let a=sp(e,s),c=a.fatal??t??!0;n.addIssue({code:"custom",...a,fatal:c})}});if(!i){let o=sp(e,s),a=o.fatal??t??!0;n.addIssue({code:"custom",...o,fatal:a})}}):br.create()}var e0={object:_t.lazycreate},K;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(K||(K={}));var t0=(r,e={message:`Input not instance of ${r.name}`})=>cp(t=>t instanceof r,e),up=wr.create,lp=Br.create,r0=Bs.create,s0=Mr.create,dp=Fr.create,n0=Vr.create,i0=Ds.create,o0=zr.create,a0=Hr.create,c0=br.create,u0=ur.create,l0=Mt.create,d0=Ls.create,h0=lr.create,f0=_t.create,p0=_t.strictCreate,m0=Kr.create,g0=Ao.create,y0=Wr.create,_0=Jt.create,v0=Oo.create,w0=Us.create,b0=qs.create,E0=Ro.create,S0=Gr.create,T0=Qr.create,A0=Jr.create,O0=Zr.create,R0=Er.create,x0=jt.create,k0=Ct.create,C0=Zt.create,P0=jt.createWithPreprocess,j0=jn.create,I0=()=>up().optional(),N0=()=>lp().optional(),$0=()=>dp().optional(),D0={string:r=>wr.create({...r,coerce:!0}),number:r=>Br.create({...r,coerce:!0}),boolean:r=>Fr.create({...r,coerce:!0}),bigint:r=>Mr.create({...r,coerce:!0}),date:r=>Vr.create({...r,coerce:!0})};var L0=z;var _p=bd(yp(),1);_p.default.config();console.log("\u{1F510} Loading environment variables...");var X0=$e.object({NODE_ENV:$e.string(),DATABASE_URL:$e.string().min(1),SUPABASE_URL:$e.string().min(1),SUPABASE_SERVICE_ROLE:$e.string().min(1),SENTRY_DSN:$e.string().optional(),HLTB_USER:$e.string().min(1),HLTB_USER_ID:$e.string().min(1)}),Qu=X0.safeParse(process.env);if(!Qu.success)throw console.error(`\u274C Invalid environment variables:
`),Qu.error.issues.forEach(r=>{console.error(r)}),new Error("Invalid environment variables");var{NODE_ENV:eE,DATABASE_URL:tE,SUPABASE_SERVICE_ROLE:rE,SUPABASE_URL:sE,SENTRY_DSN:nE,HLTB_USER:iE,HLTB_USER_ID:oE}=Qu.data,Yt={NODE_ENV:eE,DATABASE_URL:tE,SUPABASE_SERVICE_ROLE:rE,SUPABASE_URL:sE,SENTRY_DSN:nE,HLTB_USER:iE,HLTB_USER_ID:oE};console.log("\u2705 Environment variables loaded");var{SUPABASE_URL:aE,SUPABASE_SERVICE_ROLE:cE}=Yt,Nn=ep(aE,cE);function Zu(r){return r instanceof Error&&r.name==="ZodError"&&"issues"in r&&Array.isArray(r.issues)}var Ju=class extends Error{name;details;constructor(r,e){super(r,e),this.name="ZodValidationError",this.details=uE(e)}toString(){return this.message}};function uE(r){if(r){let e=r.cause;if(Zu(e))return e.issues}return[]}function wp(r){return r.length!==0}function vp(r){return r.description??""}var lE=/[$_\p{ID_Start}][$\u200c\u200d\p{ID_Continue}]*/u;function dE(r){if(r.length===1){let e=r[0];return typeof e=="symbol"&&(e=vp(e)),e.toString()||'""'}return r.reduce((e,t)=>{if(typeof t=="number")return e+"["+t.toString()+"]";if(typeof t=="symbol"&&(t=vp(t)),t.includes('"'))return e+'["'+hE(t)+'"]';if(!lE.test(t))return e+'["'+t+'"]';let s=e.length===0?"":".";return e+s+t},"")}function hE(r){return r.replace(/"/g,'\\"')}var fE="; ",pE=99,bp="Validation error",mE=": ",gE=", or ";function yE(r={}){let{issueSeparator:e=fE,unionSeparator:t=gE,prefixSeparator:s=mE,prefix:n=bp,includePath:i=!0,maxIssuesInMessage:o=pE}=r;return a=>{let c=a.slice(0,o).map(u=>ko({issue:u,issueSeparator:e,unionSeparator:t,includePath:i})).join(e);return _E(c,n,s)}}function ko(r){let{issue:e,issueSeparator:t,unionSeparator:s,includePath:n}=r;if(e.code===S.invalid_union)return e.unionErrors.reduce((i,o)=>{let a=o.issues.map(c=>ko({issue:c,issueSeparator:t,unionSeparator:s,includePath:n})).join(t);return i.includes(a)||i.push(a),i},[]).join(s);if(e.code===S.invalid_arguments)return[e.message,...e.argumentsError.issues.map(i=>ko({issue:i,issueSeparator:t,unionSeparator:s,includePath:n}))].join(t);if(e.code===S.invalid_return_type)return[e.message,...e.returnTypeError.issues.map(i=>ko({issue:i,issueSeparator:t,unionSeparator:s,includePath:n}))].join(t);if(n&&wp(e.path)){if(e.path.length===1){let i=e.path[0];if(typeof i=="number")return`${e.message} at index ${i}`}return`${e.message} at "${dE(e.path)}"`}return e.message}function _E(r,e,t){return e!==null?r.length>0?[e,r].join(t):e:r.length>0?r:bp}function Ep(r,e={}){if(!Zu(r))throw new TypeError(`Invalid zodError param; expected instance of ZodError. Did you mean to use the "${bE.name}" method instead?`);return Sp(r,e)}function Sp(r,e={}){let t=r.errors,s;return wp(t)?s=vE(e)(t):s=r.message,new Ju(s,{cause:r})}function vE(r){return"messageBuilder"in r?r.messageBuilder:yE(r)}var wE=(r={})=>e=>Zu(e)?Sp(e,r):e instanceof Error?new Ju(e.message,{cause:e}):new Ju("Unknown error");function bE(r,e={}){return wE(e)(r)}var EE=/^[\w!#$%&'*.^`|~+-]+$/,SE=/^[ !#-:<-[\]-~]*$/,Yu=(r,e)=>{if(e&&r.indexOf(e)===-1)return{};let t=r.trim().split(";"),s={};for(let n of t){n=n.trim();let i=n.indexOf("=");if(i===-1)continue;let o=n.substring(0,i).trim();if(e&&e!==o||!EE.test(o))continue;let a=n.substring(i+1).trim();if(a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1)),SE.test(a)&&(s[o]=a.indexOf("%")!==-1?hs(a,on):a,e))break}return s};var TE=(r,e,t={})=>{let s=`${r}=${e}`;if(r.startsWith("__Secure-")&&!t.secure)throw new Error("__Secure- Cookie must have Secure attributes");if(r.startsWith("__Host-")){if(!t.secure)throw new Error("__Host- Cookie must have Secure attributes");if(t.path!=="/")throw new Error('__Host- Cookie must have Path attributes with "/"');if(t.domain)throw new Error("__Host- Cookie must not have Domain attributes")}if(t&&typeof t.maxAge=="number"&&t.maxAge>=0){if(t.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");s+=`; Max-Age=${t.maxAge|0}`}if(t.domain&&t.prefix!=="host"&&(s+=`; Domain=${t.domain}`),t.path&&(s+=`; Path=${t.path}`),t.expires){if(t.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");s+=`; Expires=${t.expires.toUTCString()}`}if(t.httpOnly&&(s+="; HttpOnly"),t.secure&&(s+="; Secure"),t.sameSite&&(s+=`; SameSite=${t.sameSite.charAt(0).toUpperCase()+t.sameSite.slice(1)}`),t.priority&&(s+=`; Priority=${t.priority.charAt(0).toUpperCase()+t.priority.slice(1)}`),t.partitioned){if(!t.secure)throw new Error("Partitioned Cookie must have Secure attributes");s+="; Partitioned"}return s},Co=(r,e,t)=>(e=encodeURIComponent(e),TE(r,e,t));var Po=(r,e,t)=>{let s=r.req.raw.headers.get("Cookie");if(typeof e=="string"){if(!s)return;let i=e;return t==="secure"?i="__Secure-"+e:t==="host"&&(i="__Host-"+e),Yu(s,i)[i]}return s?Yu(s):{}};var AE=(r,e,t)=>{let s;return t?.prefix==="secure"?s=Co("__Secure-"+r,e,{path:"/",...t,secure:!0}):t?.prefix==="host"?s=Co("__Host-"+r,e,{...t,path:"/",secure:!0,domain:void 0}):s=Co(r,e,{path:"/",...t}),s},Ms=(r,e,t,s)=>{let n=AE(e,t,s);r.header("Set-Cookie",n,{append:!0})};var Tp=(r,e)=>new Response(r,{headers:{"Content-Type":e}}).formData();var OE=/^application\/([a-z-\.]+\+)?json(;\s*[a-zA-Z0-9\-]+\=([^;]+))*$/,RE=/^multipart\/form-data(;\s?boundary=[a-zA-Z0-9'"()+_,\-./:=?]+)?$/,xE=/^application\/x-www-form-urlencoded(;\s*[a-zA-Z0-9\-]+\=([^;]+))*$/,Xu=(r,e)=>async(t,s)=>{let n={},i=t.req.header("Content-Type");switch(r){case"json":if(!i||!OE.test(i))break;try{n=await t.req.json()}catch{let a="Malformed JSON in request body";throw new Dt(400,{message:a})}break;case"form":{if(!i||!(RE.test(i)||xE.test(i)))break;let a;if(t.req.bodyCache.formData)a=await t.req.bodyCache.formData;else try{let u=await t.req.arrayBuffer();a=await Tp(u,i),t.req.bodyCache.formData=a}catch(u){let l="Malformed FormData request.";throw l+=u instanceof Error?` ${u.message}`:` ${String(u)}`,new Dt(400,{message:l})}let c={};a.forEach((u,l)=>{l.endsWith("[]")?(c[l]??=[]).push(u):Array.isArray(c[l])?c[l].push(u):l in c?c[l]=[c[l],u]:c[l]=u}),n=c;break}case"query":n=Object.fromEntries(Object.entries(t.req.queries()).map(([a,c])=>c.length===1?[a,c[0]]:[a,c]));break;case"param":n=t.req.param();break;case"header":n=t.req.header();break;case"cookie":n=Po(t);break}let o=await e(n,t);return o instanceof Response?o:(t.req.addValidatedData(r,o),await s())};var jo=(r,e,t)=>Xu(r,async(s,n)=>{let i=await e.safeParseAsync(s);if(t){let a=t({data:s,...i},n);if(a){if(a instanceof Response||a instanceof Promise)return a;if("response"in a)return a.response}}if(!i.success){let a=Ep(i.error);return n.json({message:a.message,errors:a.details},400)}return i.data});var v=Symbol.for("drizzle:entityKind"),Px=Symbol.for("drizzle:hasOwnEntityKind");function T(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=r.constructor;if(t)for(;t;){if(v in t&&t[v]===e[v])return!0;t=Object.getPrototypeOf(t)}return!1}var el=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Io=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new el}logQuery(e,t){let s=t.map(i=>{try{return JSON.stringify(i)}catch{return String(i)}}),n=s.length?` -- params: [${s.join(", ")}]`:"";this.writer.write(`Query: ${e}${n}`)}},No=class{static[v]="NoopLogger";logQuery(){}};var it=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};var $o=Symbol.for("drizzle:Name"),tl=Symbol.for("drizzle:Schema"),Ap=Symbol.for("drizzle:Columns"),rl=Symbol.for("drizzle:OriginalName"),sl=Symbol.for("drizzle:BaseName"),Op=Symbol.for("drizzle:IsAlias"),Rp=Symbol.for("drizzle:ExtraConfigBuilder"),xp=Symbol.for("drizzle:IsDrizzleTable"),D=class{static[v]="Table";static Symbol={Name:$o,Schema:tl,OriginalName:rl,Columns:Ap,BaseName:sl,IsAlias:Op,ExtraConfigBuilder:Rp};[$o];[rl];[tl];[Ap];[sl];[Op]=!1;[Rp]=void 0;[xp]=!0;constructor(e,t,s){this[$o]=this[rl]=e,this[tl]=t,this[sl]=s}};function kp(r){return typeof r=="object"&&r!==null&&xp in r}function Sr(r){return r[$o]}function Do(r,...e){return r(...e)}var Cp="0.30.10";var nl,il,_e={startActiveSpan(r,e){return nl?(il||(il=nl.trace.getTracer("drizzle-orm",Cp)),Do((t,s)=>s.startActiveSpan(r,n=>{try{return e(n)}catch(i){throw n.setStatus({code:t.SpanStatusCode.ERROR,message:i instanceof Error?i.message:"Unknown error"}),i}finally{n.end()}}),nl,il)):e()}};var ve=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}static[v]="Column";name;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}};var Lo=class{static[v]="ColumnBuilder";config;constructor(e,t,s){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:s}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}};var ol=Symbol.for("drizzle:PgInlineForeignKeys"),Je=class extends D{static[v]="PgTable";static Symbol=Object.assign({},D.Symbol,{InlineForeignKeys:ol});[ol]=[];[D.Symbol.ExtraConfigBuilder]=void 0};function kE(r,e,t,s,n=r){let i=new Je(r,s,n),o=Object.fromEntries(Object.entries(e).map(([c,u])=>{let l=u,d=l.build(i);return i[ol].push(...l.buildForeignKeys(d,i)),[c,d]})),a=Object.assign(i,o);return a[D.Symbol.Columns]=o,t&&(a[Je.Symbol.ExtraConfigBuilder]=t),a}var al=(r,e,t)=>kE(r,e,t,void 0);var Uo=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:s,columns:n,foreignColumns:i}=e();return{name:s,columns:n,foreignTable:i[0].table,foreignColumns:i}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new cl(e,this)}},cl=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:s}=this.reference(),n=t.map(a=>a.name),i=s.map(a=>a.name),o=[this.table[Je.Symbol.Name],...n,s[0].table[Je.Symbol.Name],...i];return e??`${o.join("_")}_fk`}};function dl(r,e){return`${r[Je.Symbol.Name]}_${e.join("_")}_unique`}var ul=class{constructor(e,t){this.name=t,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new ll(e,this.columns,this.nullsNotDistinctConfig,this.name)}},Pp=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new ul(e,this.name)}},ll=class{constructor(e,t,s,n){this.table=e,this.columns=t,this.name=n??dl(this.table,this.columns.map(i=>i.name)),this.nullsNotDistinct=s}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function jp(r,e,t){for(let s=e;s<r.length;s++){let n=r[s];if(n==="\\"){s++;continue}if(n==='"')return[r.slice(e,s).replace(/\\/g,""),s+1];if(!t&&(n===","||n==="}"))return[r.slice(e,s).replace(/\\/g,""),s]}return[r.slice(e).replace(/\\/g,""),r.length]}function Ip(r,e=0){let t=[],s=e,n=!1;for(;s<r.length;){let i=r[s];if(i===","){(n||s===e)&&t.push(""),n=!0,s++;continue}if(n=!1,i==="\\"){s+=2;continue}if(i==='"'){let[c,u]=jp(r,s+1,!0);t.push(c),s=u;continue}if(i==="}")return[t,s+1];if(i==="{"){let[c,u]=Ip(r,s+1);t.push(c),s=u;continue}let[o,a]=jp(r,s,!1);t.push(o),s=a}return[t,s]}function Np(r){let[e]=Ip(r,1);return e}function hl(r){return`{${r.map(e=>Array.isArray(e)?hl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var Ze=class extends Lo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new fl(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:s,actions:n})=>Do((i,o)=>{let a=new Uo(()=>{let c=i();return{columns:[e],foreignColumns:[c]}});return o.onUpdate&&a.onUpdate(o.onUpdate),o.onDelete&&a.onDelete(o.onDelete),a.build(t)},s,n))}},we=class extends ve{constructor(e,t){t.uniqueName||(t.uniqueName=dl(e,[t.name])),super(e,t),this.table=e}static[v]="PgColumn"},fl=class extends Ze{static[v]="PgArrayBuilder";constructor(e,t,s){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=s}build(e){let t=this.config.baseBuilder.build(e);return new pl(e,this.config,t)}},pl=class r extends we{constructor(e,t,s,n){super(e,t),this.baseColumn=s,this.range=n,this.size=t.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Np(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let s=e.map(n=>n===null?null:T(this.baseColumn,r)?this.baseColumn.mapToDriverValue(n,!0):this.baseColumn.mapToDriverValue(n));return t?s:hl(s)}};var ml=Symbol.for("drizzle:isPgEnum");function $p(r){return!!r&&typeof r=="function"&&ml in r&&r[ml]===!0}var gl=class extends Ze{static[v]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new yl(e,this.config)}},yl=class extends we{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};function Et(r,e){return CE(r,e,void 0)}function CE(r,e,t){let s=Object.assign(n=>new gl(n,s),{enumName:r,enumValues:e,schema:t,[ml]:!0});return s}var Ke=class{static[v]="Subquery";constructor(e,t,s,n=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:s,isWith:n}}},Fs=class extends Ke{static[v]="WithSubquery"};var Ie=Symbol.for("drizzle:ViewBaseConfig");var Dp=class{static[v]="FakePrimitiveParam"};function _l(r){return r!=null&&typeof r.getSQL=="function"}function PE(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var Be=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new q([this])}},q=class r{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Up;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return _e.startActiveSpan("drizzle.buildSQL",t=>{let s=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":s.sql,"drizzle.query.params":JSON.stringify(s.params)}),s})}buildQueryFromSourceParams(e,t){let s=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{escapeName:n,escapeParam:i,prepareTyping:o,inlineParams:a,paramStartIndex:c}=s;return PE(e.map(u=>{if(T(u,Be))return{sql:u.value.join(""),params:[]};if(T(u,$n))return{sql:n(u.value),params:[]};if(u===void 0)return{sql:"",params:[]};if(Array.isArray(u)){let l=[new Be("(")];for(let[d,f]of u.entries())l.push(f),d<u.length-1&&l.push(new Be(", "));return l.push(new Be(")")),this.buildQueryFromSourceParams(l,s)}if(T(u,r))return this.buildQueryFromSourceParams(u.queryChunks,{...s,inlineParams:a||u.shouldInlineParams});if(T(u,D)){let l=u[D.Symbol.Schema],d=u[D.Symbol.Name];return{sql:l===void 0?n(d):n(l)+"."+n(d),params:[]}}if(T(u,ve))return{sql:n(u.table[D.Symbol.Name])+"."+n(u.name),params:[]};if(T(u,dt)){let l=u[Ie].schema,d=u[Ie].name;return{sql:l===void 0?n(d):n(l)+"."+n(d),params:[]}}if(T(u,St)){let l=u.value===null?null:u.encoder.mapToDriverValue(u.value);if(T(l,r))return this.buildQueryFromSourceParams([l],s);if(a)return{sql:this.mapInlineParam(l,s),params:[]};let d;return o!==void 0&&(d=[o(u.encoder)]),{sql:i(c.value++,l),params:[l],typings:d}}return T(u,ts)?{sql:i(c.value++,u),params:[u]}:T(u,r.Aliased)&&u.fieldAlias!==void 0?{sql:n(u.fieldAlias),params:[]}:T(u,Ke)?u._.isWith?{sql:n(u._.alias),params:[]}:this.buildQueryFromSourceParams([new Be("("),u._.sql,new Be(") "),new $n(u._.alias)],s):$p(u)?u.schema?{sql:n(u.schema)+"."+n(u.enumName),params:[]}:{sql:n(u.enumName),params:[]}:_l(u)?this.buildQueryFromSourceParams([new Be("("),u.getSQL(),new Be(")")],s):a?{sql:this.mapInlineParam(u,s),params:[]}:{sql:i(c.value++,u),params:[u]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let s=e.toString();return t(s==="[object Object]"?JSON.stringify(e):s)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new r.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},$n=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new q([this])}};function Lp(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var Up={mapFromDriverValue:r=>r},qp={mapToDriverValue:r=>r},Ak={...Up,...qp},St=class{constructor(e,t=qp){this.value=e,this.encoder=t}static[v]="Param";brand;getSQL(){return new q([this])}};function m(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new Be(r[0]));for(let[s,n]of e.entries())t.push(n,new Be(r[s+1]));return new q(t)}(r=>{function e(){return new q([])}r.empty=e;function t(c){return new q(c)}r.fromList=t;function s(c){return new q([new Be(c)])}r.raw=s;function n(c,u){let l=[];for(let[d,f]of c.entries())d>0&&u!==void 0&&l.push(u),l.push(f);return new q(l)}r.join=n;function i(c){return new $n(c)}r.identifier=i;function o(c){return new ts(c)}r.placeholder=o;function a(c,u){return new St(c,u)}r.param=a})(m||(m={}));(r=>{class e{constructor(s,n){this.sql=s,this.fieldAlias=n}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(q||(q={}));var ts=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new q([this])}};function vl(r,e){return r.map(t=>{if(T(t,ts)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}return t})}var dt=class{static[v]="View";[Ie];constructor({name:e,schema:t,selectedFields:s,query:n}){this[Ie]={name:e,originalName:e,schema:t,selectedFields:s,query:n,isExisting:!n,isAlias:!1}}getSQL(){return new q([this])}};ve.prototype.getSQL=function(){return new q([this])};D.prototype.getSQL=function(){return new q([this])};Ke.prototype.getSQL=function(){return new q([this])};function Bp(r,e,t){let s={},n=r.reduce((i,{path:o,field:a},c)=>{let u;T(a,ve)?u=a:T(a,q)?u=a.decoder:u=a.sql.decoder;let l=i;for(let[d,f]of o.entries())if(d<o.length-1)f in l||(l[f]={}),l=l[f];else{let p=e[c],y=l[f]=p===null?null:u.mapFromDriverValue(p);if(t&&T(a,ve)&&o.length===2){let g=o[0];g in s?typeof s[g]=="string"&&s[g]!==Sr(a.table)&&(s[g]=!1):s[g]=y===null?Sr(a.table):!1}}return i},{});if(t&&Object.keys(s).length>0)for(let[i,o]of Object.entries(s))typeof o=="string"&&!t[o]&&(n[i]=null);return n}function It(r,e){return Object.entries(r).reduce((t,[s,n])=>{if(typeof s!="string")return t;let i=e?[...e,s]:[s];return T(n,ve)||T(n,q)||T(n,q.Aliased)?t.push({path:i,field:n}):T(n,D)?t.push(...It(n[D.Symbol.Columns],i)):t.push(...It(n,i)),t},[])}function wl(r,e){let t=Object.keys(r),s=Object.keys(e);if(t.length!==s.length)return!1;for(let[n,i]of t.entries())if(i!==s[n])return!1;return!0}function qo(r,e){let t=Object.entries(e).filter(([,s])=>s!==void 0).map(([s,n])=>T(n,q)?[s,n]:[s,new St(n,r[D.Symbol.Columns][s])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function Mp(r,e){for(let t of e)for(let s of Object.getOwnPropertyNames(t.prototype))s!=="constructor"&&Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))}function Fp(r){return r[D.Symbol.Columns]}function bl(r){return T(r,Ke)?r._.alias:T(r,dt)?r[Ie].name:T(r,q)?void 0:r[D.Symbol.IsAlias]?r[D.Symbol.Name]:r[D.Symbol.BaseName]}var Dn=class extends it{constructor(e,t,s,n){super(),this.session=t,this.dialect=s,this.config={table:e,withList:n}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[D.Symbol.Columns]){return this.config.returning=It(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return _e.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}execute=e=>_e.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e));$dynamic(){return this}};var Ln=class{constructor(e,t,s,n){this.table=e,this.session=t,this.dialect=s,this.withList=n}static[v]="PgInsertBuilder";values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(s=>{let n={},i=this.table[D.Symbol.Columns];for(let o of Object.keys(s)){let a=s[o];n[o]=T(a,q)?a:new St(a,i[o])}return n});return new El(this.table,t,this.session,this.dialect,this.withList)}},El=class extends it{constructor(e,t,s,n,i){super(),this.session=s,this.dialect=n,this.config={table:e,values:t,withList:i}}static[v]="PgInsert";config;returning(e=this.config.table[D.Symbol.Columns]){return this.config.returning=It(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=m`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(n.name)).join(","):this.dialect.escapeName(e.target.name);let s=e.where?m` where ${e.where}`:void 0;this.config.onConflict=m`(${m.raw(t)})${s} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?m` where ${e.where}`:void 0,s=e.targetWhere?m` where ${e.targetWhere}`:void 0,n=e.setWhere?m` where ${e.setWhere}`:void 0,i=this.dialect.buildUpdateSet(this.config.table,qo(this.config.table,e.set)),o="";return o=Array.isArray(e.target)?e.target.map(a=>this.dialect.escapeName(a.name)).join(","):this.dialect.escapeName(e.target.name),this.config.onConflict=m`(${m.raw(o)})${s} do update set ${i}${t}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return _e.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}execute=e=>_e.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e));$dynamic(){return this}};var rs=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,t){return t==="table"?this.table:e[t]}},Vs=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[v]="TableAliasProxyHandler";get(e,t){if(t===D.Symbol.IsAlias)return!0;if(t===D.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===D.Symbol.OriginalName)return this.alias;if(t===Ie)return{...e[Ie],name:this.alias,isAlias:!0};if(t===D.Symbol.Columns){let n=e[D.Symbol.Columns];if(!n)return n;let i={};return Object.keys(n).map(o=>{i[o]=new Proxy(n[o],new rs(new Proxy(e,this)))}),i}let s=e[t];return T(s,ve)?new Proxy(s,new rs(new Proxy(e,this))):s}},Vp=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?Un(e.sourceTable,this.alias):e[t]}};function Un(r,e){return new Proxy(r,new Vs(e,!1))}function Xt(r,e){return new Proxy(r,new rs(new Proxy(r.table,new Vs(e,!1))))}function Sl(r,e){return new q.Aliased(qn(r.sql,e),r.fieldAlias)}function qn(r,e){return m.join(r.queryChunks.map(t=>T(t,ve)?Xt(t,e):T(t,q)?qn(t,e):T(t,q.Aliased)?Sl(t,e):t))}var Bn=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Bo=class extends Bn{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var er=class extends Ze{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(m`now()`)}};var zp=class extends er{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new Mn(e,this.config)}},Mn=class extends we{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Hp=class extends er{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Fn(e,this.config)}},Fn=class extends we{static[v]="PgDateString";getSQLType(){return"date"}};var Kp=class extends Ze{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Vn(e,this.config)}},Vn=class extends we{static[v]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};var Wp=class extends Ze{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new zn(e,this.config)}},zn=class extends we{static[v]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};var Tl=class extends Ze{static[v]="PgNumericBuilder";constructor(e,t,s){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=s}build(e){return new Hn(e,this.config)}},Hn=class extends we{static[v]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function Mo(r,e){return new Tl(r,e?.precision,e?.scale)}var Al=class extends Ze{static[v]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new Ol(e,this.config)}},Ol=class extends we{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function tr(r,e={}){return new Al(r,e)}var Gp=class extends er{constructor(e,t,s){super(e,"string","PgTime"),this.withTimezone=t,this.precision=s,this.config.withTimezone=t,this.config.precision=s}static[v]="PgTimeBuilder";build(e){return new Kn(e,this.config)}},Kn=class extends we{static[v]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};var Rl=class extends er{static[v]="PgTimestampBuilder";constructor(e,t,s){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=s}build(e){return new Wn(e,this.config)}},Wn=class extends we{static[v]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},xl=class extends er{static[v]="PgTimestampStringBuilder";constructor(e,t,s){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=s}build(e){return new Gn(e,this.config)}},Gn=class extends we{static[v]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function hr(r,e={}){return e.mode==="string"?new xl(r,e.withTimezone??!1,e.precision):new Rl(r,e.withTimezone??!1,e.precision)}var kl=class extends Ze{static[v]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(m`gen_random_uuid()`)}build(e){return new Qn(e,this.config)}},Qn=class extends we{static[v]="PgUUID";getSQLType(){return"uuid"}};function Cl(r){return new kl(r)}var Fo=class{static[v]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new Pl(e,this.columns,this.name)}},Pl=class{constructor(e,t,s){this.table=e,this.columns=t,this.name=s}static[v]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[Je.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};function vt(r,e){return Lp(e)&&!_l(r)&&!T(r,St)&&!T(r,ts)&&!T(r,ve)&&!T(r,D)&&!T(r,dt)?new St(r,e):r}var zs=(r,e)=>m`${r} = ${vt(e,r)}`,Qp=(r,e)=>m`${r} <> ${vt(e,r)}`;function Jn(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new q(e):new q([new Be("("),m.join(e,new Be(" and ")),new Be(")")])}function Jp(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new q(e):new q([new Be("("),m.join(e,new Be(" or ")),new Be(")")])}function Zp(r){return m`not ${r}`}var Yp=(r,e)=>m`${r} > ${vt(e,r)}`,Xp=(r,e)=>m`${r} >= ${vt(e,r)}`,em=(r,e)=>m`${r} < ${vt(e,r)}`,tm=(r,e)=>m`${r} <= ${vt(e,r)}`;function rm(r,e){if(Array.isArray(e)){if(e.length===0)throw new Error("inArray requires at least one value");return m`${r} in ${e.map(t=>vt(t,r))}`}return m`${r} in ${vt(e,r)}`}function sm(r,e){if(Array.isArray(e)){if(e.length===0)throw new Error("notInArray requires at least one value");return m`${r} not in ${e.map(t=>vt(t,r))}`}return m`${r} not in ${vt(e,r)}`}function nm(r){return m`${r} is null`}function im(r){return m`${r} is not null`}function om(r){return m`exists ${r}`}function am(r){return m`not exists ${r}`}function cm(r,e,t){return m`${r} between ${vt(e,r)} and ${vt(t,r)}`}function um(r,e,t){return m`${r} not between ${vt(e,r)} and ${vt(t,r)}`}function lm(r,e){return m`${r} like ${e}`}function dm(r,e){return m`${r} not like ${e}`}function hm(r,e){return m`${r} ilike ${e}`}function fm(r,e){return m`${r} not ilike ${e}`}function pm(r){return m`${r} asc`}function mm(r){return m`${r} desc`}var Vo=class{constructor(e,t,s){this.sourceTable=e,this.referencedTable=t,this.relationName=s,this.referencedTableName=t[D.Symbol.Name]}static[v]="Relation";referencedTableName;fieldName},jl=class{constructor(e,t){this.table=e,this.config=t}static[v]="Relations"},Tr=class r extends Vo{constructor(e,t,s,n){super(e,t,s?.relationName),this.config=s,this.isNullable=n}static[v]="One";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},Zn=class r extends Vo{constructor(e,t,s){super(e,t,s?.relationName),this.config=s}static[v]="Many";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}};function gm(){return{and:Jn,between:cm,eq:zs,exists:om,gt:Yp,gte:Xp,ilike:hm,inArray:rm,isNull:nm,isNotNull:im,like:lm,lt:em,lte:tm,ne:Qp,not:Zp,notBetween:um,notExists:am,notLike:dm,notIlike:fm,notInArray:sm,or:Jp,sql:m}}function ym(){return{sql:m,asc:pm,desc:mm}}function _m(r,e){Object.keys(r).length===1&&"default"in r&&!T(r.default,D)&&(r=r.default);let t={},s={},n={};for(let[i,o]of Object.entries(r))if(kp(o)){let a=o[D.Symbol.Name],c=s[a];t[a]=i,n[i]={tsName:i,dbName:o[D.Symbol.Name],schema:o[D.Symbol.Schema],columns:o[D.Symbol.Columns],relations:c?.relations??{},primaryKey:c?.primaryKey??[]};for(let l of Object.values(o[D.Symbol.Columns]))l.primary&&n[i].primaryKey.push(l);let u=o[D.Symbol.ExtraConfigBuilder]?.(o);if(u)for(let l of Object.values(u))T(l,Fo)&&n[i].primaryKey.push(...l.columns)}else if(T(o,jl)){let a=o.table[D.Symbol.Name],c=t[a],u=o.config(e(o.table)),l;for(let[d,f]of Object.entries(u))if(c){let p=n[c];p.relations[d]=f,l&&p.primaryKey.push(...l)}else a in s||(s[a]={relations:{},primaryKey:l}),s[a].relations[d]=f}return{tables:n,tableNamesMap:t}}function jE(r){return function(t,s){return new Tr(r,t,s,s?.fields.reduce((n,i)=>n&&i.notNull,!0)??!1)}}function IE(r){return function(t,s){return new Zn(r,t,s)}}function vm(r,e,t){if(T(t,Tr)&&t.config)return{fields:t.config.fields,references:t.config.references};let s=e[t.referencedTable[D.Symbol.Name]];if(!s)throw new Error(`Table "${t.referencedTable[D.Symbol.Name]}" not found in schema`);let n=r[s];if(!n)throw new Error(`Table "${s}" not found in schema`);let i=t.sourceTable,o=e[i[D.Symbol.Name]];if(!o)throw new Error(`Table "${i[D.Symbol.Name]}" not found in schema`);let a=[];for(let c of Object.values(n.relations))(t.relationName&&t!==c&&c.relationName===t.relationName||!t.relationName&&c.referencedTable===t.sourceTable)&&a.push(c);if(a.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${s}"`):new Error(`There are multiple relations between "${s}" and "${t.sourceTable[D.Symbol.Name]}". Please specify relation name`);if(a[0]&&T(a[0],Tr)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${t.fieldName}"`)}function wm(r){return{one:jE(r),many:IE(r)}}function zo(r,e,t,s,n=i=>i){let i={};for(let[o,a]of s.entries())if(a.isJson){let c=e.relations[a.tsKey],u=t[o],l=typeof u=="string"?JSON.parse(u):u;i[a.tsKey]=T(c,Tr)?l&&zo(r,r[a.relationTableTsKey],l,a.selection,n):l.map(d=>zo(r,r[a.relationTableTsKey],d,a.selection,n))}else{let c=n(t[o]),u=a.field,l;T(u,ve)?l=u:T(u,q)?l=u.decoder:l=u.sql.decoder,i[a.tsKey]=c===null?null:l.mapFromDriverValue(c)}return i}var Hs=class extends dt{static[v]="PgViewBase"};var Ks=class{static[v]="PgDialect";async migrate(e,t,s){let n=typeof s=="string"?"__drizzle_migrations":s.migrationsTable??"__drizzle_migrations",i=typeof s=="string"?"drizzle":s.migrationsSchema??"drizzle",o=m`
			CREATE TABLE IF NOT EXISTS ${m.identifier(i)}.${m.identifier(n)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(m`CREATE SCHEMA IF NOT EXISTS ${m.identifier(i)}`),await t.execute(o);let c=(await t.all(m`select id, hash, created_at from ${m.identifier(i)}.${m.identifier(n)} order by created_at desc limit 1`))[0];await t.transaction(async u=>{for await(let l of e)if(!c||Number(c.created_at)<l.folderMillis){for(let d of l.sql)await u.execute(m.raw(d));await u.execute(m`insert into ${m.identifier(i)}.${m.identifier(n)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[m`with `];for(let[s,n]of e.entries())t.push(m`${m.identifier(n._.alias)} as (${n._.sql})`),s<e.length-1&&t.push(m`, `);return t.push(m` `),m.join(t)}buildDeleteQuery({table:e,where:t,returning:s,withList:n}){let i=this.buildWithCTE(n),o=s?m` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,a=t?m` where ${t}`:void 0;return m`${i}delete from ${e}${a}${o}`}buildUpdateSet(e,t){let s=e[D.Symbol.Columns],n=Object.keys(s).filter(o=>t[o]!==void 0||s[o]?.onUpdateFn!==void 0),i=n.length;return m.join(n.flatMap((o,a)=>{let c=s[o],u=t[o]??m.param(c.onUpdateFn(),c),l=m`${m.identifier(c.name)} = ${u}`;return a<i-1?[l,m.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:t,where:s,returning:n,withList:i}){let o=this.buildWithCTE(i),a=this.buildUpdateSet(e,t),c=n?m` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,u=s?m` where ${s}`:void 0;return m`${o}update ${e} set ${a}${u}${c}`}buildSelection(e,{isSingleTable:t=!1}={}){let s=e.length,n=e.flatMap(({field:i},o)=>{let a=[];if(T(i,q.Aliased)&&i.isSelectionField)a.push(m.identifier(i.fieldAlias));else if(T(i,q.Aliased)||T(i,q)){let c=T(i,q.Aliased)?i.sql:i;t?a.push(new q(c.queryChunks.map(u=>T(u,we)?m.identifier(u.name):u))):a.push(c),T(i,q.Aliased)&&a.push(m` as ${m.identifier(i.fieldAlias)}`)}else T(i,ve)&&(t?a.push(m.identifier(i.name)):a.push(i));return o<s-1&&a.push(m`, `),a});return m.join(n)}buildSelectQuery({withList:e,fields:t,fieldsFlat:s,where:n,having:i,table:o,joins:a,orderBy:c,groupBy:u,limit:l,offset:d,lockingClause:f,distinct:p,setOperators:y}){let g=s??It(t);for(let ae of g)if(T(ae.field,ve)&&Sr(ae.field.table)!==(T(o,Ke)?o._.alias:T(o,Hs)?o[Ie].name:T(o,q)?void 0:Sr(o))&&!(he=>a?.some(({alias:ze})=>ze===(he[D.Symbol.IsAlias]?Sr(he):he[D.Symbol.BaseName])))(ae.field.table)){let he=Sr(ae.field.table);throw new Error(`Your "${ae.path.join("->")}" field references a column "${he}"."${ae.field.name}", but the table "${he}" is not part of the query! Did you forget to join it?`)}let w=!a||a.length===0,b=this.buildWithCTE(e),A;p&&(A=p===!0?m` distinct`:m` distinct on (${m.join(p.on,m`, `)})`);let E=this.buildSelection(g,{isSingleTable:w}),x=(()=>{if(T(o,D)&&o[D.Symbol.OriginalName]!==o[D.Symbol.Name]){let ae=m`${m.identifier(o[D.Symbol.OriginalName])}`;return o[D.Symbol.Schema]&&(ae=m`${m.identifier(o[D.Symbol.Schema])}.${ae}`),m`${ae} ${m.identifier(o[D.Symbol.Name])}`}return o})(),U=[];if(a)for(let[ae,he]of a.entries()){ae===0&&U.push(m` `);let ze=he.table,O=he.lateral?m` lateral`:void 0;if(T(ze,Je)){let M=ze[Je.Symbol.Name],te=ze[Je.Symbol.Schema],le=ze[Je.Symbol.OriginalName],Oe=M===le?void 0:he.alias;U.push(m`${m.raw(he.joinType)} join${O} ${te?m`${m.identifier(te)}.`:void 0}${m.identifier(le)}${Oe&&m` ${m.identifier(Oe)}`} on ${he.on}`)}else if(T(ze,dt)){let M=ze[Ie].name,te=ze[Ie].schema,le=ze[Ie].originalName,Oe=M===le?void 0:he.alias;U.push(m`${m.raw(he.joinType)} join${O} ${te?m`${m.identifier(te)}.`:void 0}${m.identifier(le)}${Oe&&m` ${m.identifier(Oe)}`} on ${he.on}`)}else U.push(m`${m.raw(he.joinType)} join${O} ${ze} on ${he.on}`);ae<a.length-1&&U.push(m` `)}let V=m.join(U),N=n?m` where ${n}`:void 0,W=i?m` having ${i}`:void 0,Y;c&&c.length>0&&(Y=m` order by ${m.join(c,m`, `)}`);let R;u&&u.length>0&&(R=m` group by ${m.join(u,m`, `)}`);let Ae=l?m` limit ${l}`:void 0,Q=d?m` offset ${d}`:void 0,me=m.empty();if(f){let ae=m` for ${m.raw(f.strength)}`;f.config.of&&ae.append(m` of ${m.join(Array.isArray(f.config.of)?f.config.of:[f.config.of],m`, `)}`),f.config.noWait?ae.append(m` no wait`):f.config.skipLocked&&ae.append(m` skip locked`),me.append(ae)}let Ot=m`${b}select${A} ${E} from ${x}${V}${N}${R}${W}${Y}${Ae}${Q}${me}`;return y.length>0?this.buildSetOperations(Ot,y):Ot}buildSetOperations(e,t){let[s,...n]=t;if(!s)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:s}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:s}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:s,rightSelect:n,limit:i,orderBy:o,offset:a}}){let c=m`(${e.getSQL()}) `,u=m`(${n.getSQL()})`,l;if(o&&o.length>0){let y=[];for(let g of o)if(T(g,we))y.push(m.identifier(g.name));else if(T(g,q)){for(let w=0;w<g.queryChunks.length;w++){let b=g.queryChunks[w];T(b,we)&&(g.queryChunks[w]=m.identifier(b.name))}y.push(m`${g}`)}else y.push(m`${g}`);l=m` order by ${m.join(y,m`, `)} `}let d=i?m` limit ${i}`:void 0,f=m.raw(`${t} ${s?"all ":""}`),p=a?m` offset ${a}`:void 0;return m`${c}${f}${u}${l}${d}${p}`}buildInsertQuery({table:e,values:t,onConflict:s,returning:n,withList:i}){let o=[],a=e[D.Symbol.Columns],c=Object.entries(a),u=c.map(([,y])=>m.identifier(y.name));for(let[y,g]of t.entries()){let w=[];for(let[b,A]of c){let E=g[b];if(E===void 0||T(E,St)&&E.value===void 0)if(A.defaultFn!==void 0){let x=A.defaultFn(),U=T(x,q)?x:m.param(x,A);w.push(U)}else if(!A.default&&A.onUpdateFn!==void 0){let x=A.onUpdateFn(),U=T(x,q)?x:m.param(x,A);w.push(U)}else w.push(m`default`);else w.push(E)}o.push(w),y<t.length-1&&o.push(m`, `)}let l=this.buildWithCTE(i),d=m.join(o),f=n?m` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,p=s?m` on conflict ${s}`:void 0;return m`${l}insert into ${e} ${u} values ${d}${p}${f}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:s}){let n=t?m` concurrently`:void 0,i=s?m` with no data`:void 0;return m`refresh materialized view${n} ${e}${i}`}prepareTyping(e){return T(e,zn)||T(e,Vn)?"json":T(e,Hn)?"decimal":T(e,Kn)?"time":T(e,Wn)||T(e,Gn)?"timestamp":T(e,Mn)||T(e,Fn)?"date":T(e,Qn)?"uuid":"none"}sqlToQuery(e){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:s,table:n,tableConfig:i,queryConfig:o,tableAlias:a,nestedQueryRelation:c,joinOn:u}){let l=[],d,f,p=[],y,g=[];if(o===!0)l=Object.entries(i.columns).map(([A,E])=>({dbKey:E.name,tsKey:A,field:Xt(E,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(i.columns).map(([N,W])=>[N,Xt(W,a)]));if(o.where){let N=typeof o.where=="function"?o.where(b,gm()):o.where;y=N&&qn(N,a)}let A=[],E=[];if(o.columns){let N=!1;for(let[W,Y]of Object.entries(o.columns))Y!==void 0&&W in i.columns&&(!N&&Y===!0&&(N=!0),E.push(W));E.length>0&&(E=N?E.filter(W=>o.columns?.[W]===!0):Object.keys(i.columns).filter(W=>!E.includes(W)))}else E=Object.keys(i.columns);for(let N of E){let W=i.columns[N];A.push({tsKey:N,value:W})}let x=[];o.with&&(x=Object.entries(o.with).filter(N=>!!N[1]).map(([N,W])=>({tsKey:N,queryConfig:W,relation:i.relations[N]})));let U;if(o.extras){U=typeof o.extras=="function"?o.extras(b,{sql:m}):o.extras;for(let[N,W]of Object.entries(U))A.push({tsKey:N,value:Sl(W,a)})}for(let{tsKey:N,value:W}of A)l.push({dbKey:T(W,q.Aliased)?W.fieldAlias:i.columns[N].name,tsKey:N,field:T(W,ve)?Xt(W,a):W,relationTableTsKey:void 0,isJson:!1,selection:[]});let V=typeof o.orderBy=="function"?o.orderBy(b,ym()):o.orderBy??[];Array.isArray(V)||(V=[V]),p=V.map(N=>T(N,ve)?Xt(N,a):qn(N,a)),d=o.limit,f=o.offset;for(let{tsKey:N,queryConfig:W,relation:Y}of x){let R=vm(t,s,Y),Ae=Y.referencedTable[D.Symbol.Name],Q=s[Ae],me=`${a}_${N}`,Ot=Jn(...R.fields.map((ze,O)=>zs(Xt(R.references[O],me),Xt(ze,a)))),ae=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:s,table:e[Q],tableConfig:t[Q],queryConfig:T(Y,Tr)?W===!0?{limit:1}:{...W,limit:1}:W,tableAlias:me,joinOn:Ot,nestedQueryRelation:Y}),he=m`${m.identifier(me)}.${m.identifier("data")}`.as(N);g.push({on:m`true`,table:new Ke(ae.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:N,tsKey:N,field:he,relationTableTsKey:Q,isJson:!0,selection:ae.selection})}}if(l.length===0)throw new Bn({message:`No fields selected for table "${i.tsName}" ("${a}")`});let w;if(y=Jn(u,y),c){let b=m`json_build_array(${m.join(l.map(({field:x,tsKey:U,isJson:V})=>V?m`${m.identifier(`${a}_${U}`)}.${m.identifier("data")}`:T(x,q.Aliased)?x.sql:x),m`, `)})`;T(c,Zn)&&(b=m`coalesce(json_agg(${b}${p.length>0?m` order by ${m.join(p,m`, `)}`:void 0}), '[]'::json)`);let A=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:l}];d!==void 0||f!==void 0||p.length>0?(w=this.buildSelectQuery({table:Un(n,a),fields:{},fieldsFlat:[{path:[],field:m.raw("*")}],where:y,limit:d,offset:f,orderBy:p,setOperators:[]}),y=void 0,d=void 0,f=void 0,p=[]):w=Un(n,a),w=this.buildSelectQuery({table:T(w,Je)?w:new Ke(w,{},a),fields:{},fieldsFlat:A.map(({field:x})=>({path:[],field:T(x,ve)?Xt(x,a):x})),joins:g,where:y,limit:d,offset:f,orderBy:p,setOperators:[]})}else w=this.buildSelectQuery({table:Un(n,a),fields:{},fieldsFlat:l.map(({field:b})=>({path:[],field:T(b,ve)?Xt(b,a):b})),joins:g,where:y,limit:d,offset:f,orderBy:p,setOperators:[]});return{tableTsKey:i.tsName,sql:w,selection:l}}};var wt=class r{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===Ie)return{...e[Ie],selectedFields:new Proxy(e[Ie].selectedFields,this)};if(typeof t=="symbol")return e[t];let n=(T(e,Ke)?e._.selectedFields:T(e,dt)?e[Ie].selectedFields:e)[t];if(T(n,q.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!n.isSelectionField)return n.sql;let i=n.clone();return i.isSelectionField=!0,i}if(T(n,q)){if(this.config.sqlBehavior==="sql")return n;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return T(n,ve)?this.config.alias?new Proxy(n,new rs(new Proxy(n.table,new Vs(this.config.alias,this.config.replaceOriginalName??!1)))):n:typeof n!="object"||n===null?n:new Proxy(n,new r(this.config))}};var Ho=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ot=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}from(e){let t=!!this.fields,s;return this.fields?s=this.fields:T(e,Ke)?s=Object.fromEntries(Object.keys(e._.selectedFields).map(n=>[n,e[n]])):T(e,Hs)?s=e[Ie].selectedFields:T(e,q)?s={}:s=Fp(e),new Ko({table:e,fields:s,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}},Il=class extends Ho{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:s,session:n,dialect:i,withList:o,distinct:a}){super(),this.config={withList:o,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=s,this.session=n,this.dialect=i,this._={selectedFields:t},this.tableName=bl(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,s)=>{let n=this.tableName,i=bl(t);if(typeof i=="string"&&this.config.joins?.some(o=>o.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof i=="string"&&!T(t,q))){let o=T(t,Ke)?t._.selectedFields:T(t,dt)?t[Ie].selectedFields:t[D.Symbol.Columns];this.config.fields[i]=o}if(typeof s=="function"&&(s=s(new Proxy(this.config.fields,new wt({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:s,table:t,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return s=>{let n=typeof s=="function"?s(NE()):s;if(!wl(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new wt({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new wt({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new wt({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new wt({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new Ke(this.getSQL(),this.config.fields,e),new wt({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new wt({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},Ko=class extends Il{static[v]="PgSelect";_prepare(e){let{session:t,config:s,dialect:n,joinsNotNullableMap:i}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return _e.startActiveSpan("drizzle.prepareQuery",()=>{let o=It(s.fields),a=t.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return a.joinsNotNullableMap=i,a})}prepare(e){return this._prepare(e)}execute=e=>_e.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e))};Mp(Ko,[it]);function Ws(r,e){return(t,s,...n)=>{let i=[s,...n].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of i)if(!wl(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(i)}}var NE=()=>({union:$E,unionAll:DE,intersect:LE,intersectAll:UE,except:qE,exceptAll:BE}),$E=Ws("union",!1),DE=Ws("union",!0),LE=Ws("intersect",!1),UE=Ws("intersect",!0),qE=Ws("except",!1),BE=Ws("except",!0);var Wo=class{static[v]="PgQueryBuilder";dialect;$with(e){let t=this;return{as(s){return typeof s=="function"&&(s=s(t)),new Proxy(new Fs(s.getSQL(),s.getSelectedFields(),e,!0),new wt({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){let t=this;function s(o){return new ot({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function n(o){return new ot({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function i(o,a){return new ot({fields:a??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:o}})}return{select:s,selectDistinct:n,selectDistinctOn:i}}select(e){return new ot({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ot({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new ot({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Ks),this.dialect}};var Go=class extends it{constructor(e,t,s){super(),this.session=t,this.dialect=s,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return _e.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}execute=e=>_e.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e))};var Yn=class{constructor(e,t,s,n){this.table=e,this.session=t,this.dialect=s,this.withList=n}static[v]="PgUpdateBuilder";set(e){return new Nl(this.table,qo(this.table,e),this.session,this.dialect,this.withList)}},Nl=class extends it{constructor(e,t,s,n,i){super(),this.session=s,this.dialect=n,this.config={set:t,table:e,withList:i}}static[v]="PgUpdate";config;where(e){return this.config.where=e,this}returning(e=this.config.table[D.Symbol.Columns]){return this.config.returning=It(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0)}prepare(e){return this._prepare(e)}execute=e=>this._prepare().execute(e);$dynamic(){return this}};var Qo=class{constructor(e,t,s,n,i,o,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=n,this.tableConfig=i,this.dialect=o,this.session=a}static[v]="PgRelationalQueryBuilder";findMany(e){return new Jo(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Jo(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Jo=class extends it{constructor(e,t,s,n,i,o,a,c,u){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=n,this.tableConfig=i,this.dialect=o,this.session=a,this.config=c,this.mode=u}static[v]="PgRelationalQuery";_prepare(e){return _e.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:s}=this._toSQL();return this.session.prepareQuery(s,void 0,e,!0,(n,i)=>{let o=n.map(a=>zo(this.schema,this.tableConfig,a,t.selection,i));return this.mode==="first"?o[0]:o})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}execute(){return _e.startActiveSpan("drizzle.operation",()=>this._prepare().execute())}};var Zo=class extends it{constructor(e,t,s,n){super(),this.execute=e,this.sql=t,this.query=s,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Gs=class{constructor(e,t,s){if(this.dialect=e,this.session=t,this._=s?{schema:s.schema,fullSchema:s.fullSchema,tableNamesMap:s.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[n,i]of Object.entries(this._.schema))this.query[n]=new Qo(s.fullSchema,this._.schema,this._.tableNamesMap,s.fullSchema[n],i,e,t)}static[v]="PgDatabase";query;$with(e){return{as(t){return typeof t=="function"&&(t=t(new Wo)),new Proxy(new Fs(t.getSQL(),t.getSelectedFields(),e,!0),new wt({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){let t=this;function s(u){return new ot({fields:u??void 0,session:t.session,dialect:t.dialect,withList:e})}function n(u){return new ot({fields:u??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function i(u,l){return new ot({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:u}})}function o(u){return new Yn(u,t.session,t.dialect,e)}function a(u){return new Ln(u,t.session,t.dialect,e)}function c(u){return new Dn(u,t.session,t.dialect,e)}return{select:s,selectDistinct:n,selectDistinctOn:i,update:o,insert:a,delete:c}}select(e){return new ot({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ot({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new ot({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Yn(e,this.session,this.dialect)}insert(e){return new Ln(e,this.session,this.dialect)}delete(e){return new Dn(e,this.session,this.dialect)}refreshMaterializedView(e){return new Go(e,this.session,this.dialect)}execute(e){let t=e.getSQL(),s=this.dialect.sqlToQuery(t),n=this.session.prepareQuery(s,void 0,void 0,!1);return new Zo(()=>n.execute(),t,s,i=>n.mapResult(i,!0))}transaction(e,t){return this.session.transaction(e,t)}};var Yo=class{constructor(e){this.query=e}getQuery(){return this.query}mapResult(e,t){return e}static[v]="PgPreparedQuery";joinsNotNullableMap},Xo=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e){return _e.startActiveSpan("drizzle.operation",()=>_e.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).execute())}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}},ea=class extends Gs{constructor(e,t,s,n=0){super(e,t,s),this.schema=s,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new Bo}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),m.raw(t.join(" "))}setTransaction(e){return this.session.execute(m`set transaction ${this.getTransactionConfigSQL(e)}`)}};var $l=class extends Yo{constructor(e,t,s,n,i,o,a){super({sql:t,params:s}),this.client=e,this.queryString=t,this.params=s,this.logger=n,this.fields=i,this._isResponseInArrayMode=o,this.customResultMapper=a}static[v]="PostgresJsPreparedQuery";async execute(e={}){return _e.startActiveSpan("drizzle.execute",async t=>{let s=vl(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(s)}),this.logger.logQuery(this.queryString,s);let{fields:n,queryString:i,client:o,joinsNotNullableMap:a,customResultMapper:c}=this;if(!n&&!c)return _e.startActiveSpan("drizzle.driver.execute",()=>o.unsafe(i,s));let u=await _e.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":i,"drizzle.query.params":JSON.stringify(s)}),o.unsafe(i,s).values()));return _e.startActiveSpan("drizzle.mapResponse",()=>c?c(u):u.map(l=>Bp(n,l,a)))})}all(e={}){return _e.startActiveSpan("drizzle.execute",async t=>{let s=vl(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(s)}),this.logger.logQuery(this.queryString,s),_e.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(s)}),this.client.unsafe(this.queryString,s)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},Xn=class r extends Xo{constructor(e,t,s,n={}){super(t),this.client=e,this.schema=s,this.options=n,this.logger=n.logger??new No}static[v]="PostgresJsSession";logger;prepareQuery(e,t,s,n,i){return new $l(this.client,e.sql,e.params,this.logger,t,n,i)}query(e,t){return this.logger.logQuery(e,t),this.client.unsafe(e,t).values()}queryObjects(e,t){return this.client.unsafe(e,t)}transaction(e,t){return this.client.begin(async s=>{let n=new r(s,this.dialect,this.schema,this.options),i=new Dl(this.dialect,n,this.schema);return t&&await i.setTransaction(t),e(i)})}},Dl=class r extends ea{constructor(e,t,s,n=0){super(e,t,s,n),this.session=t}static[v]="PostgresJsTransaction";transaction(e){return this.session.client.savepoint(t=>{let s=new Xn(t,this.dialect,this.schema,this.session.options),n=new r(this.dialect,s,this.schema);return e(n)})}};function Ll(r,e={}){let t=a=>a;for(let a of["1184","1082","1083","1114"])r.options.parsers[a]=t,r.options.serializers[a]=t;let s=new Ks,n;e.logger===!0?n=new Io:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let a=_m(e.schema,wm);i={fullSchema:e.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let o=new Xn(r,s,i,{logger:n});return new Gs(s,o,i)}import lS from"os";import dS from"fs";var ta=new Map,Ul=new Map,ql=Symbol("OriginError"),Qs={},Tt=class extends Promise{constructor(e,t,s,n,i={}){let o,a;super((c,u)=>{o=c,a=u}),this.tagged=Array.isArray(e.raw),this.strings=e,this.args=t,this.handler=s,this.canceller=n,this.options=i,this.state=null,this.statement=null,this.resolve=c=>(this.active=!1,o(c)),this.reject=c=>(this.active=!1,a(c)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[ql]=this.handler.debug?new Error:this.tagged&&ME(this.strings)}get origin(){return(this.handler.debug?this[ql].stack:this.tagged&&Ul.has(this.strings)?Ul.get(this.strings):Ul.set(this.strings,this[ql].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(e=1,t){if(this.options.simple=!1,typeof e=="function"&&(t=e,e=1),this.cursorRows=e,typeof t=="function")return this.cursorFn=t,this;let s;return{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};s&&s();let n=new Promise((i,o)=>{this.cursorFn=a=>(i({value:a,done:!1}),new Promise(c=>s=c)),this.resolve=()=>(this.active=!1,i({done:!0})),this.reject=a=>(this.active=!1,o(a))});return this.execute(),n},return(){return s&&s(Qs),{done:!0}}})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw new Error(".stream has been renamed to .forEach")}forEach(e){return this.forEachFn=e,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}};function ME(r){if(ta.has(r))return ta.get(r);let e=Error.stackTraceLimit;return Error.stackTraceLimit=4,ta.set(r,new Error),Error.stackTraceLimit=e,ta.get(r)}var ss=class extends Error{constructor(e){super(e.message),this.name=this.constructor.name,Object.assign(this,e)}},Me={connection:bm,postgres:Em,generic:Sm,notSupported:Tm};function bm(r,e,t){let{host:s,port:n}=t||e,i=Object.assign(new Error("write "+r+" "+(e.path||s+":"+n)),{code:r,errno:r,address:e.path||s},e.path?{}:{port:n});return Error.captureStackTrace(i,bm),i}function Em(r){let e=new ss(r);return Error.captureStackTrace(e,Em),e}function Sm(r,e){let t=Object.assign(new Error(r+": "+e),{code:r});return Error.captureStackTrace(t,Sm),t}function Tm(r){let e=Object.assign(new Error(r+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:r});return Error.captureStackTrace(e,Tm),e}var FE={string:{to:25,from:null,serialize:r=>""+r},number:{to:0,from:[21,23,26,700,701],serialize:r=>""+r,parse:r=>+r},json:{to:114,from:[114,3802],serialize:r=>JSON.stringify(r),parse:r=>JSON.parse(r)},boolean:{to:16,from:16,serialize:r=>r===!0?"t":"f",parse:r=>r==="t"},date:{to:1184,from:[1082,1114,1184],serialize:r=>(r instanceof Date?r:new Date(r)).toISOString(),parse:r=>new Date(r)},bytea:{to:17,from:17,serialize:r=>"\\x"+Buffer.from(r).toString("hex"),parse:r=>Buffer.from(r.slice(2),"hex")}},ei=class{then(){Bl()}catch(){Bl()}finally(){Bl()}},Js=class extends ei{constructor(e){super(),this.value=ia(e)}},Ft=class extends ei{constructor(e,t,s){super(),this.value=e,this.type=t,this.array=s}},ti=class extends ei{constructor(e,t){super(),this.first=e,this.rest=t}build(e,t,s,n){let i=VE.map(([o,a])=>({fn:a,i:e.search(o)})).sort((o,a)=>o.i-a.i).pop();return i.i===-1?Hl(this.first,n):i.fn(this.first,this.rest,t,s,n)}};function na(r,e,t,s){let n=r instanceof Ft?r.value:r;if(n===void 0&&(r instanceof Ft?r.value=s.transform.undefined:n=r=s.transform.undefined,n===void 0))throw Me.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+t.push(r instanceof Ft?(e.push(r.value),r.array?r.array[r.type||sa(r.value)]||r.type||xm(r.value):r.type):(e.push(r),sa(r)))}var Om=Cm(FE);function Vl(r,e,t,s,n,i){for(let o=1;o<r.strings.length;o++)e+=zl(e,t,s,n,i)+r.strings[o],t=r.args[o];return e}function zl(r,e,t,s,n){return e instanceof ti?e.build(r,t,s,n):e instanceof Tt?Fl(e,t,s,n):e instanceof Js?e.value:e&&e[0]instanceof Tt?e.reduce((i,o)=>i+" "+Fl(o,t,s,n),""):na(e,t,s,n)}function Fl(r,e,t,s){return r.fragment=!0,Vl(r,r.strings[0],r.args[0],e,t,s)}function Rm(r,e,t,s,n){return r.map(i=>"("+s.map(o=>zl("values",i[o],e,t,n)).join(",")+")").join(",")}function Am(r,e,t,s,n){let i=Array.isArray(r[0]),o=e.length?e.flat():Object.keys(i?r[0]:r);return Rm(i?r:[r],t,s,o,n)}function ra(r,e,t,s,n){if(typeof r=="string"&&(r=[r].concat(e)),Array.isArray(r))return Hl(r,n);let i;return(e.length?e.flat():Object.keys(r)).map(a=>(i=r[a],(i instanceof Tt?Fl(i,t,s,n):i instanceof Js?i.value:na(i,t,s,n))+" as "+ia(n.transform.column.to?n.transform.column.to(a):a))).join(",")}var VE=Object.entries({values:Am,in:(...r)=>{let e=Am(...r);return e==="()"?"(null)":e},select:ra,as:ra,returning:ra,"\\(":ra,update(r,e,t,s,n){return(e.length?e.flat():Object.keys(r)).map(i=>ia(n.transform.column.to?n.transform.column.to(i):i)+"="+zl("values",r[i],t,s,n))},insert(r,e,t,s,n){let i=e.length?e.flat():Object.keys(Array.isArray(r)?r[0]:r);return"("+Hl(i,n)+")values"+Rm(Array.isArray(r)?r:[r],t,s,i,n)}}).map(([r,e])=>[new RegExp("((?:^|[\\s(])"+r+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),e]);function Bl(){throw Me.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}var zE=Om.serializers,HE=Om.parsers;function xm(r){return Array.isArray(r)?xm(r[0]):typeof r=="string"?1009:0}var km=function(r){let e=Cm(r||{});return{serializers:Object.assign({},zE,e.serializers),parsers:Object.assign({},HE,e.parsers)}};function Cm(r){return Object.keys(r).reduce((e,t)=>(r[t].from&&[].concat(r[t].from).forEach(s=>e.parsers[s]=r[t].parse),r[t].serialize&&(e.serializers[r[t].to]=r[t].serialize,r[t].from&&[].concat(r[t].from).forEach(s=>e.serializers[s]=r[t].serialize)),e),{parsers:{},serializers:{}})}function Hl(r,{transform:{column:e}}){return r.map(t=>ia(e.to?e.to(t):t)).join(",")}var ia=function(e){return'"'+e.replace(/"/g,'""').replace(/\./g,'"."')+'"'},sa=function r(e){return e instanceof Ft?e.type:e instanceof Date?1184:e instanceof Uint8Array?17:e===!0||e===!1?16:typeof e=="bigint"?20:Array.isArray(e)?r(e[0]):0},KE=/\\/g,WE=/"/g;function GE(r){return r.replace(KE,"\\\\").replace(WE,'\\"')}var Pm=function r(e,t,s,n){if(Array.isArray(e)===!1)return e;if(!e.length)return"{}";let i=e[0],o=n===1020?";":",";return Array.isArray(i)&&!i.type?"{"+e.map(a=>r(a,t,s,n)).join(o)+"}":"{"+e.map(a=>{if(a===void 0&&(a=s.transform.undefined,a===void 0))throw Me.generic("UNDEFINED_VALUE","Undefined values are not allowed");return a===null?"null":'"'+GE(t?t(a.type?a.value:a):""+a)+'"'}).join(o)+"}"},Ml={i:0,char:null,str:"",quoted:!1,last:0},jm=function(e,t,s){return Ml.i=Ml.last=0,Im(Ml,e,t,s)};function Im(r,e,t,s){let n=[],i=s===1020?";":",";for(;r.i<e.length;r.i++){if(r.char=e[r.i],r.quoted)r.char==="\\"?r.str+=e[++r.i]:r.char==='"'?(n.push(t?t(r.str):r.str),r.str="",r.quoted=e[r.i+1]==='"',r.last=r.i+2):r.str+=r.char;else if(r.char==='"')r.quoted=!0;else if(r.char==="{")r.last=++r.i,n.push(Im(r,e,t,s));else if(r.char==="}"){r.quoted=!1,r.last<r.i&&n.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1;break}else r.char===i&&r.p!=="}"&&r.p!=='"'&&(n.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1);r.p=r.char}return r.last<r.i&&n.push(t?t(e.slice(r.last,r.i+1)):e.slice(r.last,r.i+1)),n}var ns=r=>{let e=r[0];for(let t=1;t<r.length;t++)e+=r[t]==="_"?r[++t].toUpperCase():r[t];return e},is=r=>{let e=r[0].toUpperCase();for(let t=1;t<r.length;t++)e+=r[t]==="_"?r[++t].toUpperCase():r[t];return e},os=r=>r.replace(/_/g,"-"),ri=r=>r.replace(/([A-Z])/g,"_$1").toLowerCase(),si=r=>(r.slice(0,1)+r.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),ni=r=>r.replace(/-/g,"_");function Kl(r){return function e(t,s){return typeof t=="object"&&t!==null&&(s.type===114||s.type===3802)?Array.isArray(t)?t.map(n=>e(n,s)):Object.entries(t).reduce((n,[i,o])=>Object.assign(n,{[r(i)]:e(o,s)}),{}):t}}ns.column={from:ns};ns.value={from:Kl(ns)};ri.column={to:ri};var Wl={...ns};Wl.column.to=ri;is.column={from:is};is.value={from:Kl(is)};si.column={to:si};var Gl={...is};Gl.column.to=si;os.column={from:os};os.value={from:Kl(os)};ni.column={to:ni};var Ql={...os};Ql.column.to=ni;import Nm from"net";import YE from"tls";import ii from"crypto";import Jl from"stream";import{performance as $m}from"perf_hooks";var Ar=class extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}};var At=QE;function QE(r=[]){let e=r.slice(),t=0;return{get length(){return e.length-t},remove:s=>{let n=e.indexOf(s);return n===-1?null:(e.splice(n,1),s)},push:s=>(e.push(s),s),shift:()=>{let s=e[t++];return t===e.length?(t=0,e=[]):e[t-1]=void 0,s}}}var at=Buffer.allocUnsafe(256),JE="BCcDdEFfHPpQSX".split("").reduce((r,e)=>{let t=e.charCodeAt(0);return r[e]=()=>(at[0]=t,ye.i=5,ye),r},{}),ye=Object.assign(ZE,JE,{N:"\0",i:0,inc(r){return ye.i+=r,ye},str(r){let e=Buffer.byteLength(r);return oa(e),ye.i+=at.write(r,ye.i,e,"utf8"),ye},i16(r){return oa(2),at.writeUInt16BE(r,ye.i),ye.i+=2,ye},i32(r,e){return e||e===0?(at.writeUInt32BE(r,e),ye):(oa(4),at.writeUInt32BE(r,ye.i),ye.i+=4,ye)},z(r){return oa(r),at.fill(0,ye.i,ye.i+r),ye.i+=r,ye},raw(r){return at=Buffer.concat([at.subarray(0,ye.i),r]),ye.i=at.length,ye},end(r=1){at.writeUInt32BE(ye.i-r,r);let e=at.subarray(0,ye.i);return ye.i=0,at=Buffer.allocUnsafe(256),e}}),B=ye;function oa(r){if(at.length-ye.i<r){let e=at,t=e.length;at=Buffer.allocUnsafe(t+(t>>1)+r),e.copy(at)}}function ZE(){return ye.i=0,ye}var Xl=Um,XE=1,Or=B().S().end(),Dm=B().H().end(),eS=B().i32(8).i32(80877103).end(8),tS=Buffer.concat([B().E().str(B.N).i32(0).end(),Or]),rS=B().D().str("S").str(B.N).end(),Zs=()=>{},sS=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),nS={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function Um(r,e={},{onopen:t=Zs,onend:s=Zs,onclose:n=Zs}={}){let{ssl:i,max:o,user:a,host:c,port:u,database:l,parsers:d,transform:f,onnotice:p,onnotify:y,onparameter:g,max_pipeline:w,keep_alive:b,backoff:A,target_session_attrs:E}=r,x=At(),U=XE++,V={pid:null,secret:null},N=Yl(pa,r.idle_timeout),W=Yl(pa,r.max_lifetime),Y=Yl(ig,r.connect_timeout),R=null,Ae,Q=new Ar,me=Buffer.alloc(0),Ot=r.fetch_types,ae={},he={},ze=Math.random().toString(36).slice(2),O=1,M=0,te=0,le=0,Oe=0,J=0,fe=0,Le=0,Pe=null,Re=null,Xe=!1,be=null,Nt=null,We=null,fr=null,Fe=null,xe=null,$t=null,Vt=null,k=null,Xs=null,et={queue:e.closed,idleTimer:N,connect(h){We=h,md()},terminate:tn,execute:en,cancel:tg,end:pa,count:0,id:U};return e.closed&&e.closed.push(et),et;async function eg(){let h;try{h=r.socket?await Promise.resolve(r.socket(r)):new Nm.Socket}catch(_){cs(_);return}return h.on("error",cs),h.on("close",gd),h.on("drain",fd),h}async function tg({pid:h,secret:_},F,ce){try{Ae=B().i32(16).i32(80877102).i32(h).i32(_).end(16),await pd(),R.once("error",ce),R.once("close",F)}catch(Ne){ce(Ne)}}function en(h){if(Xe)return ci(h,Me.connection("CONNECTION_DESTROYED",r));if(!h.cancelled)try{return h.state=V,k?x.push(h):(k=h,k.active=!0),ng(h),Ge(rg(h))&&!h.describeFirst&&!h.cursorFn&&x.length<w&&(!h.options.onexecute||h.options.onexecute(et))}catch(_){return x.length===0&&Ge(Or),zt(_),!0}}function rg(h){if(h.parameters.length>=65534)throw Me.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return h.options.simple?B().Q().str(h.statement.string+B.N).end():h.describeFirst?Buffer.concat([ld(h),Dm]):h.prepare?h.prepared?ai(h):Buffer.concat([ld(h),ai(h)]):sg(h)}function ld(h){return Buffer.concat([_d(h.statement.string,h.parameters,h.statement.types,h.statement.name),Vg("S",h.statement.name)])}function ai(h){return Buffer.concat([Fg(h.parameters,h.statement.types,h.statement.name,h.cursorName),h.cursorFn?vd("",h.cursorRows):tS])}function sg(h){return Buffer.concat([_d(h.statement.string,h.parameters,h.statement.types),rS,ai(h)])}function ng(h){let _=[],F=[],ce=Vl(h,h.strings[0],h.args[0],_,F,r);!h.tagged&&h.args.forEach(Ne=>na(Ne,_,F,r)),h.prepare=r.prepare&&("prepare"in h.options?h.options.prepare:!0),h.string=ce,h.signature=h.prepare&&F+ce,h.onlyDescribe&&delete he[h.signature],h.parameters=h.parameters||_,h.prepared=h.prepare&&h.signature in he,h.describeFirst=h.onlyDescribe||_.length&&!h.prepared,h.statement=h.prepared?he[h.signature]:{string:ce,types:F,name:h.prepare?ze+O++:""},typeof r.debug=="function"&&r.debug(U,ce,_,F)}function Ge(h,_){return xe=xe?Buffer.concat([xe,h]):Buffer.from(h),_||xe.length>=1024?dd(_):(Re===null&&(Re=setImmediate(dd)),!0)}function dd(h){let _=R.write(xe,h);return Re!==null&&clearImmediate(Re),xe=Re=null,_}function ig(){zt(Me.connection("CONNECT_TIMEOUT",r,R)),R.destroy()}async function hd(){if(Ge(eS),!await new Promise(_=>R.once("data",F=>_(F[0]===83)))&&i==="prefer")return as();R.removeAllListeners(),R=YE.connect({socket:R,servername:Nm.isIP(R.host)?void 0:R.host,...i==="require"||i==="allow"||i==="prefer"?{rejectUnauthorized:!1}:i==="verify-full"?{}:typeof i=="object"?i:{}}),R.on("secureConnect",as),R.on("error",cs),R.on("close",gd),R.on("drain",fd)}function fd(){!k&&t(et)}function fa(h){if(!(be&&(be.push(h),te-=h.length,te>0)))for(me=be?Buffer.concat(be,J-te):me.length===0?h:Buffer.concat([me,h],me.length+h.length);me.length>4;){if(J=me.readUInt32BE(1),J>=me.length){te=J-me.length,be=[me];break}try{og(me.subarray(0,J+1))}catch(_){k&&(k.cursorFn||k.describeFirst)&&Ge(Or),zt(_)}me=me.subarray(J+1),te=0,be=null}}async function pd(){if(Xe=!1,ae={},R||(R=await eg()),!!R){if(Y.start(),r.socket)return i?hd():as();if(R.on("connect",i?hd:as),r.path)return R.connect(r.path);R.ssl=i,R.connect(u[le],c[le]),R.host=c[le],R.port=u[le],le=(le+1)%u.length}}function md(){setTimeout(pd,M?M+fe-$m.now():0)}function as(){try{he={},Ot=r.fetch_types,ze=Math.random().toString(36).slice(2),O=1,W.start(),R.on("data",fa),b&&R.setKeepAlive&&R.setKeepAlive(!0,1e3*b);let h=Hg();Ge(h)}catch(h){cs(h)}}function cs(h){if(!(et.queue===e.connecting&&r.host[Oe+1]))for(zt(h);x.length;)ci(x.shift(),h)}function zt(h){Fe&&(Fe.destroy(h),Fe=null),k&&ci(k,h),We&&(ci(We,h),We=null)}function ci(h,_){if(h.reserve)return h.reject(_);(!_||typeof _!="object")&&(_=new Error(_)),"query"in _||"parameters"in _||Object.defineProperties(_,{stack:{value:_.stack+h.origin.replace(/.*\n/,`
`),enumerable:r.debug},query:{value:h.string,enumerable:r.debug},parameters:{value:h.parameters,enumerable:r.debug},args:{value:h.args,enumerable:r.debug},types:{value:h.statement&&h.statement.types,enumerable:r.debug}}),h.reject(_)}function pa(){return fr||(!et.reserved&&s(et),!et.reserved&&!We&&!k&&x.length===0?(tn(),new Promise(h=>R&&R.readyState!=="closed"?R.once("close",h):h())):fr=new Promise(h=>$t=h))}function tn(){Xe=!0,(Fe||k||We||x.length)&&cs(Me.connection("CONNECTION_DESTROYED",r)),clearImmediate(Re),R&&(R.removeListener("data",fa),R.removeListener("connect",as),R.readyState==="open"&&R.end(B().X().end())),$t&&($t(),fr=$t=null)}async function gd(h){if(me=Buffer.alloc(0),te=0,be=null,clearImmediate(Re),R.removeListener("data",fa),R.removeListener("connect",as),N.cancel(),W.cancel(),Y.cancel(),R.removeAllListeners(),R=null,We)return md();!h&&(k||x.length)&&cs(Me.connection("CONNECTION_CLOSED",r,R)),M=$m.now(),h&&r.shared.retries++,fe=(typeof A=="function"?A(r.shared.retries):A)*1e3,n(et,Me.connection("CONNECTION_CLOSED",r,R))}function og(h,_=h[0]){(_===68?ag:_===100?Ng:_===65?xg:_===83?cg:_===90?ug:_===67?lg:_===50?yd:_===49?dg:_===116?hg:_===84?fg:_===82?pg:_===110?wg:_===75?bg:_===69?Og:_===115?kg:_===51?Cg:_===71?Pg:_===78?Dg:_===72?jg:_===99?$g:_===73?Lg:_===86?Ug:_===118?qg:_===87?Ig:Bg)(h)}function ag(h){let _=7,F,ce,Ne,tt=k.isRaw?new Array(k.statement.columns.length):{};for(let ct=0;ct<k.statement.columns.length;ct++)ce=k.statement.columns[ct],F=h.readInt32BE(_),_+=4,Ne=F===-1?null:k.isRaw===!0?h.subarray(_,_+=F):ce.parser===void 0?h.toString("utf8",_,_+=F):ce.parser.array===!0?ce.parser(h.toString("utf8",_+1,_+=F)):ce.parser(h.toString("utf8",_,_+=F)),k.isRaw?tt[ct]=k.isRaw===!0?Ne:f.value.from?f.value.from(Ne,ce):Ne:tt[ce.name]=f.value.from?f.value.from(Ne,ce):Ne;k.forEachFn?k.forEachFn(f.row.from?f.row.from(tt):tt,Q):Q[Le++]=f.row.from?f.row.from(tt):tt}function cg(h){let[_,F]=h.toString("utf8",5,h.length-1).split(B.N);ae[_]=F,r.parameters[_]!==F&&(r.parameters[_]=F,g&&g(_,F))}function ug(h){if(k&&k.options.simple&&k.resolve(Nt||Q),k=Nt=null,Q=new Ar,Y.cancel(),We){if(E){if(!ae.in_hot_standby||!ae.default_transaction_read_only)return Ag();if(Tg(E,ae))return tn()}if(Ot)return We.reserve&&(We=null),Eg();We&&!We.reserve&&en(We),r.shared.retries=Oe=0,We=null;return}for(;x.length&&(k=x.shift())&&(k.active=!0,k.cancelled);)Um(r).cancel(k.state,k.cancelled.resolve,k.cancelled.reject);k||(et.reserved?!et.reserved.release&&h[5]===73?fr?tn():(et.reserved=null,t(et)):et.reserved():fr?tn():t(et))}function lg(h){Le=0;for(let _=h.length-1;_>0;_--)if(h[_]===32&&h[_+1]<58&&Q.count===null&&(Q.count=+h.toString("utf8",_+1,h.length-1)),h[_-1]>=65){Q.command=h.toString("utf8",5,_),Q.state=V;break}if(Xs&&(Xs(),Xs=null),Q.command==="BEGIN"&&o!==1&&!et.reserved)return zt(Me.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"));if(k.options.simple)return yd();k.cursorFn&&(Q.count&&k.cursorFn(Q),Ge(Or)),k.resolve(Q)}function dg(){k.parsing=!1}function yd(){!Q.statement&&(Q.statement=k.statement),Q.columns=k.statement.columns}function hg(h){let _=h.readUInt16BE(5);for(let F=0;F<_;++F)!k.statement.types[F]&&(k.statement.types[F]=h.readUInt32BE(7+F*4));k.prepare&&(he[k.signature]=k.statement),k.describeFirst&&!k.onlyDescribe&&(Ge(ai(k)),k.describeFirst=!1)}function fg(h){Q.command&&(Nt=Nt||[Q],Nt.push(Q=new Ar),Q.count=null,k.statement.columns=null);let _=h.readUInt16BE(5),F=7,ce;k.statement.columns=Array(_);for(let Ne=0;Ne<_;++Ne){for(ce=F;h[F++]!==0;);let tt=h.readUInt32BE(F),ct=h.readUInt16BE(F+4),pr=h.readUInt32BE(F+6);k.statement.columns[Ne]={name:f.column.from?f.column.from(h.toString("utf8",ce,F-1)):h.toString("utf8",ce,F-1),parser:d[pr],table:tt,number:ct,type:pr},F+=18}if(Q.statement=k.statement,k.onlyDescribe)return k.resolve(k.statement),Ge(Or)}async function pg(h,_=h.readUInt32BE(5)){(_===3?mg:_===5?gg:_===10?yg:_===11?_g:_===12?vg:_!==0?Mg:Zs)(h,_)}async function mg(){let h=await ma();Ge(B().p().str(h).z(1).end())}async function gg(h){let _="md5"+await Lm(Buffer.concat([Buffer.from(await Lm(await ma()+a)),h.subarray(9)]));Ge(B().p().str(_).z(1).end())}async function yg(){Vt=(await ii.randomBytes(18)).toString("base64"),B().p().str("SCRAM-SHA-256"+B.N);let h=B.i;Ge(B.inc(4).str("n,,n=*,r="+Vt).i32(B.i-h-4,h).end())}async function _g(h){let _=h.toString("utf8",9).split(",").reduce((ct,pr)=>(ct[pr[0]]=pr.slice(2),ct),{}),F=await ii.pbkdf2Sync(await ma(),Buffer.from(_.s,"base64"),parseInt(_.i),32,"sha256"),ce=await aa(F,"Client Key"),Ne="n=*,r="+Vt+",r="+_.r+",s="+_.s+",i="+_.i+",c=biws,r="+_.r;Pe=(await aa(await aa(F,"Server Key"),Ne)).toString("base64");let tt="c=biws,r="+_.r+",p="+oS(ce,Buffer.from(await aa(await iS(ce),Ne))).toString("base64");Ge(B().p().str(tt).end())}function vg(h){h.toString("utf8",9).split(B.N,1)[0].slice(2)!==Pe&&(zt(Me.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),R.destroy())}function ma(){return Promise.resolve(typeof r.pass=="function"?r.pass():r.pass)}function wg(){if(Q.statement=k.statement,Q.statement.columns=[],k.onlyDescribe)return k.resolve(k.statement),Ge(Or)}function bg(h){V.pid=h.readUInt32BE(5),V.secret=h.readUInt32BE(9)}async function Eg(){Ot=!1,(await new Tt([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],en)).forEach(({oid:_,typarray:F})=>Sg(_,F))}function Sg(h,_){if(r.parsers[_]&&r.serializers[_])return;let F=r.parsers[h];r.shared.typeArrayMap[h]=_,r.parsers[_]=ce=>jm(ce,F,_),r.parsers[_].array=!0,r.serializers[_]=ce=>Pm(ce,r.serializers[h],r,_)}function Tg(h,_){return h==="read-write"&&_.default_transaction_read_only==="on"||h==="read-only"&&_.default_transaction_read_only==="off"||h==="primary"&&_.in_hot_standby==="on"||h==="standby"&&_.in_hot_standby==="off"||h==="prefer-standby"&&_.in_hot_standby==="off"&&r.host[Oe]}function Ag(){let h=new Tt([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],en,null,{simple:!0});h.resolve=([[_],[F]])=>{ae.default_transaction_read_only=_.transaction_read_only,ae.in_hot_standby=F.pg_is_in_recovery?"on":"off"},h.execute()}function Og(h){k&&(k.cursorFn||k.describeFirst)&&Ge(Or);let _=Me.postgres(Zl(h));k&&k.retried?zt(k.retried):k&&k.prepared&&sS.has(_.routine)?Rg(k,_):zt(_)}function Rg(h,_){delete he[h.signature],h.retried=_,en(h)}function xg(h){if(!y)return;let _=9;for(;h[_++]!==0;);y(h.toString("utf8",9,_-1),h.toString("utf8",_,h.length-1))}async function kg(){try{let h=await Promise.resolve(k.cursorFn(Q));Le=0,h===Qs?Ge(zg(k.portal)):(Q=new Ar,Ge(vd("",k.cursorRows)))}catch(h){Ge(Or),k.reject(h)}}function Cg(){Q.count&&k.cursorFn(Q),k.resolve(Q)}function Pg(){Fe=new Jl.Writable({autoDestroy:!0,write(h,_,F){R.write(B().d().raw(h).end(),F)},destroy(h,_){_(h),R.write(B().f().str(h+B.N).end()),Fe=null},final(h){R.write(B().c().end()),Xs=h}}),k.resolve(Fe)}function jg(){Fe=new Jl.Readable({read(){R.resume()}}),k.resolve(Fe)}function Ig(){Fe=new Jl.Duplex({autoDestroy:!0,read(){R.resume()},write(h,_,F){R.write(B().d().raw(h).end(),F)},destroy(h,_){_(h),R.write(B().f().str(h+B.N).end()),Fe=null},final(h){R.write(B().c().end()),Xs=h}}),k.resolve(Fe)}function Ng(h){Fe&&(Fe.push(h.subarray(5))||R.pause())}function $g(){Fe&&Fe.push(null),Fe=null}function Dg(h){p?p(Zl(h)):console.log(Zl(h))}function Lg(){}function Ug(){zt(Me.notSupported("FunctionCallResponse"))}function qg(){zt(Me.notSupported("NegotiateProtocolVersion"))}function Bg(h){console.error("Postgres.js : Unknown Message:",h[0])}function Mg(h,_){console.error("Postgres.js : Unknown Auth:",_)}function Fg(h,_,F="",ce=""){let Ne,tt;return B().B().str(ce+B.N).str(F+B.N).i16(0).i16(h.length),h.forEach((ct,pr)=>{if(ct===null)return B.i32(4294967295);tt=_[pr],h[pr]=ct=tt in r.serializers?r.serializers[tt](ct):""+ct,Ne=B.i,B.inc(4).str(ct).i32(B.i-Ne-4,Ne)}),B.i16(0),B.end()}function _d(h,_,F,ce=""){return B().P().str(ce+B.N).str(h+B.N).i16(_.length),_.forEach((Ne,tt)=>B.i32(F[tt]||0)),B.end()}function Vg(h,_=""){return B().D().str(h).str(_+B.N).end()}function vd(h="",_=0){return Buffer.concat([B().E().str(h+B.N).i32(_).end(),Dm])}function zg(h=""){return Buffer.concat([B().C().str("P").str(h+B.N).end(),B().S().end()])}function Hg(){return Ae||B().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:a,database:l,client_encoding:"UTF8"},r.connection)).filter(([,h])=>h).map(([h,_])=>h+B.N+_).join(B.N)).z(2).end(0)}}function Zl(r){let e={},t=5;for(let s=5;s<r.length-1;s++)r[s]===0&&(e[nS[r[t]]]=r.toString("utf8",t+1,s),t=s+1);return e}function Lm(r){return ii.createHash("md5").update(r).digest("hex")}function aa(r,e){return ii.createHmac("sha256",r).update(e).digest()}function iS(r){return ii.createHash("sha256").update(r).digest()}function oS(r,e){let t=Math.max(r.length,e.length),s=Buffer.allocUnsafe(t);for(let n=0;n<t;n++)s[n]=r[n]^e[n];return s}function Yl(r,e){if(e=typeof e=="function"?e():e,!e)return{cancel:Zs,start:Zs};let t;return{cancel(){t&&(clearTimeout(t),t=null)},start(){t&&clearTimeout(t),t=setTimeout(s,e*1e3,arguments)}};function s(n){r.apply(null,n),t=null}}var qm=()=>{};function ed(r,e){let t=new Map,s="postgresjs_"+Math.random().toString(36).slice(2),n={},i,o,a=!1,c=d.sql=r({...e,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...e.connection,replication:"database"},onclose:async function(){a||(o=null,n.pid=n.secret=void 0,f(await p(c,s,e.publications)),t.forEach(g=>g.forEach(({onsubscribe:w})=>w())))},no_subscribe:!0}),u=c.end,l=c.close;return c.end=async()=>(a=!0,o&&await new Promise(g=>(o.once("close",g),o.end())),u()),c.close=async()=>(o&&await new Promise(g=>(o.once("close",g),o.end())),l()),d;async function d(g,w,b=qm,A=qm){g=uS(g),i||(i=p(c,s,e.publications));let E={fn:w,onsubscribe:b},x=t.has(g)?t.get(g).add(E):t.set(g,new Set([E])).get(g),U=()=>{x.delete(E),x.size===0&&t.delete(g)};return i.then(V=>(f(V),b(),o&&o.on("error",A),{unsubscribe:U,state:n,sql:c}))}function f(g){o=g.stream,n.pid=g.state.pid,n.secret=g.state.secret}async function p(g,w,b){if(!b)throw new Error("Missing publication names");let A=await g.unsafe(`CREATE_REPLICATION_SLOT ${w} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[E]=A,x=await g.unsafe(`START_REPLICATION SLOT ${w} LOGICAL ${E.consistent_point} (proto_version '1', publication_names '${b}')`).writable(),U={lsn:Buffer.concat(E.consistent_point.split("/").map(R=>Buffer.from(("00000000"+R).slice(-8),"hex")))};return x.on("data",N),x.on("error",V),x.on("close",g.close),{stream:x,state:A.state};function V(R){console.error("Unexpected error during logical streaming - reconnecting",R)}function N(R){R[0]===119?cS(R.subarray(25),U,g.options.parsers,W,e.transform):R[0]===107&&R[17]&&(U.lsn=R.subarray(1,9),Y())}function W(R,Ae){let Q=Ae.relation.schema+"."+Ae.relation.table;y("*",R,Ae),y("*:"+Q,R,Ae),Ae.relation.keys.length&&y("*:"+Q+"="+Ae.relation.keys.map(me=>R[me.name]),R,Ae),y(Ae.command,R,Ae),y(Ae.command+":"+Q,R,Ae),Ae.relation.keys.length&&y(Ae.command+":"+Q+"="+Ae.relation.keys.map(me=>R[me.name]),R,Ae)}function Y(){let R=Buffer.alloc(34);R[0]=114,R.fill(U.lsn,1),R.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),x.write(R)}}function y(g,w,b){t.has(g)&&t.get(g).forEach(({fn:A})=>A(w,b,g))}}function aS(r){return new Date(Date.UTC(2e3,0,1)+Number(r/BigInt(1e3)))}function cS(r,e,t,s,n){let i=(o,[a,c])=>(o[a.charCodeAt(0)]=c,o);Object.entries({R:o=>{let a=1,c=e[o.readUInt32BE(a)]={schema:o.toString("utf8",a+=4,a=o.indexOf(0,a))||"pg_catalog",table:o.toString("utf8",a+1,a=o.indexOf(0,a+1)),columns:Array(o.readUInt16BE(a+=2)),keys:[]};a+=2;let u=0,l;for(;a<o.length;)l=c.columns[u++]={key:o[a++],name:n.column.from?n.column.from(o.toString("utf8",a,a=o.indexOf(0,a))):o.toString("utf8",a,a=o.indexOf(0,a)),type:o.readUInt32BE(a+=1),parser:t[o.readUInt32BE(a)],atttypmod:o.readUInt32BE(a+=4)},l.key&&c.keys.push(l),a+=4},Y:()=>{},O:()=>{},B:o=>{e.date=aS(o.readBigInt64BE(9)),e.lsn=o.subarray(1,9)},I:o=>{let a=1,c=e[o.readUInt32BE(a)],{row:u}=ca(o,c.columns,a+=7,n);s(u,{command:"insert",relation:c})},D:o=>{let a=1,c=e[o.readUInt32BE(a)];a+=4;let u=o[a]===75;s(u||o[a]===79?ca(o,c.columns,a+=3,n).row:null,{command:"delete",relation:c,key:u})},U:o=>{let a=1,c=e[o.readUInt32BE(a)];a+=4;let u=o[a]===75,l=u||o[a]===79?ca(o,c.columns,a+=3,n):null;l&&(a=l.i);let{row:d}=ca(o,c.columns,a+3,n);s(d,{command:"update",relation:c,key:u,old:l&&l.row})},T:()=>{},C:()=>{}}).reduce(i,{})[r[0]](r)}function ca(r,e,t,s){let n,i,o,a=s.raw?new Array(e.length):{};for(let c=0;c<e.length;c++)n=r[t++],i=e[c],o=n===110?null:n===117?void 0:i.parser===void 0?r.toString("utf8",t+4,t+=4+r.readUInt32BE(t)):i.parser.array===!0?i.parser(r.toString("utf8",t+5,t+=4+r.readUInt32BE(t))):i.parser(r.toString("utf8",t+4,t+=4+r.readUInt32BE(t))),s.raw?a[c]=s.raw===!0?o:s.value.from?s.value.from(o,i):o:a[i.name]=s.value.from?s.value.from(o,i):o;return{i:t,row:s.row.from?s.row.from(a):a}}function uS(r){let e=r.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!e)throw new Error("Malformed subscribe pattern: "+r);let[,t,s,n]=e;return(t||"*")+(s?":"+(s.indexOf(".")===-1?"public."+s:s):"")+(n?"="+n:"")}import Bm from"stream";function td(r,e,t=393216){return new Promise(async(s,n)=>{await r.begin(async i=>{let o;!e&&([{oid:e}]=await i`select lo_creat(-1) as oid`);let[{fd:a}]=await i`select lo_open(${e}, ${t}) as fd`,c={writable:l,readable:u,close:()=>i`select lo_close(${a})`.then(o),tell:()=>i`select lo_tell64(${a})`,read:d=>i`select loread(${a}, ${d}) as data`,write:d=>i`select lowrite(${a}, ${d})`,truncate:d=>i`select lo_truncate64(${a}, ${d})`,seek:(d,f=0)=>i`select lo_lseek64(${a}, ${d}, ${f})`,size:()=>i`
          select
            lo_lseek64(${a}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return s(c),new Promise(async d=>o=d);async function u({highWaterMark:d=2048*8,start:f=0,end:p=1/0}={}){let y=p-f;return f&&await c.seek(f),new Bm.Readable({highWaterMark:d,async read(g){let w=g>y?g-y:g;y-=g;let[{data:b}]=await c.read(w);this.push(b),b.length<g&&this.push(null)}})}async function l({highWaterMark:d=2048*8,start:f=0}={}){return f&&await c.seek(f),new Bm.Writable({highWaterMark:d,write(p,y,g){c.write(p).then(()=>g(),g)}})}}).catch(n)})}Object.assign(ua,{PostgresError:ss,toPascal:is,pascal:Gl,toCamel:ns,camel:Wl,toKebab:os,kebab:Ql,fromPascal:si,fromCamel:ri,fromKebab:ni,BigInt:{to:20,from:[20],parse:r=>BigInt(r),serialize:r=>r.toString()}});var Mm=ua;function ua(r,e){let t=hS(r,e),s=t.no_subscribe||ed(ua,{...t}),n=!1,i=At(),o=At(),a=At(),c=At(),u=At(),l=At(),d=At(),f=At(),p={connecting:o,reserved:a,closed:c,ended:u,open:l,busy:d,full:f},y=[...Array(t.max)].map(()=>Xl(t,p,{onopen:he,onend:ae,onclose:ze})),g=w(W);return Object.assign(g,{get parameters(){return t.parameters},largeObject:td.bind(null,g),subscribe:s,CLOSE:Qs,END:Qs,PostgresError:ss,options:t,reserve:E,listen:b,begin:x,close:Q,end:Ae}),g;function w(O){return O.debug=t.debug,Object.entries(t.types).reduce((J,[fe,Le])=>(J[fe]=Pe=>new Ft(Pe,Le.to),J),M),Object.assign(te,{types:M,typed:M,unsafe:le,notify:A,array:N,json:V,file:Oe}),te;function M(J,fe){return new Ft(J,fe)}function te(J,...fe){return J&&Array.isArray(J.raw)?new Tt(J,fe,O,R):typeof J=="string"&&!fe.length?new Js(t.transform.column.to?t.transform.column.to(J):J):new ti(J,fe)}function le(J,fe=[],Le={}){return arguments.length===2&&!Array.isArray(fe)&&(Le=fe,fe=[]),new Tt([J],fe,O,R,{prepare:!1,...Le,simple:"simple"in Le?Le.simple:fe.length===0})}function Oe(J,fe=[],Le={}){return arguments.length===2&&!Array.isArray(fe)&&(Le=fe,fe=[]),new Tt([],fe,Re=>{dS.readFile(J,"utf8",(Xe,be)=>{if(Xe)return Re.reject(Xe);Re.strings=[be],O(Re)})},R,{...Le,simple:"simple"in Le?Le.simple:fe.length===0})}}async function b(O,M,te){let le={fn:M,onlisten:te},Oe=b.sql||(b.sql=ua({...t,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(b.channels).forEach(([Re,{listeners:Xe}])=>{delete b.channels[Re],Promise.all(Xe.map(be=>b(Re,be.fn,be.onlisten).catch(()=>{})))})},onnotify(Re,Xe){Re in b.channels&&b.channels[Re].listeners.forEach(be=>be.fn(Xe))}})),J=b.channels||(b.channels={});if(O in J){J[O].listeners.push(le);let Re=await J[O].result;return le.onlisten&&le.onlisten(),{state:Re.state,unlisten:Pe}}J[O]={result:Oe`listen ${Oe.unsafe('"'+O.replace(/"/g,'""')+'"')}`,listeners:[le]};let Le=await J[O].result;return le.onlisten&&le.onlisten(),{state:Le.state,unlisten:Pe};async function Pe(){if(O in J&&(J[O].listeners=J[O].listeners.filter(Re=>Re!==le),!J[O].listeners.length))return delete J[O],Oe`unlisten ${Oe.unsafe('"'+O.replace(/"/g,'""')+'"')}`}}async function A(O,M){return await g`select pg_notify(${O}, ${""+M})`}async function E(){let O=At(),M=l.length?l.shift():await new Promise((Oe,J)=>{let fe={reserve:Oe,reject:J};i.push(fe),c.length&&Ot(c.shift(),fe)});U(M,a),M.reserved=()=>O.length?M.execute(O.shift()):U(M,a),M.reserved.release=!0;let te=w(le);return te.release=()=>{M.reserved=null,he(M)},te;function le(Oe){M.queue===f?O.push(Oe):M.execute(Oe)||U(M,f)}}async function x(O,M){!M&&(M=O,O="");let te=At(),le=0,Oe,J=null;try{return await g.unsafe("begin "+O.replace(/[^a-z ]/ig,""),[],{onexecute:Le}).execute(),await Promise.race([fe(Oe,M),new Promise((Pe,Re)=>Oe.onclose=Re)])}catch(Pe){throw Pe}async function fe(Pe,Re,Xe){let be=w(Fe);be.savepoint=fr,be.prepare=xe=>J=xe.replace(/[^a-z0-9$-_. ]/gi);let Nt,We;Xe&&await be`savepoint ${be(Xe)}`;try{if(We=await new Promise((xe,$t)=>{let Vt=Re(be);Promise.resolve(Array.isArray(Vt)?Promise.all(Vt):Vt).then(xe,$t)}),Nt)throw Nt}catch(xe){throw await(Xe?be`rollback to ${be(Xe)}`:be`rollback`),xe instanceof ss&&xe.code==="25P02"&&Nt||xe}return Xe||(J?await be`prepare transaction '${be.unsafe(J)}'`:await be`commit`),We;function fr(xe,$t){return xe&&Array.isArray(xe.raw)?fr(Vt=>Vt.apply(Vt,arguments)):(arguments.length===1&&($t=xe,xe=null),fe(Pe,$t,"s"+le+++(xe?"_"+xe:"")))}function Fe(xe){xe.catch($t=>Nt||(Nt=$t)),Pe.queue===f?te.push(xe):Pe.execute(xe)||U(Pe,f)}}function Le(Pe){Oe=Pe,U(Pe,a),Pe.reserved=()=>te.length?Pe.execute(te.shift()):U(Pe,a)}}function U(O,M){return O.queue.remove(O),M.push(O),O.queue=M,M===l?O.idleTimer.start():O.idleTimer.cancel(),O}function V(O){return new Ft(O,3802)}function N(O,M){return Array.isArray(O)?new Ft(O,M||(O.length?sa(O)||25:0),t.shared.typeArrayMap):N(Array.from(arguments))}function W(O){if(n)return O.reject(Me.connection("CONNECTION_ENDED",t,t));if(l.length)return Y(l.shift(),O);if(c.length)return Ot(c.shift(),O);d.length?Y(d.shift(),O):i.push(O)}function Y(O,M){return O.execute(M)?U(O,d):U(O,f)}function R(O){return new Promise((M,te)=>{O.state?O.active?Xl(t).cancel(O.state,M,te):O.cancelled={resolve:M,reject:te}:(i.remove(O),O.cancelled=!0,O.reject(Me.generic("57014","canceling statement due to user request")),M())})}async function Ae({timeout:O=null}={}){if(n)return n;await 1;let M;return n=Promise.race([new Promise(te=>O!==null&&(M=setTimeout(me,O*1e3,te))),Promise.all(y.map(te=>te.end()).concat(b.sql?b.sql.end({timeout:0}):[],s.sql?s.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(M))}async function Q(){await Promise.all(y.map(O=>O.end()))}async function me(O){for(await Promise.all(y.map(M=>M.terminate()));i.length;)i.shift().reject(Me.connection("CONNECTION_DESTROYED",t));O()}function Ot(O,M){return U(O,o),O.connect(M),O}function ae(O){U(O,u)}function he(O){if(i.length===0)return U(O,l);let M=Math.ceil(i.length/(o.length+1)),te=!0;for(;te&&i.length&&M-- >0;){let le=i.shift();if(le.reserve)return le.reserve(O);te=O.execute(le)}te?U(O,d):U(O,f)}function ze(O,M){U(O,c),O.reserved=null,O.onclose&&(O.onclose(M),O.onclose=null),t.onclose&&t.onclose(O.id),i.length&&Ot(O,i.shift())}}function hS(r,e){if(r&&r.shared)return r;let t=process.env,s=(!r||typeof r=="string"?e:r)||{},{url:n,multihost:i}=yS(r),o=[...n.searchParams].reduce((f,[p,y])=>(f[p]=y,f),{}),a=s.hostname||s.host||i||n.hostname||t.PGHOST||"localhost",c=s.port||n.port||t.PGPORT||5432,u=s.user||s.username||n.username||t.PGUSERNAME||t.PGUSER||_S();s.no_prepare&&(s.prepare=!1),o.sslmode&&(o.ssl=o.sslmode,delete o.sslmode),"timeout"in s&&(console.log("The timeout option is deprecated, use idle_timeout instead"),s.idle_timeout=s.timeout),o.sslrootcert==="system"&&(o.ssl="verify-full");let l=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],d={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:mS,max_pipeline:100,backoff:pS,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(a)?a:a.split(",").map(f=>f.split(":")[0]),port:Array.isArray(c)?c:a.split(",").map(f=>parseInt(f.split(":")[1]||c)),path:s.path||a.indexOf("/")>-1&&a+"/.s.PGSQL."+c,database:s.database||s.db||(n.pathname||"").slice(1)||t.PGDATABASE||u,user:u,pass:s.pass||s.password||n.password||t.PGPASSWORD||"",...Object.entries(d).reduce((f,[p,y])=>{let g=p in s?s[p]:p in o?o[p]==="disable"||o[p]==="false"?!1:o[p]:t["PG"+p.toUpperCase()]||y;return f[p]=typeof g=="string"&&l.includes(p)?+g:g,f},{}),connection:{application_name:t.PGAPPNAME||"postgres.js",...s.connection,...Object.entries(o).reduce((f,[p,y])=>(p in d||(f[p]=y),f),{})},types:s.types||{},target_session_attrs:fS(s,n,t),onnotice:s.onnotice,onnotify:s.onnotify,onclose:s.onclose,onparameter:s.onparameter,socket:s.socket,transform:gS(s.transform||{undefined:void 0}),parameters:{},shared:{retries:0,typeArrayMap:{}},...km(s.types)}}function fS(r,e,t){let s=r.target_session_attrs||e.searchParams.get("target_session_attrs")||t.PGTARGETSESSIONATTRS;if(!s||["read-write","read-only","primary","standby","prefer-standby"].includes(s))return s;throw new Error("target_session_attrs "+s+" is not supported")}function pS(r){return(.5+Math.random()/2)*Math.min(3**r/100,20)}function mS(){return 60*(30+Math.random()*30)}function gS(r){return{undefined:r.undefined,column:{from:typeof r.column=="function"?r.column:r.column&&r.column.from,to:r.column&&r.column.to},value:{from:typeof r.value=="function"?r.value:r.value&&r.value.from,to:r.value&&r.value.to},row:{from:typeof r.row=="function"?r.row:r.row&&r.row.from,to:r.row&&r.row.to}}}function yS(r){if(!r||typeof r!="string")return{url:{searchParams:new Map}};let e=r;e=e.slice(e.indexOf("://")+3).split(/[?/]/)[0],e=decodeURIComponent(e.slice(e.indexOf("@")+1));let t=new URL(r.replace(e,e.split(",")[0]));return{url:{username:decodeURIComponent(t.username),password:decodeURIComponent(t.password),host:t.host,hostname:t.hostname,port:t.port,pathname:t.pathname,searchParams:t.searchParams},multihost:e.indexOf(",")>-1&&e}}function _S(){try{return lS.userInfo().username}catch{return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}var sd={};ga(sd,{aal_level:()=>vS,action:()=>xS,buckettype:()=>CS,code_challenge_method:()=>wS,equality_op:()=>kS,factor_status:()=>bS,factor_type:()=>ES,games:()=>Ys,oauth_authorization_status:()=>SS,oauth_client_type:()=>TS,oauth_registration_type:()=>AS,oauth_response_type:()=>OS,one_time_token_type:()=>RS,users:()=>rd});var vS=Et("aal_level",["aal1","aal2","aal3"]),wS=Et("code_challenge_method",["s256","plain"]),bS=Et("factor_status",["unverified","verified"]),ES=Et("factor_type",["totp","webauthn","phone"]),SS=Et("oauth_authorization_status",["pending","approved","denied","expired"]),TS=Et("oauth_client_type",["public","confidential"]),AS=Et("oauth_registration_type",["dynamic","manual"]),OS=Et("oauth_response_type",["code"]),RS=Et("one_time_token_type",["confirmation_token","reauthentication_token","recovery_token","email_change_token_new","email_change_token_current","phone_change_token"]),xS=Et("action",["INSERT","UPDATE","DELETE","TRUNCATE","ERROR"]),kS=Et("equality_op",["eq","neq","lt","lte","gt","gte","in"]),CS=Et("buckettype",["STANDARD","ANALYTICS","VECTOR"]),Ys=al("games",{id:Cl("id").defaultRandom().primaryKey().notNull(),createDateTime:hr("createDateTime",{withTimezone:!0,mode:"string"}).defaultNow().notNull(),updateDateTime:hr("updateDateTime",{mode:"string"}).defaultNow(),gameId:Mo("gameId").notNull(),title:tr("title").notNull(),description:tr("description"),genres:tr("genres").array(),platform:tr("platform"),link:tr("link"),updatedAt:hr("updatedAt",{mode:"string"}),addedAt:hr("addedAt",{mode:"string"}),startedAt:hr("startedAt",{mode:"string"}),completedAt:hr("completedAt",{mode:"string"}),rating:Mo("rating"),developer:tr("developer"),publisher:tr("publisher"),status:tr("status").notNull(),playtime:Mo("playtime")}),rd=al("users",{id:Cl("id").primaryKey().notNull(),email:tr("email"),created_at:hr("created_at",{mode:"string"}).defaultNow().notNull(),updated_at:hr("updated_at",{mode:"string"}).defaultNow().notNull()});var Fm=Mm(Yt.DATABASE_URL,{prepare:!1}),Vm={schema:sd,driver:"pg",dbCredentials:{connectionString:Yt.DATABASE_URL}},Rr;Yt.NODE_ENV==="production"?Rr=Ll(Fm,Vm):(global.db||(global.db=Ll(Fm,Vm)),Rr=global.db);var zm=()=>{try{return performance.now()}catch{}return Date.now()};var Hm=(r,e,t,s,n)=>{let i=r.get("metric");if(!i){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}if(typeof t=="number"){let o=t.toFixed(n||1),a=s?`${e};dur=${o};desc="${s}"`:`${e};dur=${o}`;i.headers.push(a)}else{let o=t?`${e};desc="${t}"`:`${e}`;i.headers.push(o)}},nd=(r,e,t)=>{let s=r.get("metric");if(!s){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}s.timers.set(e,{description:t,start:zm()})},id=(r,e,t)=>{let s=r.get("metric");if(!s){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}let n=s.timers.get(e);if(!n){console.warn(`Timer "${e}" does not exist!`);return}let{description:i,start:o}=n,a=zm()-o;Hm(r,e,a,i,t),s.timers.delete(e)};var PS=new jr().post("/sign-up",jo("json",$e.object({email:$e.string(),password:$e.string().min(8)})),async r=>{let{email:e,password:t}=r.req.valid("json"),{data:s,error:n}=await Nn.auth.signUp({email:e,password:t});if(n||!s?.user?.email)throw console.log(n),new Error(n?.message||"Error while signing up",{cause:n});let i={id:s?.user.id,email:s?.user.email,createdAt:s?.user.created_at,updatedAt:s?.user.updated_at},o=await Rr.insert(rd).values(i).returning();return r.json(o)}).post("/sign-in",jo("json",$e.object({email:$e.string(),password:$e.string().min(8)})),async r=>{let{email:e,password:t}=r.req.valid("json"),{data:s,error:n}=await Nn.auth.signInWithPassword({email:e,password:t});if(n)throw console.error("Error while signing in",n),new Dt(401,{message:n.message});return Ms(r,"access_token",s?.session.access_token,{...s?.session.expires_at&&{expires:new Date(s.session.expires_at)},httpOnly:!0,path:"/",secure:!0}),Ms(r,"refresh_token",s?.session.refresh_token,{...s?.session.expires_at&&{expires:new Date(s.session.expires_at)},httpOnly:!0,path:"/",secure:!0}),r.json(s.user)}).post("/sign-in-with-provider",jo("json",$e.object({provider:$e.enum(["google","apple"]),token:$e.string().min(8),accessToken:$e.string().optional()})),async r=>{let{token:e,provider:t,accessToken:s}=r.req.valid("json");nd(r,"supabase.auth.signInWithProvider");let{data:n,error:i}=await Nn.auth.signInWithIdToken({provider:t,token:e,access_token:s});if(id(r,"supabase.auth.signInWithProvider"),i)throw console.error("Error while signing in with Provider ",i),new Dt(401,{message:i.message});return Ms(r,"access_token",n?.session.access_token,{...n?.session.expires_at&&{expires:new Date(n.session.expires_at)},httpOnly:!0,path:"/",secure:!0}),Ms(r,"refresh_token",n?.session.refresh_token,{...n?.session.expires_at&&{expires:new Date(n.session.expires_at)},httpOnly:!0,path:"/",secure:!0}),r.json(n.user)}).get("/refresh",async r=>{let e=Po(r,"refresh_token");if(!e)throw new Dt(403,{message:"No refresh token"});let{data:t,error:s}=await Nn.auth.refreshSession({refresh_token:e});if(s)throw console.error("Error while refreshing token",s),new Dt(403,{message:s.message});return t?.session&&Ms(r,"refresh_token",t.session.refresh_token,{...t.session.expires_at&&{expires:new Date(t.session.expires_at)}}),r.json(t.user)}),Km=PS;var oi=class{endpoints={gamesList:"https://howlongtobeat.com/api/user/:userId/games/list"};lists=["playing","backlog","custom","custom2","completed","retired"];constructor(){}async getGameList(e){try{let t=this.endpoints.gamesList.replace(":userId",Yt.HLTB_USER_ID);return await(await fetch(t,{method:"POST",headers:{Host:"howlongtobeat.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0",Accept:"*/*","Accept-Language":"es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3","Accept-Encoding":"gzip, deflate, br, zstd",Referer:`https://howlongtobeat.com/user/${Yt.HLTB_USER}/games/${e}/1`,"Content-Type":"application/json",Origin:"https://howlongtobeat.com","Sec-GPC":"1","Alt-Used":"howlongtobeat.com",Connection:"keep-alive",Cookie:"OptanonConsent=isGpcEnabled=0&datestamp=Sat+Dec+06+2025+21%3A35%3A01+GMT%2B0100+(hora+est%C3%A1ndar+de+Europa+central)&version=202509.1.0&genVendors=&groups=C0001%3A1%2CC0002%3A1%2CC0004%3A1%2CV2STACK42%3A1&landingPath=NotLandingPage; zdconsent=optin; OptanonAlertBoxClosed=2025-12-06T20:34:23.826Z; eupubconsent-v2=CQcAedgQcAedgAcABBENCIFsAP_gAEPgACiQLaNR_G__bWlr-bb3aftkeYxP9_hr7sQxBgbJk24FzLvW7JwWx2E5NAzatqIKmRIAu3TBIQNlHJDURVCgKIgFryDMaEyUoTNKJ6BkiFMRI2JYCFxvm4pjWQCY5vr99lc1mB-N7dr82dzyy4hHn3a5_2S1WJCdIYetDfn8ZBKT-9IEd_x8v4v4_F7pE2-eS1n_pGvp4j9-YnM_dBmxt-bSffzPn__rl_e7X_vd_n37v94XH77v____f8FsAATDQqIIyyIEAgUDCCBAAoKwgAoEAQAAJA0QEAJgwKcgYALrCZACAFAAMEAIAAQYAAgAAEgAQiACgAgEAIEAgUAAYAEAQEADAwABgAsRAIAAQHQMUwIIBAsAEjMqg0wJQAEggJbKhBIAgQVwhCLPAIIERMFAAACAAUAAAA8FgISSAlYkEAXEE0AABAAAFECBAikLMAQVBmi0FYEnEZGmAYPmCZJToMgCYIyMk2ITfhMPFIUQoIcgAAAA.f_wACHwAAAAA","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-origin",Priority:"u=4",Pragma:"no-cache","Cache-Control":"no-cache"},body:JSON.stringify({user_id:Number(Yt.HLTB_USER_ID),toggleType:"Single List",lists:[e],set_playstyle:"comp_all",name:"",platform:"",storefront:"",sortBy:"",sortFlip:0,view:"",random:0,limit:500,currentUserHome:!1})})).json()}catch(t){console.error(t)}}getGameDescription(){this.parseGameDescriptionFromHTML()}getGameGenres(){this.parseGameGenresFromHTML()}parseGameDescriptionFromHTML(){return""}parseGameGenresFromHTML(){return[]}};var Ye=[];for(let r=0;r<256;++r)Ye.push((r+256).toString(16).slice(1));function Wm(r,e=0){return(Ye[r[e+0]]+Ye[r[e+1]]+Ye[r[e+2]]+Ye[r[e+3]]+"-"+Ye[r[e+4]]+Ye[r[e+5]]+"-"+Ye[r[e+6]]+Ye[r[e+7]]+"-"+Ye[r[e+8]]+Ye[r[e+9]]+"-"+Ye[r[e+10]]+Ye[r[e+11]]+Ye[r[e+12]]+Ye[r[e+13]]+Ye[r[e+14]]+Ye[r[e+15]]).toLowerCase()}import{randomFillSync as jS}from"node:crypto";var da=new Uint8Array(256),la=da.length;function od(){return la>da.length-16&&(jS(da),la=0),da.slice(la,la+=16)}import{randomUUID as IS}from"node:crypto";var ad={randomUUID:IS};function NS(r,e,t){r=r||{};let s=r.random??r.rng?.()??od();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let n=0;n<16;++n)e[t+n]=s[n];return e}return Wm(s)}function $S(r,e,t){return ad.randomUUID&&!e&&!r?ad.randomUUID():NS(r,e,t)}var cd=$S;var Gm=(r,e)=>({id:cd(),gameId:String(r.game_id),title:r.custom_title,description:null,genres:null,platform:r.platform,link:null,developer:null,publisher:null,status:e,playtime:String(r.invested_pro),rating:String(r.review_score),createDateTime:new Date().toISOString(),updateDateTime:new Date().toISOString(),updatedAt:ha(r.date_updated),addedAt:ha(r.date_added),startedAt:ha(r.date_start),completedAt:ha(r.date_complete)}),ha=r=>r?typeof r=="string"?r==="0000-00-00"?null:r:r.toISOString():null;var Qm=async()=>await Rr.select().from(Ys),Jm=async r=>await Rr.select().from(Ys).where(zs(Ys.status,r)),Zm=async()=>{let r=new oi,t=(await Promise.all(r.lists.map(async s=>({listType:s,result:await r.getGameList(s)})))).flatMap(s=>s.result?.data.gamesList.map(n=>({game:n,status:s.listType}))).filter(s=>s!==void 0).map(({game:s,status:n})=>Gm(s,n));return await Rr.insert(Ys).values(t).onConflictDoNothing(),t.length};var DS=new jr().get("/",async r=>{let e=await Qm();return r.json(e)}).get("/list/:status",async r=>{let e=r.req.param("status"),t=await Jm(e);return r.json(t)}).post("/sync",async r=>{let e=await Zm();return r.json({inserted:e})}),Ym=DS;var LS=new jr().basePath("/api").route("/auth",Km).route("/games",Ym).onError(Zd),ud=LS;var Xm=3e3;console.log(`Server is running on port - ${Xm}`);Pd({fetch:ud.fetch,port:Xm});Id(ud);
