#!/usr/bin/env node
var jg=Object.create;var ri=Object.defineProperty;var Ng=Object.getOwnPropertyDescriptor;var Ig=Object.getOwnPropertyNames;var $g=Object.getPrototypeOf,Dg=Object.prototype.hasOwnProperty;var si=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var Lg=(r,e)=>()=>(r&&(e=r(r=0)),e);var P=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),aa=(r,e)=>{for(var t in e)ri(r,t,{get:e[t],enumerable:!0})},nh=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ig(e))!Dg.call(r,n)&&n!==t&&ri(r,n,{get:()=>e[n],enumerable:!(s=Ng(e,n))||s.enumerable});return r};var Ug=(r,e,t)=>(t=r!=null?jg($g(r)):{},nh(e||!r||!r.__esModule?ri(t,"default",{value:r,enumerable:!0}):t,r)),ue=r=>nh(ri({},"__esModule",{value:!0}),r);var se={};aa(se,{__addDisposableResource:()=>id,__assign:()=>gi,__asyncDelegator:()=>Zh,__asyncGenerator:()=>Jh,__asyncValues:()=>Yh,__await:()=>cs,__awaiter:()=>zh,__classPrivateFieldGet:()=>rd,__classPrivateFieldIn:()=>nd,__classPrivateFieldSet:()=>sd,__createBinding:()=>_i,__decorate:()=>Lh,__disposeResources:()=>od,__esDecorate:()=>qh,__exportStar:()=>Kh,__extends:()=>$h,__generator:()=>Hh,__importDefault:()=>td,__importStar:()=>ed,__makeTemplateObject:()=>Xh,__metadata:()=>Vh,__param:()=>Uh,__propKey:()=>Mh,__read:()=>Ra,__rest:()=>Dh,__rewriteRelativeImportExtension:()=>ad,__runInitializers:()=>Bh,__setFunctionName:()=>Fh,__spread:()=>Wh,__spreadArray:()=>Qh,__spreadArrays:()=>Gh,__values:()=>yi,default:()=>Ay});function $h(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Aa(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Dh(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t}function Lh(r,e,t,s){var n=arguments.length,i=n<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,s);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(n<3?o(i):n>3?o(e,t,i):o(e,t))||i);return n>3&&i&&Object.defineProperty(e,t,i),i}function Uh(r,e){return function(t,s){e(t,s,r)}}function qh(r,e,t,s,n,i){function o(b){if(b!==void 0&&typeof b!="function")throw new TypeError("Function expected");return b}for(var a=s.kind,c=a==="getter"?"get":a==="setter"?"set":"value",u=!e&&r?s.static?r:r.prototype:null,l=e||(u?Object.getOwnPropertyDescriptor(u,s.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var y={};for(var g in s)y[g]=g==="access"?{}:s[g];for(var g in s.access)y.access[g]=s.access[g];y.addInitializer=function(b){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(b||null))};var w=(0,t[p])(a==="accessor"?{get:l.get,set:l.set}:l[c],y);if(a==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(h=o(w.get))&&(l.get=h),(h=o(w.set))&&(l.set=h),(h=o(w.init))&&n.unshift(h)}else(h=o(w))&&(a==="field"?n.unshift(h):l[c]=h)}u&&Object.defineProperty(u,s.name,l),f=!0}function Bh(r,e,t){for(var s=arguments.length>2,n=0;n<e.length;n++)t=s?e[n].call(r,t):e[n].call(r);return s?t:void 0}function Mh(r){return typeof r=="symbol"?r:"".concat(r)}function Fh(r,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(r,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function Vh(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function zh(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})}function Hh(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,n,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(s)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(s=1,n&&(i=u[0]&2?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,n=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],n=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Kh(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&_i(e,r,t)}function yi(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],s=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ra(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var s=t.call(r),n,i=[],o;try{for(;(e===void 0||e-- >0)&&!(n=s.next()).done;)i.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=s.return)&&t.call(s)}finally{if(o)throw o.error}}return i}function Wh(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Ra(arguments[e]));return r}function Gh(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var s=Array(r),n=0,e=0;e<t;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,n++)s[n]=i[o];return s}function Qh(r,e,t){if(t||arguments.length===2)for(var s=0,n=e.length,i;s<n;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return r.concat(i||Array.prototype.slice.call(e))}function cs(r){return this instanceof cs?(this.v=r,this):new cs(r)}function Jh(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(r,e||[]),n,i=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(p){return function(y){return Promise.resolve(y).then(p,h)}}function a(p,y){s[p]&&(n[p]=function(g){return new Promise(function(w,b){i.push([p,g,w,b])>1||c(p,g)})},y&&(n[p]=y(n[p])))}function c(p,y){try{u(s[p](y))}catch(g){f(i[0][3],g)}}function u(p){p.value instanceof cs?Promise.resolve(p.value.v).then(l,h):f(i[0][2],p)}function l(p){c("next",p)}function h(p){c("throw",p)}function f(p,y){p(y),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Zh(r){var e,t;return e={},s("next"),s("throw",function(n){throw n}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(n,i){e[n]=r[n]?function(o){return(t=!t)?{value:cs(r[n](o)),done:!1}:i?i(o):o}:i}}function Yh(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof yi=="function"?yi(r):r[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=r[i]&&function(o){return new Promise(function(a,c){o=r[i](o),n(a,c,o.done,o.value)})}}function n(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}}function Xh(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function ed(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t=Oa(r),s=0;s<t.length;s++)t[s]!=="default"&&_i(e,r,t[s]);return Sy(e,r),e}function td(r){return r&&r.__esModule?r:{default:r}}function rd(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)}function sd(r,e,t,s,n){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t}function nd(r,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof r=="function"?e===r:r.has(e)}function id(r,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s,n;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose],t&&(n=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");n&&(s=function(){try{n.call(this)}catch(i){return Promise.reject(i)}}),r.stack.push({value:e,dispose:s,async:t})}else t&&r.stack.push({async:!0});return e}function od(r){function e(i){r.error=r.hasError?new Ty(i,r.error,"An error was suppressed during disposal."):i,r.hasError=!0}var t,s=0;function n(){for(;t=r.stack.pop();)try{if(!t.async&&s===1)return s=0,r.stack.push(t),Promise.resolve().then(n);if(t.dispose){var i=t.dispose.call(t.value);if(t.async)return s|=2,Promise.resolve(i).then(n,function(o){return e(o),n()})}else s|=1}catch(o){e(o)}if(s===1)return r.hasError?Promise.reject(r.error):Promise.resolve();if(r.hasError)throw r.error}return n()}function ad(r,e){return typeof r=="string"&&/^\.\.?\//.test(r)?r.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,s,n,i,o){return s?e?".jsx":".js":n&&(!i||!o)?t:n+i+"."+o.toLowerCase()+"js"}):r}var Aa,gi,_i,Sy,Oa,Ty,Ay,ne=Lg(()=>{Aa=function(r,e){return Aa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])},Aa(r,e)};gi=function(){return gi=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++){t=arguments[s];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},gi.apply(this,arguments)};_i=Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]};Sy=Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e},Oa=function(r){return Oa=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},Oa(r)};Ty=typeof SuppressedError=="function"?SuppressedError:function(r,e,t){var s=new Error(t);return s.name="SuppressedError",s.error=r,s.suppressed=e,s};Ay={__extends:$h,__assign:gi,__rest:Dh,__decorate:Lh,__param:Uh,__esDecorate:qh,__runInitializers:Bh,__propKey:Mh,__setFunctionName:Fh,__metadata:Vh,__awaiter:zh,__generator:Hh,__createBinding:_i,__exportStar:Kh,__values:yi,__read:Ra,__spread:Wh,__spreadArrays:Gh,__spreadArray:Qh,__await:cs,__asyncGenerator:Jh,__asyncDelegator:Zh,__asyncValues:Yh,__makeTemplateObject:Xh,__importStar:ed,__importDefault:td,__classPrivateFieldGet:rd,__classPrivateFieldSet:sd,__classPrivateFieldIn:nd,__addDisposableResource:id,__disposeResources:od,__rewriteRelativeImportExtension:ad}});var cd=P(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.resolveFetch=void 0;var Oy=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);vi.resolveFetch=Oy});var Pa=P(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.FunctionRegion=At.FunctionsHttpError=At.FunctionsRelayError=At.FunctionsFetchError=At.FunctionsError=void 0;var us=class extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}};At.FunctionsError=us;var ka=class extends us{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}};At.FunctionsFetchError=ka;var xa=class extends us{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}};At.FunctionsRelayError=xa;var Ca=class extends us{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}};At.FunctionsHttpError=Ca;var ud;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(ud||(At.FunctionRegion=ud={}))});var ld=P(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.FunctionsClient=void 0;var Ry=(ne(),ue(se)),ky=cd(),ls=Pa(),ja=class{constructor(e,{headers:t={},customFetch:s,region:n=ls.FunctionRegion.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=(0,ky.resolveFetch)(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Ry.__awaiter(this,arguments,void 0,function*(t,s={}){var n;let i,o;try{let{headers:a,method:c,body:u,signal:l,timeout:h}=s,f={},{region:p}=s;p||(p=this.region);let y=new URL(`${this.url}/${t}`);p&&p!=="any"&&(f["x-region"]=p,y.searchParams.set("forceFunctionRegion",p));let g;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",g=u):typeof u=="string"?(f["Content-Type"]="text/plain",g=u):typeof FormData<"u"&&u instanceof FormData?g=u:(f["Content-Type"]="application/json",g=JSON.stringify(u)):g=u;let w=l;h&&(o=new AbortController,i=setTimeout(()=>o.abort(),h),l?(w=o.signal,l.addEventListener("abort",()=>o.abort())):w=o.signal);let b=yield this.fetch(y.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),a),body:g,signal:w}).catch(U=>{throw new ls.FunctionsFetchError(U)}),A=b.headers.get("x-relay-error");if(A&&A==="true")throw new ls.FunctionsRelayError(b);if(!b.ok)throw new ls.FunctionsHttpError(b);let E=((n=b.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),k;return E==="application/json"?k=yield b.json():E==="application/octet-stream"||E==="application/pdf"?k=yield b.blob():E==="text/event-stream"?k=b:E==="multipart/form-data"?k=yield b.formData():k=yield b.text(),{data:k,error:null,response:b}}catch(a){return{data:null,error:a,response:a instanceof ls.FunctionsHttpError||a instanceof ls.FunctionsRelayError?a.context:void 0}}finally{i&&clearTimeout(i)}})}};wi.FunctionsClient=ja});var Na=P(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.FunctionRegion=ht.FunctionsRelayError=ht.FunctionsHttpError=ht.FunctionsFetchError=ht.FunctionsError=ht.FunctionsClient=void 0;var xy=ld();Object.defineProperty(ht,"FunctionsClient",{enumerable:!0,get:function(){return xy.FunctionsClient}});var sn=Pa();Object.defineProperty(ht,"FunctionsError",{enumerable:!0,get:function(){return sn.FunctionsError}});Object.defineProperty(ht,"FunctionsFetchError",{enumerable:!0,get:function(){return sn.FunctionsFetchError}});Object.defineProperty(ht,"FunctionsHttpError",{enumerable:!0,get:function(){return sn.FunctionsHttpError}});Object.defineProperty(ht,"FunctionsRelayError",{enumerable:!0,get:function(){return sn.FunctionsRelayError}});Object.defineProperty(ht,"FunctionRegion",{enumerable:!0,get:function(){return sn.FunctionRegion}})});var Da=P($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});var Ia=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};$a.default=Ia});var qa=P(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});var Cy=(ne(),ue(se)),Py=Cy.__importDefault(Da()),La=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(s=e.isMaybeSingle)!==null&&s!==void 0?s:!1,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");let s=this.fetch,n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,c,u;let l=null,h=null,f=null,p=i.status,y=i.statusText;if(i.ok){if(this.method!=="HEAD"){let A=await i.text();A===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?h=A:h=JSON.parse(A))}let w=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),b=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");w&&b&&b.length>1&&(f=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(l={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,f=null,p=406,y="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{let w=await i.text();try{l=JSON.parse(w),Array.isArray(l)&&i.status===404&&(h=[],l=null,p=200,y="OK")}catch{i.status===404&&w===""?(p=204,y="No Content"):l={message:w}}if(l&&this.isMaybeSingle&&(!((u=l?.details)===null||u===void 0)&&u.includes("0 rows"))&&(l=null,p=200,y="OK"),l&&this.shouldThrowOnError)throw new Py.default(l)}return{error:l,data:h,count:f,status:p,statusText:y}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,a,c,u,l,h;let f="",p=i?.cause;if(p){let y=(o=p?.message)!==null&&o!==void 0?o:"",g=(a=p?.code)!==null&&a!==void 0?a:"";f=`${(c=i?.name)!==null&&c!==void 0?c:"FetchError"}: ${i?.message}`,f+=`

Caused by: ${(u=p?.name)!==null&&u!==void 0?u:"Error"}: ${y}`,g&&(f+=` (${g})`),p?.stack&&(f+=`
${p.stack}`)}else f=(l=i?.stack)!==null&&l!==void 0?l:"";return{error:{message:`${(h=i?.name)!==null&&h!==void 0?h:"FetchError"}: ${i?.message}`,details:f,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Ua.default=La});var Fa=P(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});var jy=(ne(),ue(se)),Ny=jy.__importDefault(qa()),Ba=class extends Ny.default{select(e){let t=!1,s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){let o=i?`${i}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){let n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){let i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var a;let c=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};Ma.default=Ba});var bi=P(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});var Iy=(ne(),ue(se)),$y=Iy.__importDefault(Fa()),Dy=new RegExp("[,()]"),Va=class extends $y.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){let s=Array.from(new Set(t)).map(n=>typeof n=="string"&&Dy.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");let o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){let n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};za.default=Va});var Wa=P(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});var Ly=(ne(),ue(se)),nn=Ly.__importDefault(bi()),Ha=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=n}select(e,t){let{head:s=!1,count:n}=t??{},i=s?"HEAD":"GET",o=!1,a=(e??"*").split("").map(c=>/\s/.test(c)&&!o?"":(c==='"'&&(o=!o),c)).join("");return this.url.searchParams.set("select",a),n&&this.headers.append("Prefer",`count=${n}`),new nn.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var n;let i="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){let a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new nn.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){var o;let a="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let c=e.reduce((u,l)=>u.concat(Object.keys(l)),[]);if(c.length>0){let u=[...new Set(c)].map(l=>`"${l}"`);this.url.searchParams.set("columns",u.join(","))}}return new nn.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:t}={}){var s;let n="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new nn.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:e}={}){var t;let s="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new nn.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};Ka.default=Ha});var dd=P(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});var hd=(ne(),ue(se)),Uy=hd.__importDefault(Wa()),qy=hd.__importDefault(bi()),Ga=class r{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=n}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");let t=new URL(`${this.url}/${e}`);return new Uy.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new r(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){var o;let a,c=new URL(`${this.url}/rpc/${e}`),u;s||n?(a=s?"HEAD":"GET",Object.entries(t).filter(([h,f])=>f!==void 0).map(([h,f])=>[h,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([h,f])=>{c.searchParams.append(h,f)})):(a="POST",u=t);let l=new Headers(this.headers);return i&&l.set("Prefer",`count=${i}`),new qy.default({method:a,url:c,headers:l,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};Qa.default=Ga});var Ja=P(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.PostgrestError=ct.PostgrestBuilder=ct.PostgrestTransformBuilder=ct.PostgrestFilterBuilder=ct.PostgrestQueryBuilder=ct.PostgrestClient=void 0;var hs=(ne(),ue(se)),fd=hs.__importDefault(dd());ct.PostgrestClient=fd.default;var pd=hs.__importDefault(Wa());ct.PostgrestQueryBuilder=pd.default;var md=hs.__importDefault(bi());ct.PostgrestFilterBuilder=md.default;var gd=hs.__importDefault(Fa());ct.PostgrestTransformBuilder=gd.default;var yd=hs.__importDefault(qa());ct.PostgrestBuilder=yd.default;var _d=hs.__importDefault(Da());ct.PostgrestError=_d.default;ct.default={PostgrestClient:fd.default,PostgrestQueryBuilder:pd.default,PostgrestFilterBuilder:md.default,PostgrestTransformBuilder:gd.default,PostgrestBuilder:yd.default,PostgrestError:_d.default}});var Za=P(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.WebSocketFactory=void 0;var Ei=class{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){let t=process.versions;if(t&&t.node){let s=t.node,n=parseInt(s.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){let s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}};on.WebSocketFactory=Ei;on.default=Ei});var vd=P(Si=>{"use strict";Object.defineProperty(Si,"__esModule",{value:!0});Si.version=void 0;Si.version="2.86.2"});var Ti=P(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.CONNECTION_STATE=pe.TRANSPORTS=pe.CHANNEL_EVENTS=pe.CHANNEL_STATES=pe.SOCKET_STATES=pe.MAX_PUSH_BUFFER_SIZE=pe.WS_CLOSE_NORMAL=pe.DEFAULT_TIMEOUT=pe.VERSION=pe.DEFAULT_VSN=pe.VSN_2_0_0=pe.VSN_1_0_0=pe.DEFAULT_VERSION=void 0;var Ad=vd();pe.DEFAULT_VERSION=`realtime-js/${Ad.version}`;pe.VSN_1_0_0="1.0.0";pe.VSN_2_0_0="2.0.0";pe.DEFAULT_VSN=pe.VSN_1_0_0;pe.VERSION=Ad.version;pe.DEFAULT_TIMEOUT=1e4;pe.WS_CLOSE_NORMAL=1e3;pe.MAX_PUSH_BUFFER_SIZE=100;var wd;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(wd||(pe.SOCKET_STATES=wd={}));var bd;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(bd||(pe.CHANNEL_STATES=bd={}));var Ed;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Ed||(pe.CHANNEL_EVENTS=Ed={}));var Sd;(function(r){r.websocket="websocket"})(Sd||(pe.TRANSPORTS=Sd={}));var Td;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Td||(pe.CONNECTION_STATE=Td={}))});var Od=P(Xa=>{"use strict";Object.defineProperty(Xa,"__esModule",{value:!0});var Ya=class{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;let n=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var t,s;let n=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:{},o=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,t,s){var n,i;let o=e.topic,a=(n=e.ref)!==null&&n!==void 0?n:"",c=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,l=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},h=Object.keys(l).length===0?"":JSON.stringify(l);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`metadata length ${h.length} exceeds maximum of 255`);let f=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+a.length+o.length+u.length+h.length,p=new ArrayBuffer(this.HEADER_LENGTH+f),y=new DataView(p),g=0;y.setUint8(g++,this.KINDS.userBroadcastPush),y.setUint8(g++,c.length),y.setUint8(g++,a.length),y.setUint8(g++,o.length),y.setUint8(g++,u.length),y.setUint8(g++,h.length),y.setUint8(g++,t),Array.from(c,b=>y.setUint8(g++,b.charCodeAt(0))),Array.from(a,b=>y.setUint8(g++,b.charCodeAt(0))),Array.from(o,b=>y.setUint8(g++,b.charCodeAt(0))),Array.from(u,b=>y.setUint8(g++,b.charCodeAt(0))),Array.from(h,b=>y.setUint8(g++,b.charCodeAt(0)));var w=new Uint8Array(p.byteLength+s.byteLength);return w.set(new Uint8Array(p),0),w.set(new Uint8Array(s),p.byteLength),w.buffer}decode(e,t){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return t(s)}if(typeof e=="string"){let s=JSON.parse(e),[n,i,o,a,c]=s;return t({join_ref:n,ref:i,topic:o,event:a,payload:c})}return t({})}_binaryDecode(e){let t=new DataView(e),s=t.getUint8(0),n=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,n)}}_decodeUserBroadcast(e,t,s){let n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4),c=this.HEADER_LENGTH+4,u=s.decode(e.slice(c,c+n));c=c+n;let l=s.decode(e.slice(c,c+i));c=c+i;let h=s.decode(e.slice(c,c+o));c=c+o;let f=e.slice(c,e.byteLength),p=a===this.JSON_ENCODING?JSON.parse(s.decode(f)):f,y={type:this.BROADCAST_EVENT,event:l,payload:p};return o>0&&(y.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:y}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>t.includes(s)))}};Xa.default=Ya});var rc=P(tc=>{"use strict";Object.defineProperty(tc,"__esModule",{value:!0});var ec=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};tc.default=ec});var Ai=P(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.httpEndpointURL=he.toTimestampString=he.toArray=he.toJson=he.toNumber=he.toBoolean=he.convertCell=he.convertColumn=he.convertChangeData=he.PostgresTypes=void 0;var Ee;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Ee||(he.PostgresTypes=Ee={}));var By=(r,e,t={})=>{var s;let n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=(0,he.convertColumn)(o,r,e,n),i),{}):{}};he.convertChangeData=By;var My=(r,e,t,s)=>{let n=e.find(a=>a.name===r),i=n?.type,o=t[r];return i&&!s.includes(i)?(0,he.convertCell)(i,o):sc(o)};he.convertColumn=My;var Fy=(r,e)=>{if(r.charAt(0)==="_"){let t=r.slice(1,r.length);return(0,he.toArray)(e,t)}switch(r){case Ee.bool:return(0,he.toBoolean)(e);case Ee.float4:case Ee.float8:case Ee.int2:case Ee.int4:case Ee.int8:case Ee.numeric:case Ee.oid:return(0,he.toNumber)(e);case Ee.json:case Ee.jsonb:return(0,he.toJson)(e);case Ee.timestamp:return(0,he.toTimestampString)(e);case Ee.abstime:case Ee.date:case Ee.daterange:case Ee.int4range:case Ee.int8range:case Ee.money:case Ee.reltime:case Ee.text:case Ee.time:case Ee.timestamptz:case Ee.timetz:case Ee.tsrange:case Ee.tstzrange:return sc(e);default:return sc(e)}};he.convertCell=Fy;var sc=r=>r,Vy=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}};he.toBoolean=Vy;var zy=r=>{if(typeof r=="string"){let e=parseFloat(r);if(!Number.isNaN(e))return e}return r};he.toNumber=zy;var Hy=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r};he.toJson=Hy;var Ky=(r,e)=>{if(typeof r!="string")return r;let t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i,o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>(0,he.convertCell)(e,a))}return r};he.toArray=Ky;var Wy=r=>typeof r=="string"?r.replace(" ","T"):r;he.toTimestampString=Wy;var Gy=r=>{let e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};he.httpEndpointURL=Gy});var Rd=P(ic=>{"use strict";Object.defineProperty(ic,"__esModule",{value:!0});var Qy=Ti(),nc=class{constructor(e,t,s={},n=Qy.DEFAULT_TIMEOUT){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}};ic.default=nc});var ac=P(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.REALTIME_PRESENCE_LISTEN_EVENTS=void 0;var kd;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(kd||(an.REALTIME_PRESENCE_LISTEN_EVENTS=kd={}));var oc=class r{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{let{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=r.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=r.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{let{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=r.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){let i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(u,l)=>{o[u]||(c[u]=l)}),this.map(o,(u,l)=>{let h=i[u];if(h){let f=l.map(w=>w.presence_ref),p=h.map(w=>w.presence_ref),y=l.filter(w=>p.indexOf(w.presence_ref)<0),g=h.filter(w=>f.indexOf(w.presence_ref)<0);y.length>0&&(a[u]=y),g.length>0&&(c[u]=g)}else a[u]=l}),this.syncDiff(i,{joins:a,leaves:c},s,n)}static syncDiff(e,t,s,n){let{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,c)=>{var u;let l=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(c),l.length>0){let h=e[a].map(p=>p.presence_ref),f=l.filter(p=>h.indexOf(p.presence_ref)<0);e[a].unshift(...f)}s(a,l,c)}),this.map(o,(a,c)=>{let u=e[a];if(!u)return;let l=c.map(h=>h.presence_ref);u=u.filter(h=>l.indexOf(h.presence_ref)<0),e[a]=u,n(a,u,c),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{let n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};an.default=oc});var lc=P($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.REALTIME_CHANNEL_STATES=$t.REALTIME_SUBSCRIBE_STATES=$t.REALTIME_LISTEN_TYPES=$t.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT=void 0;var Oi=(ne(),ue(se)),Se=Ti(),cc=Oi.__importDefault(Rd()),Jy=Oi.__importDefault(rc()),Zy=Oi.__importDefault(ac()),xd=Oi.__importStar(Ai()),Yy=Ai(),Cd;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Cd||($t.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT=Cd={}));var cn;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(cn||($t.REALTIME_LISTEN_TYPES=cn={}));var Yt;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Yt||($t.REALTIME_SUBSCRIBE_STATES=Yt={}));$t.REALTIME_CHANNEL_STATES=Se.CHANNEL_STATES;var uc=class r{constructor(e,t={config:{}},s){var n,i;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Se.CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new cc.default(this,Se.CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Jy.default(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Se.CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Se.CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Se.CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Se.CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Se.CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Se.CHANNEL_EVENTS.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Zy.default(this),this.broadcastEndpointURL=(0,Yy.httpEndpointURL)(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Se.CHANNEL_STATES.closed){let{config:{broadcast:o,presence:a,private:c}}=this.params,u=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(p=>p.filter))!==null&&n!==void 0?n:[],l=!!this.bindings[cn.PRESENCE]&&this.bindings[cn.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},f={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:l}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(p=>e?.(Yt.CHANNEL_ERROR,p)),this._onClose(()=>e?.(Yt.CLOSED)),this.updateJoinPayload(Object.assign({config:f},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var y;if(this.socket.setAuth(),p===void 0){e?.(Yt.SUBSCRIBED);return}else{let g=this.bindings.postgres_changes,w=(y=g?.length)!==null&&y!==void 0?y:0,b=[];for(let A=0;A<w;A++){let E=g[A],{filter:{event:k,schema:U,table:V,filter:I}}=E,W=p&&p[A];if(W&&W.event===k&&W.schema===U&&W.table===V&&W.filter===I)b.push(Object.assign(Object.assign({},E),{id:W.id}));else{this.unsubscribe(),this.state=Se.CHANNEL_STATES.errored,e?.(Yt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,e&&e(Yt.SUBSCRIBED);return}}).receive("error",p=>{this.state=Se.CHANNEL_STATES.errored,e?.(Yt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e?.(Yt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===Se.CHANNEL_STATES.joined&&e===cn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var n;let i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");let o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let c=a.statusText;try{let u=await a.json();c=u.error||u.message||c}catch{}return Promise.reject(new Error(c))}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{let u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;let u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Se.CHANNEL_STATES.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Se.CHANNEL_EVENTS.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new cc.default(this,Se.CHANNEL_EVENTS.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Se.CHANNEL_STATES.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){let n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new cc.default(this,e,t,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Se.MAX_PUSH_BUFFER_SIZE){let t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;let o=e.toLocaleLowerCase(),{close:a,error:c,leave:u,join:l}=Se.CHANNEL_EVENTS;if(s&&[a,c,u,l].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(p=>{var y,g,w;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((w=(g=p.filter)===null||g===void 0?void 0:g.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(p=>p.callback(f,s)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var y,g,w,b,A,E;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){let k=p.id,U=(y=p.filter)===null||y===void 0?void 0:y.event;return k&&((g=t.ids)===null||g===void 0?void 0:g.includes(k))&&(U==="*"||U?.toLocaleLowerCase()===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{let k=(A=(b=p?.filter)===null||b===void 0?void 0:b.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return k==="*"||k===((E=t?.event)===null||E===void 0?void 0:E.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){let y=f.data,{schema:g,table:w,commit_timestamp:b,type:A,errors:E}=y;f=Object.assign(Object.assign({},{schema:g,table:w,commit_timestamp:b,eventType:A,new:{},old:{},errors:E}),this._getPayloadRecords(y))}p.callback(f,s)})}_isClosed(){return this.state===Se.CHANNEL_STATES.closed}_isJoined(){return this.state===Se.CHANNEL_STATES.joined}_isJoining(){return this.state===Se.CHANNEL_STATES.joining}_isLeaving(){return this.state===Se.CHANNEL_STATES.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){let n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){let s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&r.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Se.CHANNEL_EVENTS.close,{},e)}_onError(e){this._on(Se.CHANNEL_EVENTS.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Se.CHANNEL_STATES.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=xd.convertChangeData(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=xd.convertChangeData(e.columns,e.old_record)),t}};$t.default=uc});var Pd=P(fc=>{"use strict";Object.defineProperty(fc,"__esModule",{value:!0});var ki=(ne(),ue(se)),Xy=ki.__importDefault(Za()),$e=Ti(),e_=ki.__importDefault(Od()),t_=ki.__importDefault(rc()),r_=Ai(),s_=ki.__importDefault(lc()),hc=()=>{},Ri={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},n_=[1e3,2e3,5e3,1e4],i_=1e4,o_=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,dc=class{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=$e.DEFAULT_TIMEOUT,this.transport=null,this.heartbeatIntervalMs=Ri.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=hc,this.ref=0,this.reconnectTimer=null,this.vsn=$e.DEFAULT_VSN,this.logger=hc,this.conn=null,this.sendBuffer=[],this.serializer=new e_.default,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((s=t?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${$e.TRANSPORTS.websocket}`,this.httpEndpoint=(0,r_.httpEndpointURL)(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Xy.default.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");let t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case $e.SOCKET_STATES.connecting:return $e.CONNECTION_STATE.Connecting;case $e.SOCKET_STATES.open:return $e.CONNECTION_STATE.Open;case $e.SOCKET_STATES.closing:return $e.CONNECTION_STATE.Closing;default:return $e.CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===$e.CONNECTION_STATE.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){let s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{let i=new s_.default(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){let{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close($e.WS_CLOSE_NORMAL,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ri.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:s,event:n,payload:i,ref:o}=t,a=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${s} ${n} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(s)).forEach(u=>u._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===$e.SOCKET_STATES.open||this.conn.readyState===$e.SOCKET_STATES.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger($e.CHANNEL_EVENTS.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{let s=new Blob([o_],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{let n={access_token:t,version:$e.DEFAULT_VERSION};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push($e.CHANNEL_EVENTS.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new t_.default(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ri.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,n,i,o,a,c,u,l,h,f,p;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e?.timeout)!==null&&s!==void 0?s:$e.DEFAULT_TIMEOUT,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:Ri.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:hc,this.vsn=(c=e?.vsn)!==null&&c!==void 0?c:$e.DEFAULT_VSN,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e?.reconnectAfterMs)!==null&&u!==void 0?u:y=>n_[y-1]||i_,this.vsn){case $e.VSN_1_0_0:this.encode=(l=e?.encode)!==null&&l!==void 0?l:(y,g)=>g(JSON.stringify(y)),this.decode=(h=e?.decode)!==null&&h!==void 0?h:(y,g)=>g(JSON.parse(y));break;case $e.VSN_2_0_0:this.encode=(f=e?.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(p=e?.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}};fc.default=dc});var pc=P(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.WebSocketFactory=Le.REALTIME_CHANNEL_STATES=Le.REALTIME_SUBSCRIBE_STATES=Le.REALTIME_PRESENCE_LISTEN_EVENTS=Le.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT=Le.REALTIME_LISTEN_TYPES=Le.RealtimeClient=Le.RealtimeChannel=Le.RealtimePresence=void 0;var xi=(ne(),ue(se)),a_=xi.__importDefault(Pd());Le.RealtimeClient=a_.default;var un=xi.__importStar(lc());Le.RealtimeChannel=un.default;Object.defineProperty(Le,"REALTIME_LISTEN_TYPES",{enumerable:!0,get:function(){return un.REALTIME_LISTEN_TYPES}});Object.defineProperty(Le,"REALTIME_POSTGRES_CHANGES_LISTEN_EVENT",{enumerable:!0,get:function(){return un.REALTIME_POSTGRES_CHANGES_LISTEN_EVENT}});Object.defineProperty(Le,"REALTIME_SUBSCRIBE_STATES",{enumerable:!0,get:function(){return un.REALTIME_SUBSCRIBE_STATES}});Object.defineProperty(Le,"REALTIME_CHANNEL_STATES",{enumerable:!0,get:function(){return un.REALTIME_CHANNEL_STATES}});var jd=xi.__importStar(ac());Le.RealtimePresence=jd.default;Object.defineProperty(Le,"REALTIME_PRESENCE_LISTEN_EVENTS",{enumerable:!0,get:function(){return jd.REALTIME_PRESENCE_LISTEN_EVENTS}});var c_=xi.__importDefault(Za());Le.WebSocketFactory=c_.default});var lr=P(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.StorageUnknownError=Xt.StorageApiError=Xt.StorageError=void 0;Xt.isStorageError=u_;var ln=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};Xt.StorageError=ln;function u_(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var mc=class extends ln{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}};Xt.StorageApiError=mc;var gc=class extends ln{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};Xt.StorageUnknownError=gc});var hn=P(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.isValidBucketName=dt.isPlainObject=dt.recursiveToCamel=dt.resolveResponse=dt.resolveFetch=void 0;var l_=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);dt.resolveFetch=l_;var h_=()=>Response;dt.resolveResponse=h_;var d_=r=>{if(Array.isArray(r))return r.map(t=>(0,dt.recursiveToCamel)(t));if(typeof r=="function"||r!==Object(r))return r;let e={};return Object.entries(r).forEach(([t,s])=>{let n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=(0,dt.recursiveToCamel)(s)}),e};dt.recursiveToCamel=d_;var f_=r=>{if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};dt.isPlainObject=f_;var p_=r=>!r||typeof r!="string"||r.length===0||r.length>100||r.trim()!==r||r.includes("/")||r.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(r);dt.isValidBucketName=p_});var Ci=P(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.get=y_;Rr.post=__;Rr.put=v_;Rr.head=w_;Rr.remove=b_;var Or=(ne(),ue(se)),yc=lr(),Nd=hn(),_c=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)===null||e===void 0?void 0:e.message)||JSON.stringify(r)},m_=(r,e,t)=>Or.__awaiter(void 0,void 0,void 0,function*(){let s=yield(0,Nd.resolveResponse)();r instanceof s&&!t?.noResolveJson?r.json().then(n=>{let i=r.status||500,o=n?.statusCode||i+"";e(new yc.StorageApiError(_c(n),i,o))}).catch(n=>{e(new yc.StorageUnknownError(_c(n),n))}):e(new yc.StorageUnknownError(_c(r),r))}),g_=(r,e,t,s)=>{let n={method:r,headers:e?.headers||{}};return r==="GET"||!s?n:((0,Nd.isPlainObject)(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function dn(r,e,t,s,n,i){return Or.__awaiter(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,g_(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>m_(c,a,s))})})}function y_(r,e,t,s){return Or.__awaiter(this,void 0,void 0,function*(){return dn(r,"GET",e,t,s)})}function __(r,e,t,s,n){return Or.__awaiter(this,void 0,void 0,function*(){return dn(r,"POST",e,s,n,t)})}function v_(r,e,t,s,n){return Or.__awaiter(this,void 0,void 0,function*(){return dn(r,"PUT",e,s,n,t)})}function w_(r,e,t,s){return Or.__awaiter(this,void 0,void 0,function*(){return dn(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function b_(r,e,t,s,n){return Or.__awaiter(this,void 0,void 0,function*(){return dn(r,"DELETE",e,s,n,t)})}});var Id=P(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});var E_=(ne(),ue(se)),S_=lr(),vc=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return E_.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if((0,S_.isStorageError)(e))return{data:null,error:e};throw e}})}};wc.default=vc});var Ld=P(Ec=>{"use strict";var $d;Object.defineProperty(Ec,"__esModule",{value:!0});var Dd=(ne(),ue(se)),T_=lr(),A_=Dd.__importDefault(Id()),bc=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[$d]="BlobDownloadBuilder",this.promise=null}asStream(){return new A_.default(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Dd.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if((0,T_.isStorageError)(e))return{data:null,error:e};throw e}})}};$d=Symbol.toStringTag;Ec.default=bc});var Bd=P(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});var ut=(ne(),ue(se)),ft=lr(),pt=Ci(),Ud=hn(),O_=ut.__importDefault(Ld()),R_={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},qd={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Sc=class{constructor(e,t={},s,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=(0,Ud.resolveFetch)(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,n){return ut.__awaiter(this,void 0,void 0,function*(){try{let i,o=Object.assign(Object.assign({},qd),n),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)}),c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(c))):(i=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),n?.headers&&(a=Object.assign(Object.assign({},a),n.headers));let u=this._removeEmptyFolders(t),l=this._getFinalPath(u),h=yield(e=="PUT"?pt.put:pt.post)(this.fetch,`${this.url}/object/${l}`,i,Object.assign({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if((0,ft.isStorageError)(i))return{data:null,error:i};throw i}})}upload(e,t,s){return ut.__awaiter(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return ut.__awaiter(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c,u=Object.assign({upsert:qd.upsert},n),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",u.cacheControl)):(c=s,l["cache-control"]=`max-age=${u.cacheControl}`,l["content-type"]=u.contentType);let h=yield(0,pt.put)(this.fetch,a.toString(),c,{headers:l});return{data:{path:i,fullPath:h.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if((0,ft.isStorageError)(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return ut.__awaiter(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");let i=yield(0,pt.post)(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new ft.StorageError("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,ft.isStorageError)(s))return{data:null,error:s};throw s}})}update(e,t,s){return ut.__awaiter(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return ut.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,pt.post)(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,ft.isStorageError)(n))return{data:null,error:n};throw n}})}copy(e,t,s){return ut.__awaiter(this,void 0,void 0,function*(){try{return{data:{path:(yield(0,pt.post)(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,ft.isStorageError)(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return ut.__awaiter(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield(0,pt.post)(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers}),o=s?.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,ft.isStorageError)(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return ut.__awaiter(this,void 0,void 0,function*(){try{let n=yield(0,pt.post)(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,ft.isStorageError)(n))return{data:null,error:n};throw n}})}download(e,t){let n=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"",a=this._getFinalPath(e),c=()=>(0,pt.get)(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new O_.default(c,this.shouldThrowOnError)}info(e){return ut.__awaiter(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let s=yield(0,pt.get)(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:(0,Ud.recursiveToCamel)(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,ft.isStorageError)(s))return{data:null,error:s};throw s}})}exists(e){return ut.__awaiter(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield(0,pt.head)(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,ft.isStorageError)(s)&&s instanceof ft.StorageUnknownError){let n=s.originalError;if([400,404].includes(n?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){let s=this._getFinalPath(e),n=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);let a=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&n.push(c);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${u}`)}}}remove(e){return ut.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,pt.remove)(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,ft.isStorageError)(t))return{data:null,error:t};throw t}})}list(e,t,s){return ut.__awaiter(this,void 0,void 0,function*(){try{let n=Object.assign(Object.assign(Object.assign({},R_),t),{prefix:e||""});return{data:yield(0,pt.post)(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,ft.isStorageError)(n))return{data:null,error:n};throw n}})}listV2(e,t){return ut.__awaiter(this,void 0,void 0,function*(){try{let s=Object.assign({},e);return{data:yield(0,pt.post)(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,ft.isStorageError)(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};Tc.default=Sc});var Ac=P(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.version=void 0;Pi.version="2.86.2"});var Oc=P(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.DEFAULT_HEADERS=void 0;var k_=Ac();ji.DEFAULT_HEADERS={"X-Client-Info":`storage-js/${k_.version}`}});var Md=P(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});var ds=(ne(),ue(se)),x_=Oc(),fs=lr(),ps=Ci(),C_=hn(),Rc=class{constructor(e,t={},s,n){this.shouldThrowOnError=!1;let i=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},x_.DEFAULT_HEADERS),t),this.fetch=(0,C_.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return ds.__awaiter(this,void 0,void 0,function*(){try{let t=this.listBucketOptionsToQueryString(e);return{data:yield(0,ps.get)(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,fs.isStorageError)(t))return{data:null,error:t};throw t}})}getBucket(e){return ds.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,ps.get)(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,fs.isStorageError)(t))return{data:null,error:t};throw t}})}createBucket(e){return ds.__awaiter(this,arguments,void 0,function*(t,s={public:!1}){try{return{data:yield(0,ps.post)(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if((0,fs.isStorageError)(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return ds.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,ps.put)(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,fs.isStorageError)(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ds.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,ps.post)(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,fs.isStorageError)(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ds.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,ps.remove)(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,fs.isStorageError)(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){let t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}};kc.default=Rc});var zd=P(er=>{"use strict";var gs=class extends Error{constructor(r,e){super(r),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function P_(r,e,t){let s=new URL(e,r);if(t)for(let[n,i]of Object.entries(t))i!==void 0&&s.searchParams.set(n,i);return s.toString()}async function j_(r){return!r||r.type==="none"?{}:r.type==="bearer"?{Authorization:`Bearer ${r.token}`}:r.type==="header"?{[r.name]:r.value}:r.type==="custom"?await r.getHeaders():{}}function N_(r){let e=r.fetchImpl??globalThis.fetch;return{async request({method:t,path:s,query:n,body:i,headers:o}){let a=P_(r.baseUrl,s,n),c=await j_(r.auth),u=await e(a,{method:t,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),l=await u.text(),h=(u.headers.get("content-type")||"").includes("application/json"),f=h&&l?JSON.parse(l):l;if(!u.ok){let p=h?f:void 0,y=p?.error;throw new gs(y?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:y?.type,icebergCode:y?.code,details:p})}return{status:u.status,headers:u.headers,data:f}}}}function Ni(r){return r.join("")}var I_=class{constructor(r,e=""){this.client=r,this.prefix=e}async listNamespaces(r){let e=r?{parent:Ni(r.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(r,e){let t={namespace:r.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(r){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ni(r.namespace)}`})}async loadNamespaceMetadata(r){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ni(r.namespace)}`})).data.properties}}async namespaceExists(r){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ni(r.namespace)}`}),!0}catch(e){if(e instanceof gs&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(r,e){try{return await this.createNamespace(r,e)}catch(t){if(t instanceof gs&&t.status===409)return;throw t}}};function ms(r){return r.join("")}var $_=class{constructor(r,e="",t){this.client=r,this.prefix=e,this.accessDelegation=t}async listTables(r){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ms(r.namespace)}/tables`})).data.identifiers}async createTable(r,e){let t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ms(r.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(r,e){let t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ms(r.namespace)}/tables/${r.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(r,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ms(r.namespace)}/tables/${r.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(r){let e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ms(r.namespace)}/tables/${r.name}`,headers:e})).data.metadata}async tableExists(r){let e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ms(r.namespace)}/tables/${r.name}`,headers:e}),!0}catch(t){if(t instanceof gs&&t.status===404)return!1;throw t}}async createTableIfNotExists(r,e){try{return await this.createTable(r,e)}catch(t){if(t instanceof gs&&t.status===409)return await this.loadTable({namespace:r.namespace,name:e.name});throw t}}},D_=class{constructor(r){let e="v1";r.catalogName&&(e+=`/${r.catalogName}`);let t=r.baseUrl.endsWith("/")?r.baseUrl:`${r.baseUrl}/`;this.client=N_({baseUrl:t,auth:r.auth,fetchImpl:r.fetch}),this.accessDelegation=r.accessDelegation?.join(","),this.namespaceOps=new I_(this.client,e),this.tableOps=new $_(this.client,e,this.accessDelegation)}async listNamespaces(r){return this.namespaceOps.listNamespaces(r)}async createNamespace(r,e){return this.namespaceOps.createNamespace(r,e)}async dropNamespace(r){await this.namespaceOps.dropNamespace(r)}async loadNamespaceMetadata(r){return this.namespaceOps.loadNamespaceMetadata(r)}async listTables(r){return this.tableOps.listTables(r)}async createTable(r,e){return this.tableOps.createTable(r,e)}async updateTable(r,e){return this.tableOps.updateTable(r,e)}async dropTable(r,e){await this.tableOps.dropTable(r,e)}async loadTable(r){return this.tableOps.loadTable(r)}async namespaceExists(r){return this.namespaceOps.namespaceExists(r)}async tableExists(r){return this.tableOps.tableExists(r)}async createNamespaceIfNotExists(r,e){return this.namespaceOps.createNamespaceIfNotExists(r,e)}async createTableIfNotExists(r,e){return this.tableOps.createTableIfNotExists(r,e)}},Fd=/^decimal\s*\(\s*(\d+)\s*,\s*(\d+)\s*\)$/,Vd=/^fixed\s*\[\s*(\d+)\s*\]$/;function xc(r){let e=r.match(Fd);return e?{precision:parseInt(e[1],10),scale:parseInt(e[2],10)}:null}function Cc(r){let e=r.match(Vd);return e?{length:parseInt(e[1],10)}:null}function L_(r){return Fd.test(r)}function U_(r){return Vd.test(r)}function q_(r,e){let t=xc(r),s=xc(e);if(t&&s)return t.precision===s.precision&&t.scale===s.scale;let n=Cc(r),i=Cc(e);return n&&i?n.length===i.length:r===e}function B_(r){return r.schemas.find(e=>e["schema-id"]===r["current-schema-id"])}er.IcebergError=gs;er.IcebergRestCatalog=D_;er.getCurrentSchema=B_;er.isDecimalType=L_;er.isFixedType=U_;er.parseDecimalType=xc;er.parseFixedType=Cc;er.typesEqual=q_});var Ic=P(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});var Ii=(ne(),ue(se)),M_=zd(),F_=Oc(),$i=lr(),Pc=Ci(),Hd=hn(),jc=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},F_.DEFAULT_HEADERS),t),this.fetch=(0,Hd.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Ii.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Pc.post)(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,$i.isStorageError)(t))return{data:null,error:t};throw t}})}listBuckets(e){return Ii.__awaiter(this,void 0,void 0,function*(){try{let t=new URLSearchParams;e?.limit!==void 0&&t.set("limit",e.limit.toString()),e?.offset!==void 0&&t.set("offset",e.offset.toString()),e?.sortColumn&&t.set("sortColumn",e.sortColumn),e?.sortOrder&&t.set("sortOrder",e.sortOrder),e?.search&&t.set("search",e.search);let s=t.toString(),n=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield(0,Pc.get)(this.fetch,n,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,$i.isStorageError)(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ii.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Pc.remove)(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,$i.isStorageError)(t))return{data:null,error:t};throw t}})}from(e){if(!(0,Hd.isValidBucketName)(e))throw new $i.StorageError("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");return new M_.IcebergRestCatalog({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:()=>Ii.__awaiter(this,void 0,void 0,function*(){return this.headers})},fetch:this.fetch})}};Nc.default=jc});var Li=P(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.DEFAULT_HEADERS=void 0;var V_=Ac();Di.DEFAULT_HEADERS={"X-Client-Info":`storage-js/${V_.version}`,"Content-Type":"application/json"}});var ys=P(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.StorageVectorsErrorCode=Dt.StorageVectorsUnknownError=Dt.StorageVectorsApiError=Dt.StorageVectorsError=void 0;Dt.isStorageVectorsError=z_;var fn=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};Dt.StorageVectorsError=fn;function z_(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}var $c=class extends fn{constructor(e,t,s){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}};Dt.StorageVectorsApiError=$c;var Dc=class extends fn{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};Dt.StorageVectorsUnknownError=Dc;var Kd;(function(r){r.InternalError="InternalError",r.S3VectorConflictException="S3VectorConflictException",r.S3VectorNotFoundException="S3VectorNotFoundException",r.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",r.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",r.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(Kd||(Dt.StorageVectorsErrorCode=Kd={}))});var _s=P(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.validateVectorDimension=Ot.normalizeToFloat32=Ot.isPlainObject=Ot.resolveResponse=Ot.resolveFetch=void 0;var H_=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);Ot.resolveFetch=H_;var K_=()=>Response;Ot.resolveResponse=K_;var W_=r=>{if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};Ot.isPlainObject=W_;var G_=r=>Array.from(new Float32Array(r));Ot.normalizeToFloat32=G_;var Q_=(r,e)=>{if(e!==void 0&&r.float32.length!==e)throw new Error(`Vector dimension mismatch: expected ${e}, got ${r.float32.length}`)};Ot.validateVectorDimension=Q_});var Bi=P(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});ws.get=X_;ws.post=ev;ws.put=tv;ws.remove=rv;var vs=(ne(),ue(se)),Ui=ys(),J_=_s(),Wd=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Z_=(r,e,t)=>vs.__awaiter(void 0,void 0,void 0,function*(){if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!t?.noResolveJson){let n=r.status||500,i=r;if(typeof i.json=="function")i.json().then(o=>{let a=o?.statusCode||o?.code||n+"";e(new Ui.StorageVectorsApiError(Wd(o),n,a))}).catch(()=>{let o=n+"",a=i.statusText||`HTTP ${n} error`;e(new Ui.StorageVectorsApiError(a,n,o))});else{let o=n+"",a=i.statusText||`HTTP ${n} error`;e(new Ui.StorageVectorsApiError(a,n,o))}}else e(new Ui.StorageVectorsUnknownError(Wd(r),r))}),Y_=(r,e,t,s)=>{let n={method:r,headers:e?.headers||{}};return r==="GET"||!s?n:((0,J_.isPlainObject)(s)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(s)):n.body=s,Object.assign(Object.assign({},n),t))};function qi(r,e,t,s,n,i){return vs.__awaiter(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,Y_(e,s,n,i)).then(c=>{if(!c.ok)throw c;if(s?.noResolveJson)return c;let u=c.headers.get("content-type");return!u||!u.includes("application/json")?{}:c.json()}).then(c=>o(c)).catch(c=>Z_(c,a,s))})})}function X_(r,e,t,s){return vs.__awaiter(this,void 0,void 0,function*(){return qi(r,"GET",e,t,s)})}function ev(r,e,t,s,n){return vs.__awaiter(this,void 0,void 0,function*(){return qi(r,"POST",e,s,n,t)})}function tv(r,e,t,s,n){return vs.__awaiter(this,void 0,void 0,function*(){return qi(r,"PUT",e,s,n,t)})}function rv(r,e,t,s,n){return vs.__awaiter(this,void 0,void 0,function*(){return qi(r,"DELETE",e,s,n,t)})}});var qc=P(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});var Mi=(ne(),ue(se)),sv=Li(),Fi=ys(),Vi=Bi(),nv=_s(),Lc=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},sv.DEFAULT_HEADERS),t),this.fetch=(0,nv.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return Mi.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield(0,Vi.post)(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Fi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}getIndex(e,t){return Mi.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Vi.post)(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,Fi.isStorageVectorsError)(s))return{data:null,error:s};throw s}})}listIndexes(e){return Mi.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Vi.post)(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Fi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return Mi.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield(0,Vi.post)(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if((0,Fi.isStorageVectorsError)(s))return{data:null,error:s};throw s}})}};Uc.default=Lc});var Fc=P(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});var pn=(ne(),ue(se)),iv=Li(),mn=ys(),gn=Bi(),ov=_s(),Bc=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},iv.DEFAULT_HEADERS),t),this.fetch=(0,ov.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return pn.__awaiter(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield(0,gn.post)(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,mn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}getVectors(e){return pn.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,gn.post)(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,mn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}listVectors(e){return pn.__awaiter(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield(0,gn.post)(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,mn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}queryVectors(e){return pn.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,gn.post)(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,mn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}deleteVectors(e){return pn.__awaiter(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield(0,gn.post)(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,mn.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}};Mc.default=Bc});var Hc=P(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});var zi=(ne(),ue(se)),av=Li(),Hi=ys(),Ki=Bi(),cv=_s(),Vc=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},av.DEFAULT_HEADERS),t),this.fetch=(0,cv.resolveFetch)(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return zi.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield(0,Ki.post)(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Hi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}getBucket(e){return zi.__awaiter(this,void 0,void 0,function*(){try{return{data:yield(0,Ki.post)(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Hi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}listBuckets(){return zi.__awaiter(this,arguments,void 0,function*(e={}){try{return{data:yield(0,Ki.post)(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Hi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}deleteBucket(e){return zi.__awaiter(this,void 0,void 0,function*(){try{return{data:(yield(0,Ki.post)(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if((0,Hi.isStorageVectorsError)(t))return{data:null,error:t};throw t}})}};zc.default=Vc});var Gd=P(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.VectorIndexScope=hr.VectorBucketScope=hr.StorageVectorsClient=void 0;var tt=(ne(),ue(se)),uv=tt.__importDefault(qc()),lv=tt.__importDefault(Fc()),hv=tt.__importDefault(Hc()),Kc=class extends hv.default{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Wi(this.url,this.headers,e,this.fetch)}createBucket(e){let t=Object.create(null,{createBucket:{get:()=>super.createBucket}});return tt.__awaiter(this,void 0,void 0,function*(){return t.createBucket.call(this,e)})}getBucket(e){let t=Object.create(null,{getBucket:{get:()=>super.getBucket}});return tt.__awaiter(this,void 0,void 0,function*(){return t.getBucket.call(this,e)})}listBuckets(){let e=Object.create(null,{listBuckets:{get:()=>super.listBuckets}});return tt.__awaiter(this,arguments,void 0,function*(t={}){return e.listBuckets.call(this,t)})}deleteBucket(e){let t=Object.create(null,{deleteBucket:{get:()=>super.deleteBucket}});return tt.__awaiter(this,void 0,void 0,function*(){return t.deleteBucket.call(this,e)})}};hr.StorageVectorsClient=Kc;var Wi=class extends uv.default{constructor(e,t,s,n){super(e,t,n),this.vectorBucketName=s}createIndex(e){let t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return tt.__awaiter(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return tt.__awaiter(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){let t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return tt.__awaiter(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){let t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return tt.__awaiter(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Gi(this.url,this.headers,this.vectorBucketName,e,this.fetch)}};hr.VectorBucketScope=Wi;var Gi=class extends lv.default{constructor(e,t,s,n,i){super(e,t,i),this.vectorBucketName=s,this.indexName=n}putVectors(e){let t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return tt.__awaiter(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){let t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return tt.__awaiter(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return tt.__awaiter(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){let t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return tt.__awaiter(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){let t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return tt.__awaiter(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}};hr.VectorIndexScope=Gi});var Qc=P(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.validateVectorDimension=re.normalizeToFloat32=re.isPlainObject=re.resolveResponse=re.resolveFetch=re.isStorageVectorsError=re.StorageVectorsErrorCode=re.StorageVectorsUnknownError=re.StorageVectorsApiError=re.StorageVectorsError=re.VectorDataApi=re.VectorIndexApi=re.VectorBucketApi=re.VectorIndexScope=re.VectorBucketScope=re.StorageVectorsClient=void 0;var Wc=(ne(),ue(se)),Gc=Gd();Object.defineProperty(re,"StorageVectorsClient",{enumerable:!0,get:function(){return Gc.StorageVectorsClient}});Object.defineProperty(re,"VectorBucketScope",{enumerable:!0,get:function(){return Gc.VectorBucketScope}});Object.defineProperty(re,"VectorIndexScope",{enumerable:!0,get:function(){return Gc.VectorIndexScope}});var dv=Hc();Object.defineProperty(re,"VectorBucketApi",{enumerable:!0,get:function(){return Wc.__importDefault(dv).default}});var fv=qc();Object.defineProperty(re,"VectorIndexApi",{enumerable:!0,get:function(){return Wc.__importDefault(fv).default}});var pv=Fc();Object.defineProperty(re,"VectorDataApi",{enumerable:!0,get:function(){return Wc.__importDefault(pv).default}});var yn=ys();Object.defineProperty(re,"StorageVectorsError",{enumerable:!0,get:function(){return yn.StorageVectorsError}});Object.defineProperty(re,"StorageVectorsApiError",{enumerable:!0,get:function(){return yn.StorageVectorsApiError}});Object.defineProperty(re,"StorageVectorsUnknownError",{enumerable:!0,get:function(){return yn.StorageVectorsUnknownError}});Object.defineProperty(re,"StorageVectorsErrorCode",{enumerable:!0,get:function(){return yn.StorageVectorsErrorCode}});Object.defineProperty(re,"isStorageVectorsError",{enumerable:!0,get:function(){return yn.isStorageVectorsError}});var _n=_s();Object.defineProperty(re,"resolveFetch",{enumerable:!0,get:function(){return _n.resolveFetch}});Object.defineProperty(re,"resolveResponse",{enumerable:!0,get:function(){return _n.resolveResponse}});Object.defineProperty(re,"isPlainObject",{enumerable:!0,get:function(){return _n.isPlainObject}});Object.defineProperty(re,"normalizeToFloat32",{enumerable:!0,get:function(){return _n.normalizeToFloat32}});Object.defineProperty(re,"validateVectorDimension",{enumerable:!0,get:function(){return _n.validateVectorDimension}})});var Qd=P(Qi=>{"use strict";Object.defineProperty(Qi,"__esModule",{value:!0});Qi.StorageClient=void 0;var Zc=(ne(),ue(se)),mv=Zc.__importDefault(Bd()),gv=Zc.__importDefault(Md()),yv=Zc.__importDefault(Ic()),_v=Qc(),Jc=class extends gv.default{constructor(e,t={},s,n){super(e,t,s,n)}from(e){return new mv.default(this.url,this.headers,e,this.fetch)}get vectors(){return new _v.StorageVectorsClient(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new yv.default(this.url+"/iceberg",this.headers,this.fetch)}};Qi.StorageClient=Jc});var Zd=P(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0})});var Yd=P(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.StorageAnalyticsClient=tr.StorageClient=void 0;var Ji=(ne(),ue(se)),vv=Qd();Object.defineProperty(tr,"StorageClient",{enumerable:!0,get:function(){return vv.StorageClient}});var wv=Ic();Object.defineProperty(tr,"StorageAnalyticsClient",{enumerable:!0,get:function(){return Ji.__importDefault(wv).default}});Ji.__exportStar(Zd(),tr);Ji.__exportStar(lr(),tr);Ji.__exportStar(Qc(),tr)});var Xd=P(Zi=>{"use strict";Object.defineProperty(Zi,"__esModule",{value:!0});Zi.version=void 0;Zi.version="2.86.2"});var ef=P(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.DEFAULT_REALTIME_OPTIONS=wt.DEFAULT_AUTH_OPTIONS=wt.DEFAULT_DB_OPTIONS=wt.DEFAULT_GLOBAL_OPTIONS=wt.DEFAULT_HEADERS=void 0;var bv=Xd(),vn="";typeof Deno<"u"?vn="deno":typeof document<"u"?vn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?vn="react-native":vn="node";wt.DEFAULT_HEADERS={"X-Client-Info":`supabase-js-${vn}/${bv.version}`};wt.DEFAULT_GLOBAL_OPTIONS={headers:wt.DEFAULT_HEADERS};wt.DEFAULT_DB_OPTIONS={schema:"public"};wt.DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"};wt.DEFAULT_REALTIME_OPTIONS={}});var tf=P(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.fetchWithAuth=Vt.resolveHeadersConstructor=Vt.resolveFetch=void 0;var Ev=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);Vt.resolveFetch=Ev;var Sv=()=>Headers;Vt.resolveHeadersConstructor=Sv;var Tv=(r,e,t)=>{let s=(0,Vt.resolveFetch)(t),n=(0,Vt.resolveHeadersConstructor)();return async(i,o)=>{var a;let c=(a=await e())!==null&&a!==void 0?a:r,u=new n(o?.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},o),{headers:u}))}};Vt.fetchWithAuth=Tv});var sf=P(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.isBrowser=void 0;dr.uuid=Av;dr.ensureTrailingSlash=rf;dr.applySettingDefaults=Rv;dr.validateSupabaseUrl=kv;function Av(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var e=Math.random()*16|0,t=r=="x"?e:e&3|8;return t.toString(16)})}function rf(r){return r.endsWith("/")?r:r+"/"}var Ov=()=>typeof window<"u";dr.isBrowser=Ov;function Rv(r,e){var t,s;let{db:n,auth:i,realtime:o,global:a}=r,{db:c,auth:u,realtime:l,global:h}=e,f={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},l),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),a),{headers:Object.assign(Object.assign({},(t=h?.headers)!==null&&t!==void 0?t:{}),(s=a?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}function kv(r){let e=r?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(rf(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}});var Yc=P(Yi=>{"use strict";Object.defineProperty(Yi,"__esModule",{value:!0});Yi.version=void 0;Yi.version="2.86.2"});var Xi=P(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.JWKS_TTL=ge.BASE64URL_REGEX=ge.API_VERSIONS=ge.API_VERSION_HEADER_NAME=ge.NETWORK_FAILURE=ge.DEFAULT_HEADERS=ge.AUDIENCE=ge.STORAGE_KEY=ge.GOTRUE_URL=ge.EXPIRY_MARGIN_MS=ge.AUTO_REFRESH_TICK_THRESHOLD=ge.AUTO_REFRESH_TICK_DURATION_MS=void 0;var xv=Yc();ge.AUTO_REFRESH_TICK_DURATION_MS=30*1e3;ge.AUTO_REFRESH_TICK_THRESHOLD=3;ge.EXPIRY_MARGIN_MS=ge.AUTO_REFRESH_TICK_THRESHOLD*ge.AUTO_REFRESH_TICK_DURATION_MS;ge.GOTRUE_URL="http://localhost:9999";ge.STORAGE_KEY="supabase.auth.token";ge.AUDIENCE="";ge.DEFAULT_HEADERS={"X-Client-Info":`gotrue-js/${xv.version}`};ge.NETWORK_FAILURE={MAX_RETRIES:10,RETRY_INTERVAL:2};ge.API_VERSION_HEADER_NAME="X-Supabase-Api-Version";ge.API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};ge.BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;ge.JWKS_TTL=10*60*1e3});var kr=P(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.AuthInvalidJwtError=ie.AuthWeakPasswordError=ie.AuthRetryableFetchError=ie.AuthPKCEGrantCodeExchangeError=ie.AuthImplicitGrantRedirectError=ie.AuthInvalidCredentialsError=ie.AuthInvalidTokenResponseError=ie.AuthSessionMissingError=ie.CustomAuthError=ie.AuthUnknownError=ie.AuthApiError=ie.AuthError=void 0;ie.isAuthError=Es;ie.isAuthApiError=Cv;ie.isAuthSessionMissingError=Pv;ie.isAuthImplicitGrantRedirectError=jv;ie.isAuthRetryableFetchError=Nv;ie.isAuthWeakPasswordError=Iv;var bs=class extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}};ie.AuthError=bs;function Es(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}var Xc=class extends bs{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}};ie.AuthApiError=Xc;function Cv(r){return Es(r)&&r.name==="AuthApiError"}var eu=class extends bs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}};ie.AuthUnknownError=eu;var Lt=class extends bs{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}};ie.CustomAuthError=Lt;var tu=class extends Lt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};ie.AuthSessionMissingError=tu;function Pv(r){return Es(r)&&r.name==="AuthSessionMissingError"}var ru=class extends Lt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}};ie.AuthInvalidTokenResponseError=ru;var su=class extends Lt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}};ie.AuthInvalidCredentialsError=su;var nu=class extends Lt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};ie.AuthImplicitGrantRedirectError=nu;function jv(r){return Es(r)&&r.name==="AuthImplicitGrantRedirectError"}var iu=class extends Lt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};ie.AuthPKCEGrantCodeExchangeError=iu;var ou=class extends Lt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}};ie.AuthRetryableFetchError=ou;function Nv(r){return Es(r)&&r.name==="AuthRetryableFetchError"}var au=class extends Lt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}};ie.AuthWeakPasswordError=au;function Iv(r){return Es(r)&&r.name==="AuthWeakPasswordError"}var cu=class extends Lt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}};ie.AuthInvalidJwtError=cu});var to=P(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.byteToBase64URL=wn;Rt.byteFromBase64URL=uu;Rt.stringToBase64URL=Dv;Rt.stringFromBase64URL=Lv;Rt.codepointToUTF8=of;Rt.stringToUTF8=lu;Rt.stringFromUTF8=af;Rt.base64UrlToUint8Array=Uv;Rt.stringToUint8Array=qv;Rt.bytesToBase64URL=Bv;var eo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nf=` 	
\r=`.split(""),$v=(()=>{let r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<nf.length;e+=1)r[nf[e].charCodeAt(0)]=-2;for(let e=0;e<eo.length;e+=1)r[eo[e].charCodeAt(0)]=e;return r})();function wn(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){let s=e.queue>>e.queuedBits-6&63;t(eo[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){let s=e.queue>>e.queuedBits-6&63;t(eo[s]),e.queuedBits-=6}}function uu(r,e,t){let s=$v[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Dv(r){let e=[],t=n=>{e.push(n)},s={queue:0,queuedBits:0};return lu(r,n=>{wn(n,s,t)}),wn(null,s,t),e.join("")}function Lv(r){let e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{af(o,s,t)};for(let o=0;o<r.length;o+=1)uu(r.charCodeAt(o),n,i);return e.join("")}function of(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function lu(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){let n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}of(s,e)}}function af(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Uv(r){let e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)uu(r.charCodeAt(n),t,s);return new Uint8Array(e)}function qv(r){let e=[];return lu(r,t=>e.push(t)),new Uint8Array(e)}function Bv(r){let e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>wn(n,t,s)),wn(null,t,s),e.join("")}});var Ss=P(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.Deferred=ee.removeItemAsync=ee.getItemAsync=ee.setItemAsync=ee.looksLikeFetchResponse=ee.resolveFetch=ee.supportsLocalStorage=ee.isBrowser=void 0;ee.expiresAt=Mv;ee.generateCallbackId=Fv;ee.parseParametersFromURL=Hv;ee.decodeJWT=Zv;ee.sleep=Yv;ee.retryable=Xv;ee.generatePKCEVerifier=lf;ee.generatePKCEChallenge=hf;ee.getCodeChallengeAndMethod=rw;ee.parseResponseAPIVersion=nw;ee.validateExp=iw;ee.getAlgorithm=ow;ee.validateUUID=cw;ee.userNotAvailableProxy=uw;ee.insecureUserWarningProxy=lw;ee.deepClone=hw;var uf=Xi(),cf=kr(),hu=to();function Mv(r){return Math.round(Date.now()/1e3)+r}function Fv(){return Symbol("auth-callback")}var Vv=()=>typeof window<"u"&&typeof document<"u";ee.isBrowser=Vv;var xr={tested:!1,writable:!1},zv=()=>{if(!(0,ee.isBrowser)())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(xr.tested)return xr.writable;let r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),xr.tested=!0,xr.writable=!0}catch{xr.tested=!0,xr.writable=!1}return xr.writable};ee.supportsLocalStorage=zv;function Hv(r){let e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}var Kv=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);ee.resolveFetch=Kv;var Wv=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function";ee.looksLikeFetchResponse=Wv;var Gv=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))};ee.setItemAsync=Gv;var Qv=async(r,e)=>{let t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}};ee.getItemAsync=Qv;var Jv=async(r,e)=>{await r.removeItem(e)};ee.removeItemAsync=Jv;var ro=class r{constructor(){this.promise=new r.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}};ee.Deferred=ro;ro.promiseConstructor=Promise;function Zv(r){let e=r.split(".");if(e.length!==3)throw new cf.AuthInvalidJwtError("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!uf.BASE64URL_REGEX.test(e[s]))throw new cf.AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse((0,hu.stringFromBase64URL)(e[0])),payload:JSON.parse((0,hu.stringFromBase64URL)(e[1])),signature:(0,hu.base64UrlToUint8Array)(e[2]),raw:{header:e[0],payload:e[1]}}}async function Yv(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Xv(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{let o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function ew(r){return("0"+r.toString(16)).substr(-2)}function lf(){let e=new Uint32Array(56);if(typeof crypto>"u"){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length,n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,ew).join("")}async function tw(r){let t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function hf(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;let t=await tw(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function rw(r,e,t=!1){let s=lf(),n=s;t&&(n+="/PASSWORD_RECOVERY"),await(0,ee.setItemAsync)(r,`${e}-code-verifier`,n);let i=await hf(s);return[i,s===i?"plain":"s256"]}var sw=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function nw(r){let e=r.headers.get(uf.API_VERSION_HEADER_NAME);if(!e||!e.match(sw))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function iw(r){if(!r)throw new Error("Missing exp claim");let e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function ow(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var aw=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function cw(r){if(!aw.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function uw(){let r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){let s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function lw(r,e){return new Proxy(r,{get:(t,s,n)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){let i=s.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,s,n)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,s,n)}})}function hw(r){return JSON.parse(JSON.stringify(r))}});var pu=P(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.handleError=fu;zt._request=mw;zt._sessionResponse=df;zt._sessionResponsePassword=yw;zt._userResponse=_w;zt._ssoResponse=vw;zt._generateLinkResponse=ww;zt._noResolveJsonResponse=bw;var dw=(ne(),ue(se)),so=Xi(),du=Ss(),fr=kr(),Cr=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),fw=[502,503,504];async function fu(r){var e;if(!(0,du.looksLikeFetchResponse)(r))throw new fr.AuthRetryableFetchError(Cr(r),0);if(fw.includes(r.status))throw new fr.AuthRetryableFetchError(Cr(r),r.status);let t;try{t=await r.json()}catch(i){throw new fr.AuthUnknownError(Cr(i),i)}let s,n=(0,du.parseResponseAPIVersion)(r);if(n&&n.getTime()>=so.API_VERSIONS["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new fr.AuthWeakPasswordError(Cr(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new fr.AuthSessionMissingError}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new fr.AuthWeakPasswordError(Cr(t),r.status,t.weak_password.reasons);throw new fr.AuthApiError(Cr(t),r.status||500,s)}var pw=(r,e,t,s)=>{let n={method:r,headers:e?.headers||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function mw(r,e,t,s){var n;let i=Object.assign({},s?.headers);i[so.API_VERSION_HEADER_NAME]||(i[so.API_VERSION_HEADER_NAME]=so.API_VERSIONS["2024-01-01"].name),s?.jwt&&(i.Authorization=`Bearer ${s.jwt}`);let o=(n=s?.query)!==null&&n!==void 0?n:{};s?.redirectTo&&(o.redirect_to=s.redirectTo);let a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await gw(r,e,t+a,{headers:i,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(c):{data:Object.assign({},c),error:null}}async function gw(r,e,t,s,n,i){let o=pw(e,s,n,i),a;try{a=await r(t,Object.assign({},o))}catch(c){throw console.error(c),new fr.AuthRetryableFetchError(Cr(c),0)}if(a.ok||await fu(a),s?.noResolveJson)return a;try{return await a.json()}catch(c){await fu(c)}}function df(r){var e;let t=null;Ew(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=(0,du.expiresAt)(r.expires_in)));let s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function yw(r){let e=df(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function _w(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function vw(r){return{data:r,error:null}}function ww(r){let{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=dw.__rest(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function bw(r){return r}function Ew(r){return r.access_token&&r.refresh_token&&r.expires_in}});var mu=P(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.SIGN_OUT_SCOPES=void 0;no.SIGN_OUT_SCOPES=["global","local","others"]});var io=P(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});var Sw=(ne(),ue(se)),Ce=pu(),Pr=Ss(),gu=mu(),rt=kr(),yu=class{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=(0,Pr.resolveFetch)(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=gu.SIGN_OUT_SCOPES[0]){if(gu.SIGN_OUT_SCOPES.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${gu.SIGN_OUT_SCOPES.join(", ")}`);try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if((0,rt.isAuthError)(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ce._userResponse})}catch(s){if((0,rt.isAuthError)(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{let{options:t}=e,s=Sw.__rest(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s?.newEmail,delete n.newEmail),await(0,Ce._request)(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Ce._generateLinkResponse,redirectTo:t?.redirectTo})}catch(t){if((0,rt.isAuthError)(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ce._userResponse})}catch(t){if((0,rt.isAuthError)(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,a,c;try{let u={nextPage:null,lastPage:0,total:0},l=await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Ce._noResolveJsonResponse});if(l.error)throw l.error;let h=await l.json(),f=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{let g=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(y.split(";")[1].split("=")[1]);u[`${w}Page`]=g}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if((0,rt.isAuthError)(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){(0,Pr.validateUUID)(e);try{return await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ce._userResponse})}catch(t){if((0,rt.isAuthError)(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){(0,Pr.validateUUID)(e);try{return await(0,Ce._request)(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ce._userResponse})}catch(s){if((0,rt.isAuthError)(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){(0,Pr.validateUUID)(e);try{return await(0,Ce._request)(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ce._userResponse})}catch(s){if((0,rt.isAuthError)(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){(0,Pr.validateUUID)(e.userId);try{let{data:t,error:s}=await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if((0,rt.isAuthError)(t))return{data:null,error:t};throw t}}async _deleteFactor(e){(0,Pr.validateUUID)(e.userId),(0,Pr.validateUUID)(e.id);try{return{data:await(0,Ce._request)(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if((0,rt.isAuthError)(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,n,i,o,a,c;try{let u={nextPage:null,lastPage:0,total:0},l=await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Ce._noResolveJsonResponse});if(l.error)throw l.error;let h=await l.json(),f=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{let g=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(y.split(";")[1].split("=")[1]);u[`${w}Page`]=g}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if((0,rt.isAuthError)(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if((0,rt.isAuthError)(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await(0,Ce._request)(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if((0,rt.isAuthError)(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await(0,Ce._request)(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if((0,rt.isAuthError)(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await(0,Ce._request)(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if((0,rt.isAuthError)(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await(0,Ce._request)(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if((0,rt.isAuthError)(t))return{data:null,error:t};throw t}}};_u.default=yu});var ff=P(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});vu.memoryLocalStorageAdapter=Tw;function Tw(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}});var wu=P(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.ProcessLockAcquireTimeoutError=He.NavigatorLockAcquireTimeoutError=He.LockAcquireTimeoutError=He.internals=void 0;He.navigatorLock=Ow;He.processLock=Rw;var Aw=Ss();He.internals={debug:!!(globalThis&&(0,Aw.supportsLocalStorage)()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};var bn=class extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}};He.LockAcquireTimeoutError=bn;var oo=class extends bn{};He.NavigatorLockAcquireTimeoutError=oo;var ao=class extends bn{};He.ProcessLockAcquireTimeoutError=ao;async function Ow(r,e,t){He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);let s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw He.internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new oo(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(He.internals.debug)try{let i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}var pf={};async function Rw(r,e,t){var s;let n=(s=pf[r])!==null&&s!==void 0?s:Promise.resolve(),i=Promise.race([n.catch(()=>null),e>=0?new Promise((o,a)=>{setTimeout(()=>{a(new ao(`Acquring process lock with name "${r}" timed out`))},e)}):null].filter(o=>o)).catch(o=>{if(o&&o.isAcquireTimeout)throw o;return null}).then(async()=>await t());return pf[r]=i.catch(async o=>{if(o&&o.isAcquireTimeout)return await n,null;throw o}),await i}});var mf=P(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.polyfillGlobalThis=kw;function kw(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}});var yf=P(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});Ts.getAddress=gf;Ts.fromHex=xw;Ts.toHex=Cw;Ts.createSiweMessage=Pw;function gf(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function xw(r){return parseInt(r,16)}function Cw(r){let e=new TextEncoder().encode(r);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function Pw(r){var e;let{chainId:t,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:c,resources:u,scheme:l,uri:h,version:f}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}let p=gf(r.address),y=l?`${l}://${s}`:s,g=r.statement?`${r.statement}
`:"",w=`${y} wants you to sign in with your Ethereum account:
${p}

${g}`,b=`URI: ${h}
Version: ${f}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(b+=`
Expiration Time: ${n.toISOString()}`),a&&(b+=`
Not Before: ${a.toISOString()}`),c&&(b+=`
Request ID: ${c}`),u){let A=`
Resources:`;for(let E of u){if(!E||typeof E!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${E}`);A+=`
- ${E}`}b+=A}return`${w}
${b}`}});var vf=P(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.WebAuthnUnknownError=rr.WebAuthnError=void 0;rr.isWebAuthnError=jw;rr.identifyRegistrationError=Nw;rr.identifyAuthenticationError=Iw;var _f=Su(),je=class extends Error{constructor({message:e,code:t,cause:s,name:n}){var i;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=n??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}};rr.WebAuthnError=je;var Eu=class extends je{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}};rr.WebAuthnUnknownError=Eu;function jw(r){return typeof r=="object"&&r!==null&&"__isWebAuthnError"in r}function Nw({error:r,options:e}){var t,s,n;let{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new je({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new je({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new je({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new je({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new je({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new je({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new je({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new je({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){let o=window.location.hostname;if((0,_f.isValidDomain)(o)){if(i.rp.id!==o)return new je({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new je({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new je({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new je({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new je({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function Iw({error:r,options:e}){let{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new je({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new je({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){let s=window.location.hostname;if((0,_f.isValidDomain)(s)){if(t.rpId!==s)return new je({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new je({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new je({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new je({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}});var Su=P(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.WebAuthnApi=oe.DEFAULT_REQUEST_OPTIONS=oe.DEFAULT_CREATION_OPTIONS=oe.webAuthnAbortService=oe.WebAuthnAbortService=oe.identifyAuthenticationError=oe.identifyRegistrationError=oe.isWebAuthnError=oe.WebAuthnError=void 0;oe.deserializeCredentialCreationOptions=Dw;oe.deserializeCredentialRequestOptions=Lw;oe.serializeCredentialCreationResponse=Uw;oe.serializeCredentialRequestResponse=qw;oe.isValidDomain=Bw;oe.createCredential=Ef;oe.getCredential=Sf;oe.mergeCredentialCreationOptions=Tf;oe.mergeCredentialRequestOptions=Af;var bf=(ne(),ue(se)),Ut=to(),Ht=kr(),$w=Ss(),Kt=vf();Object.defineProperty(oe,"identifyAuthenticationError",{enumerable:!0,get:function(){return Kt.identifyAuthenticationError}});Object.defineProperty(oe,"identifyRegistrationError",{enumerable:!0,get:function(){return Kt.identifyRegistrationError}});Object.defineProperty(oe,"isWebAuthnError",{enumerable:!0,get:function(){return Kt.isWebAuthnError}});Object.defineProperty(oe,"WebAuthnError",{enumerable:!0,get:function(){return Kt.WebAuthnError}});var co=class{createNewAbortSignal(){if(this.controller){let t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};oe.WebAuthnAbortService=co;oe.webAuthnAbortService=new co;function Dw(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);let{challenge:e,user:t,excludeCredentials:s}=r,n=bf.__rest(r,["challenge","user","excludeCredentials"]),i=(0,Ut.base64UrlToUint8Array)(e).buffer,o=Object.assign(Object.assign({},t),{id:(0,Ut.base64UrlToUint8Array)(t.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:i,user:o});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let c=0;c<s.length;c++){let u=s[c];a.excludeCredentials[c]=Object.assign(Object.assign({},u),{id:(0,Ut.base64UrlToUint8Array)(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function Lw(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);let{challenge:e,allowCredentials:t}=r,s=bf.__rest(r,["challenge","allowCredentials"]),n=(0,Ut.base64UrlToUint8Array)(e).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){let a=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:(0,Ut.base64UrlToUint8Array)(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function Uw(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();let t=r;return{id:r.id,rawId:r.id,response:{attestationObject:(0,Ut.bytesToBase64URL)(new Uint8Array(r.response.attestationObject)),clientDataJSON:(0,Ut.bytesToBase64URL)(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function qw(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();let t=r,s=r.getClientExtensionResults(),n=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:(0,Ut.bytesToBase64URL)(new Uint8Array(n.authenticatorData)),clientDataJSON:(0,Ut.bytesToBase64URL)(new Uint8Array(n.clientDataJSON)),signature:(0,Ut.bytesToBase64URL)(new Uint8Array(n.signature)),userHandle:n.userHandle?(0,Ut.bytesToBase64URL)(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Bw(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function wf(){var r,e;return!!((0,$w.isBrowser)()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator?.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Ef(r){try{let e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Kt.WebAuthnUnknownError("Browser returned unexpected credential type",e)}:{data:null,error:new Kt.WebAuthnUnknownError("Empty credential response",e)}}catch(e){return{data:null,error:(0,Kt.identifyRegistrationError)({error:e,options:r})}}}async function Sf(r){try{let e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Kt.WebAuthnUnknownError("Browser returned unexpected credential type",e)}:{data:null,error:new Kt.WebAuthnUnknownError("Empty credential response",e)}}catch(e){return{data:null,error:(0,Kt.identifyAuthenticationError)({error:e,options:r})}}}oe.DEFAULT_CREATION_OPTIONS={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"};oe.DEFAULT_REQUEST_OPTIONS={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function uo(...r){let e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),t=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(let n of r)if(n)for(let i in n){let o=n[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(t(o))s[i]=o;else if(e(o)){let a=s[i];e(a)?s[i]=uo(a,o):s[i]=uo(o)}else s[i]=o}return s}function Tf(r,e){return uo(oe.DEFAULT_CREATION_OPTIONS,r,e||{})}function Af(r,e){return uo(oe.DEFAULT_REQUEST_OPTIONS,r,e||{})}var Tu=class{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:n},i){try{let{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};let c=n??oe.webAuthnAbortService.createNewAbortSignal();if(o.webauthn.type==="create"){let{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${s}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{let u=Tf(o.webauthn.credential_options.publicKey,i?.create),{data:l,error:h}=await Ef({publicKey:u,signal:c});return l?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:l}},error:null}:{data:null,error:h}}case"request":{let u=Af(o.webauthn.credential_options.publicKey,i?.request),{data:l,error:h}=await Sf(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:c}));return l?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:l}},error:null}:{data:null,error:h}}}}catch(o){return(0,Ht.isAuthError)(o)?{data:null,error:o}:{data:null,error:new Ht.AuthUnknownError("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Ht.AuthError("rpId is required for WebAuthn authentication")};try{if(!wf())return{data:null,error:new Ht.AuthUnknownError("Browser does not support WebAuthn",null)};let{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:n},{request:i});if(!o)return{data:null,error:a};let{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:s,credential_response:c.credential_response}})}catch(o){return(0,Ht.isAuthError)(o)?{data:null,error:o}:{data:null,error:new Ht.AuthUnknownError("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Ht.AuthError("rpId is required for WebAuthn registration")};try{if(!wf())return{data:null,error:new Ht.AuthUnknownError("Browser does not support WebAuthn",null)};let{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(l=>{var h;return(h=l.data)===null||h===void 0?void 0:h.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(l=>l?this.client.mfa.unenroll({factorId:l?.id}):void 0),{data:null,error:a};let{data:c,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:n},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:s,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:u}}catch(o){return(0,Ht.isAuthError)(o)?{data:null,error:o}:{data:null,error:new Ht.AuthUnknownError("Unexpected error in register",o)}}}};oe.WebAuthnApi=Tu});var Ou=P(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});var Mw=(ne(),ue(se)),Fw=Mw.__importDefault(io()),mt=Xi(),j=kr(),H=pu(),$=Ss(),Of=ff(),Rf=wu(),Vw=mf(),zw=Yc(),kf=to(),lo=yf(),En=Su();(0,Vw.polyfillGlobalThis)();var Hw={url:mt.GOTRUE_URL,storageKey:mt.STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:mt.DEFAULT_HEADERS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function xf(r,e,t){return await t()}var As={},ho=class r{get jwks(){var e,t;return(t=(e=As[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){As[this.storageKey]=Object.assign(Object.assign({},As[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=As[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){As[this.storageKey]=Object.assign(Object.assign({},As[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;let i=Object.assign(Object.assign({},Hw),e);if(this.storageKey=i.storageKey,this.instanceID=(t=r.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,r.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&(0,$.isBrowser)()){let o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Fw.default({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=(0,$.resolveFetch)(i.fetch),this.lock=i.lock||xf,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:(0,$.isBrowser)()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=Rf.navigatorLock:this.lock=xf,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new En.WebAuthnApi(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:(0,$.supportsLocalStorage)()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=(0,Of.memoryLocalStorageAdapter)(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=(0,Of.memoryLocalStorageAdapter)(this.memoryStorage)),(0,$.isBrowser)()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${zw.version}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},s="none";if((0,$.isBrowser)()&&(t=(0,$.parseParametersFromURL)(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),(0,$.isBrowser)()&&this.detectSessionInUrl&&s!=="none"){let{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),(0,j.isAuthImplicitGrantRedirectError)(i)){let c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}let{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return(0,j.isAuthError)(t)?this._returnResult({error:t}):this._returnResult({error:new j.AuthUnknownError("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{let i=await(0,H._request)(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:H._sessionResponse}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});let c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if((0,j.isAuthError)(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){let{email:l,password:h,options:f}=e,p=null,y=null;this.flowType==="pkce"&&([p,y]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey)),i=await(0,H._request)(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:l,password:h,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:y},xform:H._sessionResponse})}else if("phone"in e){let{phone:l,password:h,options:f}=e;i=await(0,H._request)(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:h,data:(s=f?.data)!==null&&s!==void 0?s:{},channel:(n=f?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:H._sessionResponse})}else throw new j.AuthInvalidCredentialsError("You must provide either an email or phone number and a password");let{data:o,error:a}=i;if(a||!o)return await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});let c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){let{email:i,password:o,options:a}=e;t=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:H._sessionResponsePassword})}else if("phone"in e){let{phone:i,password:o,options:a}=e;t=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:H._sessionResponsePassword})}else throw new j.AuthInvalidCredentialsError("You must provide either an email or phone number and a password");let{data:s,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!s||!s.session||!s.user){let i=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:i})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,n,i,o,a,c,u,l,h,f;let p,y;if("message"in e)p=e.message,y=e.signature;else{let{chain:g,wallet:w,statement:b,options:A}=e,E;if((0,$.isBrowser)())if(typeof w=="object")E=w;else{let Y=window;if("ethereum"in Y&&typeof Y.ethereum=="object"&&"request"in Y.ethereum&&typeof Y.ethereum.request=="function")E=Y.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!A?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=w}let k=new URL((t=A?.url)!==null&&t!==void 0?t:window.location.href),U=await E.request({method:"eth_requestAccounts"}).then(Y=>Y).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!U||U.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let V=(0,lo.getAddress)(U[0]),I=(s=A?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!I){let Y=await E.request({method:"eth_chainId"});I=(0,lo.fromHex)(Y)}let W={domain:k.host,address:V,statement:b,uri:k.href,version:"1",chainId:I,nonce:(n=A?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=A?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=A?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(c=A?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(u=A?.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(l=A?.signInWithEthereum)===null||l===void 0?void 0:l.resources};p=(0,lo.createSiweMessage)(W),y=await E.request({method:"personal_sign",params:[(0,lo.toHex)(p),V]})}try{let{data:g,error:w}=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:y},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:H._sessionResponse});if(w)throw w;if(!g||!g.session||!g.user){let b=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:b})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:w})}catch(g){if((0,j.isAuthError)(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var t,s,n,i,o,a,c,u,l,h,f,p;let y,g;if("message"in e)y=e.message,g=e.signature;else{let{chain:w,wallet:b,statement:A,options:E}=e,k;if((0,$.isBrowser)())if(typeof b=="object")k=b;else{let V=window;if("solana"in V&&typeof V.solana=="object"&&("signIn"in V.solana&&typeof V.solana.signIn=="function"||"signMessage"in V.solana&&typeof V.solana.signMessage=="function"))k=V.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!E?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=b}let U=new URL((t=E?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in k&&k.signIn){let V=await k.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},E?.signInWithSolana),{version:"1",domain:U.host,uri:U.href}),A?{statement:A}:null)),I;if(Array.isArray(V)&&V[0]&&typeof V[0]=="object")I=V[0];else if(V&&typeof V=="object"&&"signedMessage"in V&&"signature"in V)I=V;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in I&&"signature"in I&&(typeof I.signedMessage=="string"||I.signedMessage instanceof Uint8Array)&&I.signature instanceof Uint8Array)y=typeof I.signedMessage=="string"?I.signedMessage:new TextDecoder().decode(I.signedMessage),g=I.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in k)||typeof k.signMessage!="function"||!("publicKey"in k)||typeof k!="object"||!k.publicKey||!("toBase58"in k.publicKey)||typeof k.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${U.host} wants you to sign in with your Solana account:`,k.publicKey.toBase58(),...A?["",A,""]:[""],"Version: 1",`URI: ${U.href}`,`Issued At: ${(n=(s=E?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=E?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${E.signInWithSolana.notBefore}`]:[],...!((o=E?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${E.signInWithSolana.expirationTime}`]:[],...!((a=E?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${E.signInWithSolana.chainId}`]:[],...!((c=E?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${E.signInWithSolana.nonce}`]:[],...!((u=E?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${E.signInWithSolana.requestId}`]:[],...!((h=(l=E?.signInWithSolana)===null||l===void 0?void 0:l.resources)===null||h===void 0)&&h.length?["Resources",...E.signInWithSolana.resources.map(I=>`- ${I}`)]:[]].join(`
`);let V=await k.signMessage(new TextEncoder().encode(y),"utf8");if(!V||!(V instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=V}}try{let{data:w,error:b}=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:(0,kf.bytesToBase64URL)(g)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:H._sessionResponse});if(b)throw b;if(!w||!w.session||!w.user){let A=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:A})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:b})}catch(w){if((0,j.isAuthError)(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async _exchangeCodeForSession(e){let t=await(0,$.getItemAsync)(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{let{data:i,error:o}=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:H._sessionResponse});if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){let a=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{let{options:t,provider:s,token:n,access_token:i,nonce:o}=e,a=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:H._sessionResponse}),{data:c,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!c||!c.session||!c.user){let l=new j.AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:l})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:u})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){let{email:a,options:c}=e,u=null,l=null;this.flowType==="pkce"&&([u,l]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey));let{error:h}=await(0,H._request)(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:l},redirectTo:c?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in e){let{phone:a,options:c}=e,{data:u,error:l}=await(0,H._request)(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=c?.data)!==null&&n!==void 0?n:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u?.message_id},error:l})}throw new j.AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(a){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);let{data:o,error:a}=await(0,H._request)(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:H._sessionResponse});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");let c=o.session,u=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(n){if((0,j.isAuthError)(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var t,s,n,i,o;try{let a=null,c=null;this.flowType==="pkce"&&([a,c]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey));let u=await(0,H._request)(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:c}),headers:this.headers,xform:H._ssoResponse});return!((i=u.data)===null||i===void 0)&&i.url&&(0,$.isBrowser)()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new j.AuthSessionMissingError;let{error:n}=await(0,H._request)(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if((0,j.isAuthError)(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:s,type:n,options:i}=e,{error:o}=await(0,H._request)(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){let{phone:s,type:n,options:i}=e,{data:o,error:a}=await(0,H._request)(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new j.AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){let n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,t=await(0,$.getItemAsync)(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let s=e.expires_at?e.expires_at*1e3-Date.now()<mt.EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){let o=await(0,$.getItemAsync)(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=(0,$.userNotAvailableProxy)()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){let o={value:this.suppressGetSessionWarning};e.user=(0,$.insecureUserWarningProxy)(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}let{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;let t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await(0,H._request)(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:H._userResponse}):await this._useSession(async t=>{var s,n,i;let{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new j.AuthSessionMissingError}:await(0,H._request)(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:H._userResponse})})}catch(t){if((0,j.isAuthError)(t))return(0,j.isAuthSessionMissingError)(t)&&(await this._removeSession(),await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{let{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new j.AuthSessionMissingError;let o=n.session,a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey));let{data:u,error:l}=await(0,H._request)(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:H._userResponse});if(l)throw l;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new j.AuthSessionMissingError;let t=Date.now()/1e3,s=t,n=!0,i=null,{payload:o}=(0,$.decodeJWT)(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){let{data:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!a)return{data:{user:null,session:null},error:null};i=a}else{let{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){let{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new j.AuthSessionMissingError;let{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!(0,$.isBrowser)())throw new j.AuthImplicitGrantRedirectError("No browser detected.");if(e.error||e.error_description||e.error_code)throw new j.AuthImplicitGrantRedirectError(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new j.AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new j.AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new j.AuthPKCEGrantCodeExchangeError("No code detected.");let{data:A,error:E}=await this._exchangeCodeForSession(e.code);if(E)throw E;let k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:A.session,redirectType:null},error:null}}let{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:u}=e;if(!i||!a||!o||!u)throw new j.AuthImplicitGrantRedirectError("No session defined in URL");let l=Math.round(Date.now()/1e3),h=parseInt(a),f=l+h;c&&(f=parseInt(c));let p=f-l;p*1e3<=mt.AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);let y=f-h;l-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,l):l-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,l);let{data:g,error:w}=await this._getUser(i);if(w)throw w;let b={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:b,redirectType:e.type},error:null})}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await(0,$.getItemAsync)(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;let{data:n,error:i}=t;if(i)return this._returnResult({error:i});let o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){let{error:a}=await this.admin.signOut(o,e);if(a&&!((0,j.isAuthApiError)(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){let t=(0,$.generateCallbackId)(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{let{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey,!0));try{return await(0,H._request)(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{let{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{let{data:s,error:n}=await this._useSession(async i=>{var o,a,c,u,l;let{data:h,error:f}=i;if(f)throw f;let p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await(0,H._request)(this.fetch,"GET",p,{headers:this.headers,jwt:(l=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&l!==void 0?l:void 0})});if(n)throw n;return(0,$.isBrowser)()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:e.provider,url:s?.url},error:null})}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{let{error:n,data:{session:i}}=t;if(n)throw n;let{options:o,provider:a,token:c,access_token:u,nonce:l}=e,h=await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:c,access_token:u,nonce:l,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:H._sessionResponse}),{data:f,error:p}=h;return p?this._returnResult({data:{user:null,session:null},error:p}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new j.AuthInvalidTokenResponseError}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:p}))}catch(n){if(await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`),(0,j.isAuthError)(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;let{data:i,error:o}=t;if(o)throw o;return await(0,H._request)(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{let s=Date.now();return await(0,$.retryable)(async n=>(n>0&&await(0,$.sleep)(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await(0,H._request)(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:H._sessionResponse})),(n,i)=>{let o=200*Math.pow(2,n);return i&&(0,j.isAuthRetryableFetchError)(i)&&Date.now()+o-s<mt.AUTO_REFRESH_TICK_DURATION_MS})}catch(s){if(this._debug(t,"error",s),(0,j.isAuthError)(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),(0,$.isBrowser)()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;let s="#_recoverAndRefresh()";this._debug(s,"begin");try{let n=await(0,$.getItemAsync)(this.storage,this.storageKey);if(n&&this.userStorage){let o=await(0,$.getItemAsync)(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await(0,$.setItemAsync)(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o?.user)!==null&&e!==void 0?e:(0,$.userNotAvailableProxy)()}else if(n&&!n.user&&!n.user){let o=await(0,$.getItemAsync)(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await(0,$.removeItemAsync)(this.storage,this.storageKey+"-user"),await(0,$.setItemAsync)(this.storage,this.storageKey,n)):n.user=(0,$.userNotAvailableProxy)()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}let i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<mt.EXPIRY_MARGIN_MS;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${mt.EXPIRY_MARGIN_MS}s`),i){if(this.autoRefreshToken&&n.refresh_token){let{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),(0,j.isAuthRetryableFetchError)(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{let{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new j.AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new $.Deferred;let{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new j.AuthSessionMissingError;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);let a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),(0,j.isAuthError)(i)){let o={data:null,error:i};return(0,j.isAuthRetryableFetchError)(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){let n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});let i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await(0,$.removeItemAsync)(this.storage,`${this.storageKey}-code-verifier`);let t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await(0,$.setItemAsync)(this.userStorage,this.storageKey+"-user",{user:t.user});let n=Object.assign({},t);delete n.user;let i=(0,$.deepClone)(n);await(0,$.setItemAsync)(this.storage,this.storageKey,i)}else{let n=(0,$.deepClone)(t);await(0,$.setItemAsync)(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await(0,$.removeItemAsync)(this.storage,this.storageKey),await(0,$.removeItemAsync)(this.storage,this.storageKey+"-code-verifier"),await(0,$.removeItemAsync)(this.storage,this.storageKey+"-user"),this.userStorage&&await(0,$.removeItemAsync)(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&(0,$.isBrowser)()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),mt.AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let n=Math.floor((s.expires_at*1e3-e)/mt.AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${mt.AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${mt.AUTO_REFRESH_TICK_THRESHOLD} ticks`),n<=mt.AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Rf.LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!(0,$.isBrowser)()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){let n=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){let[i,o]=await(0,$.getCodeChallengeAndMethod)(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s?.queryParams){let i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s?.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;let{data:n,error:i}=t;return i?this._returnResult({data:null,error:i}):await(0,H._request)(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;let{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});let a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:u}=await(0,H._request)(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&c.type==="totp"&&(!((n=c?.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;let{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});let o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?(0,En.serializeCredentialCreationResponse)(e.webauthn.credential_response):(0,En.serializeCredentialRequestResponse)(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:c}=await(0,H._request)(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:c}))})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;let{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});let o=await(0,H._request)(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;let{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:(0,En.deserializeCredentialCreationOptions)(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:(0,En.deserializeCredentialRequestOptions)(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){let{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;let{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};let n={all:[],phone:[],totp:[],webauthn:[]};for(let i of(e=t?.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;let{data:{session:s},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:i}=(0,$.decodeJWT)(s.access_token),o=null;i.aal&&(o=i.aal);let a=o;((t=(e=s.user.factors)===null||e===void 0?void 0:e.filter(l=>l.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");let u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{let{data:{session:s},error:n}=t;return n?this._returnResult({data:null,error:n}):s?await(0,H._request)(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new j.AuthSessionMissingError})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{let{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new j.AuthSessionMissingError});let o=await(0,H._request)(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&(0,$.isBrowser)()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{let{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new j.AuthSessionMissingError});let o=await(0,H._request)(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&(0,$.isBrowser)()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;return s?this._returnResult({data:null,error:s}):t?await(0,H._request)(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new j.AuthSessionMissingError})})}catch(e){if((0,j.isAuthError)(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{let{data:{session:s},error:n}=t;return n?this._returnResult({data:null,error:n}):s?(await(0,H._request)(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new j.AuthSessionMissingError})})}catch(t){if((0,j.isAuthError)(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(a=>a.kid===e);if(s)return s;let n=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+mt.JWKS_TTL>n)return s;let{data:i,error:o}=await(0,H._request)(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){let{data:p,error:y}=await this.getSession();if(y||!p.session)return this._returnResult({data:null,error:y});s=p.session.access_token}let{header:n,payload:i,signature:o,raw:{header:a,payload:c}}=(0,$.decodeJWT)(s);t?.allowExpired||(0,$.validateExp)(i.exp);let u=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!u){let{error:p}=await this.getUser(s);if(p)throw p;return{data:{claims:i,header:n,signature:o},error:null}}let l=(0,$.getAlgorithm)(n.alg),h=await crypto.subtle.importKey("jwk",u,l,!0,["verify"]);if(!await crypto.subtle.verify(l,h,o,(0,kf.stringToUint8Array)(`${a}.${c}`)))throw new j.AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if((0,j.isAuthError)(s))return this._returnResult({data:null,error:s});throw s}}};ho.nextInstanceID={};Au.default=ho});var Cf=P(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});var Kw=(ne(),ue(se)),Ww=Kw.__importDefault(io()),Gw=Ww.default;Ru.default=Gw});var Pf=P(ku=>{"use strict";Object.defineProperty(ku,"__esModule",{value:!0});var Qw=(ne(),ue(se)),Jw=Qw.__importDefault(Ou()),Zw=Jw.default;ku.default=Zw});var xu=P(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.processLock=Ue.lockInternals=Ue.NavigatorLockAcquireTimeoutError=Ue.navigatorLock=Ue.AuthClient=Ue.AuthAdminApi=Ue.GoTrueClient=Ue.GoTrueAdminApi=void 0;var Os=(ne(),ue(se)),Yw=Os.__importDefault(io());Ue.GoTrueAdminApi=Yw.default;var Xw=Os.__importDefault(Ou());Ue.GoTrueClient=Xw.default;var eb=Os.__importDefault(Cf());Ue.AuthAdminApi=eb.default;var tb=Os.__importDefault(Pf());Ue.AuthClient=tb.default;Os.__exportStar(mu(),Ue);Os.__exportStar(kr(),Ue);var fo=wu();Object.defineProperty(Ue,"navigatorLock",{enumerable:!0,get:function(){return fo.navigatorLock}});Object.defineProperty(Ue,"NavigatorLockAcquireTimeoutError",{enumerable:!0,get:function(){return fo.NavigatorLockAcquireTimeoutError}});Object.defineProperty(Ue,"lockInternals",{enumerable:!0,get:function(){return fo.internals}});Object.defineProperty(Ue,"processLock",{enumerable:!0,get:function(){return fo.processLock}})});var jf=P(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.SupabaseAuthClient=void 0;var rb=xu(),Cu=class extends rb.AuthClient{constructor(e){super(e)}};po.SupabaseAuthClient=Cu});var Nu=P(ju=>{"use strict";Object.defineProperty(ju,"__esModule",{value:!0});var sb=Na(),nb=Ja(),ib=pc(),ob=Yd(),mo=ef(),ab=tf(),Nf=sf(),cb=jf(),Pu=class{constructor(e,t,s){var n,i,o;this.supabaseUrl=e,this.supabaseKey=t;let a=(0,Nf.validateSupabaseUrl)(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);let c=`sb-${a.hostname.split(".")[0]}-auth-token`,u={db:mo.DEFAULT_DB_OPTIONS,realtime:mo.DEFAULT_REALTIME_OPTIONS,auth:Object.assign(Object.assign({},mo.DEFAULT_AUTH_OPTIONS),{storageKey:c}),global:mo.DEFAULT_GLOBAL_OPTIONS},l=(0,Nf.applySettingDefaults)(s??{},u);this.storageKey=(n=l.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=l.auth)!==null&&o!==void 0?o:{},this.headers,l.global.fetch),this.fetch=(0,ab.fetchWithAuth)(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new nb.PostgrestClient(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new ob.StorageClient(this.storageUrl.href,this.headers,this.fetch,s?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new sb.FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:s}=await this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,storageKey:o,flowType:a,lock:c,debug:u,throwOnError:l},h,f){let p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new cb.SupabaseAuthClient({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),h),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,userStorage:i,flowType:a,lock:c,debug:u,throwOnError:l,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(y=>y.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new ib.RealtimeClient(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};ju.default=Pu});var Df=P(Te=>{"use strict";var ub=Te&&Te.__createBinding||(Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]}),If=Te&&Te.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&ub(e,r,t)},$f=Te&&Te.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Te,"__esModule",{value:!0});Te.createClient=Te.SupabaseClient=Te.FunctionRegion=Te.FunctionsError=Te.FunctionsRelayError=Te.FunctionsFetchError=Te.FunctionsHttpError=Te.PostgrestError=void 0;var lb=$f(Nu());If(xu(),Te);var hb=Ja();Object.defineProperty(Te,"PostgrestError",{enumerable:!0,get:function(){return hb.PostgrestError}});var Sn=Na();Object.defineProperty(Te,"FunctionsHttpError",{enumerable:!0,get:function(){return Sn.FunctionsHttpError}});Object.defineProperty(Te,"FunctionsFetchError",{enumerable:!0,get:function(){return Sn.FunctionsFetchError}});Object.defineProperty(Te,"FunctionsRelayError",{enumerable:!0,get:function(){return Sn.FunctionsRelayError}});Object.defineProperty(Te,"FunctionsError",{enumerable:!0,get:function(){return Sn.FunctionsError}});Object.defineProperty(Te,"FunctionRegion",{enumerable:!0,get:function(){return Sn.FunctionRegion}});If(pc(),Te);var db=Nu();Object.defineProperty(Te,"SupabaseClient",{enumerable:!0,get:function(){return $f(db).default}});var fb=(r,e,t)=>new lb.default(r,e,t);Te.createClient=fb;function pb(){if(typeof window<"u"||typeof process>"u")return!1;let r=process.version;if(r==null)return!1;let e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}pb()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217")});var Uf=P((eR,mb)=>{mb.exports={name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}});var Vf=P((tR,sr)=>{var $u=si("fs"),go=si("path"),gb=si("os"),yb=si("crypto"),_b=Uf(),Du=_b.version,vb=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function wb(r){let e={},t=r.toString();t=t.replace(/\r\n?/mg,`
`);let s;for(;(s=vb.exec(t))!=null;){let n=s[1],i=s[2]||"";i=i.trim();let o=i[0];i=i.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),o==='"'&&(i=i.replace(/\\n/g,`
`),i=i.replace(/\\r/g,"\r")),e[n]=i}return e}function bb(r){r=r||{};let e=Ff(r);r.path=e;let t=Ve.configDotenv(r);if(!t.parsed){let o=new Error(`MISSING_DATA: Cannot parse ${e} for an unknown reason`);throw o.code="MISSING_DATA",o}let s=Mf(r).split(","),n=s.length,i;for(let o=0;o<n;o++)try{let a=s[o].trim(),c=Sb(t,a);i=Ve.decrypt(c.ciphertext,c.key);break}catch(a){if(o+1>=n)throw a}return Ve.parse(i)}function Eb(r){console.log(`[dotenv@${Du}][WARN] ${r}`)}function Tn(r){console.log(`[dotenv@${Du}][DEBUG] ${r}`)}function Bf(r){console.log(`[dotenv@${Du}] ${r}`)}function Mf(r){return r&&r.DOTENV_KEY&&r.DOTENV_KEY.length>0?r.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function Sb(r,e){let t;try{t=new URL(e)}catch(a){if(a.code==="ERR_INVALID_URL"){let c=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw c.code="INVALID_DOTENV_KEY",c}throw a}let s=t.password;if(!s){let a=new Error("INVALID_DOTENV_KEY: Missing key part");throw a.code="INVALID_DOTENV_KEY",a}let n=t.searchParams.get("environment");if(!n){let a=new Error("INVALID_DOTENV_KEY: Missing environment part");throw a.code="INVALID_DOTENV_KEY",a}let i=`DOTENV_VAULT_${n.toUpperCase()}`,o=r.parsed[i];if(!o){let a=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${i} in your .env.vault file.`);throw a.code="NOT_FOUND_DOTENV_ENVIRONMENT",a}return{ciphertext:o,key:s}}function Ff(r){let e=null;if(r&&r.path&&r.path.length>0)if(Array.isArray(r.path))for(let t of r.path)$u.existsSync(t)&&(e=t.endsWith(".vault")?t:`${t}.vault`);else e=r.path.endsWith(".vault")?r.path:`${r.path}.vault`;else e=go.resolve(process.cwd(),".env.vault");return $u.existsSync(e)?e:null}function qf(r){return r[0]==="~"?go.join(gb.homedir(),r.slice(1)):r}function Tb(r){let e=!!(r&&r.debug),t=r&&"quiet"in r?r.quiet:!0;(e||!t)&&Bf("Loading env from encrypted .env.vault");let s=Ve._parseVault(r),n=process.env;return r&&r.processEnv!=null&&(n=r.processEnv),Ve.populate(n,s,r),{parsed:s}}function Ab(r){let e=go.resolve(process.cwd(),".env"),t="utf8",s=!!(r&&r.debug),n=r&&"quiet"in r?r.quiet:!0;r&&r.encoding?t=r.encoding:s&&Tn("No encoding is specified. UTF-8 is used by default");let i=[e];if(r&&r.path)if(!Array.isArray(r.path))i=[qf(r.path)];else{i=[];for(let u of r.path)i.push(qf(u))}let o,a={};for(let u of i)try{let l=Ve.parse($u.readFileSync(u,{encoding:t}));Ve.populate(a,l,r)}catch(l){s&&Tn(`Failed to load ${u} ${l.message}`),o=l}let c=process.env;if(r&&r.processEnv!=null&&(c=r.processEnv),Ve.populate(c,a,r),s||!n){let u=Object.keys(a).length,l=[];for(let h of i)try{let f=go.relative(process.cwd(),h);l.push(f)}catch(f){s&&Tn(`Failed to load ${h} ${f.message}`),o=f}Bf(`injecting env (${u}) from ${l.join(",")}`)}return o?{parsed:a,error:o}:{parsed:a}}function Ob(r){if(Mf(r).length===0)return Ve.configDotenv(r);let e=Ff(r);return e?Ve._configVault(r):(Eb(`You set DOTENV_KEY but you are missing a .env.vault file at ${e}. Did you forget to build it?`),Ve.configDotenv(r))}function Rb(r,e){let t=Buffer.from(e.slice(-64),"hex"),s=Buffer.from(r,"base64"),n=s.subarray(0,12),i=s.subarray(-16);s=s.subarray(12,-16);try{let o=yb.createDecipheriv("aes-256-gcm",t,n);return o.setAuthTag(i),`${o.update(s)}${o.final()}`}catch(o){let a=o instanceof RangeError,c=o.message==="Invalid key length",u=o.message==="Unsupported state or unable to authenticate data";if(a||c){let l=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw l.code="INVALID_DOTENV_KEY",l}else if(u){let l=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw l.code="DECRYPTION_FAILED",l}else throw o}}function kb(r,e,t={}){let s=!!(t&&t.debug),n=!!(t&&t.override);if(typeof e!="object"){let i=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw i.code="OBJECT_REQUIRED",i}for(let i of Object.keys(e))Object.prototype.hasOwnProperty.call(r,i)?(n===!0&&(r[i]=e[i]),s&&Tn(n===!0?`"${i}" is already defined and WAS overwritten`:`"${i}" is already defined and was NOT overwritten`)):r[i]=e[i]}var Ve={configDotenv:Ab,_configVault:Tb,_parseVault:bb,config:Ob,decrypt:Rb,parse:wb,populate:kb};sr.exports.configDotenv=Ve.configDotenv;sr.exports._configVault=Ve._configVault;sr.exports._parseVault=Ve._parseVault;sr.exports.config=Ve.config;sr.exports.decrypt=Ve.decrypt;sr.exports.parse=Ve.parse;sr.exports.populate=Ve.populate;sr.exports=Ve});var Hf=P((rR,zf)=>{var jr={};process.env.DOTENV_CONFIG_ENCODING!=null&&(jr.encoding=process.env.DOTENV_CONFIG_ENCODING);process.env.DOTENV_CONFIG_PATH!=null&&(jr.path=process.env.DOTENV_CONFIG_PATH);process.env.DOTENV_CONFIG_QUIET!=null&&(jr.quiet=process.env.DOTENV_CONFIG_QUIET);process.env.DOTENV_CONFIG_DEBUG!=null&&(jr.debug=process.env.DOTENV_CONFIG_DEBUG);process.env.DOTENV_CONFIG_OVERRIDE!=null&&(jr.override=process.env.DOTENV_CONFIG_OVERRIDE);process.env.DOTENV_CONFIG_DOTENV_KEY!=null&&(jr.DOTENV_KEY=process.env.DOTENV_CONFIG_DOTENV_KEY);zf.exports=jr});var Wf=P((sR,Kf)=>{var xb=/^dotenv_config_(encoding|path|quiet|debug|override|DOTENV_KEY)=(.+)$/;Kf.exports=function(e){let t=e.reduce(function(s,n){let i=n.match(xb);return i&&(s[i[1]]=i[2]),s},{});return"quiet"in t||(t.quiet="true"),t}});import{createServer as qg}from"http";import{Http2ServerRequest as Bg}from"http2";import{Http2ServerRequest as ca}from"http2";import{Readable as ih}from"stream";import Yg from"crypto";var Er=class extends Error{constructor(r,e){super(r,e),this.name="RequestError"}},Mg=r=>r instanceof Er?r:new Er(r.message,{cause:r}),Fg=global.Request,Qs=class extends Fg{constructor(r,e){typeof r=="object"&&is in r&&(r=r[is]()),typeof e?.body?.getReader<"u"&&(e.duplex??="half"),super(r,e)}},Vg=r=>{let e=[],t=r.rawHeaders;for(let s=0;s<t.length;s+=2){let{[s]:n,[s+1]:i}=t;n.charCodeAt(0)!==58&&e.push([n,i])}return new Headers(e)},ah=Symbol("wrapBodyStream"),zg=(r,e,t,s,n)=>{let i={method:r,headers:t,signal:n.signal};if(r==="TRACE"){i.method="GET";let o=new Qs(e,i);return Object.defineProperty(o,"method",{get(){return"TRACE"}}),o}if(!(r==="GET"||r==="HEAD"))if("rawBody"in s&&s.rawBody instanceof Buffer)i.body=new ReadableStream({start(o){o.enqueue(s.rawBody),o.close()}});else if(s[ah]){let o;i.body=new ReadableStream({async pull(a){try{o||=ih.toWeb(s).getReader();let{done:c,value:u}=await o.read();c?a.close():a.enqueue(u)}catch(c){a.error(c)}}})}else i.body=ih.toWeb(s);return new Qs(e,i)},is=Symbol("getRequestCache"),Hg=Symbol("requestCache"),ni=Symbol("incomingKey"),ii=Symbol("urlKey"),Kg=Symbol("headersKey"),ns=Symbol("abortControllerKey"),Wg=Symbol("getAbortController"),oi={get method(){return this[ni].method||"GET"},get url(){return this[ii]},get headers(){return this[Kg]||=Vg(this[ni])},[Wg](){return this[is](),this[ns]},[is](){return this[ns]||=new AbortController,this[Hg]||=zg(this.method,this[ii],this.headers,this[ni],this[ns])}};["body","bodyUsed","cache","credentials","destination","integrity","mode","redirect","referrer","referrerPolicy","signal","keepalive"].forEach(r=>{Object.defineProperty(oi,r,{get(){return this[is]()[r]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(r=>{Object.defineProperty(oi,r,{value:function(){return this[is]()[r]()}})});Object.setPrototypeOf(oi,Qs.prototype);var Gg=(r,e)=>{let t=Object.create(oi);t[ni]=r;let s=r.url||"";if(s[0]!=="/"&&(s.startsWith("http://")||s.startsWith("https://"))){if(r instanceof ca)throw new Er("Absolute URL for :path is not allowed in HTTP/2");try{let a=new URL(s);t[ii]=a.href}catch(a){throw new Er("Invalid absolute URL",{cause:a})}return t}let n=(r instanceof ca?r.authority:r.headers.host)||e;if(!n)throw new Er("Missing host header");let i;if(r instanceof ca){if(i=r.scheme,!(i==="http"||i==="https"))throw new Er("Unsupported scheme")}else i=r.socket&&r.socket.encrypted?"https":"http";let o=new URL(`${i}://${n}${s}`);if(o.hostname.length!==n.length&&o.hostname!==n.replace(/:\d+$/,""))throw new Er("Invalid host header");return t[ii]=o.href,t},oh=Symbol("responseCache"),ss=Symbol("getResponseCache"),Sr=Symbol("cache"),la=global.Response,Js=class ch{#t;#e;[ss](){return delete this[Sr],this[oh]||=new la(this.#t,this.#e)}constructor(e,t){let s;if(this.#t=e,t instanceof ch){let n=t[oh];if(n){this.#e=n,this[ss]();return}else this.#e=t.#e,s=new Headers(t.#e.headers)}else this.#e=t;(typeof e=="string"||typeof e?.getReader<"u"||e instanceof Blob||e instanceof Uint8Array)&&(s||=t?.headers||{"content-type":"text/plain; charset=UTF-8"},this[Sr]=[t?.status||200,e,s])}get headers(){let e=this[Sr];return e?(e[2]instanceof Headers||(e[2]=new Headers(e[2])),e[2]):this[ss]().headers}get status(){return this[Sr]?.[0]??this[ss]().status}get ok(){let e=this.status;return e>=200&&e<300}};["body","bodyUsed","redirected","statusText","trailers","type","url"].forEach(r=>{Object.defineProperty(Js.prototype,r,{get(){return this[ss]()[r]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(r=>{Object.defineProperty(Js.prototype,r,{value:function(){return this[ss]()[r]()}})});Object.setPrototypeOf(Js,la);Object.setPrototypeOf(Js.prototype,la.prototype);async function Qg(r){return Promise.race([r,Promise.resolve().then(()=>Promise.resolve(void 0))])}function uh(r,e,t){let s=a=>{r.cancel(a).catch(()=>{})};return e.on("close",s),e.on("error",s),(t??r.read()).then(o,n),r.closed.finally(()=>{e.off("close",s),e.off("error",s)});function n(a){a&&e.destroy(a)}function i(){r.read().then(o,n)}function o({done:a,value:c}){try{if(a)e.end();else if(!e.write(c))e.once("drain",i);else return r.read().then(o,n)}catch(u){n(u)}}}function Jg(r,e){if(r.locked)throw new TypeError("ReadableStream is locked.");return e.destroyed?void 0:uh(r.getReader(),e)}var lh=r=>{let e={};r instanceof Headers||(r=new Headers(r??void 0));let t=[];for(let[s,n]of r)s==="set-cookie"?t.push(n):e[s]=n;return t.length>0&&(e["set-cookie"]=t),e["content-type"]??="text/plain; charset=UTF-8",e},Zg="x-hono-already-sent",Xg=global.fetch;typeof global.crypto>"u"&&(global.crypto=Yg);global.fetch=(r,e)=>(e={compress:!1,...e},Xg(r,e));var ha=Symbol("outgoingEnded"),ey=()=>new Response(null,{status:400}),hh=r=>new Response(null,{status:r instanceof Error&&(r.name==="TimeoutError"||r.constructor.name==="TimeoutError")?504:500}),ua=(r,e)=>{let t=r instanceof Error?r:new Error("unknown error",{cause:r});t.code==="ERR_STREAM_PREMATURE_CLOSE"?console.info("The user aborted a request."):(console.error(r),e.headersSent||e.writeHead(500,{"Content-Type":"text/plain"}),e.end(`Error: ${t.message}`),e.destroy(t))},dh=r=>{"flushHeaders"in r&&r.writable&&r.flushHeaders()},fh=async(r,e)=>{let[t,s,n]=r[Sr];n instanceof Headers&&(n=lh(n)),typeof s=="string"?n["Content-Length"]=Buffer.byteLength(s):s instanceof Uint8Array?n["Content-Length"]=s.byteLength:s instanceof Blob&&(n["Content-Length"]=s.size),e.writeHead(t,n),typeof s=="string"||s instanceof Uint8Array?e.end(s):s instanceof Blob?e.end(new Uint8Array(await s.arrayBuffer())):(dh(e),await Jg(s,e)?.catch(i=>ua(i,e))),e[ha]?.()},ty=r=>typeof r.then=="function",ry=async(r,e,t={})=>{if(ty(r))if(t.errorHandler)try{r=await r}catch(n){let i=await t.errorHandler(n);if(!i)return;r=i}else r=await r.catch(hh);if(Sr in r)return fh(r,e);let s=lh(r.headers);if(r.body){let n=r.body.getReader(),i=[],o=!1,a;if(s["transfer-encoding"]!=="chunked"){let c=2;for(let u=0;u<c;u++){a||=n.read();let l=await Qg(a).catch(h=>{console.error(h),o=!0});if(!l){if(u===1){await new Promise(h=>setTimeout(h)),c=3;continue}break}if(a=void 0,l.value&&i.push(l.value),l.done){o=!0;break}}o&&!("content-length"in s)&&(s["content-length"]=i.reduce((u,l)=>u+l.length,0))}e.writeHead(r.status,s),i.forEach(c=>{e.write(c)}),o?e.end():(i.length===0&&dh(e),await uh(n,e,a))}else s[Zg]||(e.writeHead(r.status,s),e.end());e[ha]?.()},sy=(r,e={})=>{let t=e.autoCleanupIncoming??!0;return e.overrideGlobalObjects!==!1&&global.Request!==Qs&&(Object.defineProperty(global,"Request",{value:Qs}),Object.defineProperty(global,"Response",{value:Js})),async(s,n)=>{let i,o;try{o=Gg(s,e.hostname);let a=!t||s.method==="GET"||s.method==="HEAD";if(a||(s[ah]=!0,s.on("end",()=>{a=!0}),s instanceof Bg&&(n[ha]=()=>{a||setTimeout(()=>{a||setTimeout(()=>{s.destroy(),n.destroy()})})})),n.on("close",()=>{o[ns]&&(s.errored?o[ns].abort(s.errored.toString()):n.writableFinished||o[ns].abort("Client connection prematurely closed.")),a||setTimeout(()=>{a||setTimeout(()=>{s.destroy()})})}),i=r(o,{incoming:s,outgoing:n}),Sr in i)return fh(i,n)}catch(a){if(i)return ua(a,n);if(e.errorHandler){if(i=await e.errorHandler(o?a:Mg(a)),!i)return}else o?i=hh(a):i=ey()}try{return await ry(i,n,e)}catch(a){return ua(a,n)}}},ny=r=>{let e=r.fetch,t=sy(e,{hostname:r.hostname,overrideGlobalObjects:r.overrideGlobalObjects,autoCleanupIncoming:r.autoCleanupIncoming});return(r.createServer||qg)(r.serverOptions||{},t)},ph=(r,e)=>{let t=ny(r);return t.listen(r?.port??3e3,r.hostname,()=>{let s=t.address();e&&e(s)}),t};function mh(){let{process:r,Deno:e}=globalThis;return!(typeof e?.noColor=="boolean"?e.noColor:r!==void 0?"NO_COLOR"in r?.env:!1)}var Zs="__COMPOSED_HANDLER";var da=r=>r.length>1,fa=r=>r[Zs]?fa(r[Zs]):r;var iy=r=>r.name||(da(r)?"[middleware]":"[handler]"),oy=r=>r.routes.map(({path:e,method:t,handler:s})=>{let n=fa(s);return{path:e,method:t,name:iy(n),isMiddleware:da(n)}}),gh=(r,e)=>{let t=e?.colorize??mh(),s={},n=0,i=0;oy(r).filter(({isMiddleware:o})=>e?.verbose||!o).map(o=>{let a=`${o.method}-${o.path}`;if((s[a]||=[]).push(o),!(s[a].length>1))return n=Math.max(n,o.method.length),i=Math.max(i,o.path.length),{method:o.method,path:o.path,routes:s[a]}}).forEach(o=>{if(!o)return;let{method:a,path:c,routes:u}=o,l=t?`\x1B[32m${a}\x1B[0m`:a;console.log(`${l} ${" ".repeat(n-a.length)} ${c}`),e?.verbose&&u.forEach(({name:h})=>{console.log(`${" ".repeat(n+3)} ${h}`)})})};var pa=(r,e,t)=>(s,n)=>{let i=-1;return o(0);async function o(a){if(a<=i)throw new Error("next() called multiple times");i=a;let c,u=!1,l;if(r[a]?(l=r[a][0][0],s.req.routeIndex=a):l=a===r.length&&n||void 0,l)try{c=await l(s,()=>o(a+1))}catch(h){if(h instanceof Error&&e)s.error=h,c=await e(h,s),u=!0;else throw h}else s.finalized===!1&&t&&(c=await t(s));return c&&(s.finalized===!1||u)&&(s.res=c),s}};var It=class extends Error{res;status;constructor(r=500,e){super(e?.message,{cause:e?.cause}),this.res=e?.res,this.status=r}getResponse(){return this.res?new Response(this.res.body,{status:this.status,headers:this.res.headers}):new Response(this.message,{status:this.status})}};var yh=Symbol();var _h=async(r,e=Object.create(null))=>{let{all:t=!1,dot:s=!1}=e,i=(r instanceof ai?r.raw.headers:r.headers).get("Content-Type");return i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded")?ay(r,{all:t,dot:s}):{}};async function ay(r,e){let t=await r.formData();return t?cy(t,e):{}}function cy(r,e){let t=Object.create(null);return r.forEach((s,n)=>{e.all||n.endsWith("[]")?uy(t,n,s):t[n]=s}),e.dot&&Object.entries(t).forEach(([s,n])=>{s.includes(".")&&(ly(t,s,n),delete t[s])}),t}var uy=(r,e,t)=>{r[e]!==void 0?Array.isArray(r[e])?r[e].push(t):r[e]=[r[e],t]:e.endsWith("[]")?r[e]=[t]:r[e]=t},ly=(r,e,t)=>{let s=r,n=e.split(".");n.forEach((i,o)=>{o===n.length-1?s[i]=t:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})};var ga=r=>{let e=r.split("/");return e[0]===""&&e.shift(),e},vh=r=>{let{groups:e,path:t}=hy(r),s=ga(t);return dy(s,e)},hy=r=>{let e=[];return r=r.replace(/\{[^}]+\}/g,(t,s)=>{let n=`@${s}`;return e.push([n,t]),n}),{groups:e,path:r}},dy=(r,e)=>{for(let t=e.length-1;t>=0;t--){let[s]=e[t];for(let n=r.length-1;n>=0;n--)if(r[n].includes(s)){r[n]=r[n].replace(s,e[t][1]);break}}return r},ci={},wh=(r,e)=>{if(r==="*")return"*";let t=r.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(t){let s=`${r}#${e}`;return ci[s]||(t[2]?ci[s]=e&&e[0]!==":"&&e[0]!=="*"?[s,t[1],new RegExp(`^${t[2]}(?=/${e})`)]:[r,t[1],new RegExp(`^${t[2]}$`)]:ci[s]=[r,t[1],!0]),ci[s]}return null},os=(r,e)=>{try{return e(r)}catch{return r.replace(/(?:%[0-9A-Fa-f]{2})+/g,t=>{try{return e(t)}catch{return t}})}},fy=r=>os(r,decodeURI),ya=r=>{let e=r.url,t=e.indexOf("/",e.indexOf(":")+4),s=t;for(;s<e.length;s++){let n=e.charCodeAt(s);if(n===37){let i=e.indexOf("?",s),o=e.slice(t,i===-1?void 0:i);return fy(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(n===63)break}return e.slice(t,s)};var bh=r=>{let e=ya(r);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},Tr=(r,e,...t)=>(t.length&&(e=Tr(e,...t)),`${r?.[0]==="/"?"":"/"}${r}${e==="/"?"":`${r?.at(-1)==="/"?"":"/"}${e?.[0]==="/"?e.slice(1):e}`}`),ui=r=>{if(r.charCodeAt(r.length-1)!==63||!r.includes(":"))return null;let e=r.split("/"),t=[],s="";return e.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){t.length===0&&s===""?t.push("/"):t.push(s);let i=n.replace("?","");s+="/"+i,t.push(s)}else s+="/"+n}),t.filter((n,i,o)=>o.indexOf(n)===i)},ma=r=>/[%+]/.test(r)?(r.indexOf("+")!==-1&&(r=r.replace(/\+/g," ")),r.indexOf("%")!==-1?os(r,Ys):r):r,Eh=(r,e,t)=>{let s;if(!t&&e&&!/[%+]/.test(e)){let o=r.indexOf("?",8);if(o===-1)return;for(r.startsWith(e,o+1)||(o=r.indexOf(`&${e}`,o+1));o!==-1;){let a=r.charCodeAt(o+e.length+1);if(a===61){let c=o+e.length+2,u=r.indexOf("&",c);return ma(r.slice(c,u===-1?void 0:u))}else if(a==38||isNaN(a))return"";o=r.indexOf(`&${e}`,o+1)}if(s=/[%+]/.test(r),!s)return}let n={};s??=/[%+]/.test(r);let i=r.indexOf("?",8);for(;i!==-1;){let o=r.indexOf("&",i+1),a=r.indexOf("=",i);a>o&&o!==-1&&(a=-1);let c=r.slice(i+1,a===-1?o===-1?void 0:o:a);if(s&&(c=ma(c)),i=o,c==="")continue;let u;a===-1?u="":(u=r.slice(a+1,o===-1?void 0:o),s&&(u=ma(u))),t?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(u)):n[c]??=u}return e?n[e]:n},Sh=Eh,Th=(r,e)=>Eh(r,e,!0),Ys=decodeURIComponent;var Ah=r=>os(r,Ys),ai=class{raw;#t;#e;routeIndex=0;path;bodyCache={};constructor(r,e="/",t=[[]]){this.raw=r,this.path=e,this.#e=t,this.#t={}}param(r){return r?this.#r(r):this.#i()}#r(r){let e=this.#e[0][this.routeIndex][1][r],t=this.#n(e);return t&&/\%/.test(t)?Ah(t):t}#i(){let r={},e=Object.keys(this.#e[0][this.routeIndex][1]);for(let t of e){let s=this.#n(this.#e[0][this.routeIndex][1][t]);s!==void 0&&(r[t]=/\%/.test(s)?Ah(s):s)}return r}#n(r){return this.#e[1]?this.#e[1][r]:r}query(r){return Sh(this.url,r)}queries(r){return Th(this.url,r)}header(r){if(r)return this.raw.headers.get(r)??void 0;let e={};return this.raw.headers.forEach((t,s)=>{e[s]=t}),e}async parseBody(r){return this.bodyCache.parsedBody??=await _h(this,r)}#s=r=>{let{bodyCache:e,raw:t}=this,s=e[r];if(s)return s;let n=Object.keys(e)[0];return n?e[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[r]())):e[r]=t[r]()};json(){return this.#s("text").then(r=>JSON.parse(r))}text(){return this.#s("text")}arrayBuffer(){return this.#s("arrayBuffer")}blob(){return this.#s("blob")}formData(){return this.#s("formData")}addValidatedData(r,e){this.#t[r]=e}valid(r){return this.#t[r]}get url(){return this.raw.url}get method(){return this.raw.method}get[yh](){return this.#e}get matchedRoutes(){return this.#e[0].map(([[,r]])=>r)}get routePath(){return this.#e[0].map(([[,r]])=>r)[this.routeIndex].path}};var Oh={Stringify:1,BeforeStream:2,Stream:3},py=(r,e)=>{let t=new String(r);return t.isEscaped=!0,t.callbacks=e,t};var _a=async(r,e,t,s,n)=>{typeof r=="object"&&!(r instanceof String)&&(r instanceof Promise||(r=r.toString()),r instanceof Promise&&(r=await r));let i=r.callbacks;if(!i?.length)return Promise.resolve(r);n?n[0]+=r:n=[r];let o=Promise.all(i.map(a=>a({phase:e,buffer:n,context:s}))).then(a=>Promise.all(a.filter(Boolean).map(c=>_a(c,e,!1,s,n))).then(()=>n[0]));return t?py(await o,i):o};var my="text/plain; charset=UTF-8",va=(r,e)=>({"Content-Type":r,...e}),Rh=class{#t;#e;env={};#r;finalized=!1;error;#i;#n;#s;#l;#c;#u;#a;#h;#d;constructor(r,e){this.#t=r,e&&(this.#n=e.executionCtx,this.env=e.env,this.#u=e.notFoundHandler,this.#d=e.path,this.#h=e.matchResult)}get req(){return this.#e??=new ai(this.#t,this.#d,this.#h),this.#e}get event(){if(this.#n&&"respondWith"in this.#n)return this.#n;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#n)return this.#n;throw Error("This context has no ExecutionContext")}get res(){return this.#s||=new Response(null,{headers:this.#a??=new Headers})}set res(r){if(this.#s&&r){r=new Response(r.body,r);for(let[e,t]of this.#s.headers.entries())if(e!=="content-type")if(e==="set-cookie"){let s=this.#s.headers.getSetCookie();r.headers.delete("set-cookie");for(let n of s)r.headers.append("set-cookie",n)}else r.headers.set(e,t)}this.#s=r,this.finalized=!0}render=(...r)=>(this.#c??=e=>this.html(e),this.#c(...r));setLayout=r=>this.#l=r;getLayout=()=>this.#l;setRenderer=r=>{this.#c=r};header=(r,e,t)=>{this.finalized&&(this.#s=new Response(this.#s.body,this.#s));let s=this.#s?this.#s.headers:this.#a??=new Headers;e===void 0?s.delete(r):t?.append?s.append(r,e):s.set(r,e)};status=r=>{this.#i=r};set=(r,e)=>{this.#r??=new Map,this.#r.set(r,e)};get=r=>this.#r?this.#r.get(r):void 0;get var(){return this.#r?Object.fromEntries(this.#r):{}}#o(r,e,t){let s=this.#s?new Headers(this.#s.headers):this.#a??new Headers;if(typeof e=="object"&&"headers"in e){let i=e.headers instanceof Headers?e.headers:new Headers(e.headers);for(let[o,a]of i)o.toLowerCase()==="set-cookie"?s.append(o,a):s.set(o,a)}if(t)for(let[i,o]of Object.entries(t))if(typeof o=="string")s.set(i,o);else{s.delete(i);for(let a of o)s.append(i,a)}let n=typeof e=="number"?e:e?.status??this.#i;return new Response(r,{status:n,headers:s})}newResponse=(...r)=>this.#o(...r);body=(r,e,t)=>this.#o(r,e,t);text=(r,e,t)=>!this.#a&&!this.#i&&!e&&!t&&!this.finalized?new Response(r):this.#o(r,e,va(my,t));json=(r,e,t)=>this.#o(JSON.stringify(r),e,va("application/json",t));html=(r,e,t)=>{let s=n=>this.#o(n,e,va("text/html; charset=UTF-8",t));return typeof r=="object"?_a(r,Oh.Stringify,!1,{}).then(s):s(r)};redirect=(r,e)=>{let t=String(r);return this.header("Location",/[^\x00-\xFF]/.test(t)?encodeURI(t):t),this.newResponse(null,e??302)};notFound=()=>(this.#u??=()=>new Response,this.#u(this))};var xe="ALL",kh="all",xh=["get","post","put","delete","options","patch"],li="Can not add a route since the matcher is already built.",hi=class extends Error{};var gy=r=>r.text("404 Not Found",404),Ch=(r,e)=>{if("getResponse"in r){let t=r.getResponse();return e.newResponse(t.body,t)}return console.error(r),e.text("Internal Server Error",500)},wa=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#t="/";routes=[];constructor(r={}){[...xh,kh].forEach(n=>{this[n]=(i,...o)=>(typeof i=="string"?this.#t=i:this.#i(n,this.#t,i),o.forEach(a=>{this.#i(n,this.#t,a)}),this)}),this.on=(n,i,...o)=>{for(let a of[i].flat()){this.#t=a;for(let c of[n].flat())o.map(u=>{this.#i(c.toUpperCase(),this.#t,u)})}return this},this.use=(n,...i)=>(typeof n=="string"?this.#t=n:(this.#t="*",i.unshift(n)),i.forEach(o=>{this.#i(xe,this.#t,o)}),this);let{strict:t,...s}=r;Object.assign(this,s),this.getPath=t??!0?r.getPath??ya:bh}#e(){let r=new wa({router:this.router,getPath:this.getPath});return r.errorHandler=this.errorHandler,r.#r=this.#r,r.routes=this.routes,r}#r=gy;errorHandler=Ch;route(r,e){let t=this.basePath(r);return e.routes.map(s=>{let n;e.errorHandler===Ch?n=s.handler:(n=async(i,o)=>(await pa([],e.errorHandler)(i,()=>s.handler(i,o))).res,n[Zs]=s.handler),t.#i(s.method,s.path,n)}),this}basePath(r){let e=this.#e();return e._basePath=Tr(this._basePath,r),e}onError=r=>(this.errorHandler=r,this);notFound=r=>(this.#r=r,this);mount(r,e,t){let s,n;t&&(typeof t=="function"?n=t:(n=t.optionHandler,t.replaceRequest===!1?s=a=>a:s=t.replaceRequest));let i=n?a=>{let c=n(a);return Array.isArray(c)?c:[c]}:a=>{let c;try{c=a.executionCtx}catch{}return[a.env,c]};s||=(()=>{let a=Tr(this._basePath,r),c=a==="/"?0:a.length;return u=>{let l=new URL(u.url);return l.pathname=l.pathname.slice(c)||"/",new Request(l,u)}})();let o=async(a,c)=>{let u=await e(s(a.req.raw),...i(a));if(u)return u;await c()};return this.#i(xe,Tr(r,"*"),o),this}#i(r,e,t){r=r.toUpperCase(),e=Tr(this._basePath,e);let s={basePath:this._basePath,path:e,method:r,handler:t};this.router.add(r,e,[t,s]),this.routes.push(s)}#n(r,e){if(r instanceof Error)return this.errorHandler(r,e);throw r}#s(r,e,t,s){if(s==="HEAD")return(async()=>new Response(null,await this.#s(r,e,t,"GET")))();let n=this.getPath(r,{env:t}),i=this.router.match(s,n),o=new Rh(r,{path:n,matchResult:i,env:t,executionCtx:e,notFoundHandler:this.#r});if(i[0].length===1){let c;try{c=i[0][0][0][0](o,async()=>{o.res=await this.#r(o)})}catch(u){return this.#n(u,o)}return c instanceof Promise?c.then(u=>u||(o.finalized?o.res:this.#r(o))).catch(u=>this.#n(u,o)):c??this.#r(o)}let a=pa(i[0],this.errorHandler,this.#r);return(async()=>{try{let c=await a(o);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return this.#n(c,o)}})()}fetch=(r,...e)=>this.#s(r,e[1],e[0],r.method);request=(r,e,t,s)=>r instanceof Request?this.fetch(e?new Request(r,e):r,t,s):(r=r.toString(),this.fetch(new Request(/^https?:\/\//.test(r)?r:`http://localhost${Tr("/",r)}`,e),t,s));fire=()=>{addEventListener("fetch",r=>{r.respondWith(this.#s(r.request,r,void 0,r.request.method))})}};var di=[];function ba(r,e){let t=this.buildAllMatchers(),s=(n,i)=>{let o=t[n]||t[xe],a=o[2][i];if(a)return a;let c=i.match(o[0]);if(!c)return[[],di];let u=c.indexOf("",1);return[o[1][u],c]};return this.match=s,s(r,e)}var fi="[^/]+",Xs=".*",en="(?:|/.*)",Ar=Symbol(),yy=new Set(".\\+*[^]$()");function _y(r,e){return r.length===1?e.length===1?r<e?-1:1:-1:e.length===1||r===Xs||r===en?1:e===Xs||e===en?-1:r===fi?1:e===fi?-1:r.length===e.length?r<e?-1:1:e.length-r.length}var pi=class{#t;#e;#r=Object.create(null);insert(r,e,t,s,n){if(r.length===0){if(this.#t!==void 0)throw Ar;if(n)return;this.#t=e;return}let[i,...o]=r,a=i==="*"?o.length===0?["","",Xs]:["","",fi]:i==="/*"?["","",en]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(a){let u=a[1],l=a[2]||fi;if(u&&a[2]&&(l===".*"||(l=l.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(l))))throw Ar;if(c=this.#r[l],!c){if(Object.keys(this.#r).some(h=>h!==Xs&&h!==en))throw Ar;if(n)return;c=this.#r[l]=new pi,u!==""&&(c.#e=s.varIndex++)}!n&&u!==""&&t.push([u,c.#e])}else if(c=this.#r[i],!c){if(Object.keys(this.#r).some(u=>u.length>1&&u!==Xs&&u!==en))throw Ar;if(n)return;c=this.#r[i]=new pi}c.insert(o,e,t,s,n)}buildRegExpStr(){let e=Object.keys(this.#r).sort(_y).map(t=>{let s=this.#r[t];return(typeof s.#e=="number"?`(${t})@${s.#e}`:yy.has(t)?`\\${t}`:t)+s.buildRegExpStr()});return typeof this.#t=="number"&&e.unshift(`#${this.#t}`),e.length===0?"":e.length===1?e[0]:"(?:"+e.join("|")+")"}};var Ph=class{#t={varIndex:0};#e=new pi;insert(r,e,t){let s=[],n=[];for(let o=0;;){let a=!1;if(r=r.replace(/\{[^}]+\}/g,c=>{let u=`@\\${o}`;return n[o]=[u,c],o++,a=!0,u}),!a)break}let i=r.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=n.length-1;o>=0;o--){let[a]=n[o];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(a)!==-1){i[c]=i[c].replace(a,n[o][1]);break}}return this.#e.insert(i,e,s,this.#t,t),s}buildRegExp(){let r=this.#e.buildRegExpStr();if(r==="")return[/^$/,[],[]];let e=0,t=[],s=[];return r=r.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,o)=>i!==void 0?(t[++e]=Number(i),"$()"):(o!==void 0&&(s[Number(o)]=++e),"")),[new RegExp(`^${r}`),t,s]}};var vy=[/^$/,[],Object.create(null)],jh=Object.create(null);function Nh(r){return jh[r]??=new RegExp(r==="*"?"":`^${r.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,t)=>t?`\\${t}`:"(?:|/.*)")}$`)}function wy(){jh=Object.create(null)}function by(r){let e=new Ph,t=[];if(r.length===0)return vy;let s=r.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,l],[h,f])=>u?1:h?-1:l.length-f.length),n=Object.create(null);for(let u=0,l=-1,h=s.length;u<h;u++){let[f,p,y]=s[u];f?n[p]=[y.map(([w])=>[w,Object.create(null)]),di]:l++;let g;try{g=e.insert(p,l,f)}catch(w){throw w===Ar?new hi(p):w}f||(t[l]=y.map(([w,b])=>{let A=Object.create(null);for(b-=1;b>=0;b--){let[E,k]=g[b];A[E]=k}return[w,A]}))}let[i,o,a]=e.buildRegExp();for(let u=0,l=t.length;u<l;u++)for(let h=0,f=t[u].length;h<f;h++){let p=t[u][h]?.[1];if(!p)continue;let y=Object.keys(p);for(let g=0,w=y.length;g<w;g++)p[y[g]]=a[p[y[g]]]}let c=[];for(let u in o)c[u]=t[o[u]];return[i,c,n]}function as(r,e){if(r){for(let t of Object.keys(r).sort((s,n)=>n.length-s.length))if(Nh(t).test(e))return[...r[t]]}}var mi=class{name="RegExpRouter";#t;#e;constructor(){this.#t={[xe]:Object.create(null)},this.#e={[xe]:Object.create(null)}}add(r,e,t){let s=this.#t,n=this.#e;if(!s||!n)throw new Error(li);s[r]||[s,n].forEach(a=>{a[r]=Object.create(null),Object.keys(a[xe]).forEach(c=>{a[r][c]=[...a[xe][c]]})}),e==="/*"&&(e="*");let i=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){let a=Nh(e);r===xe?Object.keys(s).forEach(c=>{s[c][e]||=as(s[c],e)||as(s[xe],e)||[]}):s[r][e]||=as(s[r],e)||as(s[xe],e)||[],Object.keys(s).forEach(c=>{(r===xe||r===c)&&Object.keys(s[c]).forEach(u=>{a.test(u)&&s[c][u].push([t,i])})}),Object.keys(n).forEach(c=>{(r===xe||r===c)&&Object.keys(n[c]).forEach(u=>a.test(u)&&n[c][u].push([t,i]))});return}let o=ui(e)||[e];for(let a=0,c=o.length;a<c;a++){let u=o[a];Object.keys(n).forEach(l=>{(r===xe||r===l)&&(n[l][u]||=[...as(s[l],u)||as(s[xe],u)||[]],n[l][u].push([t,i-c+a+1]))})}}match=ba;buildAllMatchers(){let r=Object.create(null);return Object.keys(this.#e).concat(Object.keys(this.#t)).forEach(e=>{r[e]||=this.#r(e)}),this.#t=this.#e=void 0,wy(),r}#r(r){let e=[],t=r===xe;return[this.#t,this.#e].forEach(s=>{let n=s[r]?Object.keys(s[r]).map(i=>[i,s[r][i]]):[];n.length!==0?(t||=!0,e.push(...n)):r!==xe&&e.push(...Object.keys(s[xe]).map(i=>[i,s[xe][i]]))}),t?by(e):null}};var Ea=class{name="SmartRouter";#t=[];#e=[];constructor(r){this.#t=r.routers}add(r,e,t){if(!this.#e)throw new Error(li);this.#e.push([r,e,t])}match(r,e){if(!this.#e)throw new Error("Fatal error");let t=this.#t,s=this.#e,n=t.length,i=0,o;for(;i<n;i++){let a=t[i];try{for(let c=0,u=s.length;c<u;c++)a.add(...s[c]);o=a.match(r,e)}catch(c){if(c instanceof hi)continue;throw c}this.match=a.match.bind(a),this.#t=[a],this.#e=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(this.#e||this.#t.length!==1)throw new Error("No active router has been determined yet.");return this.#t[0]}};var tn=Object.create(null),Sa=class{#t;#e;#r;#i=0;#n=tn;constructor(r,e,t){if(this.#e=t||Object.create(null),this.#t=[],r&&e){let s=Object.create(null);s[r]={handler:e,possibleKeys:[],score:0},this.#t=[s]}this.#r=[]}insert(r,e,t){this.#i=++this.#i;let s=this,n=vh(e),i=[];for(let o=0,a=n.length;o<a;o++){let c=n[o],u=n[o+1],l=wh(c,u),h=Array.isArray(l)?l[0]:c;if(h in s.#e){s=s.#e[h],l&&i.push(l[1]);continue}s.#e[h]=new Sa,l&&(s.#r.push(l),i.push(l[1])),s=s.#e[h]}return s.#t.push({[r]:{handler:t,possibleKeys:i.filter((o,a,c)=>c.indexOf(o)===a),score:this.#i}}),s}#s(r,e,t,s){let n=[];for(let i=0,o=r.#t.length;i<o;i++){let a=r.#t[i],c=a[e]||a[xe],u={};if(c!==void 0&&(c.params=Object.create(null),n.push(c),t!==tn||s&&s!==tn))for(let l=0,h=c.possibleKeys.length;l<h;l++){let f=c.possibleKeys[l],p=u[c.score];c.params[f]=s?.[f]&&!p?s[f]:t[f]??s?.[f],u[c.score]=!0}}return n}search(r,e){let t=[];this.#n=tn;let n=[this],i=ga(e),o=[];for(let a=0,c=i.length;a<c;a++){let u=i[a],l=a===c-1,h=[];for(let f=0,p=n.length;f<p;f++){let y=n[f],g=y.#e[u];g&&(g.#n=y.#n,l?(g.#e["*"]&&t.push(...this.#s(g.#e["*"],r,y.#n)),t.push(...this.#s(g,r,y.#n))):h.push(g));for(let w=0,b=y.#r.length;w<b;w++){let A=y.#r[w],E=y.#n===tn?{}:{...y.#n};if(A==="*"){let Y=y.#e["*"];Y&&(t.push(...this.#s(Y,r,y.#n)),Y.#n=E,h.push(Y));continue}let[k,U,V]=A;if(!u&&!(V instanceof RegExp))continue;let I=y.#e[k],W=i.slice(a).join("/");if(V instanceof RegExp){let Y=V.exec(W);if(Y){if(E[U]=Y[0],t.push(...this.#s(I,r,y.#n,E)),Object.keys(I.#e).length){I.#n=E;let R=Y[0].match(/\//)?.length??0;(o[R]||=[]).push(I)}continue}}(V===!0||V.test(u))&&(E[U]=u,l?(t.push(...this.#s(I,r,E,y.#n)),I.#e["*"]&&t.push(...this.#s(I.#e["*"],r,E,y.#n))):(I.#n=E,h.push(I)))}}n=h.concat(o.shift()??[])}return t.length>1&&t.sort((a,c)=>a.score-c.score),[t.map(({handler:a,params:c})=>[a,c])]}};var Ta=class{name="TrieRouter";#t;constructor(){this.#t=new Sa}add(r,e,t){let s=ui(e);if(s){for(let n=0,i=s.length;n<i;n++)this.#t.insert(r,s[n],t);return}this.#t.insert(r,e,t)}match(r,e){return this.#t.search(r,e)}};var rn=class extends wa{constructor(r={}){super(r),this.router=r.router??new Ea({routers:[new mi,new Ta]})}};var Ey=(r,e)=>(console.error(`Error on ${e.req.method} ${e.req.url}`),console.error(r?.message),console.error(r?.stack),r instanceof It?r.getResponse():new Response("Internal Error",{status:500,statusText:r?.message||"Internal Error"})),Ih=Ey;var Iu=Ug(Df(),1),{PostgrestError:hO,FunctionsHttpError:dO,FunctionsFetchError:fO,FunctionsRelayError:pO,FunctionsError:mO,FunctionRegion:gO,SupabaseClient:yO,createClient:Lf,GoTrueAdminApi:_O,GoTrueClient:vO,AuthAdminApi:wO,AuthClient:bO,navigatorLock:EO,NavigatorLockAcquireTimeoutError:SO,lockInternals:TO,processLock:AO,SIGN_OUT_SCOPES:OO,AuthError:RO,AuthApiError:kO,AuthUnknownError:xO,CustomAuthError:CO,AuthSessionMissingError:PO,AuthInvalidTokenResponseError:jO,AuthInvalidCredentialsError:NO,AuthImplicitGrantRedirectError:IO,AuthPKCEGrantCodeExchangeError:$O,AuthRetryableFetchError:DO,AuthWeakPasswordError:LO,AuthInvalidJwtError:UO,isAuthError:qO,isAuthApiError:BO,isAuthSessionMissingError:MO,isAuthImplicitGrantRedirectError:FO,isAuthRetryableFetchError:VO,isAuthWeakPasswordError:zO,RealtimePresence:HO,RealtimeChannel:KO,RealtimeClient:WO,REALTIME_LISTEN_TYPES:GO,REALTIME_POSTGRES_CHANGES_LISTEN_EVENT:QO,REALTIME_PRESENCE_LISTEN_EVENTS:JO,REALTIME_SUBSCRIBE_STATES:ZO,REALTIME_CHANNEL_STATES:YO}=Iu.default||Iu;(function(){Vf().config(Object.assign({},Hf(),Wf()(process.argv)))})();var qe={};aa(qe,{BRAND:()=>t0,DIRTY:()=>Nr,EMPTY_PATH:()=>Nb,INVALID:()=>z,NEVER:()=>q0,OK:()=>st,ParseStatus:()=>Qe,Schema:()=>Z,ZodAny:()=>gr,ZodArray:()=>ar,ZodBigInt:()=>$r,ZodBoolean:()=>Dr,ZodBranded:()=>On,ZodCatch:()=>Wr,ZodDate:()=>Lr,ZodDefault:()=>Kr,ZodDiscriminatedUnion:()=>vo,ZodEffects:()=>Ct,ZodEnum:()=>zr,ZodError:()=>gt,ZodFirstPartyTypeKind:()=>K,ZodFunction:()=>bo,ZodIntersection:()=>Mr,ZodIssueCode:()=>S,ZodLazy:()=>Fr,ZodLiteral:()=>Vr,ZodMap:()=>js,ZodNaN:()=>Is,ZodNativeEnum:()=>Hr,ZodNever:()=>qt,ZodNull:()=>qr,ZodNullable:()=>Qt,ZodNumber:()=>Ir,ZodObject:()=>yt,ZodOptional:()=>kt,ZodParsedType:()=>N,ZodPipeline:()=>Rn,ZodPromise:()=>yr,ZodReadonly:()=>Gr,ZodRecord:()=>wo,ZodSchema:()=>Z,ZodSet:()=>Ns,ZodString:()=>mr,ZodSymbol:()=>Cs,ZodTransformer:()=>Ct,ZodTuple:()=>Gt,ZodType:()=>Z,ZodUndefined:()=>Ur,ZodUnion:()=>Br,ZodUnknown:()=>or,ZodVoid:()=>Ps,addIssueToContext:()=>C,any:()=>l0,array:()=>p0,bigint:()=>i0,boolean:()=>np,coerce:()=>U0,custom:()=>tp,date:()=>o0,datetimeRegex:()=>Xf,defaultErrorMap:()=>nr,discriminatedUnion:()=>_0,effect:()=>C0,enum:()=>R0,function:()=>T0,getErrorMap:()=>Rs,getParsedType:()=>Wt,instanceof:()=>s0,intersection:()=>v0,isAborted:()=>yo,isAsync:()=>ks,isDirty:()=>_o,isValid:()=>pr,late:()=>r0,lazy:()=>A0,literal:()=>O0,makeIssue:()=>An,map:()=>E0,nan:()=>n0,nativeEnum:()=>k0,never:()=>d0,null:()=>u0,nullable:()=>j0,number:()=>sp,object:()=>m0,objectUtil:()=>Lu,oboolean:()=>L0,onumber:()=>D0,optional:()=>P0,ostring:()=>$0,pipeline:()=>I0,preprocess:()=>N0,promise:()=>x0,quotelessJson:()=>Cb,record:()=>b0,set:()=>S0,setErrorMap:()=>jb,strictObject:()=>g0,string:()=>rp,symbol:()=>a0,transformer:()=>C0,tuple:()=>w0,undefined:()=>c0,union:()=>y0,unknown:()=>h0,util:()=>X,void:()=>f0});var X;(function(r){r.assertEqual=n=>{};function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{let i={};for(let o of n)i[o]=o;return i},r.getValidEnumValues=n=>{let i=r.objectKeys(n).filter(a=>typeof n[n[a]]!="number"),o={};for(let a of i)o[a]=n[a];return r.objectValues(o)},r.objectValues=n=>r.objectKeys(n).map(function(i){return n[i]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let i=[];for(let o in n)Object.prototype.hasOwnProperty.call(n,o)&&i.push(o);return i},r.find=(n,i)=>{for(let o of n)if(i(o))return o},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}r.joinValues=s,r.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(X||(X={}));var Lu;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Lu||(Lu={}));var N=X.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Wt=r=>{switch(typeof r){case"undefined":return N.undefined;case"string":return N.string;case"number":return Number.isNaN(r)?N.nan:N.number;case"boolean":return N.boolean;case"function":return N.function;case"bigint":return N.bigint;case"symbol":return N.symbol;case"object":return Array.isArray(r)?N.array:r===null?N.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?N.promise:typeof Map<"u"&&r instanceof Map?N.map:typeof Set<"u"&&r instanceof Set?N.set:typeof Date<"u"&&r instanceof Date?N.date:N.object;default:return N.unknown}};var S=X.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Cb=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),gt=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},s={_errors:[]},n=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(n);else if(o.code==="invalid_return_type")n(o.returnTypeError);else if(o.code==="invalid_arguments")n(o.argumentsError);else if(o.path.length===0)s._errors.push(t(o));else{let a=s,c=0;for(;c<o.path.length;){let u=o.path[c];c===o.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(t(o))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return n(this),s}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,X.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},s=[];for(let n of this.issues)if(n.path.length>0){let i=n.path[0];t[i]=t[i]||[],t[i].push(e(n))}else s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};gt.create=r=>new gt(r);var Pb=(r,e)=>{let t;switch(r.code){case S.invalid_type:r.received===N.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case S.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,X.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:t=`Unrecognized key(s) in object: ${X.joinValues(r.keys,", ")}`;break;case S.invalid_union:t="Invalid input";break;case S.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${X.joinValues(r.options)}`;break;case S.invalid_enum_value:t=`Invalid enum value. Expected ${X.joinValues(r.options)}, received '${r.received}'`;break;case S.invalid_arguments:t="Invalid function arguments";break;case S.invalid_return_type:t="Invalid function return type";break;case S.invalid_date:t="Invalid date";break;case S.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:X.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case S.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case S.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case S.custom:t="Invalid input";break;case S.invalid_intersection_types:t="Intersection results could not be merged";break;case S.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case S.not_finite:t="Number must be finite";break;default:t=e.defaultError,X.assertNever(r)}return{message:t}},nr=Pb;var Gf=nr;function jb(r){Gf=r}function Rs(){return Gf}var An=r=>{let{data:e,path:t,errorMaps:s,issueData:n}=r,i=[...t,...n.path||[]],o={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let a="",c=s.filter(u=>!!u).slice().reverse();for(let u of c)a=u(o,{data:e,defaultError:a}).message;return{...n,path:i,message:a}},Nb=[];function C(r,e){let t=Rs(),s=An({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===nr?void 0:nr].filter(n=>!!n)});r.common.issues.push(s)}var Qe=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let n of t){if(n.status==="aborted")return z;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let n of t){let i=await n.key,o=await n.value;s.push({key:i,value:o})}return r.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let n of t){let{key:i,value:o}=n;if(i.status==="aborted"||o.status==="aborted")return z;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||n.alwaysSet)&&(s[i.value]=o.value)}return{status:e.value,value:s}}},z=Object.freeze({status:"aborted"}),Nr=r=>({status:"dirty",value:r}),st=r=>({status:"valid",value:r}),yo=r=>r.status==="aborted",_o=r=>r.status==="dirty",pr=r=>r.status==="valid",ks=r=>typeof Promise<"u"&&r instanceof Promise;var L;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var xt=class{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Qf=(r,e)=>{if(pr(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new gt(r.common.issues);return this._error=t,this._error}}};function G(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(o,a)=>{let{message:c}=r;return o.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??s??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:c??t??a.defaultError}},description:n}}var Z=class{get description(){return this._def.description}_getType(e){return Wt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Wt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Qe,ctx:{common:e.parent.common,data:e.data,parsedType:Wt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ks(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Wt(e)},n=this._parseSync({data:e,path:s.path,parent:s});return Qf(s,n)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Wt(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return pr(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>pr(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Wt(e)},n=this._parse({data:e,path:s.path,parent:s}),i=await(ks(n)?n:Promise.resolve(n));return Qf(s,i)}refine(e,t){let s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,i)=>{let o=e(n),a=()=>i.addIssue({code:S.custom,...s(n)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new Ct({schema:this,typeName:K.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return kt.create(this,this._def)}nullable(){return Qt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ar.create(this)}promise(){return yr.create(this,this._def)}or(e){return Br.create([this,e],this._def)}and(e){return Mr.create(this,e,this._def)}transform(e){return new Ct({...G(this._def),schema:this,typeName:K.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Kr({...G(this._def),innerType:this,defaultValue:t,typeName:K.ZodDefault})}brand(){return new On({typeName:K.ZodBranded,type:this,...G(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Wr({...G(this._def),innerType:this,catchValue:t,typeName:K.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Rn.create(this,e)}readonly(){return Gr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Ib=/^c[^\s-]{8,}$/i,$b=/^[0-9a-z]+$/,Db=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Lb=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ub=/^[a-z0-9_-]{21}$/i,qb=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Bb=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Mb=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Fb="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Uu,Vb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,zb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Hb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Kb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Wb=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Gb=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Zf="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Qb=new RegExp(`^${Zf}$`);function Yf(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Jb(r){return new RegExp(`^${Yf(r)}$`)}function Xf(r){let e=`${Zf}T${Yf(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Zb(r,e){return!!((e==="v4"||!e)&&Vb.test(r)||(e==="v6"||!e)&&Hb.test(r))}function Yb(r,e){if(!qb.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function Xb(r,e){return!!((e==="v4"||!e)&&zb.test(r)||(e==="v6"||!e)&&Kb.test(r))}var mr=class r extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==N.string){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:N.string,received:i.parsedType}),z}let s=new Qe,n;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){let o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(n=this._getOrReturnCtx(e,n),o?C(n,{code:S.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&C(n,{code:S.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")Mb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"email",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Uu||(Uu=new RegExp(Fb,"u")),Uu.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"emoji",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")Lb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"uuid",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Ub.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"nanoid",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")Ib.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"cuid",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")$b.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"cuid2",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Db.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"ulid",code:S.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),C(n,{validation:"url",code:S.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"regex",code:S.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?Xf(i).test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?Qb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?Jb(i).test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:S.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?Bb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"duration",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?Zb(e.data,i.version)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"ip",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?Yb(e.data,i.alg)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"jwt",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?Xb(e.data,i.version)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"cidr",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Wb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"base64",code:S.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?Gb.test(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{validation:"base64url",code:S.invalid_string,message:i.message}),s.dirty()):X.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(n=>e.test(n),{validation:t,code:S.invalid_string,...L.errToObj(s)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...L.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...L.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...L.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...L.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...L.errToObj(t)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};mr.create=r=>new mr({checks:[],typeName:K.ZodString,coerce:r?.coerce??!1,...G(r)});function e0(r,e){let t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,i=Number.parseInt(r.toFixed(n).replace(".","")),o=Number.parseInt(e.toFixed(n).replace(".",""));return i%o/10**n}var Ir=class r extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==N.number){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:N.number,received:i.parsedType}),z}let s,n=new Qe;for(let i of this._def.checks)i.kind==="int"?X.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{code:S.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?e0(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{code:S.not_finite,message:i.message}),n.dirty()):X.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,L.toString(t))}gt(e,t){return this.setLimit("min",e,!1,L.toString(t))}lte(e,t){return this.setLimit("max",e,!0,L.toString(t))}lt(e,t){return this.setLimit("max",e,!1,L.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:L.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&X.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Ir.create=r=>new Ir({checks:[],typeName:K.ZodNumber,coerce:r?.coerce||!1,...G(r)});var $r=class r extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==N.bigint)return this._getInvalidInput(e);let s,n=new Qe;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),C(s,{code:S.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):X.assertNever(i);return{status:n.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:N.bigint,received:t.parsedType}),z}gte(e,t){return this.setLimit("min",e,!0,L.toString(t))}gt(e,t){return this.setLimit("min",e,!1,L.toString(t))}lte(e,t){return this.setLimit("max",e,!0,L.toString(t))}lt(e,t){return this.setLimit("max",e,!1,L.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:L.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};$r.create=r=>new $r({checks:[],typeName:K.ZodBigInt,coerce:r?.coerce??!1,...G(r)});var Dr=class extends Z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==N.boolean){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:N.boolean,received:s.parsedType}),z}return st(e.data)}};Dr.create=r=>new Dr({typeName:K.ZodBoolean,coerce:r?.coerce||!1,...G(r)});var Lr=class r extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==N.date){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_type,expected:N.date,received:i.parsedType}),z}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return C(i,{code:S.invalid_date}),z}let s=new Qe,n;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),C(n,{code:S.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):X.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Lr.create=r=>new Lr({checks:[],coerce:r?.coerce||!1,typeName:K.ZodDate,...G(r)});var Cs=class extends Z{_parse(e){if(this._getType(e)!==N.symbol){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:N.symbol,received:s.parsedType}),z}return st(e.data)}};Cs.create=r=>new Cs({typeName:K.ZodSymbol,...G(r)});var Ur=class extends Z{_parse(e){if(this._getType(e)!==N.undefined){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:N.undefined,received:s.parsedType}),z}return st(e.data)}};Ur.create=r=>new Ur({typeName:K.ZodUndefined,...G(r)});var qr=class extends Z{_parse(e){if(this._getType(e)!==N.null){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:N.null,received:s.parsedType}),z}return st(e.data)}};qr.create=r=>new qr({typeName:K.ZodNull,...G(r)});var gr=class extends Z{constructor(){super(...arguments),this._any=!0}_parse(e){return st(e.data)}};gr.create=r=>new gr({typeName:K.ZodAny,...G(r)});var or=class extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return st(e.data)}};or.create=r=>new or({typeName:K.ZodUnknown,...G(r)});var qt=class extends Z{_parse(e){let t=this._getOrReturnCtx(e);return C(t,{code:S.invalid_type,expected:N.never,received:t.parsedType}),z}};qt.create=r=>new qt({typeName:K.ZodNever,...G(r)});var Ps=class extends Z{_parse(e){if(this._getType(e)!==N.undefined){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:N.void,received:s.parsedType}),z}return st(e.data)}};Ps.create=r=>new Ps({typeName:K.ZodVoid,...G(r)});var ar=class r extends Z{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==N.array)return C(t,{code:S.invalid_type,expected:N.array,received:t.parsedType}),z;if(n.exactLength!==null){let o=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(o||a)&&(C(t,{code:o?S.too_big:S.too_small,minimum:a?n.exactLength.value:void 0,maximum:o?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(C(t,{code:S.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(C(t,{code:S.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>n.type._parseAsync(new xt(t,o,t.path,a)))).then(o=>Qe.mergeArray(s,o));let i=[...t.data].map((o,a)=>n.type._parseSync(new xt(t,o,t.path,a)));return Qe.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:L.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:L.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:L.toString(t)}})}nonempty(e){return this.min(1,e)}};ar.create=(r,e)=>new ar({type:r,minLength:null,maxLength:null,exactLength:null,typeName:K.ZodArray,...G(e)});function xs(r){if(r instanceof yt){let e={};for(let t in r.shape){let s=r.shape[t];e[t]=kt.create(xs(s))}return new yt({...r._def,shape:()=>e})}else return r instanceof ar?new ar({...r._def,type:xs(r.element)}):r instanceof kt?kt.create(xs(r.unwrap())):r instanceof Qt?Qt.create(xs(r.unwrap())):r instanceof Gt?Gt.create(r.items.map(e=>xs(e))):r}var yt=class r extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=X.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==N.object){let u=this._getOrReturnCtx(e);return C(u,{code:S.invalid_type,expected:N.object,received:u.parsedType}),z}let{status:s,ctx:n}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof qt&&this._def.unknownKeys==="strip"))for(let u in n.data)o.includes(u)||a.push(u);let c=[];for(let u of o){let l=i[u],h=n.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new xt(n,h,n.path,u)),alwaysSet:u in n.data})}if(this._def.catchall instanceof qt){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:n.data[l]}});else if(u==="strict")a.length>0&&(C(n,{code:S.unrecognized_keys,keys:a}),s.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let h=n.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new xt(n,h,n.path,l)),alwaysSet:l in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let h=await l.key,f=await l.value;u.push({key:h,value:f,alwaysSet:l.alwaysSet})}return u}).then(u=>Qe.mergeObjectSync(s,u)):Qe.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return L.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{let n=this._def.errorMap?.(t,s).message??s.defaultError;return t.code==="unrecognized_keys"?{message:L.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:K.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let s of X.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let s of X.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}deepPartial(){return xs(this)}partial(e){let t={};for(let s of X.objectKeys(this.shape)){let n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let s of X.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof kt;)i=i._def.innerType;t[s]=i}return new r({...this._def,shape:()=>t})}keyof(){return ep(X.objectKeys(this.shape))}};yt.create=(r,e)=>new yt({shape:()=>r,unknownKeys:"strip",catchall:qt.create(),typeName:K.ZodObject,...G(e)});yt.strictCreate=(r,e)=>new yt({shape:()=>r,unknownKeys:"strict",catchall:qt.create(),typeName:K.ZodObject,...G(e)});yt.lazycreate=(r,e)=>new yt({shape:r,unknownKeys:"strip",catchall:qt.create(),typeName:K.ZodObject,...G(e)});var Br=class extends Z{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;function n(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(a=>new gt(a.ctx.common.issues));return C(t,{code:S.invalid_union,unionErrors:o}),z}if(t.common.async)return Promise.all(s.map(async i=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(n);{let i,o=[];for(let c of s){let u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:u}),u.common.issues.length&&o.push(u.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let a=o.map(c=>new gt(c));return C(t,{code:S.invalid_union,unionErrors:a}),z}}get options(){return this._def.options}};Br.create=(r,e)=>new Br({options:r,typeName:K.ZodUnion,...G(e)});var ir=r=>r instanceof Fr?ir(r.schema):r instanceof Ct?ir(r.innerType()):r instanceof Vr?[r.value]:r instanceof zr?r.options:r instanceof Hr?X.objectValues(r.enum):r instanceof Kr?ir(r._def.innerType):r instanceof Ur?[void 0]:r instanceof qr?[null]:r instanceof kt?[void 0,...ir(r.unwrap())]:r instanceof Qt?[null,...ir(r.unwrap())]:r instanceof On||r instanceof Gr?ir(r.unwrap()):r instanceof Wr?ir(r._def.innerType):[],vo=class r extends Z{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==N.object)return C(t,{code:S.invalid_type,expected:N.object,received:t.parsedType}),z;let s=this.discriminator,n=t.data[s],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(C(t,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),z)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let n=new Map;for(let i of t){let o=ir(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(n.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,i)}}return new r({typeName:K.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...G(s)})}};function qu(r,e){let t=Wt(r),s=Wt(e);if(r===e)return{valid:!0,data:r};if(t===N.object&&s===N.object){let n=X.objectKeys(e),i=X.objectKeys(r).filter(a=>n.indexOf(a)!==-1),o={...r,...e};for(let a of i){let c=qu(r[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===N.array&&s===N.array){if(r.length!==e.length)return{valid:!1};let n=[];for(let i=0;i<r.length;i++){let o=r[i],a=e[i],c=qu(o,a);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===N.date&&s===N.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Mr=class extends Z{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=(i,o)=>{if(yo(i)||yo(o))return z;let a=qu(i.value,o.value);return a.valid?((_o(i)||_o(o))&&t.dirty(),{status:t.value,value:a.data}):(C(s,{code:S.invalid_intersection_types}),z)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,o])=>n(i,o)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};Mr.create=(r,e,t)=>new Mr({left:r,right:e,typeName:K.ZodIntersection,...G(t)});var Gt=class r extends Z{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==N.array)return C(s,{code:S.invalid_type,expected:N.array,received:s.parsedType}),z;if(s.data.length<this._def.items.length)return C(s,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),z;!this._def.rest&&s.data.length>this._def.items.length&&(C(s,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...s.data].map((o,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new xt(s,o,s.path,a)):null}).filter(o=>!!o);return s.common.async?Promise.all(i).then(o=>Qe.mergeArray(t,o)):Qe.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Gt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Gt({items:r,typeName:K.ZodTuple,rest:null,...G(e)})};var wo=class r extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==N.object)return C(s,{code:S.invalid_type,expected:N.object,received:s.parsedType}),z;let n=[],i=this._def.keyType,o=this._def.valueType;for(let a in s.data)n.push({key:i._parse(new xt(s,a,s.path,a)),value:o._parse(new xt(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?Qe.mergeObjectAsync(t,n):Qe.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof Z?new r({keyType:e,valueType:t,typeName:K.ZodRecord,...G(s)}):new r({keyType:mr.create(),valueType:e,typeName:K.ZodRecord,...G(t)})}},js=class extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==N.map)return C(s,{code:S.invalid_type,expected:N.map,received:s.parsedType}),z;let n=this._def.keyType,i=this._def.valueType,o=[...s.data.entries()].map(([a,c],u)=>({key:n._parse(new xt(s,a,s.path,[u,"key"])),value:i._parse(new xt(s,c,s.path,[u,"value"]))}));if(s.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of o){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return z;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(u.value,l.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let c of o){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return z;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),a.set(u.value,l.value)}return{status:t.value,value:a}}}};js.create=(r,e,t)=>new js({valueType:e,keyType:r,typeName:K.ZodMap,...G(t)});var Ns=class r extends Z{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==N.set)return C(s,{code:S.invalid_type,expected:N.set,received:s.parsedType}),z;let n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(C(s,{code:S.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(C(s,{code:S.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function o(c){let u=new Set;for(let l of c){if(l.status==="aborted")return z;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}let a=[...s.data.values()].map((c,u)=>i._parse(new xt(s,c,s.path,u)));return s.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new r({...this._def,minSize:{value:e,message:L.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:L.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Ns.create=(r,e)=>new Ns({valueType:r,minSize:null,maxSize:null,typeName:K.ZodSet,...G(e)});var bo=class r extends Z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==N.function)return C(t,{code:S.invalid_type,expected:N.function,received:t.parsedType}),z;function s(a,c){return An({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Rs(),nr].filter(u=>!!u),issueData:{code:S.invalid_arguments,argumentsError:c}})}function n(a,c){return An({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Rs(),nr].filter(u=>!!u),issueData:{code:S.invalid_return_type,returnTypeError:c}})}let i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof yr){let a=this;return st(async function(...c){let u=new gt([]),l=await a._def.args.parseAsync(c,i).catch(p=>{throw u.addIssue(s(c,p)),u}),h=await Reflect.apply(o,this,l);return await a._def.returns._def.type.parseAsync(h,i).catch(p=>{throw u.addIssue(n(h,p)),u})})}else{let a=this;return st(function(...c){let u=a._def.args.safeParse(c,i);if(!u.success)throw new gt([s(c,u.error)]);let l=Reflect.apply(o,this,u.data),h=a._def.returns.safeParse(l,i);if(!h.success)throw new gt([n(l,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Gt.create(e).rest(or.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new r({args:e||Gt.create([]).rest(or.create()),returns:t||or.create(),typeName:K.ZodFunction,...G(s)})}},Fr=class extends Z{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Fr.create=(r,e)=>new Fr({getter:r,typeName:K.ZodLazy,...G(e)});var Vr=class extends Z{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return C(t,{received:t.data,code:S.invalid_literal,expected:this._def.value}),z}return{status:"valid",value:e.data}}get value(){return this._def.value}};Vr.create=(r,e)=>new Vr({value:r,typeName:K.ZodLiteral,...G(e)});function ep(r,e){return new zr({values:r,typeName:K.ZodEnum,...G(e)})}var zr=class r extends Z{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),s=this._def.values;return C(t,{expected:X.joinValues(s),received:t.parsedType,code:S.invalid_type}),z}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return C(t,{received:t.data,code:S.invalid_enum_value,options:s}),z}return st(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};zr.create=ep;var Hr=class extends Z{_parse(e){let t=X.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==N.string&&s.parsedType!==N.number){let n=X.objectValues(t);return C(s,{expected:X.joinValues(n),received:s.parsedType,code:S.invalid_type}),z}if(this._cache||(this._cache=new Set(X.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let n=X.objectValues(t);return C(s,{received:s.data,code:S.invalid_enum_value,options:n}),z}return st(e.data)}get enum(){return this._def.values}};Hr.create=(r,e)=>new Hr({values:r,typeName:K.ZodNativeEnum,...G(e)});var yr=class extends Z{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==N.promise&&t.common.async===!1)return C(t,{code:S.invalid_type,expected:N.promise,received:t.parsedType}),z;let s=t.parsedType===N.promise?t.data:Promise.resolve(t.data);return st(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}};yr.create=(r,e)=>new yr({type:r,typeName:K.ZodPromise,...G(e)});var Ct=class extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===K.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:o=>{C(s,o),o.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){let o=n.transform(s.data,i);if(s.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return z;let c=await this._def.schema._parseAsync({data:a,path:s.path,parent:s});return c.status==="aborted"?z:c.status==="dirty"?Nr(c.value):t.value==="dirty"?Nr(c.value):c});{if(t.value==="aborted")return z;let a=this._def.schema._parseSync({data:o,path:s.path,parent:s});return a.status==="aborted"?z:a.status==="dirty"?Nr(a.value):t.value==="dirty"?Nr(a.value):a}}if(n.type==="refinement"){let o=a=>{let c=n.refinement(a,i);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?z:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>a.status==="aborted"?z:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(n.type==="transform")if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!pr(o))return z;let a=n.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>pr(o)?Promise.resolve(n.transform(o.value,i)).then(a=>({status:t.value,value:a})):z);X.assertNever(n)}};Ct.create=(r,e,t)=>new Ct({schema:r,typeName:K.ZodEffects,effect:e,...G(t)});Ct.createWithPreprocess=(r,e,t)=>new Ct({schema:e,effect:{type:"preprocess",transform:r},typeName:K.ZodEffects,...G(t)});var kt=class extends Z{_parse(e){return this._getType(e)===N.undefined?st(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};kt.create=(r,e)=>new kt({innerType:r,typeName:K.ZodOptional,...G(e)});var Qt=class extends Z{_parse(e){return this._getType(e)===N.null?st(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Qt.create=(r,e)=>new Qt({innerType:r,typeName:K.ZodNullable,...G(e)});var Kr=class extends Z{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===N.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Kr.create=(r,e)=>new Kr({innerType:r,typeName:K.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...G(e)});var Wr=class extends Z{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return ks(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new gt(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new gt(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};Wr.create=(r,e)=>new Wr({innerType:r,typeName:K.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...G(e)});var Is=class extends Z{_parse(e){if(this._getType(e)!==N.nan){let s=this._getOrReturnCtx(e);return C(s,{code:S.invalid_type,expected:N.nan,received:s.parsedType}),z}return{status:"valid",value:e.data}}};Is.create=r=>new Is({typeName:K.ZodNaN,...G(r)});var t0=Symbol("zod_brand"),On=class extends Z{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}},Rn=class r extends Z{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?z:i.status==="dirty"?(t.dirty(),Nr(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{let n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?z:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new r({in:e,out:t,typeName:K.ZodPipeline})}},Gr=class extends Z{_parse(e){let t=this._def.innerType._parse(e),s=n=>(pr(n)&&(n.value=Object.freeze(n.value)),n);return ks(t)?t.then(n=>s(n)):s(t)}unwrap(){return this._def.innerType}};Gr.create=(r,e)=>new Gr({innerType:r,typeName:K.ZodReadonly,...G(e)});function Jf(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function tp(r,e={},t){return r?gr.create().superRefine((s,n)=>{let i=r(s);if(i instanceof Promise)return i.then(o=>{if(!o){let a=Jf(e,s),c=a.fatal??t??!0;n.addIssue({code:"custom",...a,fatal:c})}});if(!i){let o=Jf(e,s),a=o.fatal??t??!0;n.addIssue({code:"custom",...o,fatal:a})}}):gr.create()}var r0={object:yt.lazycreate},K;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(K||(K={}));var s0=(r,e={message:`Input not instance of ${r.name}`})=>tp(t=>t instanceof r,e),rp=mr.create,sp=Ir.create,n0=Is.create,i0=$r.create,np=Dr.create,o0=Lr.create,a0=Cs.create,c0=Ur.create,u0=qr.create,l0=gr.create,h0=or.create,d0=qt.create,f0=Ps.create,p0=ar.create,m0=yt.create,g0=yt.strictCreate,y0=Br.create,_0=vo.create,v0=Mr.create,w0=Gt.create,b0=wo.create,E0=js.create,S0=Ns.create,T0=bo.create,A0=Fr.create,O0=Vr.create,R0=zr.create,k0=Hr.create,x0=yr.create,C0=Ct.create,P0=kt.create,j0=Qt.create,N0=Ct.createWithPreprocess,I0=Rn.create,$0=()=>rp().optional(),D0=()=>sp().optional(),L0=()=>np().optional(),U0={string:r=>mr.create({...r,coerce:!0}),number:r=>Ir.create({...r,coerce:!0}),boolean:r=>Dr.create({...r,coerce:!0}),bigint:r=>$r.create({...r,coerce:!0}),date:r=>Lr.create({...r,coerce:!0})};var q0=z;console.log("\u{1F510} Loading environment variables...");var M0=qe.object({NODE_ENV:qe.string(),DATABASE_URL:qe.string().min(1),SUPABASE_URL:qe.string().min(1),SUPABASE_SERVICE_ROLE:qe.string().min(1),SENTRY_DSN:qe.string().optional()}),Bu=M0.safeParse(process.env);if(!Bu.success)throw console.error(`\u274C Invalid environment variables:
`),Bu.error.issues.forEach(r=>{console.error(r)}),new Error("Invalid environment variables");var{NODE_ENV:F0,DATABASE_URL:V0,SUPABASE_SERVICE_ROLE:z0,SUPABASE_URL:H0,SENTRY_DSN:K0}=Bu.data,$s={NODE_ENV:F0,DATABASE_URL:V0,SUPABASE_SERVICE_ROLE:z0,SUPABASE_URL:H0,SENTRY_DSN:K0};console.log("\u2705 Environment variables loaded");var{SUPABASE_URL:W0,SUPABASE_SERVICE_ROLE:G0}=$s,kn=Lf(W0,G0);function Fu(r){return r instanceof Error&&r.name==="ZodError"&&"issues"in r&&Array.isArray(r.issues)}var Mu=class extends Error{name;details;constructor(r,e){super(r,e),this.name="ZodValidationError",this.details=Q0(e)}toString(){return this.message}};function Q0(r){if(r){let e=r.cause;if(Fu(e))return e.issues}return[]}function op(r){return r.length!==0}function ip(r){return r.description??""}var J0=/[$_\p{ID_Start}][$\u200c\u200d\p{ID_Continue}]*/u;function Z0(r){if(r.length===1){let e=r[0];return typeof e=="symbol"&&(e=ip(e)),e.toString()||'""'}return r.reduce((e,t)=>{if(typeof t=="number")return e+"["+t.toString()+"]";if(typeof t=="symbol"&&(t=ip(t)),t.includes('"'))return e+'["'+Y0(t)+'"]';if(!J0.test(t))return e+'["'+t+'"]';let s=e.length===0?"":".";return e+s+t},"")}function Y0(r){return r.replace(/"/g,'\\"')}var X0="; ",eE=99,ap="Validation error",tE=": ",rE=", or ";function sE(r={}){let{issueSeparator:e=X0,unionSeparator:t=rE,prefixSeparator:s=tE,prefix:n=ap,includePath:i=!0,maxIssuesInMessage:o=eE}=r;return a=>{let c=a.slice(0,o).map(u=>Eo({issue:u,issueSeparator:e,unionSeparator:t,includePath:i})).join(e);return nE(c,n,s)}}function Eo(r){let{issue:e,issueSeparator:t,unionSeparator:s,includePath:n}=r;if(e.code===S.invalid_union)return e.unionErrors.reduce((i,o)=>{let a=o.issues.map(c=>Eo({issue:c,issueSeparator:t,unionSeparator:s,includePath:n})).join(t);return i.includes(a)||i.push(a),i},[]).join(s);if(e.code===S.invalid_arguments)return[e.message,...e.argumentsError.issues.map(i=>Eo({issue:i,issueSeparator:t,unionSeparator:s,includePath:n}))].join(t);if(e.code===S.invalid_return_type)return[e.message,...e.returnTypeError.issues.map(i=>Eo({issue:i,issueSeparator:t,unionSeparator:s,includePath:n}))].join(t);if(n&&op(e.path)){if(e.path.length===1){let i=e.path[0];if(typeof i=="number")return`${e.message} at index ${i}`}return`${e.message} at "${Z0(e.path)}"`}return e.message}function nE(r,e,t){return e!==null?r.length>0?[e,r].join(t):e:r.length>0?r:ap}function cp(r,e={}){if(!Fu(r))throw new TypeError(`Invalid zodError param; expected instance of ZodError. Did you mean to use the "${aE.name}" method instead?`);return up(r,e)}function up(r,e={}){let t=r.errors,s;return op(t)?s=iE(e)(t):s=r.message,new Mu(s,{cause:r})}function iE(r){return"messageBuilder"in r?r.messageBuilder:sE(r)}var oE=(r={})=>e=>Fu(e)?up(e,r):e instanceof Error?new Mu(e.message,{cause:e}):new Mu("Unknown error");function aE(r,e={}){return oE(e)(r)}var cE=/^[\w!#$%&'*.^`|~+-]+$/,uE=/^[ !#-:<-[\]-~]*$/,Vu=(r,e)=>{if(e&&r.indexOf(e)===-1)return{};let t=r.trim().split(";"),s={};for(let n of t){n=n.trim();let i=n.indexOf("=");if(i===-1)continue;let o=n.substring(0,i).trim();if(e&&e!==o||!cE.test(o))continue;let a=n.substring(i+1).trim();if(a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1)),uE.test(a)&&(s[o]=a.indexOf("%")!==-1?os(a,Ys):a,e))break}return s};var lE=(r,e,t={})=>{let s=`${r}=${e}`;if(r.startsWith("__Secure-")&&!t.secure)throw new Error("__Secure- Cookie must have Secure attributes");if(r.startsWith("__Host-")){if(!t.secure)throw new Error("__Host- Cookie must have Secure attributes");if(t.path!=="/")throw new Error('__Host- Cookie must have Path attributes with "/"');if(t.domain)throw new Error("__Host- Cookie must not have Domain attributes")}if(t&&typeof t.maxAge=="number"&&t.maxAge>=0){if(t.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");s+=`; Max-Age=${t.maxAge|0}`}if(t.domain&&t.prefix!=="host"&&(s+=`; Domain=${t.domain}`),t.path&&(s+=`; Path=${t.path}`),t.expires){if(t.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");s+=`; Expires=${t.expires.toUTCString()}`}if(t.httpOnly&&(s+="; HttpOnly"),t.secure&&(s+="; Secure"),t.sameSite&&(s+=`; SameSite=${t.sameSite.charAt(0).toUpperCase()+t.sameSite.slice(1)}`),t.priority&&(s+=`; Priority=${t.priority.charAt(0).toUpperCase()+t.priority.slice(1)}`),t.partitioned){if(!t.secure)throw new Error("Partitioned Cookie must have Secure attributes");s+="; Partitioned"}return s},So=(r,e,t)=>(e=encodeURIComponent(e),lE(r,e,t));var To=(r,e,t)=>{let s=r.req.raw.headers.get("Cookie");if(typeof e=="string"){if(!s)return;let i=e;return t==="secure"?i="__Secure-"+e:t==="host"&&(i="__Host-"+e),Vu(s,i)[i]}return s?Vu(s):{}};var hE=(r,e,t)=>{let s;return t?.prefix==="secure"?s=So("__Secure-"+r,e,{path:"/",...t,secure:!0}):t?.prefix==="host"?s=So("__Host-"+r,e,{...t,path:"/",secure:!0,domain:void 0}):s=So(r,e,{path:"/",...t}),s},Ds=(r,e,t,s)=>{let n=hE(e,t,s);r.header("Set-Cookie",n,{append:!0})};var lp=(r,e)=>new Response(r,{headers:{"Content-Type":e}}).formData();var dE=/^application\/([a-z-\.]+\+)?json(;\s*[a-zA-Z0-9\-]+\=([^;]+))*$/,fE=/^multipart\/form-data(;\s?boundary=[a-zA-Z0-9'"()+_,\-./:=?]+)?$/,pE=/^application\/x-www-form-urlencoded(;\s*[a-zA-Z0-9\-]+\=([^;]+))*$/,zu=(r,e)=>async(t,s)=>{let n={},i=t.req.header("Content-Type");switch(r){case"json":if(!i||!dE.test(i))break;try{n=await t.req.json()}catch{let a="Malformed JSON in request body";throw new It(400,{message:a})}break;case"form":{if(!i||!(fE.test(i)||pE.test(i)))break;let a;if(t.req.bodyCache.formData)a=await t.req.bodyCache.formData;else try{let u=await t.req.arrayBuffer();a=await lp(u,i),t.req.bodyCache.formData=a}catch(u){let l="Malformed FormData request.";throw l+=u instanceof Error?` ${u.message}`:` ${String(u)}`,new It(400,{message:l})}let c={};a.forEach((u,l)=>{l.endsWith("[]")?(c[l]??=[]).push(u):Array.isArray(c[l])?c[l].push(u):l in c?c[l]=[c[l],u]:c[l]=u}),n=c;break}case"query":n=Object.fromEntries(Object.entries(t.req.queries()).map(([a,c])=>c.length===1?[a,c[0]]:[a,c]));break;case"param":n=t.req.param();break;case"header":n=t.req.header();break;case"cookie":n=To(t);break}let o=await e(n,t);return o instanceof Response?o:(t.req.addValidatedData(r,o),await s())};var Ao=(r,e,t)=>zu(r,async(s,n)=>{let i=await e.safeParseAsync(s);if(t){let a=t({data:s,...i},n);if(a){if(a instanceof Response||a instanceof Promise)return a;if("response"in a)return a.response}}if(!i.success){let a=cp(i.error);return n.json({message:a.message,errors:a.details},400)}return i.data});var v=Symbol.for("drizzle:entityKind"),rk=Symbol.for("drizzle:hasOwnEntityKind");function T(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=r.constructor;if(t)for(;t;){if(v in t&&t[v]===e[v])return!0;t=Object.getPrototypeOf(t)}return!1}var Hu=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Oo=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Hu}logQuery(e,t){let s=t.map(i=>{try{return JSON.stringify(i)}catch{return String(i)}}),n=s.length?` -- params: [${s.join(", ")}]`:"";this.writer.write(`Query: ${e}${n}`)}},Ro=class{static[v]="NoopLogger";logQuery(){}};var nt=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};var ko=Symbol.for("drizzle:Name"),Ku=Symbol.for("drizzle:Schema"),hp=Symbol.for("drizzle:Columns"),Wu=Symbol.for("drizzle:OriginalName"),Gu=Symbol.for("drizzle:BaseName"),dp=Symbol.for("drizzle:IsAlias"),fp=Symbol.for("drizzle:ExtraConfigBuilder"),pp=Symbol.for("drizzle:IsDrizzleTable"),D=class{static[v]="Table";static Symbol={Name:ko,Schema:Ku,OriginalName:Wu,Columns:hp,BaseName:Gu,IsAlias:dp,ExtraConfigBuilder:fp};[ko];[Wu];[Ku];[hp];[Gu];[dp]=!1;[fp]=void 0;[pp]=!0;constructor(e,t,s){this[ko]=this[Wu]=e,this[Ku]=t,this[Gu]=s}};function mp(r){return typeof r=="object"&&r!==null&&pp in r}function _r(r){return r[ko]}function xo(r,...e){return r(...e)}var gp="0.30.10";var Qu,Ju,_e={startActiveSpan(r,e){return Qu?(Ju||(Ju=Qu.trace.getTracer("drizzle-orm",gp)),xo((t,s)=>s.startActiveSpan(r,n=>{try{return e(n)}catch(i){throw n.setStatus({code:t.SpanStatusCode.ERROR,message:i instanceof Error?i.message:"Unknown error"}),i}finally{n.end()}}),Qu,Ju)):e()}};var ve=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}static[v]="Column";name;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}};var Co=class{static[v]="ColumnBuilder";config;constructor(e,t,s){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:s}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}};var Zu=Symbol.for("drizzle:PgInlineForeignKeys"),Je=class extends D{static[v]="PgTable";static Symbol=Object.assign({},D.Symbol,{InlineForeignKeys:Zu});[Zu]=[];[D.Symbol.ExtraConfigBuilder]=void 0};function mE(r,e,t,s,n=r){let i=new Je(r,s,n),o=Object.fromEntries(Object.entries(e).map(([c,u])=>{let l=u,h=l.build(i);return i[Zu].push(...l.buildForeignKeys(h,i)),[c,h]})),a=Object.assign(i,o);return a[D.Symbol.Columns]=o,t&&(a[Je.Symbol.ExtraConfigBuilder]=t),a}var yp=(r,e,t)=>mE(r,e,t,void 0);var Po=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:s,columns:n,foreignColumns:i}=e();return{name:s,columns:n,foreignTable:i[0].table,foreignColumns:i}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Yu(e,this)}},Yu=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:s}=this.reference(),n=t.map(a=>a.name),i=s.map(a=>a.name),o=[this.table[Je.Symbol.Name],...n,s[0].table[Je.Symbol.Name],...i];return e??`${o.join("_")}_fk`}};function tl(r,e){return`${r[Je.Symbol.Name]}_${e.join("_")}_unique`}var Xu=class{constructor(e,t){this.name=t,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new el(e,this.columns,this.nullsNotDistinctConfig,this.name)}},_p=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Xu(e,this.name)}},el=class{constructor(e,t,s,n){this.table=e,this.columns=t,this.name=n??tl(this.table,this.columns.map(i=>i.name)),this.nullsNotDistinct=s}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function vp(r,e,t){for(let s=e;s<r.length;s++){let n=r[s];if(n==="\\"){s++;continue}if(n==='"')return[r.slice(e,s).replace(/\\/g,""),s+1];if(!t&&(n===","||n==="}"))return[r.slice(e,s).replace(/\\/g,""),s]}return[r.slice(e).replace(/\\/g,""),r.length]}function wp(r,e=0){let t=[],s=e,n=!1;for(;s<r.length;){let i=r[s];if(i===","){(n||s===e)&&t.push(""),n=!0,s++;continue}if(n=!1,i==="\\"){s+=2;continue}if(i==='"'){let[c,u]=vp(r,s+1,!0);t.push(c),s=u;continue}if(i==="}")return[t,s+1];if(i==="{"){let[c,u]=wp(r,s+1);t.push(c),s=u;continue}let[o,a]=vp(r,s,!1);t.push(o),s=a}return[t,s]}function bp(r){let[e]=wp(r,1);return e}function rl(r){return`{${r.map(e=>Array.isArray(e)?rl(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var Ze=class extends Co{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new sl(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:s,actions:n})=>xo((i,o)=>{let a=new Po(()=>{let c=i();return{columns:[e],foreignColumns:[c]}});return o.onUpdate&&a.onUpdate(o.onUpdate),o.onDelete&&a.onDelete(o.onDelete),a.build(t)},s,n))}},we=class extends ve{constructor(e,t){t.uniqueName||(t.uniqueName=tl(e,[t.name])),super(e,t),this.table=e}static[v]="PgColumn"},sl=class extends Ze{static[v]="PgArrayBuilder";constructor(e,t,s){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=s}build(e){let t=this.config.baseBuilder.build(e);return new nl(e,this.config,t)}},nl=class r extends we{constructor(e,t,s,n){super(e,t),this.baseColumn=s,this.range=n,this.size=t.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=bp(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let s=e.map(n=>n===null?null:T(this.baseColumn,r)?this.baseColumn.mapToDriverValue(n,!0):this.baseColumn.mapToDriverValue(n));return t?s:rl(s)}};var Ep=Symbol.for("drizzle:isPgEnum");function Tp(r){return!!r&&typeof r=="function"&&Ep in r&&r[Ep]===!0}var Sp=class extends Ze{static[v]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new il(e,this.config)}},il=class extends we{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};var Ke=class{static[v]="Subquery";constructor(e,t,s,n=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:s,isWith:n}}},Ls=class extends Ke{static[v]="WithSubquery"};var Ne=Symbol.for("drizzle:ViewBaseConfig");var Ap=class{static[v]="FakePrimitiveParam"};function ol(r){return r!=null&&typeof r.getSQL=="function"}function gE(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var Be=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new q([this])}},q=class r{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Rp;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return _e.startActiveSpan("drizzle.buildSQL",t=>{let s=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":s.sql,"drizzle.query.params":JSON.stringify(s.params)}),s})}buildQueryFromSourceParams(e,t){let s=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{escapeName:n,escapeParam:i,prepareTyping:o,inlineParams:a,paramStartIndex:c}=s;return gE(e.map(u=>{if(T(u,Be))return{sql:u.value.join(""),params:[]};if(T(u,xn))return{sql:n(u.value),params:[]};if(u===void 0)return{sql:"",params:[]};if(Array.isArray(u)){let l=[new Be("(")];for(let[h,f]of u.entries())l.push(f),h<u.length-1&&l.push(new Be(", "));return l.push(new Be(")")),this.buildQueryFromSourceParams(l,s)}if(T(u,r))return this.buildQueryFromSourceParams(u.queryChunks,{...s,inlineParams:a||u.shouldInlineParams});if(T(u,D)){let l=u[D.Symbol.Schema],h=u[D.Symbol.Name];return{sql:l===void 0?n(h):n(l)+"."+n(h),params:[]}}if(T(u,ve))return{sql:n(u.table[D.Symbol.Name])+"."+n(u.name),params:[]};if(T(u,lt)){let l=u[Ne].schema,h=u[Ne].name;return{sql:l===void 0?n(h):n(l)+"."+n(h),params:[]}}if(T(u,bt)){let l=u.value===null?null:u.encoder.mapToDriverValue(u.value);if(T(l,r))return this.buildQueryFromSourceParams([l],s);if(a)return{sql:this.mapInlineParam(l,s),params:[]};let h;return o!==void 0&&(h=[o(u.encoder)]),{sql:i(c.value++,l),params:[l],typings:h}}return T(u,Qr)?{sql:i(c.value++,u),params:[u]}:T(u,r.Aliased)&&u.fieldAlias!==void 0?{sql:n(u.fieldAlias),params:[]}:T(u,Ke)?u._.isWith?{sql:n(u._.alias),params:[]}:this.buildQueryFromSourceParams([new Be("("),u._.sql,new Be(") "),new xn(u._.alias)],s):Tp(u)?u.schema?{sql:n(u.schema)+"."+n(u.enumName),params:[]}:{sql:n(u.enumName),params:[]}:ol(u)?this.buildQueryFromSourceParams([new Be("("),u.getSQL(),new Be(")")],s):a?{sql:this.mapInlineParam(u,s),params:[]}:{sql:i(c.value++,u),params:[u]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let s=e.toString();return t(s==="[object Object]"?JSON.stringify(e):s)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new r.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},xn=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new q([this])}};function Op(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var Rp={mapFromDriverValue:r=>r},kp={mapToDriverValue:r=>r},Jk={...Rp,...kp},bt=class{constructor(e,t=kp){this.value=e,this.encoder=t}static[v]="Param";brand;getSQL(){return new q([this])}};function m(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new Be(r[0]));for(let[s,n]of e.entries())t.push(n,new Be(r[s+1]));return new q(t)}(r=>{function e(){return new q([])}r.empty=e;function t(c){return new q(c)}r.fromList=t;function s(c){return new q([new Be(c)])}r.raw=s;function n(c,u){let l=[];for(let[h,f]of c.entries())h>0&&u!==void 0&&l.push(u),l.push(f);return new q(l)}r.join=n;function i(c){return new xn(c)}r.identifier=i;function o(c){return new Qr(c)}r.placeholder=o;function a(c,u){return new bt(c,u)}r.param=a})(m||(m={}));(r=>{class e{constructor(s,n){this.sql=s,this.fieldAlias=n}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(q||(q={}));var Qr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new q([this])}};function al(r,e){return r.map(t=>{if(T(t,Qr)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}return t})}var lt=class{static[v]="View";[Ne];constructor({name:e,schema:t,selectedFields:s,query:n}){this[Ne]={name:e,originalName:e,schema:t,selectedFields:s,query:n,isExisting:!n,isAlias:!1}}getSQL(){return new q([this])}};ve.prototype.getSQL=function(){return new q([this])};D.prototype.getSQL=function(){return new q([this])};Ke.prototype.getSQL=function(){return new q([this])};function xp(r,e,t){let s={},n=r.reduce((i,{path:o,field:a},c)=>{let u;T(a,ve)?u=a:T(a,q)?u=a.decoder:u=a.sql.decoder;let l=i;for(let[h,f]of o.entries())if(h<o.length-1)f in l||(l[f]={}),l=l[f];else{let p=e[c],y=l[f]=p===null?null:u.mapFromDriverValue(p);if(t&&T(a,ve)&&o.length===2){let g=o[0];g in s?typeof s[g]=="string"&&s[g]!==_r(a.table)&&(s[g]=!1):s[g]=y===null?_r(a.table):!1}}return i},{});if(t&&Object.keys(s).length>0)for(let[i,o]of Object.entries(s))typeof o=="string"&&!t[o]&&(n[i]=null);return n}function Pt(r,e){return Object.entries(r).reduce((t,[s,n])=>{if(typeof s!="string")return t;let i=e?[...e,s]:[s];return T(n,ve)||T(n,q)||T(n,q.Aliased)?t.push({path:i,field:n}):T(n,D)?t.push(...Pt(n[D.Symbol.Columns],i)):t.push(...Pt(n,i)),t},[])}function cl(r,e){let t=Object.keys(r),s=Object.keys(e);if(t.length!==s.length)return!1;for(let[n,i]of t.entries())if(i!==s[n])return!1;return!0}function jo(r,e){let t=Object.entries(e).filter(([,s])=>s!==void 0).map(([s,n])=>T(n,q)?[s,n]:[s,new bt(n,r[D.Symbol.Columns][s])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function Cp(r,e){for(let t of e)for(let s of Object.getOwnPropertyNames(t.prototype))s!=="constructor"&&Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))}function Pp(r){return r[D.Symbol.Columns]}function ul(r){return T(r,Ke)?r._.alias:T(r,lt)?r[Ne].name:T(r,q)?void 0:r[D.Symbol.IsAlias]?r[D.Symbol.Name]:r[D.Symbol.BaseName]}var Cn=class extends nt{constructor(e,t,s,n){super(),this.session=t,this.dialect=s,this.config={table:e,withList:n}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[D.Symbol.Columns]){return this.config.returning=Pt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return _e.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}execute=e=>_e.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e));$dynamic(){return this}};var Pn=class{constructor(e,t,s,n){this.table=e,this.session=t,this.dialect=s,this.withList=n}static[v]="PgInsertBuilder";values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(s=>{let n={},i=this.table[D.Symbol.Columns];for(let o of Object.keys(s)){let a=s[o];n[o]=T(a,q)?a:new bt(a,i[o])}return n});return new ll(this.table,t,this.session,this.dialect,this.withList)}},ll=class extends nt{constructor(e,t,s,n,i){super(),this.session=s,this.dialect=n,this.config={table:e,values:t,withList:i}}static[v]="PgInsert";config;returning(e=this.config.table[D.Symbol.Columns]){return this.config.returning=Pt(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=m`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(n=>this.dialect.escapeName(n.name)).join(","):this.dialect.escapeName(e.target.name);let s=e.where?m` where ${e.where}`:void 0;this.config.onConflict=m`(${m.raw(t)})${s} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?m` where ${e.where}`:void 0,s=e.targetWhere?m` where ${e.targetWhere}`:void 0,n=e.setWhere?m` where ${e.setWhere}`:void 0,i=this.dialect.buildUpdateSet(this.config.table,jo(this.config.table,e.set)),o="";return o=Array.isArray(e.target)?e.target.map(a=>this.dialect.escapeName(a.name)).join(","):this.dialect.escapeName(e.target.name),this.config.onConflict=m`(${m.raw(o)})${s} do update set ${i}${t}${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return _e.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}execute=e=>_e.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e));$dynamic(){return this}};var Jr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,t){return t==="table"?this.table:e[t]}},Us=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[v]="TableAliasProxyHandler";get(e,t){if(t===D.Symbol.IsAlias)return!0;if(t===D.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===D.Symbol.OriginalName)return this.alias;if(t===Ne)return{...e[Ne],name:this.alias,isAlias:!0};if(t===D.Symbol.Columns){let n=e[D.Symbol.Columns];if(!n)return n;let i={};return Object.keys(n).map(o=>{i[o]=new Proxy(n[o],new Jr(new Proxy(e,this)))}),i}let s=e[t];return T(s,ve)?new Proxy(s,new Jr(new Proxy(e,this))):s}},jp=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?jn(e.sourceTable,this.alias):e[t]}};function jn(r,e){return new Proxy(r,new Us(e,!1))}function Jt(r,e){return new Proxy(r,new Jr(new Proxy(r.table,new Us(e,!1))))}function hl(r,e){return new q.Aliased(Nn(r.sql,e),r.fieldAlias)}function Nn(r,e){return m.join(r.queryChunks.map(t=>T(t,ve)?Jt(t,e):T(t,q)?Nn(t,e):T(t,q.Aliased)?hl(t,e):t))}var In=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},No=class extends In{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var Zt=class extends Ze{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(m`now()`)}};var Np=class extends Zt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new $n(e,this.config)}},$n=class extends we{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ip=class extends Zt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new Dn(e,this.config)}},Dn=class extends we{static[v]="PgDateString";getSQLType(){return"date"}};var $p=class extends Ze{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new Ln(e,this.config)}},Ln=class extends we{static[v]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};var Dp=class extends Ze{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Un(e,this.config)}},Un=class extends we{static[v]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};var Lp=class extends Ze{static[v]="PgNumericBuilder";constructor(e,t,s){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=s}build(e){return new qn(e,this.config)}},qn=class extends we{static[v]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};var dl=class extends Ze{static[v]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new fl(e,this.config)}},fl=class extends we{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function Up(r,e={}){return new dl(r,e)}var qp=class extends Zt{constructor(e,t,s){super(e,"string","PgTime"),this.withTimezone=t,this.precision=s,this.config.withTimezone=t,this.config.precision=s}static[v]="PgTimeBuilder";build(e){return new Bn(e,this.config)}},Bn=class extends we{static[v]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};var pl=class extends Zt{static[v]="PgTimestampBuilder";constructor(e,t,s){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=s}build(e){return new Mn(e,this.config)}},Mn=class extends we{static[v]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},ml=class extends Zt{static[v]="PgTimestampStringBuilder";constructor(e,t,s){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=s}build(e){return new Fn(e,this.config)}},Fn=class extends we{static[v]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function gl(r,e={}){return e.mode==="string"?new ml(r,e.withTimezone??!1,e.precision):new pl(r,e.withTimezone??!1,e.precision)}var yl=class extends Ze{static[v]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(m`gen_random_uuid()`)}build(e){return new Vn(e,this.config)}},Vn=class extends we{static[v]="PgUUID";getSQLType(){return"uuid"}};function Bp(r){return new yl(r)}var Io=class{static[v]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new _l(e,this.columns,this.name)}},_l=class{constructor(e,t,s){this.table=e,this.columns=t,this.name=s}static[v]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[Je.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};function _t(r,e){return Op(e)&&!ol(r)&&!T(r,bt)&&!T(r,Qr)&&!T(r,ve)&&!T(r,D)&&!T(r,lt)?new bt(r,e):r}var $o=(r,e)=>m`${r} = ${_t(e,r)}`,Mp=(r,e)=>m`${r} <> ${_t(e,r)}`;function zn(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new q(e):new q([new Be("("),m.join(e,new Be(" and ")),new Be(")")])}function Fp(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new q(e):new q([new Be("("),m.join(e,new Be(" or ")),new Be(")")])}function Vp(r){return m`not ${r}`}var zp=(r,e)=>m`${r} > ${_t(e,r)}`,Hp=(r,e)=>m`${r} >= ${_t(e,r)}`,Kp=(r,e)=>m`${r} < ${_t(e,r)}`,Wp=(r,e)=>m`${r} <= ${_t(e,r)}`;function Gp(r,e){if(Array.isArray(e)){if(e.length===0)throw new Error("inArray requires at least one value");return m`${r} in ${e.map(t=>_t(t,r))}`}return m`${r} in ${_t(e,r)}`}function Qp(r,e){if(Array.isArray(e)){if(e.length===0)throw new Error("notInArray requires at least one value");return m`${r} not in ${e.map(t=>_t(t,r))}`}return m`${r} not in ${_t(e,r)}`}function Jp(r){return m`${r} is null`}function Zp(r){return m`${r} is not null`}function Yp(r){return m`exists ${r}`}function Xp(r){return m`not exists ${r}`}function em(r,e,t){return m`${r} between ${_t(e,r)} and ${_t(t,r)}`}function tm(r,e,t){return m`${r} not between ${_t(e,r)} and ${_t(t,r)}`}function rm(r,e){return m`${r} like ${e}`}function sm(r,e){return m`${r} not like ${e}`}function nm(r,e){return m`${r} ilike ${e}`}function im(r,e){return m`${r} not ilike ${e}`}function om(r){return m`${r} asc`}function am(r){return m`${r} desc`}var Do=class{constructor(e,t,s){this.sourceTable=e,this.referencedTable=t,this.relationName=s,this.referencedTableName=t[D.Symbol.Name]}static[v]="Relation";referencedTableName;fieldName},vl=class{constructor(e,t){this.table=e,this.config=t}static[v]="Relations"},vr=class r extends Do{constructor(e,t,s,n){super(e,t,s?.relationName),this.config=s,this.isNullable=n}static[v]="One";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},Hn=class r extends Do{constructor(e,t,s){super(e,t,s?.relationName),this.config=s}static[v]="Many";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}};function cm(){return{and:zn,between:em,eq:$o,exists:Yp,gt:zp,gte:Hp,ilike:nm,inArray:Gp,isNull:Jp,isNotNull:Zp,like:rm,lt:Kp,lte:Wp,ne:Mp,not:Vp,notBetween:tm,notExists:Xp,notLike:sm,notIlike:im,notInArray:Qp,or:Fp,sql:m}}function um(){return{sql:m,asc:om,desc:am}}function lm(r,e){Object.keys(r).length===1&&"default"in r&&!T(r.default,D)&&(r=r.default);let t={},s={},n={};for(let[i,o]of Object.entries(r))if(mp(o)){let a=o[D.Symbol.Name],c=s[a];t[a]=i,n[i]={tsName:i,dbName:o[D.Symbol.Name],schema:o[D.Symbol.Schema],columns:o[D.Symbol.Columns],relations:c?.relations??{},primaryKey:c?.primaryKey??[]};for(let l of Object.values(o[D.Symbol.Columns]))l.primary&&n[i].primaryKey.push(l);let u=o[D.Symbol.ExtraConfigBuilder]?.(o);if(u)for(let l of Object.values(u))T(l,Io)&&n[i].primaryKey.push(...l.columns)}else if(T(o,vl)){let a=o.table[D.Symbol.Name],c=t[a],u=o.config(e(o.table)),l;for(let[h,f]of Object.entries(u))if(c){let p=n[c];p.relations[h]=f,l&&p.primaryKey.push(...l)}else a in s||(s[a]={relations:{},primaryKey:l}),s[a].relations[h]=f}return{tables:n,tableNamesMap:t}}function yE(r){return function(t,s){return new vr(r,t,s,s?.fields.reduce((n,i)=>n&&i.notNull,!0)??!1)}}function _E(r){return function(t,s){return new Hn(r,t,s)}}function hm(r,e,t){if(T(t,vr)&&t.config)return{fields:t.config.fields,references:t.config.references};let s=e[t.referencedTable[D.Symbol.Name]];if(!s)throw new Error(`Table "${t.referencedTable[D.Symbol.Name]}" not found in schema`);let n=r[s];if(!n)throw new Error(`Table "${s}" not found in schema`);let i=t.sourceTable,o=e[i[D.Symbol.Name]];if(!o)throw new Error(`Table "${i[D.Symbol.Name]}" not found in schema`);let a=[];for(let c of Object.values(n.relations))(t.relationName&&t!==c&&c.relationName===t.relationName||!t.relationName&&c.referencedTable===t.sourceTable)&&a.push(c);if(a.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${s}"`):new Error(`There are multiple relations between "${s}" and "${t.sourceTable[D.Symbol.Name]}". Please specify relation name`);if(a[0]&&T(a[0],vr)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${t.fieldName}"`)}function dm(r){return{one:yE(r),many:_E(r)}}function Lo(r,e,t,s,n=i=>i){let i={};for(let[o,a]of s.entries())if(a.isJson){let c=e.relations[a.tsKey],u=t[o],l=typeof u=="string"?JSON.parse(u):u;i[a.tsKey]=T(c,vr)?l&&Lo(r,r[a.relationTableTsKey],l,a.selection,n):l.map(h=>Lo(r,r[a.relationTableTsKey],h,a.selection,n))}else{let c=n(t[o]),u=a.field,l;T(u,ve)?l=u:T(u,q)?l=u.decoder:l=u.sql.decoder,i[a.tsKey]=c===null?null:l.mapFromDriverValue(c)}return i}var qs=class extends lt{static[v]="PgViewBase"};var Bs=class{static[v]="PgDialect";async migrate(e,t,s){let n=typeof s=="string"?"__drizzle_migrations":s.migrationsTable??"__drizzle_migrations",i=typeof s=="string"?"drizzle":s.migrationsSchema??"drizzle",o=m`
			CREATE TABLE IF NOT EXISTS ${m.identifier(i)}.${m.identifier(n)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(m`CREATE SCHEMA IF NOT EXISTS ${m.identifier(i)}`),await t.execute(o);let c=(await t.all(m`select id, hash, created_at from ${m.identifier(i)}.${m.identifier(n)} order by created_at desc limit 1`))[0];await t.transaction(async u=>{for await(let l of e)if(!c||Number(c.created_at)<l.folderMillis){for(let h of l.sql)await u.execute(m.raw(h));await u.execute(m`insert into ${m.identifier(i)}.${m.identifier(n)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[m`with `];for(let[s,n]of e.entries())t.push(m`${m.identifier(n._.alias)} as (${n._.sql})`),s<e.length-1&&t.push(m`, `);return t.push(m` `),m.join(t)}buildDeleteQuery({table:e,where:t,returning:s,withList:n}){let i=this.buildWithCTE(n),o=s?m` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,a=t?m` where ${t}`:void 0;return m`${i}delete from ${e}${a}${o}`}buildUpdateSet(e,t){let s=e[D.Symbol.Columns],n=Object.keys(s).filter(o=>t[o]!==void 0||s[o]?.onUpdateFn!==void 0),i=n.length;return m.join(n.flatMap((o,a)=>{let c=s[o],u=t[o]??m.param(c.onUpdateFn(),c),l=m`${m.identifier(c.name)} = ${u}`;return a<i-1?[l,m.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:t,where:s,returning:n,withList:i}){let o=this.buildWithCTE(i),a=this.buildUpdateSet(e,t),c=n?m` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,u=s?m` where ${s}`:void 0;return m`${o}update ${e} set ${a}${u}${c}`}buildSelection(e,{isSingleTable:t=!1}={}){let s=e.length,n=e.flatMap(({field:i},o)=>{let a=[];if(T(i,q.Aliased)&&i.isSelectionField)a.push(m.identifier(i.fieldAlias));else if(T(i,q.Aliased)||T(i,q)){let c=T(i,q.Aliased)?i.sql:i;t?a.push(new q(c.queryChunks.map(u=>T(u,we)?m.identifier(u.name):u))):a.push(c),T(i,q.Aliased)&&a.push(m` as ${m.identifier(i.fieldAlias)}`)}else T(i,ve)&&(t?a.push(m.identifier(i.name)):a.push(i));return o<s-1&&a.push(m`, `),a});return m.join(n)}buildSelectQuery({withList:e,fields:t,fieldsFlat:s,where:n,having:i,table:o,joins:a,orderBy:c,groupBy:u,limit:l,offset:h,lockingClause:f,distinct:p,setOperators:y}){let g=s??Pt(t);for(let ae of g)if(T(ae.field,ve)&&_r(ae.field.table)!==(T(o,Ke)?o._.alias:T(o,qs)?o[Ne].name:T(o,q)?void 0:_r(o))&&!(de=>a?.some(({alias:ze})=>ze===(de[D.Symbol.IsAlias]?_r(de):de[D.Symbol.BaseName])))(ae.field.table)){let de=_r(ae.field.table);throw new Error(`Your "${ae.path.join("->")}" field references a column "${de}"."${ae.field.name}", but the table "${de}" is not part of the query! Did you forget to join it?`)}let w=!a||a.length===0,b=this.buildWithCTE(e),A;p&&(A=p===!0?m` distinct`:m` distinct on (${m.join(p.on,m`, `)})`);let E=this.buildSelection(g,{isSingleTable:w}),k=(()=>{if(T(o,D)&&o[D.Symbol.OriginalName]!==o[D.Symbol.Name]){let ae=m`${m.identifier(o[D.Symbol.OriginalName])}`;return o[D.Symbol.Schema]&&(ae=m`${m.identifier(o[D.Symbol.Schema])}.${ae}`),m`${ae} ${m.identifier(o[D.Symbol.Name])}`}return o})(),U=[];if(a)for(let[ae,de]of a.entries()){ae===0&&U.push(m` `);let ze=de.table,O=de.lateral?m` lateral`:void 0;if(T(ze,Je)){let M=ze[Je.Symbol.Name],te=ze[Je.Symbol.Schema],le=ze[Je.Symbol.OriginalName],Oe=M===le?void 0:de.alias;U.push(m`${m.raw(de.joinType)} join${O} ${te?m`${m.identifier(te)}.`:void 0}${m.identifier(le)}${Oe&&m` ${m.identifier(Oe)}`} on ${de.on}`)}else if(T(ze,lt)){let M=ze[Ne].name,te=ze[Ne].schema,le=ze[Ne].originalName,Oe=M===le?void 0:de.alias;U.push(m`${m.raw(de.joinType)} join${O} ${te?m`${m.identifier(te)}.`:void 0}${m.identifier(le)}${Oe&&m` ${m.identifier(Oe)}`} on ${de.on}`)}else U.push(m`${m.raw(de.joinType)} join${O} ${ze} on ${de.on}`);ae<a.length-1&&U.push(m` `)}let V=m.join(U),I=n?m` where ${n}`:void 0,W=i?m` having ${i}`:void 0,Y;c&&c.length>0&&(Y=m` order by ${m.join(c,m`, `)}`);let R;u&&u.length>0&&(R=m` group by ${m.join(u,m`, `)}`);let Ae=l?m` limit ${l}`:void 0,Q=h?m` offset ${h}`:void 0,me=m.empty();if(f){let ae=m` for ${m.raw(f.strength)}`;f.config.of&&ae.append(m` of ${m.join(Array.isArray(f.config.of)?f.config.of:[f.config.of],m`, `)}`),f.config.noWait?ae.append(m` no wait`):f.config.skipLocked&&ae.append(m` skip locked`),me.append(ae)}let Tt=m`${b}select${A} ${E} from ${k}${V}${I}${R}${W}${Y}${Ae}${Q}${me}`;return y.length>0?this.buildSetOperations(Tt,y):Tt}buildSetOperations(e,t){let[s,...n]=t;if(!s)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:s}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:s}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:s,rightSelect:n,limit:i,orderBy:o,offset:a}}){let c=m`(${e.getSQL()}) `,u=m`(${n.getSQL()})`,l;if(o&&o.length>0){let y=[];for(let g of o)if(T(g,we))y.push(m.identifier(g.name));else if(T(g,q)){for(let w=0;w<g.queryChunks.length;w++){let b=g.queryChunks[w];T(b,we)&&(g.queryChunks[w]=m.identifier(b.name))}y.push(m`${g}`)}else y.push(m`${g}`);l=m` order by ${m.join(y,m`, `)} `}let h=i?m` limit ${i}`:void 0,f=m.raw(`${t} ${s?"all ":""}`),p=a?m` offset ${a}`:void 0;return m`${c}${f}${u}${l}${h}${p}`}buildInsertQuery({table:e,values:t,onConflict:s,returning:n,withList:i}){let o=[],a=e[D.Symbol.Columns],c=Object.entries(a),u=c.map(([,y])=>m.identifier(y.name));for(let[y,g]of t.entries()){let w=[];for(let[b,A]of c){let E=g[b];if(E===void 0||T(E,bt)&&E.value===void 0)if(A.defaultFn!==void 0){let k=A.defaultFn(),U=T(k,q)?k:m.param(k,A);w.push(U)}else if(!A.default&&A.onUpdateFn!==void 0){let k=A.onUpdateFn(),U=T(k,q)?k:m.param(k,A);w.push(U)}else w.push(m`default`);else w.push(E)}o.push(w),y<t.length-1&&o.push(m`, `)}let l=this.buildWithCTE(i),h=m.join(o),f=n?m` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,p=s?m` on conflict ${s}`:void 0;return m`${l}insert into ${e} ${u} values ${h}${p}${f}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:s}){let n=t?m` concurrently`:void 0,i=s?m` with no data`:void 0;return m`refresh materialized view${n} ${e}${i}`}prepareTyping(e){return T(e,Un)||T(e,Ln)?"json":T(e,qn)?"decimal":T(e,Bn)?"time":T(e,Mn)||T(e,Fn)?"timestamp":T(e,$n)||T(e,Dn)?"date":T(e,Vn)?"uuid":"none"}sqlToQuery(e){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:s,table:n,tableConfig:i,queryConfig:o,tableAlias:a,nestedQueryRelation:c,joinOn:u}){let l=[],h,f,p=[],y,g=[];if(o===!0)l=Object.entries(i.columns).map(([A,E])=>({dbKey:E.name,tsKey:A,field:Jt(E,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let b=Object.fromEntries(Object.entries(i.columns).map(([I,W])=>[I,Jt(W,a)]));if(o.where){let I=typeof o.where=="function"?o.where(b,cm()):o.where;y=I&&Nn(I,a)}let A=[],E=[];if(o.columns){let I=!1;for(let[W,Y]of Object.entries(o.columns))Y!==void 0&&W in i.columns&&(!I&&Y===!0&&(I=!0),E.push(W));E.length>0&&(E=I?E.filter(W=>o.columns?.[W]===!0):Object.keys(i.columns).filter(W=>!E.includes(W)))}else E=Object.keys(i.columns);for(let I of E){let W=i.columns[I];A.push({tsKey:I,value:W})}let k=[];o.with&&(k=Object.entries(o.with).filter(I=>!!I[1]).map(([I,W])=>({tsKey:I,queryConfig:W,relation:i.relations[I]})));let U;if(o.extras){U=typeof o.extras=="function"?o.extras(b,{sql:m}):o.extras;for(let[I,W]of Object.entries(U))A.push({tsKey:I,value:hl(W,a)})}for(let{tsKey:I,value:W}of A)l.push({dbKey:T(W,q.Aliased)?W.fieldAlias:i.columns[I].name,tsKey:I,field:T(W,ve)?Jt(W,a):W,relationTableTsKey:void 0,isJson:!1,selection:[]});let V=typeof o.orderBy=="function"?o.orderBy(b,um()):o.orderBy??[];Array.isArray(V)||(V=[V]),p=V.map(I=>T(I,ve)?Jt(I,a):Nn(I,a)),h=o.limit,f=o.offset;for(let{tsKey:I,queryConfig:W,relation:Y}of k){let R=hm(t,s,Y),Ae=Y.referencedTable[D.Symbol.Name],Q=s[Ae],me=`${a}_${I}`,Tt=zn(...R.fields.map((ze,O)=>$o(Jt(R.references[O],me),Jt(ze,a)))),ae=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:s,table:e[Q],tableConfig:t[Q],queryConfig:T(Y,vr)?W===!0?{limit:1}:{...W,limit:1}:W,tableAlias:me,joinOn:Tt,nestedQueryRelation:Y}),de=m`${m.identifier(me)}.${m.identifier("data")}`.as(I);g.push({on:m`true`,table:new Ke(ae.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:I,tsKey:I,field:de,relationTableTsKey:Q,isJson:!0,selection:ae.selection})}}if(l.length===0)throw new In({message:`No fields selected for table "${i.tsName}" ("${a}")`});let w;if(y=zn(u,y),c){let b=m`json_build_array(${m.join(l.map(({field:k,tsKey:U,isJson:V})=>V?m`${m.identifier(`${a}_${U}`)}.${m.identifier("data")}`:T(k,q.Aliased)?k.sql:k),m`, `)})`;T(c,Hn)&&(b=m`coalesce(json_agg(${b}${p.length>0?m` order by ${m.join(p,m`, `)}`:void 0}), '[]'::json)`);let A=[{dbKey:"data",tsKey:"data",field:b.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:l}];h!==void 0||f!==void 0||p.length>0?(w=this.buildSelectQuery({table:jn(n,a),fields:{},fieldsFlat:[{path:[],field:m.raw("*")}],where:y,limit:h,offset:f,orderBy:p,setOperators:[]}),y=void 0,h=void 0,f=void 0,p=[]):w=jn(n,a),w=this.buildSelectQuery({table:T(w,Je)?w:new Ke(w,{},a),fields:{},fieldsFlat:A.map(({field:k})=>({path:[],field:T(k,ve)?Jt(k,a):k})),joins:g,where:y,limit:h,offset:f,orderBy:p,setOperators:[]})}else w=this.buildSelectQuery({table:jn(n,a),fields:{},fieldsFlat:l.map(({field:b})=>({path:[],field:T(b,ve)?Jt(b,a):b})),joins:g,where:y,limit:h,offset:f,orderBy:p,setOperators:[]});return{tableTsKey:i.tsName,sql:w,selection:l}}};var vt=class r{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===Ne)return{...e[Ne],selectedFields:new Proxy(e[Ne].selectedFields,this)};if(typeof t=="symbol")return e[t];let n=(T(e,Ke)?e._.selectedFields:T(e,lt)?e[Ne].selectedFields:e)[t];if(T(n,q.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!n.isSelectionField)return n.sql;let i=n.clone();return i.isSelectionField=!0,i}if(T(n,q)){if(this.config.sqlBehavior==="sql")return n;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return T(n,ve)?this.config.alias?new Proxy(n,new Jr(new Proxy(n.table,new Us(this.config.alias,this.config.replaceOriginalName??!1)))):n:typeof n!="object"||n===null?n:new Proxy(n,new r(this.config))}};var Uo=class{static[v]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var it=class{static[v]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}from(e){let t=!!this.fields,s;return this.fields?s=this.fields:T(e,Ke)?s=Object.fromEntries(Object.keys(e._.selectedFields).map(n=>[n,e[n]])):T(e,qs)?s=e[Ne].selectedFields:T(e,q)?s={}:s=Pp(e),new qo({table:e,fields:s,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}},wl=class extends Uo{static[v]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:s,session:n,dialect:i,withList:o,distinct:a}){super(),this.config={withList:o,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=s,this.session=n,this.dialect=i,this._={selectedFields:t},this.tableName=ul(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,s)=>{let n=this.tableName,i=ul(t);if(typeof i=="string"&&this.config.joins?.some(o=>o.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof i=="string"&&!T(t,q))){let o=T(t,Ke)?t._.selectedFields:T(t,lt)?t[Ne].selectedFields:t[D.Symbol.Columns];this.config.fields[i]=o}if(typeof s=="function"&&(s=s(new Proxy(this.config.fields,new vt({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:s,table:t,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return s=>{let n=typeof s=="function"?s(vE()):s;if(!cl(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new vt({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new vt({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new vt({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new vt({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new Ke(this.getSQL(),this.config.fields,e),new vt({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new vt({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},qo=class extends wl{static[v]="PgSelect";_prepare(e){let{session:t,config:s,dialect:n,joinsNotNullableMap:i}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return _e.startActiveSpan("drizzle.prepareQuery",()=>{let o=Pt(s.fields),a=t.prepareQuery(n.sqlToQuery(this.getSQL()),o,e,!0);return a.joinsNotNullableMap=i,a})}prepare(e){return this._prepare(e)}execute=e=>_e.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e))};Cp(qo,[nt]);function Ms(r,e){return(t,s,...n)=>{let i=[s,...n].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of i)if(!cl(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(i)}}var vE=()=>({union:wE,unionAll:bE,intersect:EE,intersectAll:SE,except:TE,exceptAll:AE}),wE=Ms("union",!1),bE=Ms("union",!0),EE=Ms("intersect",!1),SE=Ms("intersect",!0),TE=Ms("except",!1),AE=Ms("except",!0);var Bo=class{static[v]="PgQueryBuilder";dialect;$with(e){let t=this;return{as(s){return typeof s=="function"&&(s=s(t)),new Proxy(new Ls(s.getSQL(),s.getSelectedFields(),e,!0),new vt({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){let t=this;function s(o){return new it({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function n(o){return new it({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function i(o,a){return new it({fields:a??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:o}})}return{select:s,selectDistinct:n,selectDistinctOn:i}}select(e){return new it({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new it({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new it({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Bs),this.dialect}};var Mo=class extends nt{constructor(e,t,s){super(),this.session=t,this.dialect=s,this.config={view:e}}static[v]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return _e.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}execute=e=>_e.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e))};var Kn=class{constructor(e,t,s,n){this.table=e,this.session=t,this.dialect=s,this.withList=n}static[v]="PgUpdateBuilder";set(e){return new bl(this.table,jo(this.table,e),this.session,this.dialect,this.withList)}},bl=class extends nt{constructor(e,t,s,n,i){super(),this.session=s,this.dialect=n,this.config={set:t,table:e,withList:i}}static[v]="PgUpdate";config;where(e){return this.config.where=e,this}returning(e=this.config.table[D.Symbol.Columns]){return this.config.returning=Pt(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0)}prepare(e){return this._prepare(e)}execute=e=>this._prepare().execute(e);$dynamic(){return this}};var Fo=class{constructor(e,t,s,n,i,o,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=n,this.tableConfig=i,this.dialect=o,this.session=a}static[v]="PgRelationalQueryBuilder";findMany(e){return new Vo(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Vo(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},Vo=class extends nt{constructor(e,t,s,n,i,o,a,c,u){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=n,this.tableConfig=i,this.dialect=o,this.session=a,this.config=c,this.mode=u}static[v]="PgRelationalQuery";_prepare(e){return _e.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:s}=this._toSQL();return this.session.prepareQuery(s,void 0,e,!0,(n,i)=>{let o=n.map(a=>Lo(this.schema,this.tableConfig,a,t.selection,i));return this.mode==="first"?o[0]:o})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}execute(){return _e.startActiveSpan("drizzle.operation",()=>this._prepare().execute())}};var zo=class extends nt{constructor(e,t,s,n){super(),this.execute=e,this.sql=t,this.query=s,this.mapBatchResult=n}static[v]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Fs=class{constructor(e,t,s){if(this.dialect=e,this.session=t,this._=s?{schema:s.schema,fullSchema:s.fullSchema,tableNamesMap:s.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[n,i]of Object.entries(this._.schema))this.query[n]=new Fo(s.fullSchema,this._.schema,this._.tableNamesMap,s.fullSchema[n],i,e,t)}static[v]="PgDatabase";query;$with(e){return{as(t){return typeof t=="function"&&(t=t(new Bo)),new Proxy(new Ls(t.getSQL(),t.getSelectedFields(),e,!0),new vt({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){let t=this;function s(u){return new it({fields:u??void 0,session:t.session,dialect:t.dialect,withList:e})}function n(u){return new it({fields:u??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function i(u,l){return new it({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:u}})}function o(u){return new Kn(u,t.session,t.dialect,e)}function a(u){return new Pn(u,t.session,t.dialect,e)}function c(u){return new Cn(u,t.session,t.dialect,e)}return{select:s,selectDistinct:n,selectDistinctOn:i,update:o,insert:a,delete:c}}select(e){return new it({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new it({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new it({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Kn(e,this.session,this.dialect)}insert(e){return new Pn(e,this.session,this.dialect)}delete(e){return new Cn(e,this.session,this.dialect)}refreshMaterializedView(e){return new Mo(e,this.session,this.dialect)}execute(e){let t=e.getSQL(),s=this.dialect.sqlToQuery(t),n=this.session.prepareQuery(s,void 0,void 0,!1);return new zo(()=>n.execute(),t,s,i=>n.mapResult(i,!0))}transaction(e,t){return this.session.transaction(e,t)}};var Ho=class{constructor(e){this.query=e}getQuery(){return this.query}mapResult(e,t){return e}static[v]="PgPreparedQuery";joinsNotNullableMap},Ko=class{constructor(e){this.dialect=e}static[v]="PgSession";execute(e){return _e.startActiveSpan("drizzle.operation",()=>_e.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).execute())}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}},Wo=class extends Fs{constructor(e,t,s,n=0){super(e,t,s),this.schema=s,this.nestedIndex=n}static[v]="PgTransaction";rollback(){throw new No}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),m.raw(t.join(" "))}setTransaction(e){return this.session.execute(m`set transaction ${this.getTransactionConfigSQL(e)}`)}};var El=class extends Ho{constructor(e,t,s,n,i,o,a){super({sql:t,params:s}),this.client=e,this.queryString=t,this.params=s,this.logger=n,this.fields=i,this._isResponseInArrayMode=o,this.customResultMapper=a}static[v]="PostgresJsPreparedQuery";async execute(e={}){return _e.startActiveSpan("drizzle.execute",async t=>{let s=al(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(s)}),this.logger.logQuery(this.queryString,s);let{fields:n,queryString:i,client:o,joinsNotNullableMap:a,customResultMapper:c}=this;if(!n&&!c)return _e.startActiveSpan("drizzle.driver.execute",()=>o.unsafe(i,s));let u=await _e.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":i,"drizzle.query.params":JSON.stringify(s)}),o.unsafe(i,s).values()));return _e.startActiveSpan("drizzle.mapResponse",()=>c?c(u):u.map(l=>xp(n,l,a)))})}all(e={}){return _e.startActiveSpan("drizzle.execute",async t=>{let s=al(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(s)}),this.logger.logQuery(this.queryString,s),_e.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(s)}),this.client.unsafe(this.queryString,s)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},Wn=class r extends Ko{constructor(e,t,s,n={}){super(t),this.client=e,this.schema=s,this.options=n,this.logger=n.logger??new Ro}static[v]="PostgresJsSession";logger;prepareQuery(e,t,s,n,i){return new El(this.client,e.sql,e.params,this.logger,t,n,i)}query(e,t){return this.logger.logQuery(e,t),this.client.unsafe(e,t).values()}queryObjects(e,t){return this.client.unsafe(e,t)}transaction(e,t){return this.client.begin(async s=>{let n=new r(s,this.dialect,this.schema,this.options),i=new Sl(this.dialect,n,this.schema);return t&&await i.setTransaction(t),e(i)})}},Sl=class r extends Wo{constructor(e,t,s,n=0){super(e,t,s,n),this.session=t}static[v]="PostgresJsTransaction";transaction(e){return this.session.client.savepoint(t=>{let s=new Wn(t,this.dialect,this.schema,this.session.options),n=new r(this.dialect,s,this.schema);return e(n)})}};function Tl(r,e={}){let t=a=>a;for(let a of["1184","1082","1083","1114"])r.options.parsers[a]=t,r.options.serializers[a]=t;let s=new Bs,n;e.logger===!0?n=new Oo:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let a=lm(e.schema,dm);i={fullSchema:e.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let o=new Wn(r,s,i,{logger:n});return new Fs(s,o,i)}import QE from"os";import JE from"fs";var Go=new Map,Al=new Map,Ol=Symbol("OriginError"),Vs={},Et=class extends Promise{constructor(e,t,s,n,i={}){let o,a;super((c,u)=>{o=c,a=u}),this.tagged=Array.isArray(e.raw),this.strings=e,this.args=t,this.handler=s,this.canceller=n,this.options=i,this.state=null,this.statement=null,this.resolve=c=>(this.active=!1,o(c)),this.reject=c=>(this.active=!1,a(c)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[Ol]=this.handler.debug?new Error:this.tagged&&OE(this.strings)}get origin(){return(this.handler.debug?this[Ol].stack:this.tagged&&Al.has(this.strings)?Al.get(this.strings):Al.set(this.strings,this[Ol].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(e=1,t){if(this.options.simple=!1,typeof e=="function"&&(t=e,e=1),this.cursorRows=e,typeof t=="function")return this.cursorFn=t,this;let s;return{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};s&&s();let n=new Promise((i,o)=>{this.cursorFn=a=>(i({value:a,done:!1}),new Promise(c=>s=c)),this.resolve=()=>(this.active=!1,i({done:!0})),this.reject=a=>(this.active=!1,o(a))});return this.execute(),n},return(){return s&&s(Vs),{done:!0}}})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw new Error(".stream has been renamed to .forEach")}forEach(e){return this.forEachFn=e,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}};function OE(r){if(Go.has(r))return Go.get(r);let e=Error.stackTraceLimit;return Error.stackTraceLimit=4,Go.set(r,new Error),Error.stackTraceLimit=e,Go.get(r)}var Zr=class extends Error{constructor(e){super(e.message),this.name=this.constructor.name,Object.assign(this,e)}},Me={connection:fm,postgres:pm,generic:mm,notSupported:gm};function fm(r,e,t){let{host:s,port:n}=t||e,i=Object.assign(new Error("write "+r+" "+(e.path||s+":"+n)),{code:r,errno:r,address:e.path||s},e.path?{}:{port:n});return Error.captureStackTrace(i,fm),i}function pm(r){let e=new Zr(r);return Error.captureStackTrace(e,pm),e}function mm(r,e){let t=Object.assign(new Error(r+": "+e),{code:r});return Error.captureStackTrace(t,mm),t}function gm(r){let e=Object.assign(new Error(r+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:r});return Error.captureStackTrace(e,gm),e}var RE={string:{to:25,from:null,serialize:r=>""+r},number:{to:0,from:[21,23,26,700,701],serialize:r=>""+r,parse:r=>+r},json:{to:114,from:[114,3802],serialize:r=>JSON.stringify(r),parse:r=>JSON.parse(r)},boolean:{to:16,from:16,serialize:r=>r===!0?"t":"f",parse:r=>r==="t"},date:{to:1184,from:[1082,1114,1184],serialize:r=>(r instanceof Date?r:new Date(r)).toISOString(),parse:r=>new Date(r)},bytea:{to:17,from:17,serialize:r=>"\\x"+Buffer.from(r).toString("hex"),parse:r=>Buffer.from(r.slice(2),"hex")}},Gn=class{then(){Rl()}catch(){Rl()}finally(){Rl()}},zs=class extends Gn{constructor(e){super(),this.value=Yo(e)}},Bt=class extends Gn{constructor(e,t,s){super(),this.value=e,this.type=t,this.array=s}},Qn=class extends Gn{constructor(e,t){super(),this.first=e,this.rest=t}build(e,t,s,n){let i=kE.map(([o,a])=>({fn:a,i:e.search(o)})).sort((o,a)=>o.i-a.i).pop();return i.i===-1?jl(this.first,n):i.fn(this.first,this.rest,t,s,n)}};function Zo(r,e,t,s){let n=r instanceof Bt?r.value:r;if(n===void 0&&(r instanceof Bt?r.value=s.transform.undefined:n=r=s.transform.undefined,n===void 0))throw Me.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+t.push(r instanceof Bt?(e.push(r.value),r.array?r.array[r.type||Jo(r.value)]||r.type||wm(r.value):r.type):(e.push(r),Jo(r)))}var _m=Em(RE);function Cl(r,e,t,s,n,i){for(let o=1;o<r.strings.length;o++)e+=Pl(e,t,s,n,i)+r.strings[o],t=r.args[o];return e}function Pl(r,e,t,s,n){return e instanceof Qn?e.build(r,t,s,n):e instanceof Et?xl(e,t,s,n):e instanceof zs?e.value:e&&e[0]instanceof Et?e.reduce((i,o)=>i+" "+xl(o,t,s,n),""):Zo(e,t,s,n)}function xl(r,e,t,s){return r.fragment=!0,Cl(r,r.strings[0],r.args[0],e,t,s)}function vm(r,e,t,s,n){return r.map(i=>"("+s.map(o=>Pl("values",i[o],e,t,n)).join(",")+")").join(",")}function ym(r,e,t,s,n){let i=Array.isArray(r[0]),o=e.length?e.flat():Object.keys(i?r[0]:r);return vm(i?r:[r],t,s,o,n)}function Qo(r,e,t,s,n){if(typeof r=="string"&&(r=[r].concat(e)),Array.isArray(r))return jl(r,n);let i;return(e.length?e.flat():Object.keys(r)).map(a=>(i=r[a],(i instanceof Et?xl(i,t,s,n):i instanceof zs?i.value:Zo(i,t,s,n))+" as "+Yo(n.transform.column.to?n.transform.column.to(a):a))).join(",")}var kE=Object.entries({values:ym,in:(...r)=>{let e=ym(...r);return e==="()"?"(null)":e},select:Qo,as:Qo,returning:Qo,"\\(":Qo,update(r,e,t,s,n){return(e.length?e.flat():Object.keys(r)).map(i=>Yo(n.transform.column.to?n.transform.column.to(i):i)+"="+Pl("values",r[i],t,s,n))},insert(r,e,t,s,n){let i=e.length?e.flat():Object.keys(Array.isArray(r)?r[0]:r);return"("+jl(i,n)+")values"+vm(Array.isArray(r)?r:[r],t,s,i,n)}}).map(([r,e])=>[new RegExp("((?:^|[\\s(])"+r+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),e]);function Rl(){throw Me.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}var xE=_m.serializers,CE=_m.parsers;function wm(r){return Array.isArray(r)?wm(r[0]):typeof r=="string"?1009:0}var bm=function(r){let e=Em(r||{});return{serializers:Object.assign({},xE,e.serializers),parsers:Object.assign({},CE,e.parsers)}};function Em(r){return Object.keys(r).reduce((e,t)=>(r[t].from&&[].concat(r[t].from).forEach(s=>e.parsers[s]=r[t].parse),r[t].serialize&&(e.serializers[r[t].to]=r[t].serialize,r[t].from&&[].concat(r[t].from).forEach(s=>e.serializers[s]=r[t].serialize)),e),{parsers:{},serializers:{}})}function jl(r,{transform:{column:e}}){return r.map(t=>Yo(e.to?e.to(t):t)).join(",")}var Yo=function(e){return'"'+e.replace(/"/g,'""').replace(/\./g,'"."')+'"'},Jo=function r(e){return e instanceof Bt?e.type:e instanceof Date?1184:e instanceof Uint8Array?17:e===!0||e===!1?16:typeof e=="bigint"?20:Array.isArray(e)?r(e[0]):0},PE=/\\/g,jE=/"/g;function NE(r){return r.replace(PE,"\\\\").replace(jE,'\\"')}var Sm=function r(e,t,s,n){if(Array.isArray(e)===!1)return e;if(!e.length)return"{}";let i=e[0],o=n===1020?";":",";return Array.isArray(i)&&!i.type?"{"+e.map(a=>r(a,t,s,n)).join(o)+"}":"{"+e.map(a=>{if(a===void 0&&(a=s.transform.undefined,a===void 0))throw Me.generic("UNDEFINED_VALUE","Undefined values are not allowed");return a===null?"null":'"'+NE(t?t(a.type?a.value:a):""+a)+'"'}).join(o)+"}"},kl={i:0,char:null,str:"",quoted:!1,last:0},Tm=function(e,t,s){return kl.i=kl.last=0,Am(kl,e,t,s)};function Am(r,e,t,s){let n=[],i=s===1020?";":",";for(;r.i<e.length;r.i++){if(r.char=e[r.i],r.quoted)r.char==="\\"?r.str+=e[++r.i]:r.char==='"'?(n.push(t?t(r.str):r.str),r.str="",r.quoted=e[r.i+1]==='"',r.last=r.i+2):r.str+=r.char;else if(r.char==='"')r.quoted=!0;else if(r.char==="{")r.last=++r.i,n.push(Am(r,e,t,s));else if(r.char==="}"){r.quoted=!1,r.last<r.i&&n.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1;break}else r.char===i&&r.p!=="}"&&r.p!=='"'&&(n.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1);r.p=r.char}return r.last<r.i&&n.push(t?t(e.slice(r.last,r.i+1)):e.slice(r.last,r.i+1)),n}var Yr=r=>{let e=r[0];for(let t=1;t<r.length;t++)e+=r[t]==="_"?r[++t].toUpperCase():r[t];return e},Xr=r=>{let e=r[0].toUpperCase();for(let t=1;t<r.length;t++)e+=r[t]==="_"?r[++t].toUpperCase():r[t];return e},es=r=>r.replace(/_/g,"-"),Jn=r=>r.replace(/([A-Z])/g,"_$1").toLowerCase(),Zn=r=>(r.slice(0,1)+r.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),Yn=r=>r.replace(/-/g,"_");function Nl(r){return function e(t,s){return typeof t=="object"&&t!==null&&(s.type===114||s.type===3802)?Array.isArray(t)?t.map(n=>e(n,s)):Object.entries(t).reduce((n,[i,o])=>Object.assign(n,{[r(i)]:e(o,s)}),{}):t}}Yr.column={from:Yr};Yr.value={from:Nl(Yr)};Jn.column={to:Jn};var Il={...Yr};Il.column.to=Jn;Xr.column={from:Xr};Xr.value={from:Nl(Xr)};Zn.column={to:Zn};var $l={...Xr};$l.column.to=Zn;es.column={from:es};es.value={from:Nl(es)};Yn.column={to:Yn};var Dl={...es};Dl.column.to=Yn;import Om from"net";import LE from"tls";import Xn from"crypto";import Ll from"stream";import{performance as Rm}from"perf_hooks";var wr=class extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}};var St=IE;function IE(r=[]){let e=r.slice(),t=0;return{get length(){return e.length-t},remove:s=>{let n=e.indexOf(s);return n===-1?null:(e.splice(n,1),s)},push:s=>(e.push(s),s),shift:()=>{let s=e[t++];return t===e.length?(t=0,e=[]):e[t-1]=void 0,s}}}var ot=Buffer.allocUnsafe(256),$E="BCcDdEFfHPpQSX".split("").reduce((r,e)=>{let t=e.charCodeAt(0);return r[e]=()=>(ot[0]=t,ye.i=5,ye),r},{}),ye=Object.assign(DE,$E,{N:"\0",i:0,inc(r){return ye.i+=r,ye},str(r){let e=Buffer.byteLength(r);return Xo(e),ye.i+=ot.write(r,ye.i,e,"utf8"),ye},i16(r){return Xo(2),ot.writeUInt16BE(r,ye.i),ye.i+=2,ye},i32(r,e){return e||e===0?(ot.writeUInt32BE(r,e),ye):(Xo(4),ot.writeUInt32BE(r,ye.i),ye.i+=4,ye)},z(r){return Xo(r),ot.fill(0,ye.i,ye.i+r),ye.i+=r,ye},raw(r){return ot=Buffer.concat([ot.subarray(0,ye.i),r]),ye.i=ot.length,ye},end(r=1){ot.writeUInt32BE(ye.i-r,r);let e=ot.subarray(0,ye.i);return ye.i=0,ot=Buffer.allocUnsafe(256),e}}),B=ye;function Xo(r){if(ot.length-ye.i<r){let e=ot,t=e.length;ot=Buffer.allocUnsafe(t+(t>>1)+r),e.copy(ot)}}function DE(){return ye.i=0,ye}var Bl=Cm,UE=1,br=B().S().end(),km=B().H().end(),qE=B().i32(8).i32(80877103).end(8),BE=Buffer.concat([B().E().str(B.N).i32(0).end(),br]),ME=B().D().str("S").str(B.N).end(),Hs=()=>{},FE=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),VE={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function Cm(r,e={},{onopen:t=Hs,onend:s=Hs,onclose:n=Hs}={}){let{ssl:i,max:o,user:a,host:c,port:u,database:l,parsers:h,transform:f,onnotice:p,onnotify:y,onparameter:g,max_pipeline:w,keep_alive:b,backoff:A,target_session_attrs:E}=r,k=St(),U=UE++,V={pid:null,secret:null},I=ql(ia,r.idle_timeout),W=ql(ia,r.max_lifetime),Y=ql(Hm,r.connect_timeout),R=null,Ae,Q=new wr,me=Buffer.alloc(0),Tt=r.fetch_types,ae={},de={},ze=Math.random().toString(36).slice(2),O=1,M=0,te=0,le=0,Oe=0,J=0,fe=0,De=0,Pe=null,Re=null,Ye=!1,be=null,jt=null,We=null,cr=null,Fe=null,ke=null,Nt=null,Mt=null,x=null,Ks=null,Xe={queue:e.closed,idleTimer:I,connect(d){We=d,Xl()},terminate:Gs,execute:Ws,cancel:Mm,end:ia,count:0,id:U};return e.closed&&e.closed.push(Xe),Xe;async function Bm(){let d;try{d=r.socket?await Promise.resolve(r.socket(r)):new Om.Socket}catch(_){rs(_);return}return d.on("error",rs),d.on("close",eh),d.on("drain",Zl),d}async function Mm({pid:d,secret:_},F,ce){try{Ae=B().i32(16).i32(80877102).i32(d).i32(_).end(16),await Yl(),R.once("error",ce),R.once("close",F)}catch(Ie){ce(Ie)}}function Ws(d){if(Ye)return ti(d,Me.connection("CONNECTION_DESTROYED",r));if(!d.cancelled)try{return d.state=V,x?k.push(d):(x=d,x.active=!0),zm(d),Ge(Fm(d))&&!d.describeFirst&&!d.cursorFn&&k.length<w&&(!d.options.onexecute||d.options.onexecute(Xe))}catch(_){return k.length===0&&Ge(br),Ft(_),!0}}function Fm(d){if(d.parameters.length>=65534)throw Me.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return d.options.simple?B().Q().str(d.statement.string+B.N).end():d.describeFirst?Buffer.concat([Gl(d),km]):d.prepare?d.prepared?ei(d):Buffer.concat([Gl(d),ei(d)]):Vm(d)}function Gl(d){return Buffer.concat([rh(d.statement.string,d.parameters,d.statement.types,d.statement.name),xg("S",d.statement.name)])}function ei(d){return Buffer.concat([kg(d.parameters,d.statement.types,d.statement.name,d.cursorName),d.cursorFn?sh("",d.cursorRows):BE])}function Vm(d){return Buffer.concat([rh(d.statement.string,d.parameters,d.statement.types),ME,ei(d)])}function zm(d){let _=[],F=[],ce=Cl(d,d.strings[0],d.args[0],_,F,r);!d.tagged&&d.args.forEach(Ie=>Zo(Ie,_,F,r)),d.prepare=r.prepare&&("prepare"in d.options?d.options.prepare:!0),d.string=ce,d.signature=d.prepare&&F+ce,d.onlyDescribe&&delete de[d.signature],d.parameters=d.parameters||_,d.prepared=d.prepare&&d.signature in de,d.describeFirst=d.onlyDescribe||_.length&&!d.prepared,d.statement=d.prepared?de[d.signature]:{string:ce,types:F,name:d.prepare?ze+O++:""},typeof r.debug=="function"&&r.debug(U,ce,_,F)}function Ge(d,_){return ke=ke?Buffer.concat([ke,d]):Buffer.from(d),_||ke.length>=1024?Ql(_):(Re===null&&(Re=setImmediate(Ql)),!0)}function Ql(d){let _=R.write(ke,d);return Re!==null&&clearImmediate(Re),ke=Re=null,_}function Hm(){Ft(Me.connection("CONNECT_TIMEOUT",r,R)),R.destroy()}async function Jl(){if(Ge(qE),!await new Promise(_=>R.once("data",F=>_(F[0]===83)))&&i==="prefer")return ts();R.removeAllListeners(),R=LE.connect({socket:R,servername:Om.isIP(R.host)?void 0:R.host,...i==="require"||i==="allow"||i==="prefer"?{rejectUnauthorized:!1}:i==="verify-full"?{}:typeof i=="object"?i:{}}),R.on("secureConnect",ts),R.on("error",rs),R.on("close",eh),R.on("drain",Zl)}function Zl(){!x&&t(Xe)}function na(d){if(!(be&&(be.push(d),te-=d.length,te>0)))for(me=be?Buffer.concat(be,J-te):me.length===0?d:Buffer.concat([me,d],me.length+d.length);me.length>4;){if(J=me.readUInt32BE(1),J>=me.length){te=J-me.length,be=[me];break}try{Km(me.subarray(0,J+1))}catch(_){x&&(x.cursorFn||x.describeFirst)&&Ge(br),Ft(_)}me=me.subarray(J+1),te=0,be=null}}async function Yl(){if(Ye=!1,ae={},R||(R=await Bm()),!!R){if(Y.start(),r.socket)return i?Jl():ts();if(R.on("connect",i?Jl:ts),r.path)return R.connect(r.path);R.ssl=i,R.connect(u[le],c[le]),R.host=c[le],R.port=u[le],le=(le+1)%u.length}}function Xl(){setTimeout(Yl,M?M+fe-Rm.now():0)}function ts(){try{de={},Tt=r.fetch_types,ze=Math.random().toString(36).slice(2),O=1,W.start(),R.on("data",na),b&&R.setKeepAlive&&R.setKeepAlive(!0,1e3*b);let d=Pg();Ge(d)}catch(d){rs(d)}}function rs(d){if(!(Xe.queue===e.connecting&&r.host[Oe+1]))for(Ft(d);k.length;)ti(k.shift(),d)}function Ft(d){Fe&&(Fe.destroy(d),Fe=null),x&&ti(x,d),We&&(ti(We,d),We=null)}function ti(d,_){if(d.reserve)return d.reject(_);(!_||typeof _!="object")&&(_=new Error(_)),"query"in _||"parameters"in _||Object.defineProperties(_,{stack:{value:_.stack+d.origin.replace(/.*\n/,`
`),enumerable:r.debug},query:{value:d.string,enumerable:r.debug},parameters:{value:d.parameters,enumerable:r.debug},args:{value:d.args,enumerable:r.debug},types:{value:d.statement&&d.statement.types,enumerable:r.debug}}),d.reject(_)}function ia(){return cr||(!Xe.reserved&&s(Xe),!Xe.reserved&&!We&&!x&&k.length===0?(Gs(),new Promise(d=>R&&R.readyState!=="closed"?R.once("close",d):d())):cr=new Promise(d=>Nt=d))}function Gs(){Ye=!0,(Fe||x||We||k.length)&&rs(Me.connection("CONNECTION_DESTROYED",r)),clearImmediate(Re),R&&(R.removeListener("data",na),R.removeListener("connect",ts),R.readyState==="open"&&R.end(B().X().end())),Nt&&(Nt(),cr=Nt=null)}async function eh(d){if(me=Buffer.alloc(0),te=0,be=null,clearImmediate(Re),R.removeListener("data",na),R.removeListener("connect",ts),I.cancel(),W.cancel(),Y.cancel(),R.removeAllListeners(),R=null,We)return Xl();!d&&(x||k.length)&&rs(Me.connection("CONNECTION_CLOSED",r,R)),M=Rm.now(),d&&r.shared.retries++,fe=(typeof A=="function"?A(r.shared.retries):A)*1e3,n(Xe,Me.connection("CONNECTION_CLOSED",r,R))}function Km(d,_=d[0]){(_===68?Wm:_===100?wg:_===65?pg:_===83?Gm:_===90?Qm:_===67?Jm:_===50?th:_===49?Zm:_===116?Ym:_===84?Xm:_===82?eg:_===110?og:_===75?ag:_===69?dg:_===115?mg:_===51?gg:_===71?yg:_===78?Eg:_===72?_g:_===99?bg:_===73?Sg:_===86?Tg:_===118?Ag:_===87?vg:Og)(d)}function Wm(d){let _=7,F,ce,Ie,et=x.isRaw?new Array(x.statement.columns.length):{};for(let at=0;at<x.statement.columns.length;at++)ce=x.statement.columns[at],F=d.readInt32BE(_),_+=4,Ie=F===-1?null:x.isRaw===!0?d.subarray(_,_+=F):ce.parser===void 0?d.toString("utf8",_,_+=F):ce.parser.array===!0?ce.parser(d.toString("utf8",_+1,_+=F)):ce.parser(d.toString("utf8",_,_+=F)),x.isRaw?et[at]=x.isRaw===!0?Ie:f.value.from?f.value.from(Ie,ce):Ie:et[ce.name]=f.value.from?f.value.from(Ie,ce):Ie;x.forEachFn?x.forEachFn(f.row.from?f.row.from(et):et,Q):Q[De++]=f.row.from?f.row.from(et):et}function Gm(d){let[_,F]=d.toString("utf8",5,d.length-1).split(B.N);ae[_]=F,r.parameters[_]!==F&&(r.parameters[_]=F,g&&g(_,F))}function Qm(d){if(x&&x.options.simple&&x.resolve(jt||Q),x=jt=null,Q=new wr,Y.cancel(),We){if(E){if(!ae.in_hot_standby||!ae.default_transaction_read_only)return hg();if(lg(E,ae))return Gs()}if(Tt)return We.reserve&&(We=null),cg();We&&!We.reserve&&Ws(We),r.shared.retries=Oe=0,We=null;return}for(;k.length&&(x=k.shift())&&(x.active=!0,x.cancelled);)Cm(r).cancel(x.state,x.cancelled.resolve,x.cancelled.reject);x||(Xe.reserved?!Xe.reserved.release&&d[5]===73?cr?Gs():(Xe.reserved=null,t(Xe)):Xe.reserved():cr?Gs():t(Xe))}function Jm(d){De=0;for(let _=d.length-1;_>0;_--)if(d[_]===32&&d[_+1]<58&&Q.count===null&&(Q.count=+d.toString("utf8",_+1,d.length-1)),d[_-1]>=65){Q.command=d.toString("utf8",5,_),Q.state=V;break}if(Ks&&(Ks(),Ks=null),Q.command==="BEGIN"&&o!==1&&!Xe.reserved)return Ft(Me.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"));if(x.options.simple)return th();x.cursorFn&&(Q.count&&x.cursorFn(Q),Ge(br)),x.resolve(Q)}function Zm(){x.parsing=!1}function th(){!Q.statement&&(Q.statement=x.statement),Q.columns=x.statement.columns}function Ym(d){let _=d.readUInt16BE(5);for(let F=0;F<_;++F)!x.statement.types[F]&&(x.statement.types[F]=d.readUInt32BE(7+F*4));x.prepare&&(de[x.signature]=x.statement),x.describeFirst&&!x.onlyDescribe&&(Ge(ei(x)),x.describeFirst=!1)}function Xm(d){Q.command&&(jt=jt||[Q],jt.push(Q=new wr),Q.count=null,x.statement.columns=null);let _=d.readUInt16BE(5),F=7,ce;x.statement.columns=Array(_);for(let Ie=0;Ie<_;++Ie){for(ce=F;d[F++]!==0;);let et=d.readUInt32BE(F),at=d.readUInt16BE(F+4),ur=d.readUInt32BE(F+6);x.statement.columns[Ie]={name:f.column.from?f.column.from(d.toString("utf8",ce,F-1)):d.toString("utf8",ce,F-1),parser:h[ur],table:et,number:at,type:ur},F+=18}if(Q.statement=x.statement,x.onlyDescribe)return x.resolve(x.statement),Ge(br)}async function eg(d,_=d.readUInt32BE(5)){(_===3?tg:_===5?rg:_===10?sg:_===11?ng:_===12?ig:_!==0?Rg:Hs)(d,_)}async function tg(){let d=await oa();Ge(B().p().str(d).z(1).end())}async function rg(d){let _="md5"+await xm(Buffer.concat([Buffer.from(await xm(await oa()+a)),d.subarray(9)]));Ge(B().p().str(_).z(1).end())}async function sg(){Mt=(await Xn.randomBytes(18)).toString("base64"),B().p().str("SCRAM-SHA-256"+B.N);let d=B.i;Ge(B.inc(4).str("n,,n=*,r="+Mt).i32(B.i-d-4,d).end())}async function ng(d){let _=d.toString("utf8",9).split(",").reduce((at,ur)=>(at[ur[0]]=ur.slice(2),at),{}),F=await Xn.pbkdf2Sync(await oa(),Buffer.from(_.s,"base64"),parseInt(_.i),32,"sha256"),ce=await ea(F,"Client Key"),Ie="n=*,r="+Mt+",r="+_.r+",s="+_.s+",i="+_.i+",c=biws,r="+_.r;Pe=(await ea(await ea(F,"Server Key"),Ie)).toString("base64");let et="c=biws,r="+_.r+",p="+HE(ce,Buffer.from(await ea(await zE(ce),Ie))).toString("base64");Ge(B().p().str(et).end())}function ig(d){d.toString("utf8",9).split(B.N,1)[0].slice(2)!==Pe&&(Ft(Me.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),R.destroy())}function oa(){return Promise.resolve(typeof r.pass=="function"?r.pass():r.pass)}function og(){if(Q.statement=x.statement,Q.statement.columns=[],x.onlyDescribe)return x.resolve(x.statement),Ge(br)}function ag(d){V.pid=d.readUInt32BE(5),V.secret=d.readUInt32BE(9)}async function cg(){Tt=!1,(await new Et([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],Ws)).forEach(({oid:_,typarray:F})=>ug(_,F))}function ug(d,_){if(r.parsers[_]&&r.serializers[_])return;let F=r.parsers[d];r.shared.typeArrayMap[d]=_,r.parsers[_]=ce=>Tm(ce,F,_),r.parsers[_].array=!0,r.serializers[_]=ce=>Sm(ce,r.serializers[d],r,_)}function lg(d,_){return d==="read-write"&&_.default_transaction_read_only==="on"||d==="read-only"&&_.default_transaction_read_only==="off"||d==="primary"&&_.in_hot_standby==="on"||d==="standby"&&_.in_hot_standby==="off"||d==="prefer-standby"&&_.in_hot_standby==="off"&&r.host[Oe]}function hg(){let d=new Et([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],Ws,null,{simple:!0});d.resolve=([[_],[F]])=>{ae.default_transaction_read_only=_.transaction_read_only,ae.in_hot_standby=F.pg_is_in_recovery?"on":"off"},d.execute()}function dg(d){x&&(x.cursorFn||x.describeFirst)&&Ge(br);let _=Me.postgres(Ul(d));x&&x.retried?Ft(x.retried):x&&x.prepared&&FE.has(_.routine)?fg(x,_):Ft(_)}function fg(d,_){delete de[d.signature],d.retried=_,Ws(d)}function pg(d){if(!y)return;let _=9;for(;d[_++]!==0;);y(d.toString("utf8",9,_-1),d.toString("utf8",_,d.length-1))}async function mg(){try{let d=await Promise.resolve(x.cursorFn(Q));De=0,d===Vs?Ge(Cg(x.portal)):(Q=new wr,Ge(sh("",x.cursorRows)))}catch(d){Ge(br),x.reject(d)}}function gg(){Q.count&&x.cursorFn(Q),x.resolve(Q)}function yg(){Fe=new Ll.Writable({autoDestroy:!0,write(d,_,F){R.write(B().d().raw(d).end(),F)},destroy(d,_){_(d),R.write(B().f().str(d+B.N).end()),Fe=null},final(d){R.write(B().c().end()),Ks=d}}),x.resolve(Fe)}function _g(){Fe=new Ll.Readable({read(){R.resume()}}),x.resolve(Fe)}function vg(){Fe=new Ll.Duplex({autoDestroy:!0,read(){R.resume()},write(d,_,F){R.write(B().d().raw(d).end(),F)},destroy(d,_){_(d),R.write(B().f().str(d+B.N).end()),Fe=null},final(d){R.write(B().c().end()),Ks=d}}),x.resolve(Fe)}function wg(d){Fe&&(Fe.push(d.subarray(5))||R.pause())}function bg(){Fe&&Fe.push(null),Fe=null}function Eg(d){p?p(Ul(d)):console.log(Ul(d))}function Sg(){}function Tg(){Ft(Me.notSupported("FunctionCallResponse"))}function Ag(){Ft(Me.notSupported("NegotiateProtocolVersion"))}function Og(d){console.error("Postgres.js : Unknown Message:",d[0])}function Rg(d,_){console.error("Postgres.js : Unknown Auth:",_)}function kg(d,_,F="",ce=""){let Ie,et;return B().B().str(ce+B.N).str(F+B.N).i16(0).i16(d.length),d.forEach((at,ur)=>{if(at===null)return B.i32(4294967295);et=_[ur],d[ur]=at=et in r.serializers?r.serializers[et](at):""+at,Ie=B.i,B.inc(4).str(at).i32(B.i-Ie-4,Ie)}),B.i16(0),B.end()}function rh(d,_,F,ce=""){return B().P().str(ce+B.N).str(d+B.N).i16(_.length),_.forEach((Ie,et)=>B.i32(F[et]||0)),B.end()}function xg(d,_=""){return B().D().str(d).str(_+B.N).end()}function sh(d="",_=0){return Buffer.concat([B().E().str(d+B.N).i32(_).end(),km])}function Cg(d=""){return Buffer.concat([B().C().str("P").str(d+B.N).end(),B().S().end()])}function Pg(){return Ae||B().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:a,database:l,client_encoding:"UTF8"},r.connection)).filter(([,d])=>d).map(([d,_])=>d+B.N+_).join(B.N)).z(2).end(0)}}function Ul(r){let e={},t=5;for(let s=5;s<r.length-1;s++)r[s]===0&&(e[VE[r[t]]]=r.toString("utf8",t+1,s),t=s+1);return e}function xm(r){return Xn.createHash("md5").update(r).digest("hex")}function ea(r,e){return Xn.createHmac("sha256",r).update(e).digest()}function zE(r){return Xn.createHash("sha256").update(r).digest()}function HE(r,e){let t=Math.max(r.length,e.length),s=Buffer.allocUnsafe(t);for(let n=0;n<t;n++)s[n]=r[n]^e[n];return s}function ql(r,e){if(e=typeof e=="function"?e():e,!e)return{cancel:Hs,start:Hs};let t;return{cancel(){t&&(clearTimeout(t),t=null)},start(){t&&clearTimeout(t),t=setTimeout(s,e*1e3,arguments)}};function s(n){r.apply(null,n),t=null}}var Pm=()=>{};function Ml(r,e){let t=new Map,s="postgresjs_"+Math.random().toString(36).slice(2),n={},i,o,a=!1,c=h.sql=r({...e,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...e.connection,replication:"database"},onclose:async function(){a||(o=null,n.pid=n.secret=void 0,f(await p(c,s,e.publications)),t.forEach(g=>g.forEach(({onsubscribe:w})=>w())))},no_subscribe:!0}),u=c.end,l=c.close;return c.end=async()=>(a=!0,o&&await new Promise(g=>(o.once("close",g),o.end())),u()),c.close=async()=>(o&&await new Promise(g=>(o.once("close",g),o.end())),l()),h;async function h(g,w,b=Pm,A=Pm){g=GE(g),i||(i=p(c,s,e.publications));let E={fn:w,onsubscribe:b},k=t.has(g)?t.get(g).add(E):t.set(g,new Set([E])).get(g),U=()=>{k.delete(E),k.size===0&&t.delete(g)};return i.then(V=>(f(V),b(),o&&o.on("error",A),{unsubscribe:U,state:n,sql:c}))}function f(g){o=g.stream,n.pid=g.state.pid,n.secret=g.state.secret}async function p(g,w,b){if(!b)throw new Error("Missing publication names");let A=await g.unsafe(`CREATE_REPLICATION_SLOT ${w} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[E]=A,k=await g.unsafe(`START_REPLICATION SLOT ${w} LOGICAL ${E.consistent_point} (proto_version '1', publication_names '${b}')`).writable(),U={lsn:Buffer.concat(E.consistent_point.split("/").map(R=>Buffer.from(("00000000"+R).slice(-8),"hex")))};return k.on("data",I),k.on("error",V),k.on("close",g.close),{stream:k,state:A.state};function V(R){console.error("Unexpected error during logical streaming - reconnecting",R)}function I(R){R[0]===119?WE(R.subarray(25),U,g.options.parsers,W,e.transform):R[0]===107&&R[17]&&(U.lsn=R.subarray(1,9),Y())}function W(R,Ae){let Q=Ae.relation.schema+"."+Ae.relation.table;y("*",R,Ae),y("*:"+Q,R,Ae),Ae.relation.keys.length&&y("*:"+Q+"="+Ae.relation.keys.map(me=>R[me.name]),R,Ae),y(Ae.command,R,Ae),y(Ae.command+":"+Q,R,Ae),Ae.relation.keys.length&&y(Ae.command+":"+Q+"="+Ae.relation.keys.map(me=>R[me.name]),R,Ae)}function Y(){let R=Buffer.alloc(34);R[0]=114,R.fill(U.lsn,1),R.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),k.write(R)}}function y(g,w,b){t.has(g)&&t.get(g).forEach(({fn:A})=>A(w,b,g))}}function KE(r){return new Date(Date.UTC(2e3,0,1)+Number(r/BigInt(1e3)))}function WE(r,e,t,s,n){let i=(o,[a,c])=>(o[a.charCodeAt(0)]=c,o);Object.entries({R:o=>{let a=1,c=e[o.readUInt32BE(a)]={schema:o.toString("utf8",a+=4,a=o.indexOf(0,a))||"pg_catalog",table:o.toString("utf8",a+1,a=o.indexOf(0,a+1)),columns:Array(o.readUInt16BE(a+=2)),keys:[]};a+=2;let u=0,l;for(;a<o.length;)l=c.columns[u++]={key:o[a++],name:n.column.from?n.column.from(o.toString("utf8",a,a=o.indexOf(0,a))):o.toString("utf8",a,a=o.indexOf(0,a)),type:o.readUInt32BE(a+=1),parser:t[o.readUInt32BE(a)],atttypmod:o.readUInt32BE(a+=4)},l.key&&c.keys.push(l),a+=4},Y:()=>{},O:()=>{},B:o=>{e.date=KE(o.readBigInt64BE(9)),e.lsn=o.subarray(1,9)},I:o=>{let a=1,c=e[o.readUInt32BE(a)],{row:u}=ta(o,c.columns,a+=7,n);s(u,{command:"insert",relation:c})},D:o=>{let a=1,c=e[o.readUInt32BE(a)];a+=4;let u=o[a]===75;s(u||o[a]===79?ta(o,c.columns,a+=3,n).row:null,{command:"delete",relation:c,key:u})},U:o=>{let a=1,c=e[o.readUInt32BE(a)];a+=4;let u=o[a]===75,l=u||o[a]===79?ta(o,c.columns,a+=3,n):null;l&&(a=l.i);let{row:h}=ta(o,c.columns,a+3,n);s(h,{command:"update",relation:c,key:u,old:l&&l.row})},T:()=>{},C:()=>{}}).reduce(i,{})[r[0]](r)}function ta(r,e,t,s){let n,i,o,a=s.raw?new Array(e.length):{};for(let c=0;c<e.length;c++)n=r[t++],i=e[c],o=n===110?null:n===117?void 0:i.parser===void 0?r.toString("utf8",t+4,t+=4+r.readUInt32BE(t)):i.parser.array===!0?i.parser(r.toString("utf8",t+5,t+=4+r.readUInt32BE(t))):i.parser(r.toString("utf8",t+4,t+=4+r.readUInt32BE(t))),s.raw?a[c]=s.raw===!0?o:s.value.from?s.value.from(o,i):o:a[i.name]=s.value.from?s.value.from(o,i):o;return{i:t,row:s.row.from?s.row.from(a):a}}function GE(r){let e=r.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!e)throw new Error("Malformed subscribe pattern: "+r);let[,t,s,n]=e;return(t||"*")+(s?":"+(s.indexOf(".")===-1?"public."+s:s):"")+(n?"="+n:"")}import jm from"stream";function Fl(r,e,t=393216){return new Promise(async(s,n)=>{await r.begin(async i=>{let o;!e&&([{oid:e}]=await i`select lo_creat(-1) as oid`);let[{fd:a}]=await i`select lo_open(${e}, ${t}) as fd`,c={writable:l,readable:u,close:()=>i`select lo_close(${a})`.then(o),tell:()=>i`select lo_tell64(${a})`,read:h=>i`select loread(${a}, ${h}) as data`,write:h=>i`select lowrite(${a}, ${h})`,truncate:h=>i`select lo_truncate64(${a}, ${h})`,seek:(h,f=0)=>i`select lo_lseek64(${a}, ${h}, ${f})`,size:()=>i`
          select
            lo_lseek64(${a}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return s(c),new Promise(async h=>o=h);async function u({highWaterMark:h=2048*8,start:f=0,end:p=1/0}={}){let y=p-f;return f&&await c.seek(f),new jm.Readable({highWaterMark:h,async read(g){let w=g>y?g-y:g;y-=g;let[{data:b}]=await c.read(w);this.push(b),b.length<g&&this.push(null)}})}async function l({highWaterMark:h=2048*8,start:f=0}={}){return f&&await c.seek(f),new jm.Writable({highWaterMark:h,write(p,y,g){c.write(p).then(()=>g(),g)}})}}).catch(n)})}Object.assign(ra,{PostgresError:Zr,toPascal:Xr,pascal:$l,toCamel:Yr,camel:Il,toKebab:es,kebab:Dl,fromPascal:Zn,fromCamel:Jn,fromKebab:Yn,BigInt:{to:20,from:[20],parse:r=>BigInt(r),serialize:r=>r.toString()}});var Nm=ra;function ra(r,e){let t=ZE(r,e),s=t.no_subscribe||Ml(ra,{...t}),n=!1,i=St(),o=St(),a=St(),c=St(),u=St(),l=St(),h=St(),f=St(),p={connecting:o,reserved:a,closed:c,ended:u,open:l,busy:h,full:f},y=[...Array(t.max)].map(()=>Bl(t,p,{onopen:de,onend:ae,onclose:ze})),g=w(W);return Object.assign(g,{get parameters(){return t.parameters},largeObject:Fl.bind(null,g),subscribe:s,CLOSE:Vs,END:Vs,PostgresError:Zr,options:t,reserve:E,listen:b,begin:k,close:Q,end:Ae}),g;function w(O){return O.debug=t.debug,Object.entries(t.types).reduce((J,[fe,De])=>(J[fe]=Pe=>new Bt(Pe,De.to),J),M),Object.assign(te,{types:M,typed:M,unsafe:le,notify:A,array:I,json:V,file:Oe}),te;function M(J,fe){return new Bt(J,fe)}function te(J,...fe){return J&&Array.isArray(J.raw)?new Et(J,fe,O,R):typeof J=="string"&&!fe.length?new zs(t.transform.column.to?t.transform.column.to(J):J):new Qn(J,fe)}function le(J,fe=[],De={}){return arguments.length===2&&!Array.isArray(fe)&&(De=fe,fe=[]),new Et([J],fe,O,R,{prepare:!1,...De,simple:"simple"in De?De.simple:fe.length===0})}function Oe(J,fe=[],De={}){return arguments.length===2&&!Array.isArray(fe)&&(De=fe,fe=[]),new Et([],fe,Re=>{JE.readFile(J,"utf8",(Ye,be)=>{if(Ye)return Re.reject(Ye);Re.strings=[be],O(Re)})},R,{...De,simple:"simple"in De?De.simple:fe.length===0})}}async function b(O,M,te){let le={fn:M,onlisten:te},Oe=b.sql||(b.sql=ra({...t,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(b.channels).forEach(([Re,{listeners:Ye}])=>{delete b.channels[Re],Promise.all(Ye.map(be=>b(Re,be.fn,be.onlisten).catch(()=>{})))})},onnotify(Re,Ye){Re in b.channels&&b.channels[Re].listeners.forEach(be=>be.fn(Ye))}})),J=b.channels||(b.channels={});if(O in J){J[O].listeners.push(le);let Re=await J[O].result;return le.onlisten&&le.onlisten(),{state:Re.state,unlisten:Pe}}J[O]={result:Oe`listen ${Oe.unsafe('"'+O.replace(/"/g,'""')+'"')}`,listeners:[le]};let De=await J[O].result;return le.onlisten&&le.onlisten(),{state:De.state,unlisten:Pe};async function Pe(){if(O in J&&(J[O].listeners=J[O].listeners.filter(Re=>Re!==le),!J[O].listeners.length))return delete J[O],Oe`unlisten ${Oe.unsafe('"'+O.replace(/"/g,'""')+'"')}`}}async function A(O,M){return await g`select pg_notify(${O}, ${""+M})`}async function E(){let O=St(),M=l.length?l.shift():await new Promise((Oe,J)=>{let fe={reserve:Oe,reject:J};i.push(fe),c.length&&Tt(c.shift(),fe)});U(M,a),M.reserved=()=>O.length?M.execute(O.shift()):U(M,a),M.reserved.release=!0;let te=w(le);return te.release=()=>{M.reserved=null,de(M)},te;function le(Oe){M.queue===f?O.push(Oe):M.execute(Oe)||U(M,f)}}async function k(O,M){!M&&(M=O,O="");let te=St(),le=0,Oe,J=null;try{return await g.unsafe("begin "+O.replace(/[^a-z ]/ig,""),[],{onexecute:De}).execute(),await Promise.race([fe(Oe,M),new Promise((Pe,Re)=>Oe.onclose=Re)])}catch(Pe){throw Pe}async function fe(Pe,Re,Ye){let be=w(Fe);be.savepoint=cr,be.prepare=ke=>J=ke.replace(/[^a-z0-9$-_. ]/gi);let jt,We;Ye&&await be`savepoint ${be(Ye)}`;try{if(We=await new Promise((ke,Nt)=>{let Mt=Re(be);Promise.resolve(Array.isArray(Mt)?Promise.all(Mt):Mt).then(ke,Nt)}),jt)throw jt}catch(ke){throw await(Ye?be`rollback to ${be(Ye)}`:be`rollback`),ke instanceof Zr&&ke.code==="25P02"&&jt||ke}return Ye||(J?await be`prepare transaction '${be.unsafe(J)}'`:await be`commit`),We;function cr(ke,Nt){return ke&&Array.isArray(ke.raw)?cr(Mt=>Mt.apply(Mt,arguments)):(arguments.length===1&&(Nt=ke,ke=null),fe(Pe,Nt,"s"+le+++(ke?"_"+ke:"")))}function Fe(ke){ke.catch(Nt=>jt||(jt=Nt)),Pe.queue===f?te.push(ke):Pe.execute(ke)||U(Pe,f)}}function De(Pe){Oe=Pe,U(Pe,a),Pe.reserved=()=>te.length?Pe.execute(te.shift()):U(Pe,a)}}function U(O,M){return O.queue.remove(O),M.push(O),O.queue=M,M===l?O.idleTimer.start():O.idleTimer.cancel(),O}function V(O){return new Bt(O,3802)}function I(O,M){return Array.isArray(O)?new Bt(O,M||(O.length?Jo(O)||25:0),t.shared.typeArrayMap):I(Array.from(arguments))}function W(O){if(n)return O.reject(Me.connection("CONNECTION_ENDED",t,t));if(l.length)return Y(l.shift(),O);if(c.length)return Tt(c.shift(),O);h.length?Y(h.shift(),O):i.push(O)}function Y(O,M){return O.execute(M)?U(O,h):U(O,f)}function R(O){return new Promise((M,te)=>{O.state?O.active?Bl(t).cancel(O.state,M,te):O.cancelled={resolve:M,reject:te}:(i.remove(O),O.cancelled=!0,O.reject(Me.generic("57014","canceling statement due to user request")),M())})}async function Ae({timeout:O=null}={}){if(n)return n;await 1;let M;return n=Promise.race([new Promise(te=>O!==null&&(M=setTimeout(me,O*1e3,te))),Promise.all(y.map(te=>te.end()).concat(b.sql?b.sql.end({timeout:0}):[],s.sql?s.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(M))}async function Q(){await Promise.all(y.map(O=>O.end()))}async function me(O){for(await Promise.all(y.map(M=>M.terminate()));i.length;)i.shift().reject(Me.connection("CONNECTION_DESTROYED",t));O()}function Tt(O,M){return U(O,o),O.connect(M),O}function ae(O){U(O,u)}function de(O){if(i.length===0)return U(O,l);let M=Math.ceil(i.length/(o.length+1)),te=!0;for(;te&&i.length&&M-- >0;){let le=i.shift();if(le.reserve)return le.reserve(O);te=O.execute(le)}te?U(O,h):U(O,f)}function ze(O,M){U(O,c),O.reserved=null,O.onclose&&(O.onclose(M),O.onclose=null),t.onclose&&t.onclose(O.id),i.length&&Tt(O,i.shift())}}function ZE(r,e){if(r&&r.shared)return r;let t=process.env,s=(!r||typeof r=="string"?e:r)||{},{url:n,multihost:i}=rS(r),o=[...n.searchParams].reduce((f,[p,y])=>(f[p]=y,f),{}),a=s.hostname||s.host||i||n.hostname||t.PGHOST||"localhost",c=s.port||n.port||t.PGPORT||5432,u=s.user||s.username||n.username||t.PGUSERNAME||t.PGUSER||sS();s.no_prepare&&(s.prepare=!1),o.sslmode&&(o.ssl=o.sslmode,delete o.sslmode),"timeout"in s&&(console.log("The timeout option is deprecated, use idle_timeout instead"),s.idle_timeout=s.timeout),o.sslrootcert==="system"&&(o.ssl="verify-full");let l=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],h={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:eS,max_pipeline:100,backoff:XE,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(a)?a:a.split(",").map(f=>f.split(":")[0]),port:Array.isArray(c)?c:a.split(",").map(f=>parseInt(f.split(":")[1]||c)),path:s.path||a.indexOf("/")>-1&&a+"/.s.PGSQL."+c,database:s.database||s.db||(n.pathname||"").slice(1)||t.PGDATABASE||u,user:u,pass:s.pass||s.password||n.password||t.PGPASSWORD||"",...Object.entries(h).reduce((f,[p,y])=>{let g=p in s?s[p]:p in o?o[p]==="disable"||o[p]==="false"?!1:o[p]:t["PG"+p.toUpperCase()]||y;return f[p]=typeof g=="string"&&l.includes(p)?+g:g,f},{}),connection:{application_name:t.PGAPPNAME||"postgres.js",...s.connection,...Object.entries(o).reduce((f,[p,y])=>(p in h||(f[p]=y),f),{})},types:s.types||{},target_session_attrs:YE(s,n,t),onnotice:s.onnotice,onnotify:s.onnotify,onclose:s.onclose,onparameter:s.onparameter,socket:s.socket,transform:tS(s.transform||{undefined:void 0}),parameters:{},shared:{retries:0,typeArrayMap:{}},...bm(s.types)}}function YE(r,e,t){let s=r.target_session_attrs||e.searchParams.get("target_session_attrs")||t.PGTARGETSESSIONATTRS;if(!s||["read-write","read-only","primary","standby","prefer-standby"].includes(s))return s;throw new Error("target_session_attrs "+s+" is not supported")}function XE(r){return(.5+Math.random()/2)*Math.min(3**r/100,20)}function eS(){return 60*(30+Math.random()*30)}function tS(r){return{undefined:r.undefined,column:{from:typeof r.column=="function"?r.column:r.column&&r.column.from,to:r.column&&r.column.to},value:{from:typeof r.value=="function"?r.value:r.value&&r.value.from,to:r.value&&r.value.to},row:{from:typeof r.row=="function"?r.row:r.row&&r.row.from,to:r.row&&r.row.to}}}function rS(r){if(!r||typeof r!="string")return{url:{searchParams:new Map}};let e=r;e=e.slice(e.indexOf("://")+3).split(/[?/]/)[0],e=decodeURIComponent(e.slice(e.indexOf("@")+1));let t=new URL(r.replace(e,e.split(",")[0]));return{url:{username:decodeURIComponent(t.username),password:decodeURIComponent(t.password),host:t.host,hostname:t.hostname,port:t.port,pathname:t.pathname,searchParams:t.searchParams},multihost:e.indexOf(",")>-1&&e}}function sS(){try{return QE.userInfo().username}catch{return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}var zl={};aa(zl,{users:()=>Vl});var Vl=yp("users",{id:Bp("id").primaryKey().notNull(),email:Up("email"),createdAt:gl("created_at",{mode:"string"}).notNull().default(m`now()`),updatedAt:gl("updated_at",{mode:"string"}).notNull().default(m`now()`)});var Im=Nm($s.DATABASE_URL,{prepare:!1}),$m={schema:zl,driver:"pg",dbCredentials:{connectionString:$s.DATABASE_URL}},sa;$s.NODE_ENV==="production"?sa=Tl(Im,$m):(global.db||(global.db=Tl(Im,$m)),sa=global.db);var Dm=()=>{try{return performance.now()}catch{}return Date.now()};var Lm=(r,e,t,s,n)=>{let i=r.get("metric");if(!i){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}if(typeof t=="number"){let o=t.toFixed(n||1),a=s?`${e};dur=${o};desc="${s}"`:`${e};dur=${o}`;i.headers.push(a)}else{let o=t?`${e};desc="${t}"`:`${e}`;i.headers.push(o)}},Hl=(r,e,t)=>{let s=r.get("metric");if(!s){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}s.timers.set(e,{description:t,start:Dm()})},Kl=(r,e,t)=>{let s=r.get("metric");if(!s){console.warn("Metrics not initialized! Please add the `timing()` middleware to this route!");return}let n=s.timers.get(e);if(!n){console.warn(`Timer "${e}" does not exist!`);return}let{description:i,start:o}=n,a=Dm()-o;Lm(r,e,a,i,t),s.timers.delete(e)};var nS=new rn().post("/sign-up",Ao("json",qe.object({email:qe.string(),password:qe.string().min(8)})),async r=>{let{email:e,password:t}=r.req.valid("json"),{data:s,error:n}=await kn.auth.signUp({email:e,password:t});if(n||!s?.user?.email)throw console.log(n),new Error(n?.message||"Error while signing up",{cause:n});let i={id:s?.user.id,email:s?.user.email,createdAt:s?.user.created_at,updatedAt:s?.user.updated_at},o=await sa.insert(Vl).values(i).returning();return r.json(o)}).post("/sign-in",Ao("json",qe.object({email:qe.string(),password:qe.string().min(8)})),async r=>{let{email:e,password:t}=r.req.valid("json"),{data:s,error:n}=await kn.auth.signInWithPassword({email:e,password:t});if(n)throw console.error("Error while signing in",n),new It(401,{message:n.message});return Ds(r,"access_token",s?.session.access_token,{...s?.session.expires_at&&{expires:new Date(s.session.expires_at)},httpOnly:!0,path:"/",secure:!0}),Ds(r,"refresh_token",s?.session.refresh_token,{...s?.session.expires_at&&{expires:new Date(s.session.expires_at)},httpOnly:!0,path:"/",secure:!0}),r.json(s.user)}).post("/sign-in-with-provider",Ao("json",qe.object({provider:qe.enum(["google","apple"]),token:qe.string().min(8),accessToken:qe.string().optional()})),async r=>{let{token:e,provider:t,accessToken:s}=r.req.valid("json");Hl(r,"supabase.auth.signInWithProvider");let{data:n,error:i}=await kn.auth.signInWithIdToken({provider:t,token:e,access_token:s});if(Kl(r,"supabase.auth.signInWithProvider"),i)throw console.error("Error while signing in with Provider ",i),new It(401,{message:i.message});return Ds(r,"access_token",n?.session.access_token,{...n?.session.expires_at&&{expires:new Date(n.session.expires_at)},httpOnly:!0,path:"/",secure:!0}),Ds(r,"refresh_token",n?.session.refresh_token,{...n?.session.expires_at&&{expires:new Date(n.session.expires_at)},httpOnly:!0,path:"/",secure:!0}),r.json(n.user)}).get("/refresh",async r=>{let e=To(r,"refresh_token");if(!e)throw new It(403,{message:"No refresh token"});let{data:t,error:s}=await kn.auth.refreshSession({refresh_token:e});if(s)throw console.error("Error while refreshing token",s),new It(403,{message:s.message});return t?.session&&Ds(r,"refresh_token",t.session.refresh_token,{...t.session.expires_at&&{expires:new Date(t.session.expires_at)}}),r.json(t.user)}),Um=nS;var iS=new rn().basePath("/api").route("/auth",Um).onError(Ih),Wl=iS;var qm=3e3;console.log(`Server is running on port - ${qm}`);ph({fetch:Wl.fetch,port:qm});gh(Wl);
